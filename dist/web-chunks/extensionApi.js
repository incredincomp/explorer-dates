var module = { exports: {} }; var exports = module.exports; (function() {
var L=(c,e)=>()=>(e||c((e={exports:{}}).exports,e),e.exports);var u=L((exports,module)=>{var vscode=require("vscode"),isWebRuntime=process.env.VSCODE_WEB==="true",inspectValue=isWebRuntime?c=>{if(typeof c=="string")return c;try{return JSON.stringify(c,null,2)}catch{return"<<unable to serialize log arg>>"}}:eval("require")("util").inspect,DEFAULT_LOG_PROFILE="default",SUPPORTED_PROFILES=new Set(["default","stress","soak"]),LOG_LEVEL_ORDER=["debug","info","warn","error"],DEFAULT_CONSOLE_LEVEL="warn",TEST_CONSOLE_LEVEL=process.env.EXPLORER_DATES_TEST_MODE==="1"?"warn":null,Logger=class{constructor(){this.e=vscode.window.createOutputChannel("Explorer Dates"),this.n=!1,this.t=null,this.s=process.env.EXPLORER_DATES_TEST_MODE==="1",this.i=(process.env.EXPLORER_DATES_LOG_PROFILE||DEFAULT_LOG_PROFILE).toLowerCase(),SUPPORTED_PROFILES.has(this.i)||(this.i=DEFAULT_LOG_PROFILE),this.o=new Map,this.h=DEFAULT_CONSOLE_LEVEL,this.g(),this.t=vscode.workspace.onDidChangeConfiguration(e=>{(e.affectsConfiguration("explorerDates.enableLogging")||e.affectsConfiguration("explorerDates.consoleLogLevel"))&&this.g()})}g(){let e=vscode.workspace.getConfiguration("explorerDates");this.n=e.get("enableLogging",!1);let t=(process.env.EXPLORER_DATES_LOG_LEVEL||"").toLowerCase(),r=(e.get("consoleLogLevel",DEFAULT_CONSOLE_LEVEL)||"").toLowerCase(),i=TEST_CONSOLE_LEVEL||t||r||DEFAULT_CONSOLE_LEVEL;this.h=LOG_LEVEL_ORDER.includes(i)?i:DEFAULT_CONSOLE_LEVEL,TEST_CONSOLE_LEVEL&&(this.n=!1)}setLogProfile(e=DEFAULT_LOG_PROFILE){let t=(e||DEFAULT_LOG_PROFILE).toLowerCase();this.i=SUPPORTED_PROFILES.has(t)?t:DEFAULT_LOG_PROFILE,this.resetThrottle()}resetThrottle(e){if(e){this.o.delete(e);return}this.o.clear()}debug(e,...t){this.n&&this.a("debug",null,e,t)}info(e,...t){this.a("info",null,e,t)}infoWithOptions(e,t,...r){this.a("info",e||null,t,r)}warn(e,...t){this.a("warn",null,e,t)}error(e,t,...r){let o=`[${new Date().toISOString()}] [ERROR] ${e}`;this.s||(this.e.appendLine(o),t instanceof Error?(this.e.appendLine(`Error: ${t.message}`),t.stack&&this.e.appendLine(`Stack: ${t.stack}`)):t&&this.e.appendLine(this.f(t)));let n=this.d(r);n.length>0&&!this.s&&n.forEach(f=>this.e.appendLine(this.f(f)));let a=[];t!=null&&a.push(t),n.length>0&&a.push(...n),this.u("error",o,a)}show(){this.e.show()}clear(){this.e.clear()}dispose(){this.e.dispose(),this.t&&(this.t.dispose(),this.t=null);let e="__explorerDatesLogger";typeof global<"u"&&global[e]===this?global[e]=null:typeof globalThis<"u"&&globalThis[e]===this?globalThis[e]=null:typeof globalThis<"u"&&globalThis.window?.[e]===this&&(globalThis.window[e]=null),loggerInstance===this&&(loggerInstance=null)}a(e,t,r,i){if(e==="debug"&&!this.n||this.p(e,t))return;let n=`[${new Date().toISOString()}] [${e.toUpperCase()}] ${r}`;this.s||this.e.appendLine(n);let a=this.d(i);a.length>0&&!this.s&&a.forEach(f=>this.e.appendLine(this.f(f))),this.u(e,n,a)}d(e){return!e||e.length===0?[]:e.map(t=>{if(typeof t!="function")return t;try{return t()}catch(r){return`<<log arg threw: ${r.message}>>`}})}f(e){try{return typeof e=="string"?e:typeof e=="object"?JSON.stringify(e,null,2):inspectValue(e)}catch(t){return`<<failed to serialize log arg: ${t.message}>>`}}p(e,t){if(e!=="info"||!t||!t.throttleKey)return!1;let r=(t.profile||"stress").toLowerCase();if(!this.D(r))return!1;let i=Number(t.throttleLimit)||50,o=t.throttleKey,n=this.o.get(o)||{count:0,suppressed:0,noticeLogged:!1};if(n.count<i)return n.count+=1,this.o.set(o,n),!1;if(n.suppressed+=1,!n.noticeLogged){n.noticeLogged=!0;let a=`[${new Date().toISOString()}] [INFO] \u23F8\uFE0F Suppressing further logs for "${o}" after ${i} entries (profile=${this.i})`;this.e.appendLine(a),this.u("info",a)}return this.o.set(o,n),!0}D(e){let t=this.i||DEFAULT_LOG_PROFILE;return e==="default"?t===DEFAULT_LOG_PROFILE:t===e}O(e){let t=LOG_LEVEL_ORDER.indexOf(this.h),r=LOG_LEVEL_ORDER.indexOf(e);return t===-1||r===-1?!1:r>=t}u(e,t,r=[]){if(!this.O(e))return;(e==="warn"?console.warn:e==="error"?console.error:console.log).call(console,t,...r)}},GLOBAL_LOGGER_KEY="__explorerDatesLogger";function getLogger(){return typeof global<"u"?(global[GLOBAL_LOGGER_KEY]||(global[GLOBAL_LOGGER_KEY]=new Logger),global[GLOBAL_LOGGER_KEY]):typeof globalThis<"u"?(globalThis[GLOBAL_LOGGER_KEY]||(globalThis[GLOBAL_LOGGER_KEY]=new Logger),globalThis.window&&(globalThis.window[GLOBAL_LOGGER_KEY]=globalThis[GLOBAL_LOGGER_KEY]),globalThis[GLOBAL_LOGGER_KEY]):(loggerInstance||(loggerInstance=new Logger),loggerInstance)}var loggerInstance=null;module.exports={Logger,getLogger}});var p=L((P,E)=>{var l=require("vscode"),{getLogger:O}=u(),s=O(),h=class{constructor(){this.l=new Map}on(e,t){let r=this.l.get(e)||[];return r.push(t),this.l.set(e,r),this}off(e,t){let r=this.l.get(e);if(!r)return this;let i=r.indexOf(t);return i!==-1&&r.splice(i,1),this}emit(e,...t){let r=this.l.get(e);return r&&r.slice().forEach(i=>{try{i(...t)}catch(o){s.error(`Explorer Dates API handler failed for "${e}":`,o)}}),this}},g=class extends h{constructor(){super(),this.plugins=new Map,this.api=null,this.decorationProviders=new Map,this.t=null,this.initialize(),this._()}initialize(){this.api=this.createPublicApi(),s.info("Extension API Manager initialized")}createPublicApi(){return{getFileDecorations:this.getFileDecorations.bind(this),refreshDecorations:this.refreshDecorations.bind(this),registerPlugin:this.registerPlugin.bind(this),unregisterPlugin:this.unregisterPlugin.bind(this),registerDecorationProvider:this.registerDecorationProvider.bind(this),unregisterDecorationProvider:this.unregisterDecorationProvider.bind(this),onDecorationChanged:this.onDecorationChanged.bind(this),onFileScanned:this.onFileScanned.bind(this),formatDate:this.formatDate.bind(this),getFileStats:this.getFileStats.bind(this),version:"1.1.0",apiVersion:"1.0.0"}}async getFileDecorations(e){if(!this.r("getFileDecorations"))return[];try{let t=[];for(let r of e){let i=l.Uri.file(r),o=await this.getDecorationForFile(i);o&&t.push({uri:i.toString(),decoration:o})}return t}catch(t){return s.error("Failed to get file decorations:",t),[]}}async getDecorationForFile(e){if(!this.r("getDecorationForFile"))return null;try{let t=await l.workspace.fs.stat(e),r=new Date(t.mtime),i={badge:this.formatDate(r,"smart"),color:void 0,tooltip:`Modified: ${r.toLocaleString()}`};for(let[o,n]of this.decorationProviders)try{let a=await n.provideDecoration(e,t,i);a&&(i={...i,...a})}catch(a){s.error(`Decoration provider ${o} failed:`,a)}return i}catch(t){return s.error("Failed to get decoration for file:",t),null}}async refreshDecorations(e=null){if(!this.r("refreshDecorations"))return!1;try{return this.emit("decorationRefreshRequested",e),s.info("Decoration refresh requested"),!0}catch(t){return s.error("Failed to refresh decorations:",t),!1}}registerPlugin(e,t){if(!this.c(`registerPlugin:${e}`))return!1;try{if(!this.validatePlugin(t))throw new Error("Invalid plugin structure");return this.plugins.set(e,{...t,registeredAt:new Date,active:!0}),typeof t.activate=="function"&&t.activate(this.api),this.emit("pluginRegistered",{pluginId:e,plugin:t}),s.info(`Plugin registered: ${e}`),!0}catch(r){return s.error(`Failed to register plugin ${e}:`,r),!1}}unregisterPlugin(e){if(!this.c(`unregisterPlugin:${e}`))return!1;try{let t=this.plugins.get(e);return t?(typeof t.deactivate=="function"&&t.deactivate(),this.plugins.delete(e),this.emit("pluginUnregistered",{pluginId:e}),s.info(`Plugin unregistered: ${e}`),!0):!1}catch(t){return s.error(`Failed to unregister plugin ${e}:`,t),!1}}registerDecorationProvider(e,t){if(!this.c(`registerDecorationProvider:${e}`))return!1;try{if(!this.validateDecorationProvider(t))throw new Error("Invalid decoration provider");return this.decorationProviders.set(e,t),this.emit("decorationProviderRegistered",{providerId:e,provider:t}),s.info(`Decoration provider registered: ${e}`),!0}catch(r){return s.error(`Failed to register decoration provider ${e}:`,r),!1}}unregisterDecorationProvider(e){if(!this.c(`unregisterDecorationProvider:${e}`))return!1;try{let t=this.decorationProviders.delete(e);return t&&(this.emit("decorationProviderUnregistered",{providerId:e}),s.info(`Decoration provider unregistered: ${e}`)),t}catch(t){return s.error(`Failed to unregister decoration provider ${e}:`,t),!1}}onDecorationChanged(e){return this.on("decorationChanged",e),()=>this.off("decorationChanged",e)}onFileScanned(e){return this.on("fileScanned",e),()=>this.off("fileScanned",e)}formatDate(e,t=null){if(!this.r("formatDate"))return"";try{let r=l.workspace.getConfiguration("explorerDates"),i=t||r.get("displayFormat","smart"),n=new Date-e,a=Math.floor(n/(1e3*60*60*24));switch(i){case"relative-short":return this.getRelativeTimeShort(n);case"relative-long":return this.getRelativeTimeLong(n);case"absolute-short":return e.toLocaleDateString("en-US",{month:"short",day:"numeric"});case"absolute-long":return e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});case"smart":default:return a<7?this.getRelativeTimeShort(n):e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}catch(r){return s.error("Failed to format date:",r),e.toLocaleDateString()}}async getFileStats(e){if(!this.r("getFileStats"))return null;try{let t=l.Uri.file(e),r=await l.workspace.fs.stat(t);return{path:e,size:r.size,created:new Date(r.ctime),modified:new Date(r.mtime),type:r.type===l.FileType.Directory?"directory":"file"}}catch(t){return s.error("Failed to get file stats:",t),null}}getApi(){return this.api}getRegisteredPlugins(){let e=[];for(let[t,r]of this.plugins)e.push({id:t,name:r.name,version:r.version,author:r.author,active:r.active,registeredAt:r.registeredAt});return e}validatePlugin(e){return!(!e||typeof e!="object"||!e.name||!e.version||e.activate&&typeof e.activate!="function"||e.deactivate&&typeof e.deactivate!="function")}validateDecorationProvider(e){return!(!e||typeof e!="object"||typeof e.provideDecoration!="function")}getRelativeTimeShort(e){let t=Math.floor(e/1e3),r=Math.floor(t/60),i=Math.floor(r/60),o=Math.floor(i/24);if(t<60)return`${t}s`;if(r<60)return`${r}m`;if(i<24)return`${i}h`;if(o<30)return`${o}d`;let n=Math.floor(o/30);return n<12?`${n}mo`:`${Math.floor(n/12)}y`}getRelativeTimeLong(e){let t=Math.floor(e/1e3),r=Math.floor(t/60),i=Math.floor(r/60),o=Math.floor(i/24);if(t<60)return`${t} second${t!==1?"s":""} ago`;if(r<60)return`${r} minute${r!==1?"s":""} ago`;if(i<24)return`${i} hour${i!==1?"s":""} ago`;if(o<30)return`${o} day${o!==1?"s":""} ago`;let n=Math.floor(o/30);if(n<12)return`${n} month${n!==1?"s":""} ago`;let a=Math.floor(n/12);return`${a} year${a!==1?"s":""} ago`}getColorForAge(e){if(!l.workspace.getConfiguration("explorerDates").get("colorCoding",!1))return;let o=(new Date-e)/(1e3*60*60);return o<1?new l.ThemeColor("charts.green"):o<24?new l.ThemeColor("charts.yellow"):o<168?new l.ThemeColor("charts.orange"):new l.ThemeColor("charts.red")}createExamplePlugin(){return{name:"File Size Display",version:"1.0.0",author:"Explorer Dates",description:"Adds file size to decorations",activate:e=>{e.registerDecorationProvider("fileSize",{provideDecoration:async(t,r,i)=>{let o=this.formatFileSize(r.size);return{badge:`${i.badge} \u2022 ${o}`,tooltip:`${i.tooltip}
Size: ${o}`}}}),s.info("File Size Display plugin activated")},deactivate:()=>{s.info("File Size Display plugin deactivated")}}}_(){this.t&&this.t.dispose(),this.t=l.workspace.onDidChangeConfiguration(e=>{(e.affectsConfiguration("explorerDates.enableExtensionApi")||e.affectsConfiguration("explorerDates.allowExternalPlugins"))&&s.info("Explorer Dates API configuration changed",{apiEnabled:this.L(),externalPluginsAllowed:this.E()})})}L(){return l.workspace.getConfiguration("explorerDates").get("enableExtensionApi",!0)}E(){return l.workspace.getConfiguration("explorerDates").get("allowExternalPlugins",!0)}r(e){return this.L()?!0:(s.warn(`Explorer Dates API request "${e}" ignored because enableExtensionApi is disabled.`),!1)}c(e){return this.r(e)?this.E()?!0:(s.warn(`Explorer Dates plugin request "${e}" ignored because allowExternalPlugins is disabled.`),!1):!1}formatFileSize(e){if(e===0)return"0 B";let t=1024,r=["B","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(1))+" "+r[i]}dispose(){this.t&&(this.t.dispose(),this.t=null),this.plugins.clear(),this.decorationProviders.clear(),s.info("Extension API Manager disposed")}};E.exports={ExtensionApiManager:g}});var{ExtensionApiManager:d}=p(),{getLogger:_}=u(),w=_();function D(c){try{let e=new d;return c&&c.subscriptions&&c.subscriptions.push(e),e}catch(e){return w.error("Failed to create Extension API Manager:",e),null}}module.exports={ExtensionApiManager:d,createExtensionApiManager:D,default:{ExtensionApiManager:d,createExtensionApiManager:D}};
})(); (function(){const primaryKey="explorerDatesChunks";const legacyKey="__explorerDatesChunks";const registry=(globalThis[primaryKey]=globalThis[primaryKey]||globalThis[legacyKey]||(globalThis[legacyKey]={}));registry["extensionApi"]=module.exports;})();
