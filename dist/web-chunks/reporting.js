var module = { exports: {} }; var exports = module.exports; (function() {
var m=(o,t)=>()=>(t||o((t={exports:{}}).exports,t),t.exports);var b=m((exports,module)=>{var vscode=require("vscode"),isWebRuntime=process.env.VSCODE_WEB==="true",inspectValue=isWebRuntime?o=>{if(typeof o=="string")return o;try{return JSON.stringify(o,null,2)}catch{return"<<unable to serialize log arg>>"}}:eval("require")("util").inspect,DEFAULT_LOG_PROFILE="default",SUPPORTED_PROFILES=new Set(["default","stress","soak"]),LOG_LEVEL_ORDER=["debug","info","warn","error"],DEFAULT_CONSOLE_LEVEL="warn",TEST_CONSOLE_LEVEL=process.env.EXPLORER_DATES_TEST_MODE==="1"?"warn":null,Logger=class{constructor(){this.t=vscode.window.createOutputChannel("Explorer Dates"),this.d=!1,this.e=null,this.p=process.env.EXPLORER_DATES_TEST_MODE==="1",this.a=(process.env.EXPLORER_DATES_LOG_PROFILE||DEFAULT_LOG_PROFILE).toLowerCase(),SUPPORTED_PROFILES.has(this.a)||(this.a=DEFAULT_LOG_PROFILE),this.c=new Map,this.F=DEFAULT_CONSOLE_LEVEL,this.T(),this.e=vscode.workspace.onDidChangeConfiguration(t=>{(t.affectsConfiguration("explorerDates.enableLogging")||t.affectsConfiguration("explorerDates.consoleLogLevel"))&&this.T()})}T(){let t=vscode.workspace.getConfiguration("explorerDates");this.d=t.get("enableLogging",!1);let e=(process.env.EXPLORER_DATES_LOG_LEVEL||"").toLowerCase(),i=(t.get("consoleLogLevel",DEFAULT_CONSOLE_LEVEL)||"").toLowerCase(),r=TEST_CONSOLE_LEVEL||e||i||DEFAULT_CONSOLE_LEVEL;this.F=LOG_LEVEL_ORDER.includes(r)?r:DEFAULT_CONSOLE_LEVEL,TEST_CONSOLE_LEVEL&&(this.d=!1)}setLogProfile(t=DEFAULT_LOG_PROFILE){let e=(t||DEFAULT_LOG_PROFILE).toLowerCase();this.a=SUPPORTED_PROFILES.has(e)?e:DEFAULT_LOG_PROFILE,this.resetThrottle()}resetThrottle(t){if(t){this.c.delete(t);return}this.c.clear()}debug(t,...e){this.d&&this.m("debug",null,t,e)}info(t,...e){this.m("info",null,t,e)}infoWithOptions(t,e,...i){this.m("info",t||null,e,i)}warn(t,...e){this.m("warn",null,t,e)}error(t,e,...i){let s=`[${new Date().toISOString()}] [ERROR] ${t}`;this.p||(this.t.appendLine(s),e instanceof Error?(this.t.appendLine(`Error: ${e.message}`),e.stack&&this.t.appendLine(`Stack: ${e.stack}`)):e&&this.t.appendLine(this.y(e)));let n=this.S(i);n.length>0&&!this.p&&n.forEach(l=>this.t.appendLine(this.y(l)));let a=[];e!=null&&a.push(e),n.length>0&&a.push(...n),this.E("error",s,a)}show(){this.t.show()}clear(){this.t.clear()}dispose(){this.t.dispose(),this.e&&(this.e.dispose(),this.e=null);let t="__explorerDatesLogger";typeof global<"u"&&global[t]===this?global[t]=null:typeof globalThis<"u"&&globalThis[t]===this?globalThis[t]=null:typeof globalThis<"u"&&globalThis.window?.[t]===this&&(globalThis.window[t]=null),loggerInstance===this&&(loggerInstance=null)}m(t,e,i,r){if(t==="debug"&&!this.d||this.b(t,e))return;let n=`[${new Date().toISOString()}] [${t.toUpperCase()}] ${i}`;this.p||this.t.appendLine(n);let a=this.S(r);a.length>0&&!this.p&&a.forEach(l=>this.t.appendLine(this.y(l))),this.E(t,n,a)}S(t){return!t||t.length===0?[]:t.map(e=>{if(typeof e!="function")return e;try{return e()}catch(i){return`<<log arg threw: ${i.message}>>`}})}y(t){try{return typeof t=="string"?t:typeof t=="object"?JSON.stringify(t,null,2):inspectValue(t)}catch(e){return`<<failed to serialize log arg: ${e.message}>>`}}b(t,e){if(t!=="info"||!e||!e.throttleKey)return!1;let i=(e.profile||"stress").toLowerCase();if(!this.P(i))return!1;let r=Number(e.throttleLimit)||50,s=e.throttleKey,n=this.c.get(s)||{count:0,suppressed:0,noticeLogged:!1};if(n.count<r)return n.count+=1,this.c.set(s,n),!1;if(n.suppressed+=1,!n.noticeLogged){n.noticeLogged=!0;let a=`[${new Date().toISOString()}] [INFO] \u23F8\uFE0F Suppressing further logs for "${s}" after ${r} entries (profile=${this.a})`;this.t.appendLine(a),this.E("info",a)}return this.c.set(s,n),!0}P(t){let e=this.a||DEFAULT_LOG_PROFILE;return t==="default"?e===DEFAULT_LOG_PROFILE:e===t}M(t){let e=LOG_LEVEL_ORDER.indexOf(this.F),i=LOG_LEVEL_ORDER.indexOf(t);return e===-1||i===-1?!1:i>=e}E(t,e,i=[]){if(!this.M(t))return;(t==="warn"?console.warn:t==="error"?console.error:console.log).call(console,e,...i)}},GLOBAL_LOGGER_KEY="__explorerDatesLogger";function getLogger(){return typeof global<"u"?(global[GLOBAL_LOGGER_KEY]||(global[GLOBAL_LOGGER_KEY]=new Logger),global[GLOBAL_LOGGER_KEY]):typeof globalThis<"u"?(globalThis[GLOBAL_LOGGER_KEY]||(globalThis[GLOBAL_LOGGER_KEY]=new Logger),globalThis.window&&(globalThis.window[GLOBAL_LOGGER_KEY]=globalThis[GLOBAL_LOGGER_KEY]),globalThis[GLOBAL_LOGGER_KEY]):(loggerInstance||(loggerInstance=new Logger),loggerInstance)}var loggerInstance=null;module.exports={Logger,getLogger}});var I=m((_t,M)=>{var P=require("vscode");function ot(){try{return P?.env?.uiKind===P?.UIKind?.Web}catch{return!1}}M.exports={isWebEnvironment:ot}});var T=m((At,G)=>{function g(o=""){return o?o.replace(/\\/g,"/"):""}function nt(o=""){let t=g(o);return t?t.split("/").filter(Boolean):[]}function $(o=""){let t=nt(o);return t.length?t[t.length-1]:""}function at(o=""){let t=$(o),e=t.lastIndexOf(".");return e<=0?"":t.substring(e).toLowerCase()}function ct(o=""){let t=g(o),e=t.lastIndexOf("/");return e===-1?"":t.substring(0,e)}function lt(...o){return g(o.filter(Boolean).join("/")).replace(/\/+/g,"/")}function ht(o=""){return g(o).toLowerCase()}function ft(o=""){if(!o)return"";if(typeof o=="string")return o;if(typeof o.fsPath=="string"&&o.fsPath.length>0)return o.fsPath;if(typeof o.path=="string"&&o.path.length>0)return o.path;if(typeof o.toString=="function")try{return o.toString(!0)}catch{return o.toString()}return String(o)}function ut(o="",t=""){let e=g(o),i=g(t);return e&&i.startsWith(e)?i.substring(e.length).replace(/^\/+/,""):i}G.exports={normalizePath:g,getFileName:$,getExtension:at,getDirectory:ct,joinPath:lt,getCacheKey:ht,getUriPath:ft,getRelativePath:ut}});var j=m((Rt,N)=>{var D=class extends Error{constructor(t,e,i={}){super(e),this.code=t,this.context=i,this.name="ExtensionError"}},z={FILE_PERMISSION_DENIED:"FILE_PERMISSION_DENIED",WORKSPACE_TOO_LARGE:"WORKSPACE_TOO_LARGE",CHUNK_LOAD_FAILED:"CHUNK_LOAD_FAILED"};function dt(o){if(!o)return!1;let t=o.code||o?.name;return["EACCES","EPERM","EROFS","NoPermissions"].includes(t)}var S=class extends D{constructor(t,e,i={}){let{recoverable:r=!0,context:s={}}=i;super(z.CHUNK_LOAD_FAILED,`Failed to load ${t}: ${e}`,{chunkName:t,recoverable:r,...s}),this.name="ChunkLoadError",this.chunkName=t,this.recoverable=r}};function pt(o,t,e={}){let i=require("vscode"),{userFacing:r=!0}=e,s=t?.recoverable??!0;r&&!s&&i.window.showErrorMessage(`Explorer Dates: ${o} feature unavailable. Please reinstall or rebuild the extension.`)}N.exports={ExtensionError:D,ERROR_CODES:z,isPermissionError:dt,ChunkLoadError:S,handleChunkFailure:pt}});var v=m((Ct,B)=>{function U(){return typeof performance<"u"&&performance.now&&performance.timeOrigin?Math.floor(performance.timeOrigin+performance.now()):typeof Date=="function"&&Date.now?Date.now():16409952e5}function W(o){return!!(o&&typeof o=="object"&&typeof o.getTime=="function")}function w(o){if(!o||isNaN(o))return"Invalid Date";if(typeof Intl<"u"&&Intl.DateTimeFormat)try{return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(o)}catch{}let t=864e5,e=36e5,i=6e4,r=1e3,s=1970,n=Math.floor(o/t),a=o%t,l=Math.floor(a/e),h=Math.floor(a%e/i),f=Math.floor(a%i/r),y=s+Math.floor(n/365.25),E=Math.floor(n%365.25/30.44)+1,Z=Math.floor(n%30.44)+1,tt=String(Math.min(E,12)).padStart(2,"0"),et=String(Math.min(Z,31)).padStart(2,"0"),it=String(l).padStart(2,"0"),rt=String(h).padStart(2,"0"),st=String(f).padStart(2,"0");return`${tt}/${et}/${y}, ${it}:${rt}:${st}`}function mt(o){if(W(o))return o;let t=typeof Date=="function"&&Date.prototype&&Date.prototype.constructor===Date;if(o==null){if(!t){let e=U();return{getTime:()=>e,toLocaleString:()=>w(e),toString:()=>w(e)}}return new Date}if(typeof o=="number")return t?new Date(o):{getTime:()=>o,toLocaleString:()=>w(o),toString:()=>w(o)};if(typeof o=="string"){let e=0;if(t)e=Date.parse(o);else{let i=parseFloat(o);e=isNaN(i)?0:i}return t?new Date(o):{getTime:()=>e,toLocaleString:()=>w(e),toString:()=>w(e)}}return t?new Date(o):{getTime:()=>0,toLocaleString:()=>"Invalid Date",toString:()=>"Invalid Date"}}B.exports={ensureDate:mt,isDateLike:W,getCurrentTimestamp:U}});var q=m((xt,V)=>{var u=require("vscode"),{isWebEnvironment:gt}=I(),{normalizePath:yt}=T(),{ExtensionError:Et,ERROR_CODES:wt,isPermissionError:Lt}=j(),{ensureDate:O}=v(),K=process.env.VSCODE_WEB==="true",Dt=process.env.EXPLORER_DATES_FORCE_VSCODE_FS==="1",d=null;if(!K&&!Dt)try{d=require("fs").promises}catch{d=null}var F=class{constructor(){this.isWeb=K||gt()}r(t){if(!t)return"";if(typeof t=="string")return t;if(t&&typeof t=="object"&&typeof t.fsPath=="string")return t.fsPath;if(t&&typeof t=="object"&&typeof t.path=="string")return t.path;if(typeof t=="object"){if(typeof t.fsPath=="string")return t.fsPath;if(typeof t.path=="string")return t.path}return String(t)}s(t){if(t&&typeof t=="object"&&typeof t.scheme=="string"&&typeof t.path=="string")return t;if(typeof t=="string")return u.Uri.file(t);if(t&&typeof t=="object"){if(t.uri&&t.uri!==t)try{return this.s(t.uri)}catch{}if(typeof t.fsPath=="string"&&t.fsPath.length>0)return u.Uri.file(t.fsPath);if(typeof t.path=="string"&&t.path.length>0)return u.Uri.file(t.path);if(typeof t.href=="string"&&t.href.length>0)return u.Uri.parse(t.href);if(typeof t.scheme=="string")return u.Uri.from({scheme:t.scheme,authority:t.authority||"",path:t.path||t.fsPath||"",query:t.query||"",fragment:t.fragment||""});if(typeof t.toString=="function")try{let e=t.toString(!0);if(e&&e!=="[object Object]")return u.Uri.parse(e)}catch{let e=t.toString();if(e&&e!=="[object Object]")return u.Uri.parse(e)}}throw new Error(`Unsupported target type: ${typeof t}`)}async stat(t){if(!this.isWeb&&d)return d.stat(this.r(t));let e=this.s(t),i=await u.workspace.fs.stat(e);return{...i,mtime:O(i.mtime),ctime:O(i.ctime),birthtime:O(i.ctime),isFile:()=>i.type===u.FileType.File,isDirectory:()=>i.type===u.FileType.Directory}}async readFile(t,e="utf8"){if(!this.isWeb&&d)return d.readFile(this.r(t),e);let i=this.s(t),r=await u.workspace.fs.readFile(i);return e===null||e==="binary"?r:new TextDecoder(e).decode(r)}async writeFile(t,e,i="utf8"){let r=this.r(t);try{if(!this.isWeb&&d)return d.writeFile(r,e,i);let s=this.s(t),n=typeof e=="string"?new TextEncoder().encode(e):e;await u.workspace.fs.writeFile(s,n)}catch(s){this.v("write file",r,s)}}async mkdir(t,e={recursive:!0}){let i=this.r(t);try{if(!this.isWeb&&d)return d.mkdir(i,e);let r=this.s(t);await u.workspace.fs.createDirectory(r)}catch(r){this.v("create directory",i,r)}}async readdir(t,e={withFileTypes:!1}){if(!this.isWeb&&d)return d.readdir(this.r(t),e);let i=this.s(t),r=await u.workspace.fs.readDirectory(i);return e.withFileTypes?r.map(([s,n])=>({name:s,isDirectory:()=>n===u.FileType.Directory,isFile:()=>n===u.FileType.File})):r.map(([s])=>s)}async delete(t,e={recursive:!1}){if(!this.isWeb&&d){let r=this.r(t);return e.recursive?d.rm?d.rm(r,e):d.rmdir(r,e):d.unlink(r)}let i=this.s(t);await u.workspace.fs.delete(i,e)}async exists(t){try{return await this.stat(t),!0}catch{return!1}}async ensureDirectory(t){let e=yt(this.r(t));await this.mkdir(e,{recursive:!0})}v(t,e,i){throw Lt(i)?new Et(wt.FILE_PERMISSION_DENIED,`Permission denied while attempting to ${t}`,{path:e,code:i.code}):i}},Ft=new F;V.exports={FileSystemAdapter:F,fileSystem:Ft}});var J=m((kt,X)=>{var c=require("vscode"),{getLogger:Tt}=b(),{fileSystem:St}=q(),{getExtension:_,normalizePath:Y}=T(),{ensureDate:A}=v(),p=Tt(),L=process.env.VSCODE_WEB==="true",R=["node_modules",".git","dist","build","out",".vscode-test"],C=["**/*.tmp","**/*.log","**/.git/**","**/node_modules/**"],x=3e3,H=100,vt=2e4,k=class{constructor(){this.fileActivityCache=new Map,this.i=new Map,this.allowedFormats=["json","csv","html","markdown"],this.activityTrackingDays=30,this.activityCutoffMs=null,this.timeTrackingIntegration="none",this.maxTrackedActivityFiles=x,this.excludedFolders=[...R],this.excludedPatterns=[...C],this.O=[],this.e=null,this.l=null,this.g=[],this.h=[],this.o=new Map,this.I=Number(process.env.EXPLORER_DATES_USER_ACTIVITY_TTL_MS||300*1e3),this.n={user:0,watcher:0},this.$=process.env.EXPLORER_DATES_LIGHTWEIGHT_MODE==="1",this.f=!1,this._(),this.G(),this.initialize()}_(){try{let t=c.workspace.getConfiguration("explorerDates"),e=t.get("reportFormats",["json","html"]),i=["json","csv","html","markdown"];this.allowedFormats=Array.from(new Set([...e,...i]));let r=t.get("activityTrackingDays",30);this.activityTrackingDays=Math.max(1,Math.min(365,r)),this.activityCutoffMs=this.activityTrackingDays*24*60*60*1e3,this.timeTrackingIntegration=t.get("timeTrackingIntegration","none"),this.maxTrackedActivityFiles=this.z(t.get("maxTrackedActivityFiles",x)),this.excludedFolders=t.get("excludedFolders",R)||R,this.excludedPatterns=t.get("excludedPatterns",C)||C,this.O=this.excludedPatterns.map(s=>this.N(s)).filter(Boolean)}catch(t){p.error("Failed to load reporting configuration",t)}}G(){this.e&&this.e.dispose(),this.e=c.workspace.onDidChangeConfiguration(t=>{(t.affectsConfiguration("explorerDates.reportFormats")||t.affectsConfiguration("explorerDates.activityTrackingDays")||t.affectsConfiguration("explorerDates.timeTrackingIntegration")||t.affectsConfiguration("explorerDates.maxTrackedActivityFiles")||t.affectsConfiguration("explorerDates.excludedFolders")||t.affectsConfiguration("explorerDates.excludedPatterns")||t.affectsConfiguration("explorerDates.performanceMode"))&&(this._(),this.A(),p.info("Reporting configuration updated",{allowedFormats:this.allowedFormats,activityTrackingDays:this.activityTrackingDays,timeTrackingIntegration:this.timeTrackingIntegration,maxTrackedActivityFiles:this.maxTrackedActivityFiles}))})}async initialize(){try{if(this.R()){this.f=!0,this.w(),this.L(),p.info("Export & Reporting Manager initialized (activity tracking suppressed by performance/lightweight mode)");return}this.f=!1,this.D(),this.A(),p.info("Export & Reporting Manager initialized")}catch(t){p.error("Failed to initialize Export & Reporting Manager:",t)}}startFileWatcher(){if(this.l||this.maxTrackedActivityFiles===0||L){this.maxTrackedActivityFiles===0&&p.info("File activity tracking disabled (maxTrackedActivityFiles=0)"),L&&p.info("Skipping file activity watcher in web environment");return}let t=c.workspace.createFileSystemWatcher("**/*");this.l=t,this.g=[t.onDidChange(e=>this.recordFileActivity(e,"modified",{source:"watcher"})),t.onDidCreate(e=>this.recordFileActivity(e,"created",{source:"watcher"})),t.onDidDelete(e=>this.recordFileActivity(e,"deleted",{source:"watcher"}))]}L(){if(this.g.length){for(let t of this.g)try{t.dispose()}catch{}this.g=[]}if(this.l){try{this.l.dispose()}catch{}this.l=null}}A(){let t=this.R();if(t||this.maxTrackedActivityFiles<=0||L){this.f=t||this.maxTrackedActivityFiles<=0||L,this.L(),this.w(),this.fileActivityCache.clear(),this.i.clear();return}this.f&&(this.f=!1,this.D()),this.D(),this.startFileWatcher(),this.C()}recordFileActivity(t,e,i={}){try{let r=i.source||"system";if(this.maxTrackedActivityFiles===0)return;let s=t?.fsPath||t?.path;if(!s)return;let n=this.u(s);if(!n||!this.j(n))return;let a=this.fileActivityCache.get(n);a?a.path=s:(a={path:s,activities:[]},this.fileActivityCache.set(n,a));let l=new Date;a.activities.push({action:e,timestamp:l,path:s,source:r}),r==="user"&&this.x(n,l.getTime()),this.n[r]===void 0&&(this.n[r]=0),this.n[r]++,this.U(n,a),this.W(n,l.getTime())}catch(r){p.error("Failed to record file activity:",r)}}U(t,e){let i=e?.activities;if(!(!i||i.length===0)){if(this.activityCutoffMs){let r=Date.now()-this.activityCutoffMs;for(;i.length&&i[0].timestamp.getTime()<r;)i.shift()}i.length>H&&i.splice(0,i.length-H),i.length===0&&(this.fileActivityCache.delete(t),this.i.delete(t))}}async generateFileModificationReport(t={}){try{let{format:e="json",timeRange:i="all",includeDeleted:r=!1,outputPath:s=null}=t;if(!this.allowedFormats.includes(e)){let l=`Report format "${e}" is disabled. Allowed formats: ${this.allowedFormats.join(", ")}`;return c.window.showWarningMessage(l),p.warn(l),null}let n=await this.collectFileData(i,r),a=await this.formatReport(n,e);return s&&(await this.saveReport(a,s),c.window.showInformationMessage(`Report saved to ${s}`)),a}catch(e){return p.error("Failed to generate file modification report:",e),c.window.showErrorMessage("Failed to generate report"),null}}async collectFileData(t,e){let i=[],r=c.workspace.workspaceFolders;if(!r)return{files:[],summary:this.createSummary([])};for(let n of r){let a=await this.scanWorkspaceFolder(n.uri,t,e);i.push(...a)}let s=this.createSummary(i);return s.integrationTarget=this.timeTrackingIntegration,s.activityTrackingDays=this.activityTrackingDays,{generatedAt:new Date().toISOString(),workspace:r.map(n=>n.uri.fsPath),timeRange:t,files:i,summary:s}}async scanWorkspaceFolder(t,e,i){let r=[],n=c.workspace.getConfiguration("explorerDates").get("excludedPatterns",[]);try{let a=await c.workspace.fs.readDirectory(t);for(let[l,h]of a){let f=c.Uri.joinPath(t,l),y=c.workspace.asRelativePath(f);if(!this.isExcluded(y,n)){if(h===c.FileType.File){let E=await this.getFileData(f,e);E&&r.push(E)}else if(h===c.FileType.Directory){let E=await this.scanWorkspaceFolder(f,e,i);r.push(...E)}}}if(i&&t.fsPath){let l=this.getDeletedFiles(t.fsPath,e);r.push(...l)}}catch(a){p.error(`Failed to scan folder ${t.fsPath||t.path}:`,a)}return r}async getFileData(t,e){try{let i=await c.workspace.fs.stat(t),r=c.workspace.asRelativePath(t),s=t.fsPath||t.path,n=this.u(s),a=this.fileActivityCache.get(n),l=a?.activities||[],h=this.filterActivitiesByTimeRange(l,e);return{path:r,fullPath:a?.path||s,size:i.size,created:A(i.ctime),modified:A(i.mtime),type:this.getFileType(r),extension:_(r),activities:h,activityCount:h.length,lastActivity:h.length>0?h[h.length-1].timestamp:A(i.mtime)}}catch(i){return p.error(`Failed to get file data for ${t.fsPath||t.path}:`,i),null}}filterActivitiesByTimeRange(t,e){let i=t;if(e!=="all"){let r=new Date,s;switch(e){case"24h":s=new Date(r-1440*60*1e3);break;case"7d":s=new Date(r-10080*60*1e3);break;case"30d":s=new Date(r-720*60*60*1e3);break;case"90d":s=new Date(r-2160*60*60*1e3);break;default:s=null}s&&(i=i.filter(n=>n.timestamp>=s))}if(this.activityCutoffMs){let r=new Date(Date.now()-this.activityCutoffMs);i=i.filter(s=>s.timestamp>=r)}return i}getDeletedFiles(t,e){if(!t)return[];let i=[],r=t?this.u(t):"";for(let[s,n]of this.fileActivityCache.entries()){if(!n?.activities||n.activities.length===0||r&&!s.startsWith(r))continue;let a=n.activities.filter(h=>h.action==="deleted"),l=this.filterActivitiesByTimeRange(a,e);l.length>0&&i.push({path:c.workspace.asRelativePath(n.path||s),fullPath:n.path||s,size:0,created:null,modified:null,type:"deleted",extension:_(n.path||s),activities:l,activityCount:l.length,lastActivity:l[l.length-1].timestamp})}return i}createSummary(t){let e={totalFiles:t.length,totalSize:t.reduce((r,s)=>r+(s.size||0),0),fileTypes:{},activityByDay:{},mostActiveFiles:[],recentlyModified:[],largestFiles:[],oldestFiles:[],activitySourceBreakdown:{user:this.n.user||0,watcher:this.n.watcher||0}};t.forEach(r=>{let s=r.type||"unknown";e.fileTypes[s]=(e.fileTypes[s]||0)+1});let i=new Date(Date.now()-this.activityTrackingDays*24*60*60*1e3);return t.forEach(r=>{r.activities.forEach(s=>{if(s.timestamp>=i){let n=s.timestamp.toISOString().split("T")[0];e.activityByDay[n]=(e.activityByDay[n]||0)+1}})}),e.mostActiveFiles=t.sort((r,s)=>s.activityCount-r.activityCount).slice(0,10).map(r=>({path:r.path,activityCount:r.activityCount,lastActivity:r.lastActivity})),e.recentlyModified=t.filter(r=>r.modified).sort((r,s)=>s.modified-r.modified).slice(0,20).map(r=>({path:r.path,modified:r.modified,size:r.size})),e.largestFiles=t.sort((r,s)=>(s.size||0)-(r.size||0)).slice(0,10).map(r=>({path:r.path,size:r.size,modified:r.modified})),e.oldestFiles=t.filter(r=>r.modified).sort((r,s)=>r.modified-s.modified).slice(0,10).map(r=>({path:r.path,modified:r.modified,size:r.size})),e}async formatReport(t,e){switch(e.toLowerCase()){case"json":return JSON.stringify(t,null,2);case"csv":return this.formatAsCSV(t);case"html":return this.formatAsHTML(t);case"markdown":return this.formatAsMarkdown(t);default:throw new Error(`Unsupported format: ${e}`)}}formatAsCSV(t){let e=["Path,Size,Created,Modified,Type,Extension,ActivityCount,LastActivity"];return t.files.forEach(i=>{e.push([i.path,i.size||0,i.created?i.created.toISOString():"",i.modified?i.modified.toISOString():"",i.type,i.extension,i.activityCount,i.lastActivity?i.lastActivity.toISOString():""].join(","))}),e.join(`
`)}formatAsHTML(t){return`<!DOCTYPE html>
<html>
<head>
    <title>File Modification Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .summary { background-color: #f9f9f9; padding: 15px; margin: 20px 0; }
        .chart { margin: 20px 0; }
    </style>
</head>
<body>
    <h1>File Modification Report</h1>
    <p>Generated: ${new Date(t.generatedAt).toLocaleString()}</p>
    
    <div class="summary">
        <h2>Summary</h2>
        <p><strong>Total Files:</strong> ${t.summary.totalFiles}</p>
        <p><strong>Total Size:</strong> ${this.formatFileSize(t.summary.totalSize)}</p>
        <p><strong>Time Range:</strong> ${t.timeRange}</p>
    </div>
    
    <h2>File Types</h2>
    <table>
        <tr><th>Type</th><th>Count</th></tr>
        ${Object.entries(t.summary.fileTypes).map(([e,i])=>`<tr><td>${e}</td><td>${i}</td></tr>`).join("")}
    </table>
    
    <h2>Most Active Files</h2>
    <table>
        <tr><th>Path</th><th>Activity Count</th><th>Last Activity</th></tr>
        ${t.summary.mostActiveFiles.map(e=>`<tr><td>${e.path}</td><td>${e.activityCount}</td><td>${new Date(e.lastActivity).toLocaleString()}</td></tr>`).join("")}
    </table>
    
    <h2>All Files</h2>
    <table>
        <tr><th>Path</th><th>Size</th><th>Modified</th><th>Type</th><th>Activity Count</th></tr>
        ${t.files.map(e=>`<tr>
                <td>${e.path}</td>
                <td>${this.formatFileSize(e.size||0)}</td>
                <td>${e.modified?new Date(e.modified).toLocaleString():"N/A"}</td>
                <td>${e.type}</td>
                <td>${e.activityCount}</td>
            </tr>`).join("")}
    </table>
</body>
</html>`}formatAsMarkdown(t){return`# File Modification Report

**Generated:** ${new Date(t.generatedAt).toLocaleString()}
**Time Range:** ${t.timeRange}

## Summary

- **Total Files:** ${t.summary.totalFiles}
- **Total Size:** ${this.formatFileSize(t.summary.totalSize)}

## File Types

| Type | Count |
|------|-------|
${Object.entries(t.summary.fileTypes).map(([e,i])=>`| ${e} | ${i} |`).join(`
`)}

## Most Active Files

| Path | Activity Count | Last Activity |
|------|----------------|---------------|
${t.summary.mostActiveFiles.map(e=>`| ${e.path} | ${e.activityCount} | ${new Date(e.lastActivity).toLocaleString()} |`).join(`
`)}

## Recently Modified Files

| Path | Modified | Size |
|------|----------|------|
${t.summary.recentlyModified.map(e=>`| ${e.path} | ${new Date(e.modified).toLocaleString()} | ${this.formatFileSize(e.size)} |`).join(`
`)}

## All Files

| Path | Size | Modified | Type | Activities |
|------|------|----------|------|------------|
${t.files.map(e=>`| ${e.path} | ${this.formatFileSize(e.size||0)} | ${e.modified?new Date(e.modified).toLocaleString():"N/A"} | ${e.type} | ${e.activityCount} |`).join(`
`)}
`}async saveReport(t,e){try{if(L){let r=encodeURIComponent(t);await c.env.openExternal(c.Uri.parse(`data:text/plain;charset=utf-8,${r}`)),c.window.showInformationMessage("Report download triggered in browser");return}let i=e instanceof c.Uri?e:c.Uri.file(e);await St.writeFile(i,t,"utf8"),p.info(`Report saved to ${i.fsPath||i.path}`)}catch(i){throw p.error("Failed to save report:",i),i}}async exportToTimeTrackingTools(t={}){try{let{tool:e="generic",timeRange:i="7d"}=t,r=await this.collectFileData(i,!1);return this.formatForTimeTracking(r,e)}catch(e){return p.error("Failed to export to time tracking tools:",e),null}}formatForTimeTracking(t,e){let i=[];switch(t.files.forEach(r=>{r.activities.forEach(s=>{i.push({file:r.path,action:s.action,timestamp:s.timestamp,duration:this.estimateSessionDuration(s),project:this.extractProjectName(r.path)})})}),e){case"toggl":return this.formatForToggl(i);case"clockify":return this.formatForClockify(i);case"generic":default:return i}}formatForToggl(t){return t.map(e=>({description:`${e.action}: ${e.file}`,start:e.timestamp.toISOString(),duration:e.duration*60,project:e.project,tags:[e.action,this.getFileType(e.file)]}))}formatForClockify(t){return t.map(e=>({description:`${e.action}: ${e.file}`,start:e.timestamp.toISOString(),end:new Date(e.timestamp.getTime()+e.duration*60*1e3).toISOString(),project:e.project,tags:[e.action,this.getFileType(e.file)]}))}estimateSessionDuration(t){switch(t.action){case"created":return 15;case"modified":return 5;case"deleted":return 1;default:return 5}}extractProjectName(t){return Y(t).split("/")[0]||"Unknown Project"}getFileType(t){let e=_(t);return{".js":"javascript",".ts":"typescript",".py":"python",".java":"java",".cpp":"cpp",".html":"html",".css":"css",".md":"markdown",".json":"json",".xml":"xml",".txt":"text"}[e]||"other"}isExcluded(t,e){return e.some(i=>new RegExp(i.replace(/\*/g,".*")).test(t))}formatFileSize(t){if(t===0)return"0 B";let e=1024,i=["B","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,r)).toFixed(1))+" "+i[r]}async showReportDialog(){try{let t={"\u{1F4CA} Generate Full Report":"full","\u{1F4C5} Last 24 Hours":"24h","\u{1F4C5} Last 7 Days":"7d","\u{1F4C5} Last 30 Days":"30d","\u{1F4C5} Last 90 Days":"90d"},e=await c.window.showQuickPick(Object.keys(t),{placeHolder:"Select report time range"});if(!e)return;let i=t[e],r=["JSON","CSV","HTML","Markdown"],s=await c.window.showQuickPick(r,{placeHolder:"Select report format"});if(!s)return;let n=await c.window.showSaveDialog({defaultUri:c.Uri.file(`file-report.${s.toLowerCase()}`),filters:{[s]:[s.toLowerCase()]}});if(!n)return;await this.generateFileModificationReport({format:s.toLowerCase(),timeRange:i,outputPath:n.fsPath})}catch(t){p.error("Failed to show report dialog:",t),c.window.showErrorMessage("Failed to generate report")}}dispose(){this.e&&(this.e.dispose(),this.e=null),this.L(),this.w(),this.fileActivityCache.clear(),this.i.clear(),this.o.clear(),this.n={user:0,watcher:0},p.info("Export & Reporting Manager disposed")}u(t=""){let e=Y(t||"").trim();return e?e.toLowerCase():""}j(t){if(!t)return!1;for(let e of this.excludedFolders){if(!e)continue;let i=e.replace(/^\/+|\/+$/g,"").toLowerCase();if(!i)continue;let r=`/${i}`;if(t.includes(`${r}/`)||t.endsWith(r))return!1}return!this.O.some(e=>e.test(t))}N(t){if(!t||typeof t!="string")return null;let e=t.replace(/([.+^${}()|[\]\\])/g,"\\$1").replace(/\\\*\\\*/g,".*").replace(/\\\*/g,"[^/]*").replace(/\\\?/g,".");try{return new RegExp(e,"i")}catch{return null}}W(t,e){t&&(this.i.has(t)&&this.i.delete(t),this.i.set(t,e),this.C())}C(){if(this.maxTrackedActivityFiles<=0){this.fileActivityCache.clear(),this.i.clear();return}for(;this.i.size>this.maxTrackedActivityFiles;){let t=this.i.keys().next();if(t.done)break;let e=t.value;this.i.delete(e),this.fileActivityCache.delete(e)}}z(t){let e=Number(t);return Number.isFinite(e)?e<=0?0:Math.min(Math.max(Math.floor(e),500),vt):x}R(){return c.workspace.getConfiguration("explorerDates").get("performanceMode",!1)||this.$}D(){if(this.h.length>0)return;let t=c.workspace||{},e=(h,f)=>typeof h!="function"?null:h.call(t,f),i=[],r=e(t.onDidSaveTextDocument,h=>{this.recordFileActivity(h.uri,"modified",{source:"user"})});r&&i.push(r);let s=e(t.onDidChangeTextDocument,h=>{let f=h?.document;if(!f)return;let y=this.u(f.uri.fsPath||f.uri.path||"");y&&this.x(y,Date.now())});s&&i.push(s);let n=e(t.onDidCreateFiles,h=>{h?.files?.forEach(f=>this.recordFileActivity(f,"created",{source:"user"}))});n&&i.push(n);let a=e(t.onDidDeleteFiles,h=>{h?.files?.forEach(f=>this.recordFileActivity(f,"deleted",{source:"user"}))});a&&i.push(a);let l=e(t.onDidRenameFiles,h=>{h?.files?.forEach(f=>{this.recordFileActivity(f.oldUri,"deleted",{source:"user"}),this.recordFileActivity(f.newUri,"created",{source:"user"})})});l&&i.push(l),i.length>0&&(this.h=i)}w(){if(this.h.length){for(let t of this.h)try{t.dispose()}catch{}this.h=[],this.o.clear()}}x(t,e){t&&(this.k(),this.o.set(t,e||Date.now()))}k(){if(!this.o.size)return;let t=Date.now();for(let[e,i]of this.o.entries())t-i>this.I&&this.o.delete(e)}B(t){return this.k(),this.o.has(t)?!0:!!(Array.isArray(c.workspace?.textDocuments)?c.workspace.textDocuments:[]).find(r=>(r?.uri?this.u(r.uri.fsPath||r.uri.path):"")===t)}};X.exports={ExportReportingManager:k}});var{ExportReportingManager:Q}=J();module.exports={ExportReportingManager:Q,createExportReportingManager:o=>new Q(o)};
})(); (function(){const primaryKey="explorerDatesChunks";const legacyKey="__explorerDatesChunks";const registry=(globalThis[primaryKey]=globalThis[primaryKey]||globalThis[legacyKey]||(globalThis[legacyKey]={}));registry["reporting"]=module.exports;})();
