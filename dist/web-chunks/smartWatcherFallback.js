var module = { exports: {} }; var exports = module.exports; (function() {
var f=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var g=f((exports,module)=>{var vscode=require("vscode"),isWebRuntime=process.env.VSCODE_WEB==="true",inspectValue=isWebRuntime?s=>{if(typeof s=="string")return s;try{return JSON.stringify(s,null,2)}catch{return"<<unable to serialize log arg>>"}}:eval("require")("util").inspect,DEFAULT_LOG_PROFILE="default",SUPPORTED_PROFILES=new Set(["default","stress","soak"]),LOG_LEVEL_ORDER=["debug","info","warn","error"],DEFAULT_CONSOLE_LEVEL="warn",Logger=class{constructor(){this.e=vscode.window.createOutputChannel("Explorer Dates"),this.u=!1,this.c=null,this.r=(process.env.EXPLORER_DATES_LOG_PROFILE||DEFAULT_LOG_PROFILE).toLowerCase(),SUPPORTED_PROFILES.has(this.r)||(this.r=DEFAULT_LOG_PROFILE),this.n=new Map,this.w=DEFAULT_CONSOLE_LEVEL,this.O(),this.c=vscode.workspace.onDidChangeConfiguration(t=>{(t.affectsConfiguration("explorerDates.enableLogging")||t.affectsConfiguration("explorerDates.consoleLogLevel"))&&this.O()})}O(){let t=vscode.workspace.getConfiguration("explorerDates");this.u=t.get("enableLogging",!1);let e=(t.get("consoleLogLevel",DEFAULT_CONSOLE_LEVEL)||"").toLowerCase();this.w=LOG_LEVEL_ORDER.includes(e)?e:DEFAULT_CONSOLE_LEVEL}setLogProfile(t=DEFAULT_LOG_PROFILE){let e=(t||DEFAULT_LOG_PROFILE).toLowerCase();this.r=SUPPORTED_PROFILES.has(e)?e:DEFAULT_LOG_PROFILE,this.resetThrottle()}resetThrottle(t){if(t){this.n.delete(t);return}this.n.clear()}debug(t,...e){this.u&&this.h("debug",null,t,e)}info(t,...e){this.h("info",null,t,e)}infoWithOptions(t,e,...i){this.h("info",t||null,e,i)}warn(t,...e){this.h("warn",null,t,e)}error(t,e,...i){let n=`[${new Date().toISOString()}] [ERROR] ${t}`;this.e.appendLine(n),e instanceof Error?(this.e.appendLine(`Error: ${e.message}`),e.stack&&this.e.appendLine(`Stack: ${e.stack}`)):e&&this.e.appendLine(this.f(e));let r=this.y(i);r.length>0&&r.forEach(c=>this.e.appendLine(this.f(c))),this.g("error",n,[e,...r])}show(){this.e.show()}clear(){this.e.clear()}dispose(){this.e.dispose(),this.c&&(this.c.dispose(),this.c=null),loggerInstance===this&&(loggerInstance=null)}h(t,e,i,o){if(t==="debug"&&!this.u||this.S(t,e))return;let r=`[${new Date().toISOString()}] [${t.toUpperCase()}] ${i}`;this.e.appendLine(r);let c=this.y(o);c.length>0&&c.forEach(S=>this.e.appendLine(this.f(S))),this.g(t,r,c)}y(t){return!t||t.length===0?[]:t.map(e=>{if(typeof e!="function")return e;try{return e()}catch(i){return`<<log arg threw: ${i.message}>>`}})}f(t){try{return typeof t=="string"?t:typeof t=="object"?JSON.stringify(t,null,2):inspectValue(t)}catch(e){return`<<failed to serialize log arg: ${e.message}>>`}}S(t,e){if(t!=="info"||!e||!e.throttleKey)return!1;let i=(e.profile||"stress").toLowerCase();if(!this._(i))return!1;let o=Number(e.throttleLimit)||50,n=e.throttleKey,r=this.n.get(n)||{count:0,suppressed:0,noticeLogged:!1};if(r.count<o)return r.count+=1,this.n.set(n,r),!1;if(r.suppressed+=1,!r.noticeLogged){r.noticeLogged=!0;let c=`[${new Date().toISOString()}] [INFO] \u23F8\uFE0F Suppressing further logs for "${n}" after ${o} entries (profile=${this.r})`;this.e.appendLine(c),this.g("info",c)}return this.n.set(n,r),!0}_(t){let e=this.r||DEFAULT_LOG_PROFILE;return t==="default"?e===DEFAULT_LOG_PROFILE:e===t}D(t){let e=LOG_LEVEL_ORDER.indexOf(this.w),i=LOG_LEVEL_ORDER.indexOf(t);return e===-1||i===-1?!1:i>=e}g(t,e,i=[]){if(!this.D(t))return;(t==="warn"?console.warn:t==="error"?console.error:console.log).call(console,e,...i)}},loggerInstance=null;function getLogger(){return loggerInstance||(loggerInstance=new Logger),loggerInstance}module.exports={Logger,getLogger}});var m=f((x,E)=>{function h(s=""){return s?s.replace(/\\/g,"/"):""}function _(s=""){let t=h(s);return t?t.split("/").filter(Boolean):[]}function L(s=""){let t=_(s);return t.length?t[t.length-1]:""}function D(s=""){let t=L(s),e=t.lastIndexOf(".");return e<=0?"":t.substring(e).toLowerCase()}function R(s=""){let t=h(s),e=t.lastIndexOf("/");return e===-1?"":t.substring(0,e)}function F(...s){return h(s.filter(Boolean).join("/")).replace(/\/+/g,"/")}function P(s=""){return h(s).toLowerCase()}function b(s=""){if(!s)return"";if(typeof s=="string")return s;if(typeof s.fsPath=="string"&&s.fsPath.length>0)return s.fsPath;if(typeof s.path=="string"&&s.path.length>0)return s.path;if(typeof s.toString=="function")try{return s.toString(!0)}catch{return s.toString()}return String(s)}function I(s="",t=""){let e=h(s),i=h(t);return e&&i.startsWith(e)?i.substring(e.length).replace(/^\/+/,""):i}E.exports={normalizePath:h,getFileName:L,getExtension:D,getDirectory:R,joinPath:F,getCacheKey:P,getUriPath:b,getRelativePath:I}});var y=f((N,O)=>{var a=require("vscode"),{getLogger:w}=g(),{normalizePath:v}=m(),l=class{constructor(t={}){this.t=t.logger||w(),this.R=t.pattern,this.F=t.pollingInterval||2e3,this.o=new Map,this.s=!1,this.a=null,this.d=new a.EventEmitter,this.p=new a.EventEmitter,this.L=new a.EventEmitter,this.t.warn("Using legacy file watcher fallback - performance may be reduced"),this.P()}get onDidChange(){return this.d.event}get onDidCreate(){return this.p.event}get onDidDelete(){return this.L.event}P(){this.s||this.a||(this.a=setInterval(()=>{this.b().catch(t=>{this.t.debug("Polling error in legacy watcher:",t)})},this.F))}async b(){if(!this.s)try{let t=a.workspace.workspaceFolders||[];for(let e of t)await this.I(e)}catch(t){this.t.debug("Error polling workspace folders:",t)}}async I(t){try{let e=await a.workspace.findFiles(this.R||"**/*","**/node_modules/**",1e3);for(let i of e)await this.v(i)}catch(e){this.t.debug(`Error polling folder ${t.name}:`,e)}}async v(t){if(this.s)return;let e=t.fsPath,i=v(e);try{let n=(await a.workspace.fs.stat(t)).mtime,r=this.o.get(i);r?r.mtime!==n&&(r.mtime=n,this.d.fire(t)):(this.o.set(i,{mtime:n,exists:!0}),this.p.fire(t))}catch{let o=this.o.get(i);o&&o.exists&&(o.exists=!1,this.L.fire(t),this.o.delete(i))}}dispose(){this.s||(this.s=!0,this.a&&(clearInterval(this.a),this.a=null),this.d.dispose(),this.p.dispose(),this.L.dispose(),this.o.clear(),this.t.debug("Legacy file watcher disposed"))}},d=class{constructor(t={}){this.t=t.logger||w(),this.T=t.nativeWatcherTimeout||5e3,this.E=new Set,this.s=!1,this.m=!1}async createWatcherWithFallback(t,e={}){if(this.s)throw new Error("SmartWatcherFallback has been disposed");try{let i=await this.k(t,e);if(i)return this.t.debug(`Native watcher created successfully for pattern: ${t}`),i}catch(i){this.t.debug(`Native watcher failed for pattern ${t}:`,i)}return this.C(t,e)}async k(t){return new Promise((e,i)=>{let o=setTimeout(()=>{i(new Error("Native watcher creation timeout"))},this.T);try{let n=a.workspace.createFileSystemWatcher(t),r=n.onDidChange(()=>{clearTimeout(o),r.dispose(),e(n)});setTimeout(()=>{clearTimeout(o),r.dispose(),e(n)},1e3)}catch(n){clearTimeout(o),i(n)}})}C(t,e){this.m||(this.m=!0,this.t.info("\u{1F504} Smart watcher fallback activated - using legacy polling mode"));let i=new l({pattern:t,logger:this.t,pollingInterval:e.pollingInterval||2e3});return this.E.add(i),i}static platformRequiresFallback(){let t=process.platform,e=process.env.WSL_DISTRO_NAME||process.env.WSLENV,i=a.env.remoteName,o=process.env.DOCKER_CONTAINER;return e||i||o||t==="android"}static async testNativeWatcherSupport(){try{let t=a.workspace.createFileSystemWatcher("**/.vscode-watcher-test-*"),e=!!t;return t.dispose(),e}catch{return!1}}dispose(){if(!this.s){this.s=!0;for(let t of this.E)try{t.dispose()}catch(e){this.t.debug("Error disposing legacy watcher:",e)}this.E.clear(),this.m&&this.t.debug("Smart watcher fallback manager disposed")}}};O.exports={SmartWatcherFallback:d,LegacyFileWatcher:l}});var{SmartWatcherFallback:u,LegacyFileWatcher:T}=y(),{getLogger:k}=g(),p=class{constructor(t={}){this.t=t.logger||k(),this.i=null,this.l=!1}async initialize(){return this.l?this.i:(this.i=new u({logger:this.t}),this.l=!0,this.t.info("\u{1F4E6} Smart watcher fallback chunk loaded on demand (~3-4KB)"),this.i)}async getFallback(){return this.l||await this.initialize(),this.i}static isPlatformFallbackRequired(){return u.platformRequiresFallback()}static async testNativeSupport(){return u.testNativeWatcherSupport()}dispose(){this.i&&(this.i.dispose(),this.i=null),this.l=!1}};module.exports={SmartWatcherFallbackManager:p,SmartWatcherFallback:u,LegacyFileWatcher:T};
})(); (globalThis.__explorerDatesChunks = globalThis.__explorerDatesChunks || {})["smartWatcherFallback"] = module.exports;
