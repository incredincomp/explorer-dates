var module = { exports: {} }; var exports = module.exports; (function() {
var u=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var L=u((exports,module)=>{var vscode=require("vscode"),isWebRuntime=process.env.VSCODE_WEB==="true",inspectValue=isWebRuntime?i=>{if(typeof i=="string")return i;try{return JSON.stringify(i,null,2)}catch{return"<<unable to serialize log arg>>"}}:eval("require")("util").inspect,DEFAULT_LOG_PROFILE="default",SUPPORTED_PROFILES=new Set(["default","stress","soak"]),LOG_LEVEL_ORDER=["debug","info","warn","error"],DEFAULT_CONSOLE_LEVEL="warn",TEST_CONSOLE_LEVEL=process.env.EXPLORER_DATES_TEST_MODE==="1"?"warn":null,Logger=class{constructor(){this.e=vscode.window.createOutputChannel("Explorer Dates"),this.a=!1,this.l=null,this.c=process.env.EXPLORER_DATES_TEST_MODE==="1",this.i=(process.env.EXPLORER_DATES_LOG_PROFILE||DEFAULT_LOG_PROFILE).toLowerCase(),SUPPORTED_PROFILES.has(this.i)||(this.i=DEFAULT_LOG_PROFILE),this.r=new Map,this.O=DEFAULT_CONSOLE_LEVEL,this.w(),this.l=vscode.workspace.onDidChangeConfiguration(e=>{(e.affectsConfiguration("explorerDates.enableLogging")||e.affectsConfiguration("explorerDates.consoleLogLevel"))&&this.w()})}w(){let e=vscode.workspace.getConfiguration("explorerDates");this.a=e.get("enableLogging",!1);let t=(process.env.EXPLORER_DATES_LOG_LEVEL||"").toLowerCase(),s=(e.get("consoleLogLevel",DEFAULT_CONSOLE_LEVEL)||"").toLowerCase(),n=TEST_CONSOLE_LEVEL||t||s||DEFAULT_CONSOLE_LEVEL;this.O=LOG_LEVEL_ORDER.includes(n)?n:DEFAULT_CONSOLE_LEVEL,TEST_CONSOLE_LEVEL&&(this.a=!1)}setLogProfile(e=DEFAULT_LOG_PROFILE){let t=(e||DEFAULT_LOG_PROFILE).toLowerCase();this.i=SUPPORTED_PROFILES.has(t)?t:DEFAULT_LOG_PROFILE,this.resetThrottle()}resetThrottle(e){if(e){this.r.delete(e);return}this.r.clear()}debug(e,...t){this.a&&this.h("debug",null,e,t)}info(e,...t){this.h("info",null,e,t)}infoWithOptions(e,t,...s){this.h("info",e||null,t,s)}warn(e,...t){this.h("warn",null,e,t)}error(e,t,...s){let o=`[${new Date().toISOString()}] [ERROR] ${e}`;this.c||(this.e.appendLine(o),t instanceof Error?(this.e.appendLine(`Error: ${t.message}`),t.stack&&this.e.appendLine(`Stack: ${t.stack}`)):t&&this.e.appendLine(this.f(t)));let r=this.m(s);r.length>0&&!this.c&&r.forEach(f=>this.e.appendLine(this.f(f)));let a=[];t!=null&&a.push(t),r.length>0&&a.push(...r),this.u("error",o,a)}show(){this.e.show()}clear(){this.e.clear()}dispose(){this.e.dispose(),this.l&&(this.l.dispose(),this.l=null);let e="__explorerDatesLogger";typeof global<"u"&&global[e]===this?global[e]=null:typeof globalThis<"u"&&globalThis[e]===this?globalThis[e]=null:typeof globalThis<"u"&&globalThis.window?.[e]===this&&(globalThis.window[e]=null),loggerInstance===this&&(loggerInstance=null)}h(e,t,s,n){if(e==="debug"&&!this.a||this.S(e,t))return;let r=`[${new Date().toISOString()}] [${e.toUpperCase()}] ${s}`;this.c||this.e.appendLine(r);let a=this.m(n);a.length>0&&!this.c&&a.forEach(f=>this.e.appendLine(this.f(f))),this.u(e,r,a)}m(e){return!e||e.length===0?[]:e.map(t=>{if(typeof t!="function")return t;try{return t()}catch(s){return`<<log arg threw: ${s.message}>>`}})}f(e){try{return typeof e=="string"?e:typeof e=="object"?JSON.stringify(e,null,2):inspectValue(e)}catch(t){return`<<failed to serialize log arg: ${t.message}>>`}}S(e,t){if(e!=="info"||!t||!t.throttleKey)return!1;let s=(t.profile||"stress").toLowerCase();if(!this.b(s))return!1;let n=Number(t.throttleLimit)||50,o=t.throttleKey,r=this.r.get(o)||{count:0,suppressed:0,noticeLogged:!1};if(r.count<n)return r.count+=1,this.r.set(o,r),!1;if(r.suppressed+=1,!r.noticeLogged){r.noticeLogged=!0;let a=`[${new Date().toISOString()}] [INFO] \u23F8\uFE0F Suppressing further logs for "${o}" after ${n} entries (profile=${this.i})`;this.e.appendLine(a),this.u("info",a)}return this.r.set(o,r),!0}b(e){let t=this.i||DEFAULT_LOG_PROFILE;return e==="default"?t===DEFAULT_LOG_PROFILE:t===e}R(e){let t=LOG_LEVEL_ORDER.indexOf(this.O),s=LOG_LEVEL_ORDER.indexOf(e);return t===-1||s===-1?!1:s>=t}u(e,t,s=[]){if(!this.R(e))return;(e==="warn"?console.warn:e==="error"?console.error:console.log).call(console,t,...s)}},GLOBAL_LOGGER_KEY="__explorerDatesLogger";function getLogger(){return typeof global<"u"?(global[GLOBAL_LOGGER_KEY]||(global[GLOBAL_LOGGER_KEY]=new Logger),global[GLOBAL_LOGGER_KEY]):typeof globalThis<"u"?(globalThis[GLOBAL_LOGGER_KEY]||(globalThis[GLOBAL_LOGGER_KEY]=new Logger),globalThis.window&&(globalThis.window[GLOBAL_LOGGER_KEY]=globalThis[GLOBAL_LOGGER_KEY]),globalThis[GLOBAL_LOGGER_KEY]):(loggerInstance||(loggerInstance=new Logger),loggerInstance)}var loggerInstance=null;module.exports={Logger,getLogger}});var O=u((C,_)=>{function c(i=""){return i?i.replace(/\\/g,"/"):""}function b(i=""){let e=c(i);return e?e.split("/").filter(Boolean):[]}function p(i=""){let e=b(i);return e.length?e[e.length-1]:""}function R(i=""){let e=p(i),t=e.lastIndexOf(".");return t<=0?"":e.substring(t).toLowerCase()}function T(i=""){let e=c(i),t=e.lastIndexOf("/");return t===-1?"":e.substring(0,t)}function y(...i){return c(i.filter(Boolean).join("/")).replace(/\/+/g,"/")}function D(i=""){return c(i).toLowerCase()}function G(i=""){if(!i)return"";if(typeof i=="string")return i;if(typeof i.fsPath=="string"&&i.fsPath.length>0)return i.fsPath;if(typeof i.path=="string"&&i.path.length>0)return i.path;if(typeof i.toString=="function")try{return i.toString(!0)}catch{return i.toString()}return String(i)}function v(i="",e=""){let t=c(i),s=c(e);return t&&s.startsWith(t)?s.substring(t.length).replace(/^\/+/,""):s}_.exports={normalizePath:c,getFileName:p,getExtension:R,getDirectory:T,joinPath:y,getCacheKey:D,getUriPath:G,getRelativePath:v}});var S=u((N,m)=>{var l=require("vscode"),{getLogger:w}=L(),{normalizePath:P}=O(),h=class{constructor(e={}){this._logger=e.logger||w(),this.T=e.pattern,this.y=e.pollingInterval||2e3,this.n=new Map,this.t=!1,this.o=null,this.L=new l.EventEmitter,this.E=new l.EventEmitter,this.d=new l.EventEmitter,this._logger.warn("Using legacy file watcher fallback - performance may be reduced"),this.D()}get onDidChange(){return this.L.event}get onDidCreate(){return this.E.event}get onDidDelete(){return this.d.event}D(){this.t||this.o||(this.o=setInterval(()=>{this.G().catch(e=>{this._logger.debug("Polling error in legacy watcher:",e)})},this.y))}async G(){if(!this.t)try{let e=l.workspace.workspaceFolders||[];for(let t of e)await this.v(t)}catch(e){this._logger.debug("Error polling workspace folders:",e)}}async v(e){try{let t=await l.workspace.findFiles(this.T||"**/*","**/node_modules/**",1e3);for(let s of t)await this.P(s)}catch(t){this._logger.debug(`Error polling folder ${e.name}:`,t)}}async P(e){if(this.t)return;let t=e.fsPath,s=P(t);try{let o=(await l.workspace.fs.stat(e)).mtime,r=this.n.get(s);r?r.mtime!==o&&(r.mtime=o,this.L.fire(e)):(this.n.set(s,{mtime:o,exists:!0}),this.E.fire(e))}catch{let n=this.n.get(s);n&&n.exists&&(n.exists=!1,this.d.fire(e),this.n.delete(s))}}dispose(){this.t||(this.t=!0,this.o&&(clearInterval(this.o),this.o=null),this.L.dispose(),this.E.dispose(),this.d.dispose(),this.n.clear(),this._logger.debug("Legacy file watcher disposed"))}},E=class{constructor(e={}){this._logger=e.logger||w(),this.F=e.nativeWatcherTimeout||5e3,this.p=new Set,this.t=!1,this._=!1}async createWatcherWithFallback(e,t={}){if(this.t)throw new Error("SmartWatcherFallback has been disposed");try{let s=await this.I(e,t);if(s)return this._logger.debug(`Native watcher created successfully for pattern: ${e}`),s}catch(s){this._logger.debug(`Native watcher failed for pattern ${e}:`,s)}return this.A(e,t)}async I(e){return new Promise((t,s)=>{let n=setTimeout(()=>{s(new Error("Native watcher creation timeout"))},this.F);try{let o=l.workspace.createFileSystemWatcher(e),r=o.onDidChange(()=>{clearTimeout(n),r.dispose(),t(o)});setTimeout(()=>{clearTimeout(n),r.dispose(),t(o)},1e3)}catch(o){clearTimeout(n),s(o)}})}A(e,t){this._||(this._=!0,this._logger.info("\u{1F504} Smart watcher fallback activated - using legacy polling mode"));let s=new h({pattern:e,logger:this._logger,pollingInterval:t.pollingInterval||2e3});return this.p.add(s),s}static platformRequiresFallback(){let e=process.platform,t=process.env.WSL_DISTRO_NAME||process.env.WSLENV,s=l.env.remoteName,n=process.env.DOCKER_CONTAINER;return t||s||n||e==="android"}static async testNativeWatcherSupport(){try{let e=l.workspace.createFileSystemWatcher("**/.vscode-watcher-test-*"),t=!!e;return e.dispose(),t}catch{return!1}}dispose(){if(!this.t){this.t=!0;for(let e of this.p)try{e.dispose()}catch(t){this._logger.debug("Error disposing legacy watcher:",t)}this.p.clear(),this._&&this._logger.debug("Smart watcher fallback manager disposed")}}};m.exports={SmartWatcherFallback:E,LegacyFileWatcher:h}});var{SmartWatcherFallback:g,LegacyFileWatcher:F}=S(),{getLogger:I}=L(),d=class{constructor(e={}){this._logger=e.logger||I(),this.s=null,this.g=!1}async initialize(){return this.g?this.s:(this.s=new g({logger:this._logger}),this.g=!0,this._logger.info("\u{1F4E6} Smart watcher fallback chunk loaded on demand (~3-4KB)"),this.s)}async getFallback(){return this.g||await this.initialize(),this.s}static isPlatformFallbackRequired(){return g.platformRequiresFallback()}static async testNativeSupport(){return g.testNativeWatcherSupport()}dispose(){this.s&&(this.s.dispose(),this.s=null),this.g=!1}};module.exports={SmartWatcherFallbackManager:d,SmartWatcherFallback:g,LegacyFileWatcher:F};
})(); (function(){const primaryKey="explorerDatesChunks";const legacyKey="__explorerDatesChunks";const registry=(globalThis[primaryKey]=globalThis[primaryKey]||globalThis[legacyKey]||(globalThis[legacyKey]={}));registry["smartWatcherFallback"]=module.exports;})();
