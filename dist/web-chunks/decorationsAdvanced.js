var module = { exports: {} }; var exports = module.exports; (function() {
var F=(e,a)=>()=>(a||e((a={exports:{}}).exports,a),a.exports);var f=F((exports,module)=>{var FEATURE_FLAGS_GLOBAL_KEY="__explorerDatesFeatureFlags";function registerFeatureFlagsGlobal(e){if(e)try{typeof globalThis<"u"&&(globalThis[FEATURE_FLAGS_GLOBAL_KEY]=e)}catch{}}function loadFeatureFlagsFallback(){try{let dynamicRequire=typeof eval=="function"?eval("require"):null;if(typeof dynamicRequire=="function")return dynamicRequire("../featureFlags")}catch{}return null}function getFeatureFlagsGlobal(){try{if(typeof globalThis<"u"&&globalThis[FEATURE_FLAGS_GLOBAL_KEY])return globalThis[FEATURE_FLAGS_GLOBAL_KEY]}catch{}return loadFeatureFlagsFallback()}module.exports={FEATURE_FLAGS_GLOBAL_KEY,registerFeatureFlagsGlobal,getFeatureFlagsGlobal}});var s=require("vscode"),{getFeatureFlagsGlobal:k}=f(),r=k();if(!r)throw new Error("Explorer Dates: feature flags bridge unavailable for decorationsAdvanced chunk");function h(e){let a=e._progressiveLoadingJobs;return a instanceof Set||(a=new Set(a&&typeof a[Symbol.iterator]=="function"?a:[]),e._progressiveLoadingJobs=a),a}async function _(e){if(e._performanceMode)return null;if(!e._batchProcessorModule)try{if(e._batchProcessorModule=await r.batchProcessor(),!e._batchProcessorModule)return e._logger?.debug?.("BatchProcessor chunk not available"),null;e._logger?.debug?.("BatchProcessor module loaded dynamically")}catch(a){return e._logger?.error?.("Failed to load BatchProcessor module:",a),null}if(!e._batchProcessor&&e._batchProcessorModule){let a=e._batchProcessorModule.BatchProcessor||e._batchProcessorModule.default?.BatchProcessor;if(!a)return e._logger?.warn?.("BatchProcessor chunk missing BatchProcessor export"),null;e._batchProcessor=new a,e._logger?.debug?.("BatchProcessor instance created")}return e._batchProcessor}function i(e){let a=h(e);if(a.size!==0){if(e._batchProcessor?.cancelBatch)for(let t of a)e._batchProcessor.cancelBatch(t);else e._batchProcessor&&e._logger?.debug?.("BatchProcessor missing cancelBatch, skipping job cancellation");a.clear()}}async function b(e){if(!s.workspace.getConfiguration("explorerDates").get("progressiveLoading",!0)){e._logger?.info?.("Progressive loading disabled via explorerDates.progressiveLoading - BatchProcessor will not be loaded"),e._progressiveLoadingEnabled=!1,e._batchProcessor&&(e._batchProcessor.dispose(),e._batchProcessor=null,e._logger?.debug?.("BatchProcessor disposed due to disabled progressive loading")),i(e);return}if(e._performanceMode){e._logger?.info?.("Progressive loading disabled due to performance mode"),i(e),e._progressiveLoadingEnabled=!1;return}if(!await _(e)){e._logger?.info?.("BatchProcessor not available - progressive loading disabled"),e._progressiveLoadingEnabled=!1;return}e._progressiveLoadingEnabled=!0;let l=s.workspace.workspaceFolders;if(!l||l.length===0)return;i(e);let n=h(e);l.forEach(o=>{let u=e._batchProcessor.processDirectoryProgressively(o.uri,async y=>{try{await e.provideFileDecoration(y)}catch(w){e._logger?.debug?.("Progressive warmup processor failed",w)}},{background:!0,priority:"low",maxFiles:500});u&&n.add(u)}),e._logger?.info?.(`Progressive loading queued for ${l.length} workspace folder(s).`)}async function P(e,a){try{if(e._extensionContext=a,e._isWeb&&await e._maybeWarnAboutGitLimitations?.(),e._performanceMode){e._logger?.info?.("Performance mode enabled - skipping advanced cache, batch processor, and progressive loading");return}let t=await r.advancedCache();if(t){let n=null;if(typeof t=="function")if(t.name==="createAdvancedCache")e._advancedCache=t(a),await e._advancedCache.initialize(),e._logger?.info?.("Advanced cache initialized via factory function");else try{e._advancedCache=new t(a),await e._advancedCache.initialize(),e._logger?.info?.("Advanced cache initialized via direct constructor")}catch(o){e._logger?.warn?.("Failed to instantiate AdvancedCache via direct constructor, disabling advanced cache:",o.message),e._advancedCache=null}else t.AdvancedCache?(n=t.AdvancedCache,e._advancedCache=new n(a),await e._advancedCache.initialize(),e._logger?.info?.("Advanced cache initialized via module property")):t.createAdvancedCache?(e._advancedCache=t.createAdvancedCache(a),await e._advancedCache.initialize(),e._logger?.info?.("Advanced cache initialized via module factory")):(e._logger?.warn?.("AdvancedCache module format not recognized, disabling advanced cache"),e._advancedCache=null)}else e._logger?.info?.("Advanced cache disabled by feature flag"),e._advancedCache=null;await b(e),e._batchProcessor&&(e._batchProcessor.initialize(),e._logger?.info?.("Batch processor initialized"));let c=await r.workspaceIntelligence();if(c)try{let n=c.WorkspaceIntelligenceManager||c.default?.WorkspaceIntelligenceManager||c;if(typeof n=="function"){e._workspaceIntelligence=new n(e._fileSystem),await e._workspaceIntelligence.initialize({batchProcessor:e._batchProcessor,extensionContext:a,enableProgressiveAnalysis:e._shouldEnableProgressiveAnalysis?.()});let o=s.workspace.workspaceFolders;o?.length&&await e._workspaceIntelligence.analyzeWorkspace(o,{maxFiles:e._getIndexerMaxFiles()}),await e._workspaceIntelligence.cleanupWorkspaceProfiles(),e._logger?.info?.("Workspace intelligence initialized")}else e._logger?.warn?.("WorkspaceIntelligenceManager not found in chunk, disabling workspace intelligence"),e._workspaceIntelligence=null}catch(n){e._logger?.warn?.("Failed to initialize workspace intelligence:",n.message),e._workspaceIntelligence=null}else e._logger?.info?.("Workspace intelligence disabled by feature flag"),e._workspaceIntelligence=null;s.workspace.getConfiguration("explorerDates").get("autoThemeAdaptation",!0)&&e._themeIntegration?.autoConfigureForTheme&&(await e._themeIntegration.autoConfigureForTheme(),e._logger?.info?.("Theme integration configured")),e._accessibility?.shouldEnhanceAccessibility?.()&&(await e._accessibility.applyAccessibilityRecommendations?.(),e._logger?.info?.("Accessibility recommendations applied")),e._allocationTelemetryEnabled&&(g(e),e._logger?.info?.("Allocation telemetry enabled - reports every",e._telemetryReportInterval,"ms")),e._logger?.info?.("Advanced systems initialized successfully")}catch(t){e._logger?.error?.("Failed to initialize advanced systems",t)}}function A(e){return e._enableWatcherFallbacks===!1?!1:e._enableWatcherFallbacks==="auto"||e._enableWatcherFallbacks===!0?W():!1}function W(){let e=process.platform,a=process.env.WSL_DISTRO_NAME||process.env.WSLENV,t=s.env.remoteName,c=process.env.DOCKER_CONTAINER;return a||t||c||e==="android"}async function d(e,a,t){try{if(!e._smartWatcherFallbackManager){let c=await r.loadFeatureModule("smartWatcherFallback");if(c){let{SmartWatcherFallbackManager:l}=c;e._smartWatcherFallbackManager=new l({logger:e._logger}),await e._smartWatcherFallbackManager.initialize()}}if(e._smartWatcherFallbackManager){let l=await(await e._smartWatcherFallbackManager.getFallback()).createWatcherWithFallback(a);return e._logger?.debug?.(`Fallback watcher created for ${t}`),l}}catch(c){e._logger?.warn?.(`Fallback watcher creation failed for ${t}:`,c)}return null}async function E(e,a,t="unknown"){try{let c=s.workspace.createFileSystemWatcher(a);return e._logger?.debug?.(`Native watcher created for ${t}`),c}catch(c){if(e._logger?.debug?.(`Native watcher failed for ${t}:`,c),!A(e))throw c;return d(e,a,t)}}function g(e){!e._allocationTelemetryEnabled||e._telemetryReportTimer||(e._telemetryReportTimer=setTimeout(()=>{e._telemetryReportTimer=null,m(e),g(e)},e._telemetryReportInterval))}function m(e){let a=e.getMetrics().allocationTelemetry,t=a.decorationPool.allocations+a.badgeFlyweight.allocations+a.readableFlyweight.allocations,c=a.decorationPool.reuses+a.badgeFlyweight.reuses+a.readableFlyweight.reuses;(t>0||c>0)&&e._logger?.info?.("\u{1F9EE} Allocation telemetry report",{timestamp:new Date().toISOString(),pool:{allocations:a.decorationPool.allocations,reuses:a.decorationPool.reuses,reuseRate:a.decorationPool.reusePercent+"%"},badgeFlyweight:{allocations:a.badgeFlyweight.allocations,reuses:a.badgeFlyweight.reuses,reuseRate:a.badgeFlyweight.reusePercent+"%"},readableFlyweight:{allocations:a.readableFlyweight.allocations,reuses:a.readableFlyweight.reuses,reuseRate:a.readableFlyweight.reusePercent+"%"},summary:{totalAllocations:t,totalReuses:c,overallReuseRate:t+c>0?(c/(t+c)*100).toFixed(1)+"%":"0%"},decorationsProcessed:e._metrics.totalDecorations,cacheHitRate:e.getMetrics().cacheHitRate})}module.exports={applyProgressiveLoadingSetting:b,cancelProgressiveWarmupJobs:i,createFallbackWatcher:d,createWatcherWithFallback:E,initializeAdvancedSystems:P,loadBatchProcessorIfNeeded:_,reportAllocationTelemetry:m,scheduleTelemetryReport:g};
})(); (function(){const primaryKey="explorerDatesChunks";const legacyKey="__explorerDatesChunks";const registry=(globalThis[primaryKey]=globalThis[primaryKey]||globalThis[legacyKey]||(globalThis[legacyKey]={}));registry["decorationsAdvanced"]=module.exports;})();
