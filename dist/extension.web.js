var b=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var V=b((exports,module)=>{var vscode=require("vscode"),isWebRuntime=!0,inspectValue=isWebRuntime?i=>{if(typeof i=="string")return i;try{return JSON.stringify(i,null,2)}catch{return"<<unable to serialize log arg>>"}}:eval("require")("util").inspect,DEFAULT_LOG_PROFILE="default",SUPPORTED_PROFILES=new Set(["default","stress","soak"]),LOG_LEVEL_ORDER=["debug","info","warn","error"],DEFAULT_CONSOLE_LEVEL="warn",TEST_CONSOLE_LEVEL=process.env.EXPLORER_DATES_TEST_MODE==="1"?"warn":null,Logger=class{constructor(){this.g=vscode.window.createOutputChannel("Explorer Dates"),this.ke=!1,this.r=null,this.De=process.env.EXPLORER_DATES_TEST_MODE==="1",this.Q=(process.env.EXPLORER_DATES_LOG_PROFILE||DEFAULT_LOG_PROFILE).toLowerCase(),SUPPORTED_PROFILES.has(this.Q)||(this.Q=DEFAULT_LOG_PROFILE),this.ee=new Map,this.Ot=DEFAULT_CONSOLE_LEVEL,this.Pt(),this.r=vscode.workspace.onDidChangeConfiguration(e=>{(e.affectsConfiguration("explorerDates.enableLogging")||e.affectsConfiguration("explorerDates.consoleLogLevel"))&&this.Pt()})}Pt(){let e=vscode.workspace.getConfiguration("explorerDates");this.ke=e.get("enableLogging",!1);let t=(process.env.EXPLORER_DATES_LOG_LEVEL||"").toLowerCase(),s=(e.get("consoleLogLevel",DEFAULT_CONSOLE_LEVEL)||"").toLowerCase(),r=TEST_CONSOLE_LEVEL||t||s||DEFAULT_CONSOLE_LEVEL;this.Ot=LOG_LEVEL_ORDER.includes(r)?r:DEFAULT_CONSOLE_LEVEL,TEST_CONSOLE_LEVEL&&(this.ke=!1)}setLogProfile(e=DEFAULT_LOG_PROFILE){let t=(e||DEFAULT_LOG_PROFILE).toLowerCase();this.Q=SUPPORTED_PROFILES.has(t)?t:DEFAULT_LOG_PROFILE,this.resetThrottle()}resetThrottle(e){if(e){this.ee.delete(e);return}this.ee.clear()}debug(e,...t){this.ke&&this.Te("debug",null,e,t)}info(e,...t){this.Te("info",null,e,t)}infoWithOptions(e,t,...s){this.Te("info",e||null,t,s)}warn(e,...t){this.Te("warn",null,e,t)}error(e,t,...s){let o=`[${new Date().toISOString()}] [ERROR] ${e}`;this.De||(this.g.appendLine(o),t instanceof Error?(this.g.appendLine(`Error: ${t.message}`),t.stack&&this.g.appendLine(`Stack: ${t.stack}`)):t&&this.g.appendLine(this.et(t)));let n=this.It(s);n.length>0&&!this.De&&n.forEach(a=>this.g.appendLine(this.et(a)));let c=[];t!=null&&c.push(t),n.length>0&&c.push(...n),this.tt("error",o,c)}show(){this.g.show()}clear(){this.g.clear()}dispose(){this.g.dispose(),this.r&&(this.r.dispose(),this.r=null);let e="__explorerDatesLogger";typeof global<"u"&&global[e]===this?global[e]=null:typeof globalThis<"u"&&globalThis[e]===this?globalThis[e]=null:typeof globalThis<"u"&&globalThis.window?.[e]===this&&(globalThis.window[e]=null),loggerInstance===this&&(loggerInstance=null)}Te(e,t,s,r){if(e==="debug"&&!this.ke||this.Is(e,t))return;let n=`[${new Date().toISOString()}] [${e.toUpperCase()}] ${s}`;this.De||this.g.appendLine(n);let c=this.It(r);c.length>0&&!this.De&&c.forEach(a=>this.g.appendLine(this.et(a))),this.tt(e,n,c)}It(e){return!e||e.length===0?[]:e.map(t=>{if(typeof t!="function")return t;try{return t()}catch(s){return`<<log arg threw: ${s.message}>>`}})}et(e){try{return typeof e=="string"?e:typeof e=="object"?JSON.stringify(e,null,2):inspectValue(e)}catch(t){return`<<failed to serialize log arg: ${t.message}>>`}}Is(e,t){if(e!=="info"||!t||!t.throttleKey)return!1;let s=(t.profile||"stress").toLowerCase();if(!this.$s(s))return!1;let r=Number(t.throttleLimit)||50,o=t.throttleKey,n=this.ee.get(o)||{count:0,suppressed:0,noticeLogged:!1};if(n.count<r)return n.count+=1,this.ee.set(o,n),!1;if(n.suppressed+=1,!n.noticeLogged){n.noticeLogged=!0;let c=`[${new Date().toISOString()}] [INFO] \u23F8\uFE0F Suppressing further logs for "${o}" after ${r} entries (profile=${this.Q})`;this.g.appendLine(c),this.tt("info",c)}return this.ee.set(o,n),!0}$s(e){let t=this.Q||DEFAULT_LOG_PROFILE;return e==="default"?t===DEFAULT_LOG_PROFILE:t===e}Ws(e){let t=LOG_LEVEL_ORDER.indexOf(this.Ot),s=LOG_LEVEL_ORDER.indexOf(e);return t===-1||s===-1?!1:s>=t}tt(e,t,s=[]){if(!this.Ws(e))return;(e==="warn"?console.warn:e==="error"?console.error:console.log).call(console,t,...s)}},GLOBAL_LOGGER_KEY="__explorerDatesLogger";function getLogger(){return typeof global<"u"?(global[GLOBAL_LOGGER_KEY]||(global[GLOBAL_LOGGER_KEY]=new Logger),global[GLOBAL_LOGGER_KEY]):typeof globalThis<"u"?(globalThis[GLOBAL_LOGGER_KEY]||(globalThis[GLOBAL_LOGGER_KEY]=new Logger),globalThis.window&&(globalThis.window[GLOBAL_LOGGER_KEY]=globalThis[GLOBAL_LOGGER_KEY]),globalThis[GLOBAL_LOGGER_KEY]):(loggerInstance||(loggerInstance=new Logger),loggerInstance)}var loggerInstance=null;module.exports={Logger,getLogger}});var ze=b((wi,Ct)=>{var Ue=require("vscode"),ye={en:{now:"now",minutes:"m",hours:"h",days:"d",weeks:"w",months:"mo",years:"y",justNow:"just now",minutesAgo:i=>`${i} minute${i!==1?"s":""} ago`,hoursAgo:i=>`${i} hour${i!==1?"s":""} ago`,yesterday:"yesterday",daysAgo:i=>`${i} day${i!==1?"s":""} ago`,lastModified:"Last modified",refreshSuccess:"Date decorations refreshed",activationError:"Explorer Dates failed to activate",errorAccessingFile:"Error accessing file for decoration"},es:{now:"ahora",minutes:"m",hours:"h",days:"d",weeks:"s",months:"m",years:"a",justNow:"ahora mismo",minutesAgo:i=>`hace ${i} minuto${i!==1?"s":""}`,hoursAgo:i=>`hace ${i} hora${i!==1?"s":""}`,yesterday:"ayer",daysAgo:i=>`hace ${i} d\xEDa${i!==1?"s":""}`,lastModified:"\xDAltima modificaci\xF3n",refreshSuccess:"Decoraciones de fecha actualizadas",activationError:"Explorer Dates no se pudo activar",errorAccessingFile:"Error al acceder al archivo para decoraci\xF3n"},fr:{now:"maintenant",minutes:"m",hours:"h",days:"j",weeks:"s",months:"m",years:"a",justNow:"\xE0 l'instant",minutesAgo:i=>`il y a ${i} minute${i!==1?"s":""}`,hoursAgo:i=>`il y a ${i} heure${i!==1?"s":""}`,yesterday:"hier",daysAgo:i=>`il y a ${i} jour${i!==1?"s":""}`,lastModified:"Derni\xE8re modification",refreshSuccess:"D\xE9corations de date actualis\xE9es",activationError:"\xC9chec de l'activation d'Explorer Dates",errorAccessingFile:"Erreur lors de l'acc\xE8s au fichier pour la d\xE9coration"},de:{now:"jetzt",minutes:"Min",hours:"Std",days:"T",weeks:"W",months:"Mon",years:"J",justNow:"gerade eben",minutesAgo:i=>`vor ${i} Minute${i!==1?"n":""}`,hoursAgo:i=>`vor ${i} Stunde${i!==1?"n":""}`,yesterday:"gestern",daysAgo:i=>`vor ${i} Tag${i!==1?"en":""}`,lastModified:"Zuletzt ge\xE4ndert",refreshSuccess:"Datumsdekorationen aktualisiert",activationError:"Explorer Dates konnte nicht aktiviert werden",errorAccessingFile:"Fehler beim Zugriff auf Datei f\xFCr Dekoration"},ja:{now:"\u4ECA",minutes:"\u5206",hours:"\u6642\u9593",days:"\u65E5",weeks:"\u9031",months:"\u30F6\u6708",years:"\u5E74",justNow:"\u305F\u3063\u305F\u4ECA",minutesAgo:i=>`${i}\u5206\u524D`,hoursAgo:i=>`${i}\u6642\u9593\u524D`,yesterday:"\u6628\u65E5",daysAgo:i=>`${i}\u65E5\u524D`,lastModified:"\u6700\u7D42\u66F4\u65B0",refreshSuccess:"\u65E5\u4ED8\u88C5\u98FE\u304C\u66F4\u65B0\u3055\u308C\u307E\u3057\u305F",activationError:"Explorer Dates\u306E\u30A2\u30AF\u30C6\u30A3\u30D9\u30FC\u30B7\u30E7\u30F3\u306B\u5931\u6557\u3057\u307E\u3057\u305F",errorAccessingFile:"\u30D5\u30A1\u30A4\u30EB\u30A2\u30AF\u30BB\u30B9\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F"},zh:{now:"\u73B0\u5728",minutes:"\u5206\u949F",hours:"\u5C0F\u65F6",days:"\u5929",weeks:"\u5468",months:"\u6708",years:"\u5E74",justNow:"\u521A\u521A",minutesAgo:i=>`${i}\u5206\u949F\u524D`,hoursAgo:i=>`${i}\u5C0F\u65F6\u524D`,yesterday:"\u6628\u5929",daysAgo:i=>`${i}\u5929\u524D`,lastModified:"\u6700\u540E\u4FEE\u6539",refreshSuccess:"\u65E5\u671F\u88C5\u9970\u5DF2\u5237\u65B0",activationError:"Explorer Dates \u6FC0\u6D3B\u5931\u8D25",errorAccessingFile:"\u8BBF\u95EE\u6587\u4EF6\u88C5\u9970\u65F6\u51FA\u9519"}},Ee=class{constructor(){this.Fe="en",this.r=null,this.$t(),this.r=Ue.workspace.onDidChangeConfiguration(e=>{e.affectsConfiguration("explorerDates.locale")&&this.$t()})}$t(){let t=Ue.workspace.getConfiguration("explorerDates").get("locale","auto");t==="auto"&&(t=Ue.env.language.split("-")[0]),ye[t]||(t="en"),this.Fe=t}getString(e,...t){let r=(ye[this.Fe]||ye.en)[e];return typeof r=="function"?r(...t):r||ye.en[e]||e}getCurrentLocale(){return this.Fe}formatDate(e,t={}){try{return e.toLocaleDateString(this.Fe,t)}catch{return e.toLocaleDateString("en",t)}}dispose(){this.r&&(this.r.dispose(),this.r=null),ne===this&&(ne=null)}},ne=null;function Is(){return ne||(ne=new Ee),ne}Ct.exports={LocalizationManager:Ee,getLocalization:Is}});var Be=b((bi,vt)=>{var St=require("vscode");function $s(){try{return St?.env?.uiKind===St?.UIKind?.Web}catch{return!1}}vt.exports={isWebEnvironment:$s}});var ae=b((yi,Dt)=>{function j(i=""){return i?i.replace(/\\/g,"/"):""}function Ws(i=""){let e=j(i);return e?e.split("/").filter(Boolean):[]}function kt(i=""){let e=Ws(i);return e.length?e[e.length-1]:""}function Ns(i=""){let e=kt(i),t=e.lastIndexOf(".");return t<=0?"":e.substring(t).toLowerCase()}function Us(i=""){let e=j(i),t=e.lastIndexOf("/");return t===-1?"":e.substring(0,t)}function zs(...i){return j(i.filter(Boolean).join("/")).replace(/\/+/g,"/")}function Bs(i=""){return j(i).toLowerCase()}function Vs(i=""){if(!i)return"";if(typeof i=="string")return i;if(typeof i.fsPath=="string"&&i.fsPath.length>0)return i.fsPath;if(typeof i.path=="string"&&i.path.length>0)return i.path;if(typeof i.toString=="function")try{return i.toString(!0)}catch{return i.toString()}return String(i)}function Gs(i="",e=""){let t=j(i),s=j(e);return t&&s.startsWith(t)?s.substring(t.length).replace(/^\/+/,""):s}Dt.exports={normalizePath:j,getFileName:kt,getExtension:Ns,getDirectory:Us,joinPath:zs,getCacheKey:Bs,getUriPath:Vs,getRelativePath:Gs}});var Ge=b((Ei,Ft)=>{var _e=class extends Error{constructor(e,t,s={}){super(t),this.code=e,this.context=s,this.name="ExtensionError"}},Tt={FILE_PERMISSION_DENIED:"FILE_PERMISSION_DENIED",WORKSPACE_TOO_LARGE:"WORKSPACE_TOO_LARGE",CHUNK_LOAD_FAILED:"CHUNK_LOAD_FAILED"};function Hs(i){if(!i)return!1;let e=i.code||i?.name;return["EACCES","EPERM","EROFS","NoPermissions"].includes(e)}var Ve=class extends _e{constructor(e,t,s={}){let{recoverable:r=!0,context:o={}}=s;super(Tt.CHUNK_LOAD_FAILED,`Failed to load ${e}: ${t}`,{chunkName:e,recoverable:r,...o}),this.name="ChunkLoadError",this.chunkName=e,this.recoverable=r}};function Ks(i,e,t={}){let s=require("vscode"),{userFacing:r=!0}=t,o=e?.recoverable??!0;r&&!o&&s.window.showErrorMessage(`Explorer Dates: ${i} feature unavailable. Please reinstall or rebuild the extension.`)}Ft.exports={ExtensionError:_e,ERROR_CODES:Tt,isPermissionError:Hs,ChunkLoadError:Ve,handleChunkFailure:Ks}});var ce=b((_i,Mt)=>{function xt(){return typeof performance<"u"&&performance.now&&performance.timeOrigin?Math.floor(performance.timeOrigin+performance.now()):typeof Date=="function"&&Date.now?Date.now():16409952e5}function At(i){return!!(i&&typeof i=="object"&&typeof i.getTime=="function")}function te(i){if(!i||isNaN(i))return"Invalid Date";if(typeof Intl<"u"&&Intl.DateTimeFormat)try{return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(i)}catch{}let e=864e5,t=36e5,s=6e4,r=1e3,o=1970,n=Math.floor(i/e),c=i%e,a=Math.floor(c/t),l=Math.floor(c%t/s),u=Math.floor(c%s/r),d=o+Math.floor(n/365.25),f=Math.floor(n%365.25/30.44)+1,p=Math.floor(n%30.44)+1,w=String(Math.min(f,12)).padStart(2,"0"),_=String(Math.min(p,31)).padStart(2,"0"),T=String(a).padStart(2,"0"),L=String(l).padStart(2,"0"),H=String(u).padStart(2,"0");return`${w}/${_}/${d}, ${T}:${L}:${H}`}function js(i){if(At(i))return i;let e=typeof Date=="function"&&Date.prototype&&Date.prototype.constructor===Date;if(i==null){if(!e){let t=xt();return{getTime:()=>t,toLocaleString:()=>te(t),toString:()=>te(t)}}return new Date}if(typeof i=="number")return e?new Date(i):{getTime:()=>i,toLocaleString:()=>te(i),toString:()=>te(i)};if(typeof i=="string"){let t=0;if(e)t=Date.parse(i);else{let s=parseFloat(i);t=isNaN(s)?0:s}return e?new Date(i):{getTime:()=>t,toLocaleString:()=>te(t),toString:()=>te(t)}}return e?new Date(i):{getTime:()=>0,toLocaleString:()=>"Invalid Date",toString:()=>"Invalid Date"}}Mt.exports={ensureDate:js,isDateLike:At,getCurrentTimestamp:xt}});var Se=b((Ci,Lt)=>{var v=require("vscode"),{isWebEnvironment:qs}=Be(),{normalizePath:Ys}=ae(),{ExtensionError:Xs,ERROR_CODES:Js,isPermissionError:Zs}=Ge(),{ensureDate:He}=ce(),Rt=!0,Qs=process.env.EXPLORER_DATES_FORCE_VSCODE_FS==="1",k=null;if(!Rt&&!Qs)try{k=require("fs").promises}catch{k=null}var Ce=class{constructor(){this.isWeb=Rt||qs()}v(e){if(!e)return"";if(typeof e=="string")return e;if(e&&typeof e=="object"&&typeof e.fsPath=="string")return e.fsPath;if(e&&typeof e=="object"&&typeof e.path=="string")return e.path;if(typeof e=="object"){if(typeof e.fsPath=="string")return e.fsPath;if(typeof e.path=="string")return e.path}return String(e)}k(e){if(e&&typeof e=="object"&&typeof e.scheme=="string"&&typeof e.path=="string")return e;if(typeof e=="string")return v.Uri.file(e);if(e&&typeof e=="object"){if(e.uri&&e.uri!==e)try{return this.k(e.uri)}catch{}if(typeof e.fsPath=="string"&&e.fsPath.length>0)return v.Uri.file(e.fsPath);if(typeof e.path=="string"&&e.path.length>0)return v.Uri.file(e.path);if(typeof e.href=="string"&&e.href.length>0)return v.Uri.parse(e.href);if(typeof e.scheme=="string")return v.Uri.from({scheme:e.scheme,authority:e.authority||"",path:e.path||e.fsPath||"",query:e.query||"",fragment:e.fragment||""});if(typeof e.toString=="function")try{let t=e.toString(!0);if(t&&t!=="[object Object]")return v.Uri.parse(t)}catch{let t=e.toString();if(t&&t!=="[object Object]")return v.Uri.parse(t)}}throw new Error(`Unsupported target type: ${typeof e}`)}async stat(e){if(!this.isWeb&&k)return k.stat(this.v(e));let t=this.k(e),s=await v.workspace.fs.stat(t);return{...s,mtime:He(s.mtime),ctime:He(s.ctime),birthtime:He(s.ctime),isFile:()=>s.type===v.FileType.File,isDirectory:()=>s.type===v.FileType.Directory}}async readFile(e,t="utf8"){if(!this.isWeb&&k)return k.readFile(this.v(e),t);let s=this.k(e),r=await v.workspace.fs.readFile(s);return t===null||t==="binary"?r:new TextDecoder(t).decode(r)}async writeFile(e,t,s="utf8"){let r=this.v(e);try{if(!this.isWeb&&k)return k.writeFile(r,t,s);let o=this.k(e),n=typeof t=="string"?new TextEncoder().encode(t):t;await v.workspace.fs.writeFile(o,n)}catch(o){this.Wt("write file",r,o)}}async mkdir(e,t={recursive:!0}){let s=this.v(e);try{if(!this.isWeb&&k)return k.mkdir(s,t);let r=this.k(e);await v.workspace.fs.createDirectory(r)}catch(r){this.Wt("create directory",s,r)}}async readdir(e,t={withFileTypes:!1}){if(!this.isWeb&&k)return k.readdir(this.v(e),t);let s=this.k(e),r=await v.workspace.fs.readDirectory(s);return t.withFileTypes?r.map(([o,n])=>({name:o,isDirectory:()=>n===v.FileType.Directory,isFile:()=>n===v.FileType.File})):r.map(([o])=>o)}async delete(e,t={recursive:!1}){if(!this.isWeb&&k){let r=this.v(e);return t.recursive?k.rm?k.rm(r,t):k.rmdir(r,t):k.unlink(r)}let s=this.k(e);await v.workspace.fs.delete(s,t)}async exists(e){try{return await this.stat(e),!0}catch{return!1}}async ensureDirectory(e){let t=Ys(this.v(e));await this.mkdir(t,{recursive:!0})}Wt(e,t,s){throw Zs(s)?new Xs(Js.FILE_PERMISSION_DENIED,`Permission denied while attempting to ${e}`,{path:t,code:s.code}):s}},er=new Ce;Lt.exports={FileSystemAdapter:Ce,fileSystem:er}});var le=b((Si,Pt)=>{var tr=["Ja","Fe","Mr","Ap","My","Jn","Jl","Au","Se","Oc","No","De"],sr=Number(process.env.EXPLORER_DATES_DECORATION_POOL_SIZE||2048),rr=Number(process.env.EXPLORER_DATES_FLYWEIGHT_CACHE_SIZE||4096),ir=Number(process.env.EXPLORER_DATES_WORKSPACE_BALANCED_THRESHOLD||15e3),or=Number(process.env.EXPLORER_DATES_WORKSPACE_LARGE_THRESHOLD||25e4),Ot=Number(process.env.EXPLORER_DATES_WORKSPACE_EXTREME_THRESHOLD||4e5),nr=Number(process.env.EXPLORER_DATES_WORKSPACE_SCAN_MAX_RESULTS||Math.min(Ot+1,50001)),ar={ADVANCED_CACHE:"explorerDates.advancedCache",ADVANCED_CACHE_METADATA:"explorerDates.advancedCacheMetadata",TEMPLATE_STORE:"explorerDates.templates",WEB_GIT_NOTICE:"explorerDates.webGitNotice"},cr="explorerDatesChunks",lr="__explorerDatesChunks";Pt.exports={DEFAULT_CACHE_TIMEOUT:12e4,DEFAULT_MAX_CACHE_SIZE:1e4,DEFAULT_PERSISTENT_CACHE_TTL:864e5,DEFAULT_DECORATION_POOL_SIZE:sr,DEFAULT_FLYWEIGHT_CACHE_SIZE:rr,MAX_BADGE_LENGTH:2,MONTH_ABBREVIATIONS:tr,WORKSPACE_SCALE_BALANCED_THRESHOLD:ir,WORKSPACE_SCALE_LARGE_THRESHOLD:or,WORKSPACE_SCALE_EXTREME_THRESHOLD:Ot,WORKSPACE_SCAN_MAX_RESULTS:nr,GLOBAL_STATE_KEYS:ar,WEB_CHUNK_GLOBAL_KEY:cr,LEGACY_WEB_CHUNK_GLOBAL_KEY:lr}});var Wt=b((vi,$t)=>{var{MAX_BADGE_LENGTH:It}=le();function ur(i=0,e="auto"){let t=typeof i=="number"&&!Number.isNaN(i)?i:0;if(e==="bytes")return`~${t}B`;let s=t/1024;if(e==="kb")return`~${s.toFixed(1)}K`;let r=s/1024;return e==="mb"?`~${r.toFixed(1)}M`:t<1024?`~${t}B`:s<1024?`~${Math.round(s)}K`:`~${r.toFixed(1)}M`}function hr(i){if(i)return i.length>It?i.substring(0,It):i}$t.exports={formatFileSize:ur,trimBadge:hr}});var Ye=b((ki,Bt)=>{var{normalizePath:Ke,getUriPath:dr}=ae(),{getLogger:gr}=V(),fr=gr(),ue=240,je=255,Nt=/[\x00-\x1f\x7f<>:"|?*]/g,pr=/[\x00-\x1f\x7f<>:"|?*]/,mr=[/\.\./,/\.\.[\\/]/,/[\\/]\.\./,/^\.\.$/,/^\.\.[\\/]/,/[\\/]\.\.$/],Ut=new Set(["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"]),zt=new Set([".exe",".scr",".bat",".cmd",".pif",".vbs",".js",".jar",".com",".msi",".dll",".dmg",".pkg",".deb",".rpm"]),wr=new Set([".js",".jsx",".ts",".tsx",".mjs",".cjs",".py",".rb",".rs",".go",".php",".java",".kt",".swift",".cs",".c",".cpp",".h",".hpp",".html",".css",".scss",".less",".json",".jsonc",".md",".mdx",".txt",".sh",".bash",".yml",".yaml"]),br=()=>process.env.EXPLORER_DATES_TEST_MODE==="1"||process.env.VSCODE_TEST==="1"?"test":process.env.EXPLORER_DATES_DEV_MODE==="1"?"development":"production",se=class{static hasPathTraversal(e){let t=this.P(e);if(!t||typeof t!="string")return!1;let s=Ke(t);return mr.some(r=>r.test(s))}static hasDangerousChars(e){let t=this.P(e);return!t||typeof t!="string"?!1:pr.test(t)}static isWindowsReservedName(e){if(!e||typeof e!="string")return!1;let t=e.split(".")[0].toUpperCase();return Ut.has(t)}static isSuspiciousExtension(e,t={}){let{workspaceContext:s=!0}=t;if(!e||typeof e!="string")return!1;let r=e.toLowerCase(),o=r.startsWith(".")?r:`.${r}`;return s&&wr.has(o)?!1:zt.has(o)}static isPathTooLong(e){let t=this.P(e);return!t||typeof t!="string"?!1:t.length>ue}static isFilenameTooLong(e){return!e||typeof e!="string"?!1:e.length>je}static validatePath(e,t={}){let{allowSuspiciousExtensions:s=!1,allowWindowsReservedNames:r=!1,strictLength:o=!0,workspaceContext:n=!0}=t,c=this.P(e),a=[],l=[];if(!c||typeof c!="string")return{isValid:!1,path:c,issues:["Invalid or empty path"],warnings:[],isSafe:!1};this.hasPathTraversal(c)&&a.push("Path contains directory traversal attempts"),this.hasDangerousChars(c)&&a.push("Path contains dangerous characters"),o&&this.isPathTooLong(c)&&a.push(`Path exceeds maximum length (${ue})`);let u=c.split(/[/\\]/).pop()||"";o&&this.isFilenameTooLong(u)&&a.push(`Filename exceeds maximum length (${je})`),!r&&this.isWindowsReservedName(u)&&l.push("Filename is a Windows reserved name");let d=u.includes(".")?u.split(".").pop():"";return!s&&this.isSuspiciousExtension(d,{workspaceContext:n})&&l.push("File extension is potentially suspicious"),{isValid:a.length===0,path:c,filename:u,extension:d,issues:a,warnings:l,isSafe:a.length===0&&l.length===0}}static sanitizePath(e,t={}){let{replacementChar:s="_",preserveExtension:r=!0}=t,o=this.P(e);if(!o||typeof o!="string")return"";o=o.replace(/\x00/g,"");let n=o.startsWith("/"),c=Ke(o).split("/").filter(Boolean),a=[];for(let l of c){if(l===".."){a.length>0&&a.pop();continue}l!=="."&&a.push(l)}if(o=(n?"/":"")+a.join("/"),o=o.replace(Nt,s),r){let l=o.split("/"),u=l[l.length-1];if(u&&this.isWindowsReservedName(u)){let d=u.split(".");d[0]=d[0]+"_safe",l[l.length-1]=d.join("."),o=l.join("/")}}return o.length>ue&&(o=o.substring(0,ue),fr.warn("Path truncated due to length:",o)),o}static isWithinBoundaries(e,t=[]){let s=this.P(e);if(!s||!Array.isArray(t)||t.length===0)return!1;let r=s.split("/").filter(Boolean),o=[];for(let c of r)c===".."?o.length>0&&o.pop():c!=="."&&o.push(c);let n="/"+o.join("/");return t.some(c=>{let a=Ke(c);return n.startsWith(a)})}static validateRegexPattern(e){if(!e||typeof e!="string")return{isValid:!1,issue:"Invalid pattern"};let t=[/\([^)]*\+[^)]*\)\+/,/\([^)]*\*[^)]*\)\*/,/\([^)]*\+[^)]*\)\*/,/\([^)]*\*[^)]*\)\+/,/\+.*\*|{\d+,}.*\*/,/\([^|]*\|[^)]*\)\*/];for(let s of t)if(s.test(e))return{isValid:!1,issue:"Pattern may cause catastrophic backtracking (ReDoS)"};try{return new RegExp(e),{isValid:!0}}catch(s){return{isValid:!1,issue:`Invalid regex syntax: ${s.message}`}}}static P(e){if(!e)return"";if(typeof e=="string")return e;try{return dr(e)}catch{return String(e)}}},qe=class{static validateFileUri(e,t=[]){if(!e||typeof e!="object")return{isValid:!1,issue:"Invalid URI object"};if(e.scheme!=="file"&&e.scheme!=="vscode-vfs")return{isValid:!1,issue:`Unsupported URI scheme: ${e.scheme}`};let s=se.validatePath(e);return s.isValid?t.length>0&&!se.isWithinBoundaries(e,t)?{isValid:!1,issue:"Path is outside allowed workspace boundaries"}:{isValid:!0,warnings:s.warnings}:{isValid:!1,issue:`Path validation failed: ${s.issues.join(", ")}`}}static validateExclusionPatterns(e){if(!Array.isArray(e))return{isValid:!1,issue:"Patterns must be an array"};let t=[],s=[];for(let r of e){if(typeof r!="string"){s.push(`Invalid pattern type: ${typeof r}`);continue}let o=r.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\?/g,"."),n=se.validateRegexPattern(o);t.push({pattern:r,isValid:n.isValid,issue:n.issue}),n.isValid||s.push(`Pattern "${r}": ${n.issue}`)}return{isValid:s.length===0,results:t,issues:s}}};Bt.exports={SecurityValidator:se,SecureFileOperations:qe,detectSecurityEnvironment:br,MAX_SAFE_PATH_LENGTH:ue,MAX_SAFE_FILENAME_LENGTH:je,DANGEROUS_PATH_CHARS:Nt,WINDOWS_RESERVED_NAMES:Array.from(Ut),SUSPICIOUS_EXTENSIONS:Array.from(zt)}});var qt=b((Di,jt)=>{var N=require("vscode"),{getLogger:yr}=V(),{WORKSPACE_SCALE_BALANCED_THRESHOLD:Vt,WORKSPACE_SCALE_LARGE_THRESHOLD:ke,WORKSPACE_SCALE_EXTREME_THRESHOLD:Gt,WORKSPACE_SCAN_MAX_RESULTS:Ht}=le(),Xe=yr(),ve=null;function Kt(i){return i&&(i.fsPath||i.path)||null}function Je(i,e){let t=Kt(i);!t||typeof e!="number"||(ve={workspaceKey:t,fileCount:e,timestamp:Date.now()})}function Ze(i){let e=Kt(i);return!e||!ve||ve.workspaceKey!==e?null:ve}function Er(i,e="default"){if(!i)return`unknown-workspace-${e}`;let t=i.fsPath||i.path||"",s=t.split("/").pop()||"workspace",r=Math.abs(t.split("").reduce((n,c)=>(n=(n<<5)-n+c.charCodeAt(0),n&n),0)).toString(36).substr(0,8),o=Math.abs(e.split("").reduce((n,c)=>(n=(n<<5)-n+c.charCodeAt(0),n&n),0)).toString(36).substr(0,4);return`${s}-${r}-${o}`}async function _r(i){try{if(!i)return"unknown";let e=Ze(i),t;e?t=e.fileCount:(t=(await N.workspace.findFiles("**/*",null,Ht)).length,Je(i,t));let s="small";t>=Gt?s="extreme":t>=ke?s="large":t>=1e3&&(s="medium");let r=N.env.remoteName,o=N.env.uiKind===N.UIKind.Web,n=s==="medium"&&t>=Vt&&t<ke;if(s==="extreme"||s==="large"&&(r||o))return"minimal";if(s==="large"||n||r||o)return"balanced";try{let a=(await N.workspace.fs.readDirectory(i)).map(([l])=>l.toLowerCase());if(a.includes("package.json")||a.includes("yarn.lock"))return"web-development";if(a.some(l=>l.endsWith(".ipynb"))||a.includes("requirements.txt"))return"data-science";if(a.includes("docker-compose.yml")||a.includes(".enterprise"))return"enterprise"}catch(c){Xe.debug("Project type detection failed:",c)}return"full"}catch(e){return Xe.error("Workspace profile detection failed:",e),"unknown"}}async function Cr(i){if(!i)return null;try{let e=Ze(i),t;e?t=e.fileCount:(t=(await N.workspace.findFiles("**/*",null,Ht)).length,Je(i,t));let s="small";t>=Gt?s="extreme":t>=ke?s="large":t>=1e3&&(s="medium");let r=!!N.env.remoteName,o=N.env.uiKind===N.UIKind.Web,n=o?"web":r?"remote":"local",c=s==="medium"&&t>=Vt&&t<ke;return{workspaceSize:s,fileCount:t,remoteType:n,isRemoteEnvironment:r||o,timestamp:Date.now(),mediumBalanced:c}}catch(e){return Xe.error("Workspace environment analysis failed:",e),null}}jt.exports={generateWorkspaceKey:Er,detectWorkspaceProfile:_r,analyzeWorkspaceEnvironment:Cr,setCachedWorkspaceMetrics:Je,getCachedWorkspaceMetrics:Ze}});var Xt=b((Ti,Yt)=>{var y={onboarding:34,analysisCommands:23,exportReporting:17,extensionApi:15,workspaceTemplates:14,advancedCache:28,workspaceIntelligence:31,incrementalWorkers:19},Y=99,q={minimal:{id:"minimal",name:"Minimal",description:"Core decorations only, smallest bundle (~99KB)",targetBundleSize:Y,settings:{"explorerDates.enableOnboardingSystem":!1,"explorerDates.enableAnalysisCommands":!1,"explorerDates.enableExportReporting":!1,"explorerDates.enableExtensionApi":!1,"explorerDates.enableWorkspaceTemplates":!1,"explorerDates.enableAdvancedCache":!1,"explorerDates.enableWorkspaceIntelligence":!1,"explorerDates.enableIncrementalWorkers":!1,"explorerDates.performanceMode":!0,"explorerDates.showDateDecorations":!0,"explorerDates.dateDecorationFormat":"relative-short"},targetScenarios:["Resource-constrained environments","Basic file dates only","Large remote workspaces"]},balanced:{id:"balanced",name:"Balanced",description:"Essential features with optimization (~200KB)",targetBundleSize:Y+y.onboarding+y.workspaceTemplates+y.advancedCache+y.analysisCommands,settings:{"explorerDates.enableOnboardingSystem":!0,"explorerDates.enableAnalysisCommands":!0,"explorerDates.enableExportReporting":!1,"explorerDates.enableExtensionApi":!1,"explorerDates.enableWorkspaceTemplates":!0,"explorerDates.enableAdvancedCache":!0,"explorerDates.enableWorkspaceIntelligence":!1,"explorerDates.enableIncrementalWorkers":!1,"explorerDates.performanceMode":!0,"explorerDates.smartFileWatching":!0},targetScenarios:["Most development workflows","Remote environments","Medium to large workspaces"]},"web-development":{id:"web-development",name:"Web Development",description:"Optimized for web projects (~240KB)",targetBundleSize:Y+y.onboarding+y.analysisCommands+y.workspaceTemplates+y.advancedCache+y.incrementalWorkers,settings:{"explorerDates.enableOnboardingSystem":!0,"explorerDates.enableAnalysisCommands":!0,"explorerDates.enableExportReporting":!1,"explorerDates.enableExtensionApi":!1,"explorerDates.enableWorkspaceTemplates":!0,"explorerDates.enableAdvancedCache":!0,"explorerDates.enableWorkspaceIntelligence":!1,"explorerDates.enableIncrementalWorkers":!0,"explorerDates.showGitInfo":"author","explorerDates.colorScheme":"file-type"},targetScenarios:["JavaScript/TypeScript projects","Node.js development","Frontend frameworks"]},enterprise:{id:"enterprise",name:"Enterprise",description:"Full feature set with reporting and API (~380KB)",targetBundleSize:Object.values(y).reduce((i,e)=>i+e,Y),settings:{"explorerDates.enableOnboardingSystem":!0,"explorerDates.enableAnalysisCommands":!0,"explorerDates.enableExportReporting":!0,"explorerDates.enableExtensionApi":!0,"explorerDates.enableWorkspaceTemplates":!0,"explorerDates.enableAdvancedCache":!0,"explorerDates.enableWorkspaceIntelligence":!0,"explorerDates.enableIncrementalWorkers":!0,"explorerDates.persistentCache":!0,"explorerDates.smartExclusions":!0},targetScenarios:["Team lead workflows","Analytics and reporting needs","API integration requirements","Full workspace intelligence"]},"data-science":{id:"data-science",name:"Data Science",description:"Optimized for data workflows (~280KB)",targetBundleSize:Y+y.onboarding+y.analysisCommands+y.exportReporting+y.workspaceIntelligence+y.advancedCache,settings:{"explorerDates.enableOnboardingSystem":!0,"explorerDates.enableAnalysisCommands":!0,"explorerDates.enableExportReporting":!0,"explorerDates.enableExtensionApi":!1,"explorerDates.enableWorkspaceTemplates":!1,"explorerDates.enableAdvancedCache":!0,"explorerDates.enableWorkspaceIntelligence":!0,"explorerDates.enableIncrementalWorkers":!1,"explorerDates.dateDecorationFormat":"iso-detailed"},targetScenarios:["Jupyter notebooks","Python data analysis","Research workflows"]}},Sr=new Set(["enableOnboardingSystem","enableAnalysisCommands","enableExportReporting","enableExtensionApi","enableWorkspaceTemplates","enableAdvancedCache","enableWorkspaceIntelligence","enableIncrementalWorkers","performanceMode","smartFileWatching"]);function vr(i){let e=Y;return i["explorerDates.enableOnboardingSystem"]&&(e+=y.onboarding),i["explorerDates.enableAnalysisCommands"]&&(e+=y.analysisCommands),i["explorerDates.enableExportReporting"]&&(e+=y.exportReporting),i["explorerDates.enableExtensionApi"]&&(e+=y.extensionApi),i["explorerDates.enableWorkspaceTemplates"]&&(e+=y.workspaceTemplates),i["explorerDates.enableAdvancedCache"]&&(e+=y.advancedCache),i["explorerDates.enableWorkspaceIntelligence"]&&(e+=y.workspaceIntelligence),i["explorerDates.enableIncrementalWorkers"]&&(e+=y.incrementalWorkers),e}function kr(i){switch(i){case"minimal":case"extreme":return q.minimal;case"balanced":return q.balanced;case"web-development":return q["web-development"];case"data-science":return q["data-science"];case"enterprise":return q.enterprise;default:return q.balanced}}Yt.exports={PRESET_DEFINITIONS:q,CHUNK_SIZES:y,BASE_BUNDLE_SIZE:Y,RESTART_REQUIRED_SETTINGS:Sr,calculateBundleSize:vr,getDefaultPresetForProfile:kr}});var Qe=b((Fi,Jt)=>{var De={onboarding:"src/chunks/onboarding-chunk",onboardingAssets:"src/chunks/onboarding-assets-chunk",reporting:"src/chunks/reporting-chunk",templates:"src/chunks/templates-chunk",analysis:"src/chunks/analysis-chunk",diagnostics:"src/chunks/diagnostics-chunk",extensionApi:"src/chunks/extension-api-chunk",advancedCache:"src/chunks/advancedCache-chunk",batchProcessor:"src/chunks/batchProcessor-chunk",decorationsAdvanced:"src/chunks/decorations-advanced",workspaceIntelligence:"src/chunks/workspaceIntelligence",incrementalWorkers:"src/chunks/incrementalWorkers",uiAdapters:"src/chunks/ui-adapters",gitInsights:"src/chunks/gitInsights-chunk",smartWatcherFallback:"src/chunks/smartWatcherFallback-chunk",runtimeManagement:"src/chunks/runtime-management"};function Dr(i){return De[i]||null}function Tr(){return Object.keys(De)}function Fr(i){let e={};for(let[t,s]of Object.entries(De))e[t]=()=>i(`./${s}`);return e}Jt.exports={CHUNK_MAP:De,getChunkSourcePath:Dr,getAllChunkNames:Tr,generateDevLoaderMap:Fr}});var et=b((exports,module)=>{var FEATURE_FLAGS_GLOBAL_KEY="__explorerDatesFeatureFlags";function registerFeatureFlagsGlobal(i){if(i)try{typeof globalThis<"u"&&(globalThis[FEATURE_FLAGS_GLOBAL_KEY]=i)}catch{}}function loadFeatureFlagsFallback(){try{let dynamicRequire=typeof eval=="function"?eval("require"):null;if(typeof dynamicRequire=="function")return dynamicRequire("../featureFlags")}catch{}return null}function getFeatureFlagsGlobal(){try{if(typeof globalThis<"u"&&globalThis[FEATURE_FLAGS_GLOBAL_KEY])return globalThis[FEATURE_FLAGS_GLOBAL_KEY]}catch{}return loadFeatureFlagsFallback()}module.exports={FEATURE_FLAGS_GLOBAL_KEY,registerFeatureFlagsGlobal,getFeatureFlagsGlobal}});var X=b((exports,module)=>{var{getLogger}=V(),{CHUNK_SIZES}=Xt(),{getChunkSourcePath,getAllChunkNames}=Qe(),{registerFeatureFlagsGlobal}=et(),featureLogger=null,DEFAULT_CHUNK_TIMEOUT_MS=Number(process.env.EXPLORER_DATES_CHUNK_TIMEOUT||5e3),NETWORK_ERROR_CODES=new Set(["ENOTFOUND","ECONNRESET","ECONNREFUSED","EAI_AGAIN","ETIMEDOUT","EHOSTUNREACH"]),BUILT_CHUNK_CACHE=new Map,CHUNK_METHOD_ALIASES={reporting:"exportReporting",templates:"workspaceTemplates",analysis:"analysisCommands"},DEV_CHUNK_PATH_CACHE=new Map;function getDevChunkImportPath(i){if(DEV_CHUNK_PATH_CACHE.has(i))return DEV_CHUNK_PATH_CACHE.get(i);let e=getChunkSourcePath(i);if(!e)return DEV_CHUNK_PATH_CACHE.set(i,null),null;let t=e;return t.startsWith("src/")&&(t=t.slice(4)),t.startsWith("./")||(t=`./${t}`),DEV_CHUNK_PATH_CACHE.set(i,t),t}function resolveNodeDependencies(){if(nativeDepsResolved)return!!(nativePath&&nativeFs);if(nativeDepsResolved=!0,!isNodeLikeRuntime())return!1;try{nativePath=eval("require")("path"),nativeFs=eval("require")("fs")}catch{nativePath=null,nativeFs=null}return!!(nativePath&&nativeFs)}var nativeDepsResolved=!1,nativePath=null,nativeFs=null;function isWebRuntime(){try{return typeof navigator<"u"&&navigator?.userAgent?navigator.userAgent.includes("vscode-web")||navigator.userAgent.includes("Code - Web"):typeof process<"u"&&!0}catch{return!1}}function isNodeLikeRuntime(){return typeof process<"u"&&!!process.versions?.node&&!isWebRuntime()}function getChunkTimeoutMs(){return DEFAULT_CHUNK_TIMEOUT_MS>0?DEFAULT_CHUNK_TIMEOUT_MS:0}function logFeature(i,e,t){featureLogger||(featureLogger=getLogger());let s=featureLogger;typeof s[i]=="function"?s[i](e,t):s.info(e,t)}function logFeatureDisabled(i,e){logFeature("info","Feature disabled via configuration",{feature:i,savedKB:e&&CHUNK_SIZES[e]!==void 0?CHUNK_SIZES[e]:void 0})}function isLikelyNetworkIssue(i){if(!i)return!1;if(i.code&&NETWORK_ERROR_CODES.has(i.code))return!0;let e=(i.message||"").toLowerCase();return e.includes("network")||e.includes("fetch")||e.includes("timed out")}function runWithChunkTimeout(i,e){let t=getChunkTimeoutMs(),s=()=>{try{return Promise.resolve(i())}catch(r){return Promise.reject(r)}};return t?new Promise((r,o)=>{let n=!1,c=setTimeout(()=>{if(n)return;n=!0;let a=new Error(`Chunk "${e}" load timed out after ${t}ms`);a.code="CHUNK_TIMEOUT",o(a)},t);s().then(a=>{n||(n=!0,clearTimeout(c),r(a))}).catch(a=>{n||(n=!0,clearTimeout(c),o(a))})}):s()}function logResolverFailure(i,e){if(!e)return;let t={chunkName:i,error:e.message,code:e.code,networkIssue:isLikelyNetworkIssue(e),timedOut:e.code==="CHUNK_TIMEOUT"},s=t.networkIssue||t.timedOut?"warn":"error";logFeature(s,"Chunk resolver failed",t)}function tryLoadBuiltChunk(i){if(!i||!resolveNodeDependencies()||typeof nativeFs?.existsSync!="function")return null;if(BUILT_CHUNK_CACHE.has(i))return BUILT_CHUNK_CACHE.get(i);let e=[];typeof __dirname=="string"&&nativePath&&(e.push(nativePath.join(__dirname,"chunks",`${i}.js`)),e.push(nativePath.join(__dirname,"..","dist","chunks",`${i}.js`)));for(let t of e)try{if(!t||!nativeFs.existsSync(t))continue;let s=require(t),r=s?.default||s;return BUILT_CHUNK_CACHE.set(i,r||null),r&&logFeature("info","Loaded chunk via built artifact fallback",{chunkName:i,path:t}),r}catch(s){logFeature("warn","Built chunk fallback failed",{chunkName:i,path:t,error:s.message})}return BUILT_CHUNK_CACHE.set(i,null),null}function tryRequireDevChunk(i){if(isWebRuntime())return null;let e=getDevChunkImportPath(i);if(!e)return null;try{let t=require(e);return t?.default||t}catch(t){(t.code!=="MODULE_NOT_FOUND"||typeof t.message=="string"&&!t.message.includes(e))&&logFeature("debug","Dev chunk require failed",{chunkName:i,importPath:e,error:t.message})}return null}function tryRequireLocalBuiltChunk(i){if(isWebRuntime())return null;let e=`./chunks/${i}`;try{let t=require(e);return t?.default||t}catch(t){t.code==="MODULE_NOT_FOUND"||logFeature("debug","Local chunk require failed",{chunkName:i,importPath:e,error:t.message})}return null}function getSavingsKey(i){return i in CHUNK_SIZES?i:CHUNK_METHOD_ALIASES[i]||null}function announceChunkSavings(i){let e=getSavingsKey(i);if(!e)return;let t=CHUNK_SIZES[e];if(!t)return;let r=`\u{1F4BE} ${e===i||!i?e:`${e} (requested as "${i}")`} chunk unavailable - keeping the feature disabled is saving ~${t}KB`;logFeature("info","Chunk savings applied",{chunkName:e,requestedName:i,savedKB:t})}var getFeatureConfig=()=>{try{let e=require("vscode").workspace.getConfiguration("explorerDates");return{enableOnboarding:e.get("enableOnboardingSystem",!0),enableExportReporting:e.get("enableExportReporting",!0),enableWorkspaceTemplates:e.get("enableWorkspaceTemplates",!0),enableAnalysisCommands:e.get("enableAnalysisCommands",!0),enableAdvancedCache:e.get("enableAdvancedCache",!0),enableWorkspaceIntelligence:e.get("enableWorkspaceIntelligence",!0),enableIncrementalWorkers:e.get("enableIncrementalWorkers",!1),enableExtensionApi:e.get("enableExtensionApi",!0)}}catch{return{enableOnboarding:!0,enableExportReporting:!0,enableWorkspaceTemplates:!0,enableAnalysisCommands:!0,enableAdvancedCache:!0,enableWorkspaceIntelligence:!0,enableIncrementalWorkers:!1,enableExtensionApi:!0}}},featureLoaders=new Map,chunkResolver=null;function setFeatureChunkResolver(i){if(i&&typeof i!="function")throw new Error("Feature chunk resolver must be a function");chunkResolver=i||null}function registerFeatureLoader(i,e){if(typeof e!="function")throw new Error(`Feature loader for "${i}" must be a function`);featureLoaders.set(i,e)}function unregisterFeatureLoader(i){featureLoaders.delete(i)}function clearFeatureLoaders(){featureLoaders.clear()}async function loadFeatureModule(i){let e=featureLoaders.get(i);if(!e&&chunkResolver&&(e=()=>chunkResolver(i)),!e)return logFeature("warn","No loader registered for feature",{feature:i}),null;try{return await runWithChunkTimeout(()=>e(),i)}catch(t){return logFeature("warn","Feature loader failed",{feature:i,error:t.message,code:t.code,networkIssue:isLikelyNetworkIssue(t)}),announceChunkSavings(i),null}}function registerDefaultLoaders(){getAllChunkNames().forEach(e=>{featureLoaders.has(e)||registerFeatureLoader(e,createDefaultLoader(e))})}function createDefaultLoader(i){return async()=>{if(chunkResolver&&typeof chunkResolver=="function")try{let r=await runWithChunkTimeout(()=>chunkResolver(i),i);if(r)return r;logFeature("info","Chunk resolver returned no module",{chunkName:i})}catch(r){logResolverFailure(i,r)}let e=tryRequireDevChunk(i);if(e)return e;let t=tryRequireLocalBuiltChunk(i);if(t)return t;let s=tryLoadBuiltChunk(i);return s||(logFeature("warn","No built artifact available for chunk",{chunkName:i}),null)}}var featureFlags={async onboarding(){return getFeatureConfig().enableOnboarding?loadFeatureModule("onboarding"):(logFeatureDisabled("onboarding","onboarding"),null)},async exportReporting(){return getFeatureConfig().enableExportReporting?loadFeatureModule("reporting"):(logFeatureDisabled("exportReporting","exportReporting"),null)},async workspaceTemplates(){return getFeatureConfig().enableWorkspaceTemplates?loadFeatureModule("templates"):(logFeatureDisabled("workspaceTemplates","workspaceTemplates"),null)},async analysisCommands(){return getFeatureConfig().enableAnalysisCommands?loadFeatureModule("analysis"):(logFeatureDisabled("analysisCommands","analysisCommands"),null)},async advancedCache(){return getFeatureConfig().enableAdvancedCache?loadFeatureModule("advancedCache"):(logFeatureDisabled("advancedCache","advancedCache"),null)},async workspaceIntelligence(){return getFeatureConfig().enableWorkspaceIntelligence?loadFeatureModule("workspaceIntelligence"):(logFeatureDisabled("workspaceIntelligence","workspaceIntelligence"),null)},async incrementalWorkers(){return getFeatureConfig().enableIncrementalWorkers?loadFeatureModule("incrementalWorkers"):(logFeatureDisabled("incrementalWorkers","incrementalWorkers"),null)},async extensionApi(){return getFeatureConfig().enableExtensionApi?loadFeatureModule("extensionApi"):(logFeatureDisabled("extensionApi","extensionApi"),null)},async uiAdapters(){return loadFeatureModule("uiAdapters")},async batchProcessor(){return loadFeatureModule("batchProcessor")},async decorationsAdvanced(){return loadFeatureModule("decorationsAdvanced")},async gitInsights(){return loadFeatureModule("gitInsights")},isEnabled(i){let e=getFeatureConfig();return{onboarding:e.enableOnboarding,exportReporting:e.enableExportReporting,workspaceTemplates:e.enableWorkspaceTemplates,analysisCommands:e.enableAnalysisCommands,advancedCache:e.enableAdvancedCache,workspaceIntelligence:e.enableWorkspaceIntelligence,incrementalWorkers:e.enableIncrementalWorkers,extensionApi:e.enableExtensionApi}[i]??!0},getEnabledFeatures(){let i=getFeatureConfig(),e=[];return i.enableOnboarding&&e.push("onboarding"),i.enableExportReporting&&e.push("exportReporting"),i.enableWorkspaceTemplates&&e.push("workspaceTemplates"),i.enableAnalysisCommands&&e.push("analysisCommands"),i.enableAdvancedCache&&e.push("advancedCache"),i.enableWorkspaceIntelligence&&e.push("workspaceIntelligence"),i.enableIncrementalWorkers&&e.push("incrementalWorkers"),i.enableExtensionApi&&e.push("extensionApi"),e},calculateSavings(){let i=getFeatureConfig(),e=0;return i.enableOnboarding||(e+=34),i.enableExportReporting||(e+=17),i.enableExtensionApi||(e+=15),i.enableWorkspaceTemplates||(e+=14),i.enableWorkspaceIntelligence||(e+=12),i.enableAnalysisCommands||(e+=8),i.enableAdvancedCache||(e+=5),e}};for(let[i,e]of Object.entries(CHUNK_METHOD_ALIASES))!featureFlags[i]&&typeof featureFlags[e]=="function"&&(featureFlags[i]=(...t)=>featureFlags[e](...t));function calculateSavings(i){i||(i=getFeatureConfig());let e=267,t=0;i.enableOnboarding||(t+=34),i.enableExportReporting||(t+=17),i.enableExtensionApi||(t+=15),i.enableWorkspaceTemplates||(t+=14),i.enableWorkspaceIntelligence||(t+=12),i.enableIncrementalWorkers||(t+=19),i.enableAnalysisCommands||(t+=8),i.enableAdvancedCache||(t+=5);let s=e-t,r=t>0?Math.round(t/e*100):0;return{baseSize:`${e}KB`,totalSavings:`${t}KB`,optimizedSize:`${s}KB`,percentage:r}}registerDefaultLoaders();var exportedFeatureFlags={...featureFlags,getFeatureConfig,calculateSavings,registerFeatureLoader,setFeatureChunkResolver,unregisterFeatureLoader,clearFeatureLoaders,loadFeatureModule,registerDefaultLoaders};registerFeatureFlagsGlobal(exportedFeatureFlags);module.exports=exportedFeatureFlags});var ds=b((xi,hs)=>{var h=require("vscode"),{getLogger:xr}=V(),{getLocalization:Ar}=ze(),{fileSystem:Mr}=Se(),{formatFileSize:Rr,trimBadge:Zt}=Wt(),{getFileName:nt,getExtension:Te,getCacheKey:Lr,normalizePath:R,getUriPath:$}=ae(),{DEFAULT_CACHE_TIMEOUT:Qt,DEFAULT_MAX_CACHE_SIZE:Or,MONTH_ABBREVIATIONS:Pr,GLOBAL_STATE_KEYS:Ir,DEFAULT_DECORATION_POOL_SIZE:es,DEFAULT_FLYWEIGHT_CACHE_SIZE:tt,WORKSPACE_SCALE_LARGE_THRESHOLD:st,WORKSPACE_SCALE_EXTREME_THRESHOLD:us,WORKSPACE_SCAN_MAX_RESULTS:$r}=le(),{isWebEnvironment:at}=Be(),{ensureDate:ts}=ce(),{SecurityValidator:Wr,SecureFileOperations:Nr,detectSecurityEnvironment:ss}=Ye(),{setCachedWorkspaceMetrics:Ur}=qt(),rs=process.env.EXPLORER_DATES_DISABLE_GIT_FEATURES==="1",U=null;try{at()||(U=require("path"))}catch{U=null}var Fe={basename:i=>{if(U)return U.basename(i);let e=i.replace(/\\/g,"/"),t=e.lastIndexOf("/");return t===-1?e:e.substring(t+1)},dirname:i=>{if(U)return U.dirname(i);let e=i.replace(/\\/g,"/"),t=e.lastIndexOf("/");return t===-1?".":e.substring(0,t)}},xe=3e4,rt="::",is=Number(process.env.EXPLORER_DATES_MAX_DYNAMIC_WATCHERS||200),os=Number(process.env.EXPLORER_DATES_WATCHER_TTL_MS||600*1e3),ns=["ts","tsx","js","jsx","mjs","cjs","mts","cts","vue","py","go","rb","rs","java","kt","swift","cs","cpp","c","php","scala","sql","md","mdx","json","jsonc","yml","yaml","toml","ini","txt","html","css","scss"],zr=new Map([["src",100],["app",95],["apps",95],["packages",90],["services",85],["service",80],["client",75],["clients",70],["server",70],["servers",65],["lib",65],["libs",60],["api",60],["apis",60],["components",55],["modules",55],["feature",50],["features",50],["extensions",45],["scripts",45],["tools",45],["examples",40],["docs",35],["config",35],["test",30],["tests",30],["spec",30],["specs",30],["demo",25],["demos",25]]),J=Number(process.env.EXPLORER_DATES_WORKSPACE_SCAN_TIMEOUT||7e3),as=us,Ae="__root__",cs=300*1e3,Br=600*1e3,ls=900*1e3,Vr=Number(process.env.EXPLORER_DATES_VIEWPORT_HISTORY_LIMIT||400),it=["full","enhanced","standard","minimal"],Gr=Math.max(100,Number(process.env.EXPLORER_DATES_INDEXER_MAX_FILES||2e3)),Hr="EXPLORER_DATES_SECURITY_EXTRA_PATHS",ot=Number(process.env.EXPLORER_DATES_SECURITY_WARNING_THROTTLE_MS||5e3),Kr=Number(process.env.EXPLORER_DATES_SECURITY_WARNING_CACHE||500),he=Number(process.env.EXPLORER_DATES_SECURITY_MAX_WARNINGS_PER_FILE??1),I=(i="")=>{let e=typeof i=="string"?i:$(i),t=R(e);return nt(t)||t||"unknown"},ct=class{constructor(){this.n=new Map,this.b=new Map,this.u=0}get size(){return this.u}get bucketCount(){return this.n.size}clear(){this.n.clear(),this.b.clear(),this.u=0}get(e){if(!e)return;let t=this.b.get(e);if(!t)return;let s=this.n.get(t);if(!s){this.b.delete(e);return}return s.lastAccess=Date.now(),s.entries.get(e)}set(e,t,s={}){if(!e)return;let r=s.folderKey||this.Ns(e),o=this.Us(r),n=o.entries.has(e);o.entries.set(e,t),o.lastAccess=Date.now(),n||this.u++,this.b.set(e,r)}delete(e){if(!e)return!1;let t=this.b.get(e);if(!t)return!1;let s=this.n.get(t);if(!s)return this.b.delete(e),!1;let r=s.entries.delete(e);return r&&(this.u=Math.max(0,this.u-1),s.entries.size===0&&this.n.delete(t)),this.b.delete(e),r}*entries(){for(let e of this.n.values())yield*e.entries.entries()}*keys(){for(let e of this.n.values())yield*e.entries.keys()}*values(){for(let e of this.n.values())yield*e.entries.values()}[Symbol.iterator](){return this.entries()}enforceLimit(e=0,t){if(!e||this.u<=e)return 0;let s=Math.max(Math.floor(e*.2),this.u-e,1),r=0,o=Array.from(this.n.entries()).map(([n,c])=>({folderKey:n,bucket:c}));o.sort((n,c)=>(n.bucket.lastAccess||0)-(c.bucket.lastAccess||0));for(let{folderKey:n,bucket:c}of o){if(r>=s)break;if(!c.entries.size){this.n.delete(n);continue}let a=c.entries.size,l=s-r;if(a<=l){r+=this.zs(n,c);continue}let u=Array.from(c.entries.entries());u.sort((f,p)=>(f[1].timestamp||0)-(p[1].timestamp||0));let d=Math.min(l,Math.max(1,Math.ceil(a*.5)));for(let f=0;f<d&&f<u.length;f++){let[p]=u[f];c.entries.delete(p),this.b.delete(p),r++,this.u=Math.max(0,this.u-1)}c.entries.size?c.lastAccess=Date.now():this.n.delete(n)}return r>0&&t&&t.debug(`Hierarchical cache eviction removed ${r} entries (${this.u} remaining)`),r}Us(e){return this.n.has(e)||this.n.set(e,{entries:new Map,lastAccess:Date.now()}),this.n.get(e)}zs(e,t){if(!t)return 0;let s=t.entries.size;for(let r of t.entries.keys())this.b.delete(r);return this.n.delete(e),this.u=Math.max(0,this.u-s),s}Ns(e){if(!e||typeof e!="string")return Ae;let t=R(e);if(!t)return Ae;let s=t.lastIndexOf("/");return s===-1?Ae:t.slice(0,s)||Ae}},jr=!0,lt=class{constructor(){this.f=new h.EventEmitter,this.onDidChangeFileDecorations=this.f.event,this.e=new ct,this.te=new Map,this.Bs=new Map,this.xe=[],this.Ae=20,this.p=this.Ae,this.y=0,this.st=!1,this.Nt=!1,this.C=new Map,this.D=[],this.a={hits:0,misses:0,allocations:0,reuses:0},this.I=es,this.se=new Map,this.rt=[],this.it=tt,this.$={hits:0,misses:0,allocations:0,reuses:0},this.re=new Map,this.ot=[],this.nt=tt,this.W={hits:0,misses:0,allocations:0,reuses:0},this.Me=process.env.EXPLORER_DATES_ENABLE_DECORATION_POOL!=="0",this.Re=process.env.EXPLORER_DATES_ENABLE_FLYWEIGHTS!=="0",this.E=process.env.EXPLORER_DATES_LIGHTWEIGHT_MODE==="1",this.Le=process.env.EXPLORER_DATES_MEMORY_SHEDDING==="1",this.Oe=Number(process.env.EXPLORER_DATES_MEMORY_SHED_THRESHOLD_MB||3),this.Pe=!1,this.ie=this.Le?this.Ut():0,this.Vs=Number(process.env.EXPLORER_DATES_MEMORY_SHED_CACHE_LIMIT||1e3),this.zt=Number(process.env.EXPLORER_DATES_MEMORY_SHED_REFRESH_MS||6e4),this.S=null,this.Ie=process.env.EXPLORER_DATES_FORCE_CACHE_BYPASS==="1",this.Bt=Number(process.env.EXPLORER_DATES_LIGHTWEIGHT_PURGE_INTERVAL||400),this._isWeb=jr||at(),this.at=Qt*4,this.Vt=this.at,this.ct=0,this.s=Or,this._fileSystem=Mr,this.$e=!this._isWeb,this.Gt=!1,this.i=null,this.oe=null,this._allocationTelemetryEnabled=process.env.EXPLORER_DATES_TELEMETRY==="1",this._telemetryReportInterval=Number(process.env.EXPLORER_DATES_TELEMETRY_INTERVAL_MS||6e4),this._telemetryReportTimer=null,this.N=null,this.Ht=new Map,this.T=new Set,this._=new Map,this.Kt=Vr,this.U=cs,this.jt=Date.now(),this.z=[],this.B="full",this.ne=null,this._logger=xr(),this.F=Ar(),this._workspaceIntelligence=null,this._batchProcessor=null,this._batchProcessorModule=null,this._progressiveLoadingJobs=new Set,this._progressiveLoadingEnabled=!1,this.ae=null,this.We=null,this._advancedCache=null,this.r=null,this.m=new Set,this.V=void 0,this.h=new Map,this.G=[],this.ce=null,this.H=!0,this._enableWatcherFallbacks="auto",this._smartWatcherFallbackManager=null,this.le=null,this.x="none",this.K=new Map,this.Ne=null,this.t="unknown",this.Gs=process.env.EXPLORER_DATES_LOG_WATCHERS==="1",this.Ue=ss(),this.qt=!0,this.lt=[],this.Yt=!0,this.ut=!1,this.Xt=!1,this.ue=new Map,this.ze=ot,this.he=Number.isFinite(he)?Math.max(0,he):1,this.ht=typeof h.workspace.onDidChangeWorkspaceFolders=="function"?h.workspace.onDidChangeWorkspaceFolders(s=>this.Hs(s)):null,this.A=null,this.ge=null,this.fe=null,this.M=null,this.pe=!1,this.dt=0,this.R=!1,this._themeIntegration=null,this._accessibility=null,this.gt=!1,this.ft={profile:"stress",throttleKey:"decorations:request",throttleLimit:Number(process.env.EXPLORER_DATES_LOG_INFO_LIMIT||50)},this._metrics={totalDecorations:0,cacheHits:0,cacheMisses:0,cacheEvictions:0,errors:0,gitBlameTimeMs:0,gitBlameCalls:0,fileStatTimeMs:0,fileStatCalls:0,viewportPriorityDecorations:0,viewportBackgroundDecorations:0},this.w=null,this.L=6e4,this.j=new Set,this.me=!1,this.pt=!1;let e=h.workspace.getConfiguration("explorerDates"),t=e.get("cacheTimeout",xe);this.mt=this.Jt(e,t),this.l=this.Zt(t),this.Be=e.get("performanceMode",!1),this.wt=!1,this._performanceMode=this.Be,this.Qt(e),this.ts(e),this.ss(e),this.E&&(this._performanceMode=!0,this.Me=!1,this.Re=!1,this.l=Math.min(this.l,5e3),this.s=Math.min(this.s,64),this._logger.info("Lightweight mode: decoration pooling and flyweight caches disabled; cache timeout capped at 5s")),this._performanceMode||this.we(),this.Ks(),this._performanceMode||this.O(),this.q(this.Y(e),"initialization"),this.js(),this._logger.info(`FileDateDecorationProvider initialized (performanceMode: ${this._performanceMode})`),this.Ie&&this._logger.warn("Force cache bypass mode enabled - decoration caches will be skipped"),this.Me||this._logger.warn("Decoration pool disabled via EXPLORER_DATES_ENABLE_DECORATION_POOL=0"),this.Re||this._logger.warn("Flyweight caches disabled via EXPLORER_DATES_ENABLE_FLYWEIGHTS=0"),this.E&&this._logger.warn("Lightweight mode enabled via EXPLORER_DATES_LIGHTWEIGHT_MODE=1 (performanceMode forced on)"),this.Le&&this._logger.warn(`Memory shedding enabled (threshold ${this.Oe} MB); will stretch refresh interval and shrink cache if exceeded.`),this.Ve=[],this.Ge=Number(process.env.EXPLORER_DATES_SOFT_HEAP_ALERT_MB||2),this.X=0,this.be=!1,this.bt=Number(process.env.EXPLORER_DATES_CACHE_PRESSURE_RATIO||.7),this.He=!1,this.o=null,this._extensionContext=null,this.rs()}async rs(){let e=h.workspace.getConfiguration("explorerDates"),t=e.get("autoThemeAdaptation",!0),s=e.get("accessibilityMode",!1);if(t||s)try{let r=await this.qs();r&&(this._themeIntegration=t?r.themeManager:null,this._accessibility=s?r.accessibilityManager:null,this.gt=!0,this._logger.debug(`\u{1F50C} UI adapters loaded: theme=${!!this._themeIntegration}, accessibility=${!!this._accessibility}`))}catch(r){this._logger.error("Failed to load UI adapters chunk:",r),this._themeIntegration=null,this._accessibility=null,this.gt=!1}else this._logger.debug("\u{1F50C} UI adapters not loaded (features disabled)")}async qs(){try{let t=await X().uiAdapters();return t?typeof t.createUIAdapters=="function"?await t.createUIAdapters():t:null}catch(e){return this._logger.warn("UI adapters chunk not available:",e.message),null}}async Ys(){return rs?(this.$e=!1,null):this.oe?this.oe:this.i?this.i:(this.oe=(async()=>{try{let t=await X().gitInsights();if(!t)throw new Error("Git insights chunk failed to load");let s=null;if(typeof t=="function"?s=t:t&&typeof t.getGitInsightsManager=="function"?s=t.getGitInsightsManager:t&&typeof t.default=="function"&&(s=t.default),typeof s!="function")throw new Error("Git insights chunk missing getGitInsightsManager export");if(this.i=s(),!this.i||typeof this.i.initialize!="function")throw new Error("Git insights manager factory returned invalid instance");let r=h.workspace.getConfiguration("explorerDates");return await this.i.initialize({enableWorker:r.get("enableWorkerThreads",!0),enableWasm:r.get("enableWasmDigest",!0)}),this.$e=await this.i.isGitAvailable(),this._logger.debug("\u{1F527} Git insights manager loaded and initialized"),this.i}catch(e){return this._logger.error("Failed to load git insights:",e),this.i=null,this.$e=!1,null}finally{this.oe=null}})(),this.oe)}async Xs(){this._themeIntegration&&typeof this._themeIntegration.dispose=="function"&&this._themeIntegration.dispose(),this._accessibility&&typeof this._accessibility.dispose=="function"&&this._accessibility.dispose(),this._themeIntegration=null,this._accessibility=null,this.gt=!1,await this.rs()}applyPreviewSettings(e){let t=!!this.o;e&&typeof e=="object"?(this.o=Object.assign({},e),this._logger.info("\u{1F504} Applied preview settings",this.o)):(this.o=null,this._logger.info("\u{1F504} Cleared preview settings"));let s=this.e.size;if(this.e.clear(),this.J("preview-mode-change"),this._logger.info(`\u{1F5D1}\uFE0F Cleared memory cache (${s} items) for preview mode change`),this._advancedCache)try{typeof this._advancedCache.clear=="function"?(this._advancedCache.clear(),this._logger.info("\u{1F5D1}\uFE0F Cleared advanced cache for preview mode change")):this._logger.warn("\u26A0\uFE0F Advanced cache does not support clear operation")}catch(r){this._logger.warn("\u26A0\uFE0F Failed to clear advanced cache:",r.message)}this.o&&!t?this._logger.info("\u{1F3AD} Entered preview mode - caching disabled"):!this.o&&t&&this._logger.info("\u{1F3AD} Exited preview mode - caching re-enabled"),this.f.fire(void 0),this._logger.info("\u{1F504} Fired decoration refresh event for preview change")}async testDecorationProvider(){this._logger.info("\u{1F9EA} Testing decoration provider functionality...");let e=h.workspace.workspaceFolders;if(!e||e.length===0){this._logger.error("\u274C No workspace folders available for testing");return}let t=h.Uri.joinPath(e[0].uri,"package.json");try{let s=await this.provideFileDecoration(t);this._logger.info("\u{1F9EA} Test decoration result:",{file:"package.json",success:!!s,badge:s?.badge,hasTooltip:!!s?.tooltip,hasColor:!!s?.color}),this.f.fire(t),this._logger.info("\u{1F504} Fired decoration change event for test file")}catch(s){this._logger.error("\u274C Test decoration failed:",s)}}forceRefreshAllDecorations(){this._logger.info("\u{1F504} Force refreshing ALL decorations..."),this.Z(),this.e.clear(),this.J("force-refresh"),this._advancedCache&&this._advancedCache.clear(),this.f.fire(void 0),this._logger.info("\u{1F504} Triggered global decoration refresh")}startProviderCallMonitoring(){this.yt=0,this.ye=new Set;let e=this.provideFileDecoration.bind(this);this.provideFileDecoration=async(t,s)=>{this.yt++;let r=$(t)||t?.toString(!0)||"unknown";return this.ye.add(R(r)),this._logger.info(`\u{1F50D} Provider called ${this.yt} times for: ${I(t||r)}`),await e(t,s)},this._logger.info("\u{1F4CA} Started provider call monitoring")}getProviderCallStats(){return{totalCalls:this.yt||0,uniqueFiles:this.ye?this.ye.size:0,calledFiles:this.ye?Array.from(this.ye):[]}}async checkWorkspaceSize(){if(this.ge)return this.ge;if(!this.fe){this.pe=!1;let s=this.Js().then(r=>(this.pe&&(this.pe=!1,this._logger.info("Workspace size scan completed after watchdog fallback; applied actual workspace metrics",{workspaceFileCount:this.Ne,workspaceScale:this.t})),r)).catch(r=>{this._logger.debug("Workspace size check failed (non-critical):",r)});this.fe=s.finally(()=>{this.fe=null})}let e=this.Zs(),t=e?[this.fe,e]:[this.fe];return this.ge=Promise.race(t).finally(()=>{this.Qs(),this.ge=null}),this.ge}async er(e){let t=Number.isFinite(J)?J:0,s=h.workspace.findFiles("**/*",null,e);if(!t||t<=0)return s;try{return await new Promise((r,o)=>{let n=null,c=(a,l=!1)=>{n&&(clearTimeout(n),n=null),l?o(a):r(a)};n=setTimeout(()=>c(null),t),s.then(a=>c(a),a=>c(a,!0))})}catch(r){return this._logger.warn("Workspace scan failed, assuming large workspace",{error:r.message}),null}}Zs(){if(this.pe)return Promise.resolve();let e=Number(process.env.EXPLORER_DATES_WORKSPACE_SCAN_WATCHDOG_MS),t=Number.isFinite(J)&&J>0?J:5e3,s=Number.isFinite(e)?e:Math.min(2e4,Math.max(3e3,t+2e3));return!Number.isFinite(s)||s<=0?null:(this.M&&clearTimeout(this.M),new Promise(r=>{this.M=setTimeout(()=>{this.M=null,this.pe=!0,this.Ne=as,this.t="extreme";try{let o=h.workspace.getConfiguration("explorerDates");this.q(this.Y(o),"workspace-scale-watchdog")}catch{this.q(this.Y(),"workspace-scale-watchdog")}this._logger.warn(`Workspace size check exceeded ${s}ms; forcing extreme scale fallback`),r()},s)}))}Qs(){this.M&&(clearTimeout(this.M),this.M=null)}async Js(){let e=h.workspace.getConfiguration("explorerDates"),t=e.get("forceEnableForLargeWorkspaces",!1),s=e.get("performanceMode",!1),r=t||s,o=h.workspace.workspaceFolders;if(!o||o.length===0)return;this._logger.info("Checking workspace size for large workspace detection...");let n=await this.er($r),c=!Array.isArray(n),a=c?as:n.length;if(c){let u=J?`${J}ms`:"the configured timeout";this._logger.warn(`Workspace scan exceeded ${u}; defaulting to extreme scale`)}else{let u=`${st}+`;this._logger.info(`Workspace contains ${a>=st?u:a} files`)}let l=this.t;this.Ne=a,this.t=a>=us?"extreme":a>=st?"large":"normal";try{let u=o[0]?.uri;Ur(u,a)}catch(u){this._logger.debug("Unable to cache workspace file count",u)}l!==this.t&&this.H&&!this._performanceMode&&(this._logger.info(`Workspace scale changed ${l} -> ${this.t}; recalibrating watchers`),this.we("workspace-scale-update")),this._batchProcessor&&typeof this._batchProcessor.setWorkspaceScale=="function"&&this._batchProcessor.setWorkspaceScale(this.t||"normal"),this.q(this.Y(e),"workspace-scale-change"),r&&this._logger.debug("Large workspace prompt suppressed (force/performance mode), but scaling adjustments applied")}_getIndexerMaxFiles(){let e=Gr;return this.t==="extreme"?Math.min(600,e):this.t==="large"?Math.min(1200,e):e}_shouldEnableProgressiveAnalysis(){let t=h.workspace.getConfiguration("explorerDates").get("enableProgressiveAnalysis");return t===!0||t===!1?t:this.t==="large"||this.t==="extreme"}we(e="initial"){if(this._performanceMode||this.R){let r=this.R?"provider disposed":"performance mode enabled";this._logger.debug(`Skipping file watcher setup (${e}) - ${r}`);return}this.V||(this.V={pending:!0});let t=++this.dt;(async()=>{if(this.le)try{await this.le}catch(o){this._logger.debug("Previous watcher setup promise rejected",o)}let r=this.tr(e,t);this.le=r;try{await r}finally{this.le===r&&(this.le=null)}})().catch(r=>{this._logger.error("Failed to configure file watchers",r)})}async tr(e,t){if(this.Ee(t))return;if(this.Ke({permanent:!1}),this.Ee(t)){this.je("post-dispose");return}this.V={pending:!0};let s=h.workspace.workspaceFolders;if(!s||s.length===0){this._logger.debug("No workspace folders detected; skipping watcher setup"),this.x="none";return}if(at()){this._logger.info("File watchers are unavailable in web environments; skipping watcher setup"),this.x="none";return}let r=h.workspace.getConfiguration("explorerDates"),o=process.env.EXPLORER_DATES_DISABLE_SMART_WATCHERS==="1";this.H=!o&&r.get("smartFileWatching",!0),this._enableWatcherFallbacks=this.H&&r.get("enableSmartWatcherFallbacks","auto");let n=r.get("smartWatcherMaxPatterns",20),c=this.sr(r.get("smartWatcherExtensions",ns)),a=this.rr(n);if(this.ir={maxPatterns:a,extensions:c},this.Ee(t)){this.je("post-config");return}if(!this.H){this._logger.info("Smart file watching disabled; falling back to global watcher"),await this.qe("disabled");return}let l=[];try{l=await this.or(s,this.ir)}catch(u){this._logger.error("Smart watcher analysis failed, falling back to global watcher",u),await this.qe("analysis-failed");return}if(this.Ee(t)){this.je("post-analysis");return}if(!l||l.length===0){this._logger.warn("Smart watcher analysis yielded no targets; falling back to global watcher"),await this.qe("no-targets");return}for(let u of l)try{let d=await this.is(u.pattern,u.label);d&&(this.Et(d,u.label),this.m.add(d))}catch(d){this._logger.debug(`Failed to create watcher for pattern ${u.label}`,d)}if(this.m.size===0){this._logger.warn("Smart watcher setup produced zero watchers; using global fallback"),await this.qe("no-watchers-created");return}if(this.Ee(t)){this.je("post-creation");return}this.V=this.m.values().next().value||void 0,this.x="smart",this._logger.info(`Smart file watching enabled (${this.m.size} base watcher${this.m.size===1?"":"s"})`,{reason:e,patterns:l.map(u=>u.label)}),this.nr()}Ee(e){return!!(this.R||this._performanceMode||typeof e=="number"&&e!==this.dt)}je(e="unknown"){let t=this._performanceMode||this.R;this.Ke({permanent:t}),this._logger.debug(`Watcher setup aborted (${e})`,{permanentAbort:t,disposed:this.R,performanceMode:this._performanceMode})}async _e(){return this.We?this.We:(this.We=(async()=>{try{let t=await X().decorationsAdvanced();return this.ae=t||null,this.ae}catch(e){return this._logger.debug("Failed to load decorationsAdvanced chunk",e),this.ae=null,null}})(),this.We)}async is(e,t="unknown"){try{let r=await this._e();if(r?.createWatcherWithFallback)return await r.createWatcherWithFallback(this,e,t)}catch(r){this._logger.debug(`Advanced watcher chunk failed for ${t}`,r)}let s=()=>{if(this._enableWatcherFallbacks===!1)return!1;if(this._enableWatcherFallbacks==="auto"||this._enableWatcherFallbacks===!0){let r=process.platform,o=process.env.WSL_DISTRO_NAME||process.env.WSLENV,n=h.env.remoteName,c=process.env.DOCKER_CONTAINER;return o||n||c||r==="android"}return!1};try{let r=h.workspace.createFileSystemWatcher(e);return this._logger.debug(`Native watcher created for ${t}`),r}catch(r){return this._logger.debug(`Native watcher failed for ${t}:`,r),s()?this.ar(e,t):null}}async ar(e,t){try{let s=await this._e();if(s?.createFallbackWatcher)return await s.createFallbackWatcher(this,e,t)}catch(s){this._logger.warn(`Fallback watcher creation failed for ${t}:`,s)}try{if(!this._smartWatcherFallbackManager){let{loadFeatureModule:s}=X(),r=await s("smartWatcherFallback");if(r){let{SmartWatcherFallbackManager:o}=r;this._smartWatcherFallbackManager=new o({logger:this._logger}),await this._smartWatcherFallbackManager.initialize()}}if(this._smartWatcherFallbackManager){let r=await(await this._smartWatcherFallbackManager.getFallback()).createWatcherWithFallback(e);return this._logger.debug(`Fallback watcher created for ${t}`),r}}catch(s){this._logger.warn(`Fallback watcher creation failed for ${t}:`,s)}return null}async qe(e="global-default"){this._t();let t=await this.is("**/*",`global:${e}`);t?(this.Et(t,`global:${e}`),this.m.add(t),this.V=t,this.x="global",this._logger.info(`Global watcher activated (${e})`)):this._logger.error(`Failed to create global watcher (${e})`)}Et(e,t="unknown"){e&&(e.onDidChange(s=>this.Ct(s,"change",t)),e.onDidCreate(s=>this.Ct(s,"create",t)),e.onDidDelete(s=>this.Ct(s,"delete",t)))}Ct(e,t,s="unknown"){if(!e||e.scheme!=="file"||!this.Ye(e,`watcher:${t}`)?.isValid)return;let o=this.cr();if(o<=0){this.os(e,t,s);return}let n=`${e.toString()}:${t}`,c=this.K.get(n);c&&clearTimeout(c.timer);let a=setTimeout(()=>{this.K.delete(n),this.os(e,t,s)},o);this.K.set(n,{timer:a,source:s})}os(e,t,s){t==="delete"?this.clearDecoration(e):this.refreshDecoration(e),this._workspaceIntelligence?.incrementalIndexer&&this._workspaceIntelligence.incrementalIndexer.queueDelta(e,t),this.Gs&&this._logger.debug(`Watcher event processed (${t}) for ${I(e)} via ${s}`)}cr(){if(this._performanceMode)return 0;switch(this.t){case"extreme":return 600;case"large":return 250;default:return 100}}Hs(e){let t=(e?.added||[]).map(o=>o.uri).filter(Boolean),s=(e?.removed||[]).map(o=>o.uri).filter(Boolean);if(t.length===0&&s.length===0)return;let r=async()=>{if(this._logger.info("Workspace folders changed",{added:t.length,removed:s.length}),await this.checkWorkspaceSize(),!this._performanceMode&&(this.we("workspace-change"),await this.ns().catch(o=>{this._logger.debug("Failed to reconfigure progressive loading after workspace change",o)}),this._workspaceIntelligence)){let o=(h.workspace.workspaceFolders||[]).map(n=>({uri:n.uri}));await this._workspaceIntelligence.onWorkspaceFoldersChanged({added:o,removed:s.map(n=>({uri:n}))})}};this.A&&clearTimeout(this.A),this.A=setTimeout(()=>{this.A=null,r().catch(o=>this._logger.debug("Workspace folder change handling failed",o))},250)}Ke(e={}){let t=e.permanent===!0;if(this.m?.size){for(let s of this.m)try{s.dispose()}catch(r){this._logger.debug("Failed to dispose file watcher",r)}this.m.clear()}this.V=t?null:void 0,this._t(),this.as(!0),this.lr(),this.x="none"}lr(){if(this.K?.size){for(let e of this.K.values())clearTimeout(e.timer);this.K.clear()}}nr(){if(!this.H||this.G.length>0)return;let e=(s,r)=>{let o=this.Xe(h.window,s,r);o&&this.G.push(o)},t=(s,r)=>{let o=this.Xe(h.workspace,s,r);o&&this.G.push(o)};e("onDidChangeVisibleTextEditors",s=>{(s||[]).forEach(r=>this.Ce(r?.document?.uri,"visible-editor"))}),e("onDidChangeActiveTextEditor",s=>{this.Ce(s?.document?.uri,"active-editor")}),t("onDidOpenTextDocument",s=>{this.Ce(s?.uri,"open-document")}),t("onDidSaveTextDocument",s=>{this.Ce(s?.uri,"save-document")}),this.ur(),this.hr()}_t(){if(this.G?.length){for(let e of this.G)try{e.dispose()}catch(t){this._logger.debug("Failed to dispose watcher listener",t)}this.G=[]}this.cs()}dr(){if(this._smartWatcherFallbackManager){try{this._smartWatcherFallbackManager.dispose()}catch(e){this._logger.debug("Error disposing smart watcher fallback manager:",e)}this._smartWatcherFallbackManager=null}}ur(){(Array.isArray(h.window?.visibleTextEditors)?h.window.visibleTextEditors:[]).forEach(t=>this.Ce(t?.document?.uri,"visible-seed"))}hr(){this.ce||(this.ce=setInterval(()=>this.as(),os))}cs(){this.ce&&(clearInterval(this.ce),this.ce=null)}as(e=!1){if(!this.h?.size)return;let t=Date.now()-os;for(let[s,r]of this.h.entries())if(e||r.lastUsed<t){try{r.watcher.dispose()}catch(o){this._logger.debug(`Failed to dispose dynamic watcher for ${s}`,o)}this.h.delete(s)}this.h.size||this.cs()}Ce(e,t="editor"){if(!this.H||!e||e.scheme!=="file"||!U)return;let s=Fe.dirname(e.fsPath||"");if(!s)return;let r=R(s),o=this.h.get(r);if(o){o.lastUsed=Date.now();return}this.h.size>=is&&this.gr();try{let n=new h.RelativePattern(r,"**/*"),c=h.workspace.createFileSystemWatcher(n),a=Fe.basename(r)||"root";this.Et(c,`dynamic:${t}:${a}`),this.h.set(r,{watcher:c,lastUsed:Date.now(),source:t})}catch(n){this._logger.debug(`Failed to create dynamic watcher for ${r}`,n)}}gr(){let e=null,t=Number.POSITIVE_INFINITY;for(let[s,r]of this.h.entries())r.lastUsed<t&&(t=r.lastUsed,e=s);if(e){let s=this.h.get(e);try{s?.watcher?.dispose()}catch(r){this._logger.debug(`Failed to evict watcher for ${e}`,r)}this.h.delete(e)}}js(){if(this.z.length>0)return;let e=(s,r)=>{let o=this.Xe(h.window,s,r);o&&this.z.push(o)},t=(s,r)=>{let o=this.Xe(h.workspace,s,r);o&&this.z.push(o)};e("onDidChangeVisibleTextEditors",s=>{this.ls(s)}),e("onDidChangeActiveTextEditor",s=>{this.Se(s?.document?.uri,{reason:"active-editor"})}),t("onDidOpenTextDocument",s=>{this.Se(s?.uri,{reason:"open-document"})}),t("onDidSaveTextDocument",s=>{this.Se(s?.uri,{reason:"save-document"})}),this.ls(Array.isArray(h.window?.visibleTextEditors)?h.window.visibleTextEditors:[]),h.window?.activeTextEditor?.document?.uri&&this.Se(h.window.activeTextEditor.document.uri,{reason:"initial-active"})}pr(){if(this.z?.length){for(let e of this.z)try{e.dispose()}catch(t){this._logger.debug("Failed to dispose viewport listener",t)}this.z=[],this.T.clear(),this._.clear()}}ls(e){if(this.T.clear(),!Array.isArray(e))return;let t=Date.now();for(let s of e){let r=s?.document?.uri;if(!r||r.scheme!=="file")continue;let o=R($(r));o&&(this.T.add(o),this._.set(o,t))}this.St()}Se(e,t={}){if(!e||e.scheme!=="file")return;let s=R($(e));if(!s)return;let r=Date.now();this._.set(s,r),t.visible&&this.T.add(s),this._.size>this.Kt?this.St(!0):r-this.jt>this.U&&this.St()}St(e=!1){let t=Date.now(),s=t-this.U*2;for(let[r,o]of this._.entries())(e||o<s||this._.size>this.Kt&&o<t)&&this._.delete(r);this.jt=t}mr(e){if(!e||e.scheme!=="file"||this._performanceMode||this.B==="full")return!0;let t=R($(e));if(!t||this.T.has(t))return!0;let s=this._.get(t);return s?Date.now()-s<=this.U:!1}async or(e,t){let s=[],r=h.workspace.getConfiguration("explorerDates"),o=this.wr(r);for(let n of e){if(s.length>=t.maxPatterns)break;let c=await this.br(n,o),a=new h.RelativePattern(n,"*.{md,mdx,json,jsonc,yml,yaml,ts,tsx,js,jsx}");if(s.push({pattern:a,label:`root:${n.name}`}),s.length>=t.maxPatterns)break;let l=t.maxPatterns-s.length,u=await this.yr(n,{excludedSet:c,extensions:t.extensions,limit:l});s.push(...u)}return s.slice(0,t.maxPatterns)}wr(e){let t=new Set,s=e.get("excludedFolders",[]);for(let o of s)this.Je(t,o);return["node_modules",".git",".hg",".svn","dist","build","out",".vscode",".idea",".cache",".parcel-cache",".yarn",".pnpm-store","tmp","temp","coverage",".next","logs","old-builds"].forEach(o=>this.Je(t,o)),t}async br(e,t){let s=new Set(t);if(!e||!this._workspaceIntelligence?.smartExclusion)return s;try{let r=await this._workspaceIntelligence.smartExclusion.getCombinedExclusions(e.uri),o=r?.folders||[],n=r?.patterns||[];for(let c of o)this.Je(s,c,{onlyRootSegment:!0});for(let c of n)this.Je(s,c,{onlyRootSegment:!0});(o.length||n.length)&&this._logger&&s.size>t.size&&this._logger.debug("Merged smart exclusion hints for watcher setup",{workspace:e.name,totalExclusions:s.size})}catch(r){this._logger.debug("Failed to merge smart exclusion data for watcher setup",r)}return s}Je(e,t,s={}){if(!t)return;let{onlyRootSegment:r=!1}=s,o=typeof t=="string"?t:typeof t?.toString=="function"?t.toString():"";if(!o||typeof o!="string")return;let n=o.trim();if(!n)return;let a=n.replace(/\\/g,"/").replace(/\*\*/g,"").replace(/\*/g,"").split("/").map(l=>l.trim()).filter(Boolean);if(!a.length){if(n.includes("*")||n.includes("?"))return;e.add(n.toLowerCase());return}if(r){e.add(a[0].toLowerCase());return}for(let l of a)e.add(l.toLowerCase())}Er(e=[]){if(!Array.isArray(e))return[];let t=new Set,s=[];for(let r of e)!r||t.has(r)||(t.add(r),s.push(r));return s}us(e=[]){let t=Array.isArray(e)?e:e?[e]:[],s=[];for(let r of t){if(!r||typeof r!="string")continue;let o=r.trim().replace(/^['"]|['"]$/g,"");if(!o)continue;let n=R(o);n?s.push(n):this._logger.debug(`Ignored invalid security path entry: ${r}`)}return s}hs(e,t){if(!(!e||typeof e.inspect!="function"))try{let s=e.inspect(t);if(!s||typeof s!="object")return;let r=[s.workspaceFolderValue,s.workspaceValue,s.globalValue];for(let o of r)if(typeof o=="boolean")return o;return}catch{return}}_r(){let e=process.env[Hr];if(!e||typeof e!="string")return[];let t=U&&U.delimiter||(process.platform==="win32"?";":":");return e.split(t).map(s=>s.trim()).filter(Boolean)}Cr(){return process.env.EXPLORER_DATES_TEST_MODE==="1"||!1||process.env.VSCODE_TEST==="1"}ts(e){let t=e||h.workspace.getConfiguration("explorerDates"),s=t.get("security.allowTestPaths",!0),r=t.get("security.allowedExtraPaths",[]);this.Ue=ss();let o=this.hs(t,"security.enableBoundaryEnforcement"),n=this.hs(t,"security.enforceWorkspaceBoundaries"),c;typeof o=="boolean"?c=o:typeof n=="boolean"?c=n:c=this.Ue==="production";let a=this.us(r),l=this.us(this._r());this.lt=this.Er([...a,...l]),this.qt=c!==!1,this.Yt=s!==!1,this.ut=this.Yt&&(this.Ue==="test"||this.Cr()),this.ut&&!this.Xt&&(this._logger.warn("Security workspace boundary enforcement relaxed (test environment detected)"),this.Xt=!0);let u=t.get("security.logThrottleWindowMs"),d=t.get("security.maxWarningsPerFile"),f=Number.isFinite(u)?Math.max(0,u):Number.isFinite(ot)?Math.max(0,ot):5e3;this.ze=f;let p=Number.isFinite(he)&&he>=0?he:1;Number.isFinite(d)&&d>=0?this.he=d:this.he=p}Sr(){let e=h.workspace.workspaceFolders||[],t=[],s=new Set,r=o=>{if(!o)return;let n=R(o);!n||s.has(n)||(s.add(n),t.push(n))};return e.forEach(o=>{try{r($(o.uri))}catch{}}),Array.isArray(this.lt)&&this.lt.forEach(o=>r(o)),t}vr(e){if(!e)return!1;let t=Date.now(),s=this.ue.get(e)||{lastTimestamp:0,count:0};if(typeof this.he=="number"&&this.he>=0&&s.count>=this.he||typeof this.ze=="number"&&this.ze>0&&t-s.lastTimestamp<this.ze)return!0;if(s.lastTimestamp=t,s.count=(s.count||0)+1,this.ue.set(e,s),this.ue.size>Kr){let r=Array.from(this.ue.keys()),o=Math.ceil(r.length*.25);for(let n=0;n<o;n++)this.ue.delete(r[n])}return!1}ds(e,t,s={},r={}){let o=`${e}:${t}`;if(this.vr(o))return;let n=this.Ue||"production",c=n==="production"?r.level||"warn":n==="development"?"info":"debug";(typeof this._logger[c]=="function"?this._logger[c].bind(this._logger):this._logger.warn.bind(this._logger))(`${e}: ${t}`,{environment:n,...s})}kr(e){let t="";if(typeof e=="string")t=e;else if(e&&(t=e.fsPath||e.path||"",!t&&typeof e.toString=="function"))try{t=e.toString(!0)}catch{t=e.toString()}return Wr.sanitizePath(t||"",{preserveExtension:!0})||"unknown"}Ye(e,t="operation"){if(!e)return{isValid:!1,issue:"Missing URI"};let s=this.Sr(),r=this.qt&&!this.ut&&s.length>0,o=Nr.validateFileUri(e,r?s:[]),n=this.kr(e);return o.isValid?o.warnings?.length&&this.ds(`Security warnings for ${t}`,n,{warnings:o.warnings,enforceBoundaries:r},{level:"info"}):this.ds(`Security validation blocked ${t}`,n,{issue:o.issue,enforceBoundaries:r}),o}async yr(e,t){if(t.limit<=0)return[];let s=[];try{s=await this._fileSystem.readdir(e.uri,{withFileTypes:!0})}catch(n){return this._logger.debug(`Failed to read workspace folder ${e.name}`,n),[]}let r=[];for(let n of s){if(!n.isDirectory())continue;let c=n.name.toLowerCase();if(this.Dr(c,t.excludedSet))continue;let a=zr.get(c)||(c.startsWith(".")?1:10);r.push({name:n.name,score:a})}return r.sort((n,c)=>c.score-n.score),r.slice(0,t.limit).map(n=>({pattern:new h.RelativePattern(e,this.Tr(n.name,t.extensions)),label:`dir:${e.name}/${n.name}`}))}Dr(e,t){return!!(!e||t.has(e)||e.startsWith("."))}Tr(e,t){return!t||t.length===0?`${e}/**/*`:t.length===1?`${e}/**/*.${t[0]}`:`${e}/**/*.{${t.join(",")}}`}sr(e){let t=Array.isArray(e)&&e.length>0?e:ns;return Array.from(new Set(t.map(s=>(s||"").toString().trim().replace(/^\./,"").toLowerCase()).filter(Boolean)))}rr(e){let t=Math.max(1,Math.min(e,is)),s=this.Fr();return s?Math.min(t,s):t}Fr(){switch(this.t){case"extreme":return 8;case"large":return 14;default:return null}}O(){let e=h.workspace.getConfiguration("explorerDates"),t=e.get("badgeRefreshInterval",6e4),s=this.S||t;if(this.L=s,this._logger.info(`Setting up periodic refresh with interval: ${this.L}ms`),this.w&&(clearInterval(this.w),this.w=null),this.Z(),!e.get("showDateDecorations",!0)){this._logger.info("Decorations disabled, skipping periodic refresh setup");return}this.w=setInterval(()=>{if(this.me){this._logger.debug("Periodic refresh skipped - incremental refresh already running");return}this._logger.debug("Periodic refresh triggered - scheduling incremental refresh"),this.xr("periodic")},this.L),this._logger.info("Periodic refresh timer started")}Ar(e,t){if(t?.uri)return t.uri;if(!e)return null;try{return h.Uri.file(e)}catch(s){return this._logger.debug(`Failed to rebuild URI from cache key: ${e}`,s),null}}Z(){if(this.j?.size){for(let e of this.j)clearTimeout(e);this.j.clear()}this.me=!1}xr(e="manual"){if(this.pt){this._logger.debug(`Incremental refresh (${e}) skipped - refresh already pending`);return}this.me&&(this._logger.debug(`Incremental refresh (${e}) already in progress, cancelling pending timers and rescheduling`),this.Z());let t=Array.from(this.e.entries());if(t.length===0){this._logger.debug(`No cached decorations to refresh for ${e}, falling back to global refresh`),this.f.fire(void 0);return}let s=t.map(([a,l])=>{let u=this.Ar(a,l);return u?{cacheKey:a,uri:u}:null}).filter(Boolean);if(s.length===0){this._logger.debug(`Failed to resolve URIs for ${e} incremental refresh, firing global refresh`),this.f.fire(void 0);return}let r=40,o=Math.ceil(s.length/r),n=Math.min(4e3,Math.max(750,Math.floor(this.L*.25))),c=o>1?Math.max(25,Math.floor(n/o)):0;this.me=!0,this.pt=!0,this._logger.debug(`Incremental refresh (${e}) scheduled for ${s.length} items in ${o} batches (spacing: ${c}ms)`);for(let a=0;a<o;a++){let l=s.slice(a*r,(a+1)*r),u=a===0?0:c*a,d=setTimeout(()=>{try{l.forEach(({cacheKey:f,uri:p})=>{this.Mr(f),this.f.fire(p)})}finally{this.j.delete(d),this.j.size===0&&(this.me=!1,this.pt=!1,this._logger.debug(`Incremental refresh (${e}) completed`))}},u);this.j.add(d)}}Mr(e){if(!e)return;let t=this.e.get(e);if(t){let s=Date.now()-t.timestamp;s>this.l*.75?(t.forceRefresh=!0,this._logger.debug(`Marked stale entry for refresh: ${e} (age: ${Math.round(s/1e3)}s)`)):this._logger.debug(`Skipped refresh for fresh entry: ${e} (age: ${Math.round(s/1e3)}s, threshold: ${Math.round(this.l*.75/1e3)}s)`)}if(this._advancedCache)try{let s=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this._advancedCache.invalidateByPattern(s)}catch(s){this._logger.debug(`Could not invalidate advanced cache for ${e}: ${s.message}`)}}Ks(){this.r&&this.r.dispose(),this.r=h.workspace.onDidChangeConfiguration(async e=>{if(e.affectsConfiguration("explorerDates")){this._logger.debug("Configuration changed, updating settings");let t=h.workspace.getConfiguration("explorerDates"),s=t.get("cacheTimeout",xe);this.mt=this.Jt(t,s),this.l=this.Zt(s),this.s=t.get("maxCacheSize",1e4);let r=this.Qt(t);if(e.affectsConfiguration("explorerDates.performanceMode")){let a=t.get("performanceMode",!1);a!==this.Be&&(this.Be=a,await this.gs(this.ps(),{reason:"configuration-change"}),this.q(this.Y(t),"performance-mode-change"))}e.affectsConfiguration("explorerDates.featureLevel")&&this.q(this.Y(t),"configuration-change"),e.affectsConfiguration("explorerDates.badgeRefreshInterval")&&(this.L=t.get("badgeRefreshInterval",6e4),this._logger.info(`Badge refresh interval updated to: ${this.L}ms`),this._performanceMode||this.O());let o=e.affectsConfiguration("explorerDates.showDateDecorations")||e.affectsConfiguration("explorerDates.dateDecorationFormat")||e.affectsConfiguration("explorerDates.excludedFolders")||e.affectsConfiguration("explorerDates.excludedPatterns")||e.affectsConfiguration("explorerDates.highContrastMode")||e.affectsConfiguration("explorerDates.fadeOldFiles")||e.affectsConfiguration("explorerDates.fadeThreshold")||e.affectsConfiguration("explorerDates.colorScheme")||e.affectsConfiguration("explorerDates.showGitInfo")||e.affectsConfiguration("explorerDates.customColors")||e.affectsConfiguration("explorerDates.showFileSize")||e.affectsConfiguration("explorerDates.fileSizeFormat")||e.affectsConfiguration("explorerDates.featureLevel");(e.affectsConfiguration("explorerDates.security.enforceWorkspaceBoundaries")||e.affectsConfiguration("explorerDates.security.allowedExtraPaths")||e.affectsConfiguration("explorerDates.security.allowTestPaths"))&&this.ts(t),(e.affectsConfiguration("explorerDates.decorationPoolSize")||e.affectsConfiguration("explorerDates.flyweightCacheSize"))&&this.ss(t),(o||r)&&this.refreshAll({preservePersistentCache:!0,reason:o?"configuration-change":"namespace-change"});let c=e.affectsConfiguration("explorerDates.smartFileWatching")||e.affectsConfiguration("explorerDates.smartWatcherMaxPatterns")||e.affectsConfiguration("explorerDates.smartWatcherExtensions")||e.affectsConfiguration("explorerDates.excludedFolders")||e.affectsConfiguration("explorerDates.smartExclusions");!this._performanceMode&&c&&this.we("configuration-change"),e.affectsConfiguration("explorerDates.progressiveLoading")&&this.ns().catch(a=>{this._logger.error("Failed to reconfigure progressive loading",a)}),(e.affectsConfiguration("explorerDates.autoThemeAdaptation")||e.affectsConfiguration("explorerDates.accessibilityMode"))&&(this._logger.debug("UI adapters configuration changed, reloading..."),await this.Xs()),e.affectsConfiguration("explorerDates.showDateDecorations")&&!this._performanceMode&&this.O()}})}Jt(e,t){if(typeof t=="number"&&t!==xe)return!0;if(!e||typeof e.inspect!="function")return!1;try{let s=e.inspect("cacheTimeout");if(!s)return!1;if(typeof s=="object"&&(typeof s.globalValue=="number"||typeof s.workspaceValue=="number"||typeof s.workspaceFolderValue=="number"))return!0;if(s.cacheTimeout&&typeof s.cacheTimeout=="object"){let r=s.cacheTimeout;if(typeof r.globalValue=="number"||typeof r.workspaceValue=="number"||typeof r.workspaceFolderValue=="number"){let n=r.globalValue??r.workspaceValue??r.workspaceFolderValue;return typeof n=="number"&&n!==xe}}}catch{return!1}return!1}Zt(e){return this._isWeb||this.mt?e:Math.max(this.at,e||this.at)}async $i(){let e=await this._e();return e?.loadBatchProcessorIfNeeded?e.loadBatchProcessorIfNeeded(this):null}async ns(){let e=await this._e();if(e?.applyProgressiveLoadingSetting)return e.applyProgressiveLoadingSetting(this);this._progressiveLoadingEnabled=!1,this.ms()}ms(){if(this.ae?.cancelProgressiveWarmupJobs){this.ae.cancelProgressiveWarmupJobs(this);return}if(this._batchProcessor)for(let e of this._progressiveLoadingJobs)this._batchProcessor.cancelBatch(e);this._progressiveLoadingJobs.clear()}refreshDecoration(e){if(!e||!this.Ye(e,"refreshDecoration")?.isValid)return;let s=this.vt(e);if(this.e.delete(s),this._advancedCache)try{this._advancedCache.invalidateByPattern(s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))}catch(r){this._logger.debug(`Could not invalidate advanced cache for ${I(e)}: ${r.message}`)}this.f.fire(e),this._logger.debug(`\u{1F504} Refreshed decoration cache for: ${I(e)}`)}clearDecoration(e){if(!e||!this.Ye(e,"clearDecoration")?.isValid)return;let s=this.vt(e);this.e.delete(s),this._advancedCache&&this._logger.debug(`Advanced cache entry will expire naturally: ${I(e)}`),this.f.fire(e),this._logger.debug(`\u{1F5D1}\uFE0F Cleared decoration cache for: ${I(e)}`)}clearAllCaches(){this.Z();let e=this.e.size;this.e.clear(),this.J("clearAllCaches"),this._logger.info(`Cleared memory cache (was ${e} items)`),this._advancedCache&&(this._advancedCache.clear(),this._logger.info("Cleared advanced cache")),this._metrics.cacheHits=0,this._metrics.cacheMisses=0,this._logger.info("All caches cleared successfully")}refreshAll(e={}){let{preservePersistentCache:t=!1,reason:s="manual-refresh"}=e;this.Z(),this.e.clear(),this.J("refreshAll"),this.i&&this.i.clearCache(),this._advancedCache&&(t&&typeof this._advancedCache.resetRuntimeOnly=="function"?this._advancedCache.resetRuntimeOnly():this._advancedCache.clear()),this.f.fire(void 0);let r=t?" (persistent cache preserved)":"";this._logger.info(`All decorations refreshed (${s})${r}`)}async Rr(e){let t=h.workspace.getConfiguration("explorerDates"),s=$(e);if(!s)return!1;let r=R(s),o=nt(r),n=Te(s),c=t.get("forceShowForFileTypes",[]);if(c.length>0&&c.includes(n))return this._logger.debug(`File type ${n} is forced to show: ${s}`),!1;let a=t.get("enableTroubleShootingMode",!1);a&&this._logger.info(`\u{1F50D} Checking exclusion for: ${o} (ext: ${n})`);let l=t.get("excludedFolders",["node_modules",".git","dist","build","out",".vscode-test"]),u=t.get("excludedPatterns",["**/*.tmp","**/*.log","**/.git/**","**/node_modules/**"]);for(let d of l){let f=d.replace(/^\/+|\/+$/g,"");if(r.includes(`/${f}/`)||r.endsWith(`/${f}`))return a?this._logger.info(`\u274C File excluded by folder: ${s} (${d})`):this._logger.debug(`File excluded by folder: ${s} (${d})`),!0}for(let d of u)if(d.includes("node_modules")&&r.includes("/node_modules/")||d.includes(".git/**")&&r.includes("/.git/")||d.includes("*.tmp")&&o.endsWith(".tmp")||d.includes("*.log")&&o.endsWith(".log"))return!0;return a&&this._logger.info(`\u2705 File NOT excluded: ${o} (ext: ${n})`),!1}async Wi(e){let t=h.workspace.getConfiguration("explorerDates"),s=$(e);if(!s)return!1;let r=R(s),o=nt(r),n=h.workspace.getWorkspaceFolder(e);if(n){let c=this._workspaceIntelligence?.smartExclusion?await this._workspaceIntelligence.smartExclusion.getCombinedExclusions(n.uri):null;for(let a of c.folders)if(new RegExp(`(^|/)${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(/|$)`).test(r))return this._logger.debug(`File excluded by folder rule: ${s} (folder: ${a})`),!0;for(let a of c.patterns){let l=a.replace(/\*\*/g,".*").replace(/\*/g,"[^/\\\\]*").replace(/\?/g,"."),u=new RegExp(l);if(u.test(r)||u.test(o))return this._logger.debug(`File excluded by pattern: ${s} (pattern: ${a})`),!0}}else{let c=t.get("excludedFolders",[]),a=t.get("excludedPatterns",[]);for(let l of c)if(new RegExp(`(^|/)${l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(/|$)`).test(r))return!0;for(let l of a){let u=l.replace(/\*\*/g,".*").replace(/\*/g,"[^/\\\\]*").replace(/\?/g,"."),d=new RegExp(u);if(d.test(r)||d.test(o))return!0}}return!1}Lr(){if(this.e.size<=this.s)return;let e=this.e.enforceLimit(this.s,this._logger);e>0&&(this._metrics.cacheEvictions+=e)}Or(){if(this._isWeb||this.mt)return;let e=this._metrics.cacheHits+this._metrics.cacheMisses;if(e<200)return;let t=this._metrics.cacheHits/e;if(t<.9||this.l>=this.Vt||e<=this.ct||e-this.ct<100)return;let r=this.l;this.l=Math.min(this.l+Qt,this.Vt),this.ct=e,this._logger.info("\u2699\uFE0F Cache timeout extended (max 8min)",{previousTimeout:r,newTimeout:this.l,hitRate:Number(t.toFixed(2)),totalLookups:e})}async Pr(e,t){if(this.Ie)return this._logger.debug(`\u26A0\uFE0F Cache bypass enabled - recalculating decoration for: ${t}`),null;if(this._advancedCache)try{let r=await this._advancedCache.get(e);if(r)return this._metrics.cacheHits++,this._logger.debug(`\u{1F9E0} Advanced cache hit for: ${t}`),r}catch(r){this._logger.debug(`Advanced cache error: ${r.message}`)}let s=this.e.get(e);if(s){if(s.forceRefresh)this.e.delete(e),this._logger.debug(`\u{1F6AB} Memory cache bypassed (forced refresh) for: ${t}`);else if(Date.now()-s.timestamp<this.l)return this._metrics.cacheHits++,this._logger.debug(`\u{1F4BE} Memory cache hit for: ${t}`),s.decoration}return null}async Ir(e,t,s,r){if(this.Ie)return;this.Lr();let o={decoration:t,timestamp:Date.now()};if(r&&(o.uri=r),this.e.set(e,o),this.$r(),this._advancedCache)try{await this._advancedCache.set(e,t,{ttl:this.l}),this._logger.debug(`\u{1F9E0} Stored in advanced cache: ${s}`)}catch(n){this._logger.debug(`Failed to store in advanced cache: ${n.message}`)}this.Or()}ws(e,t,s,r,o,n){if(!this.Re||!r)return n&&(n.misses++,n.allocations++),o();if(e.has(r))return n&&(n.hits++,n.reuses++),e.get(r);n&&(n.misses++,n.allocations++);let c=o();if(e.set(r,c),t.push(r),t.length>s){let a=t.shift();a&&e.delete(a)}return c}Ut(){try{let e=process?.memoryUsage?process.memoryUsage().heapUsed:0;return Number((e/1024/1024).toFixed(2))}catch{return 0}}bs(){try{let e=process?.memoryUsage?process.memoryUsage().rss:0;return Number((e/1024/1024).toFixed(2))}catch{return 0}}Wr(){if(!this.Le||this.Pe)return;let e=this.Ut();if(!e)return;if(!this.ie){this.ie=e,this.X=0,this.be=!1;return}let t=e-this.ie;if(t>=this.Ge?(this.X++,this.X>=2&&!this.be&&(this.be=!0,this._logger.warn("Memory pressure warning (soft threshold exceeded twice)",{deltaMB:Number(t.toFixed(2)),baselineMB:this.ie,heapMB:e,rssMB:this.bs(),cacheSize:this.e.size,cacheLimit:this.s}))):this.X>0&&(this.X=0,t<this.Ge*.5&&(this.be=!1)),t>=this.Oe){this.Pe=!0,this.s=Math.min(this.s,this.Vs),this.S=Math.max(this.S||this.L||this.zt,this.zt);let s=this.bs(),r={timestamp:new Date().toISOString(),deltaMB:Number(t.toFixed(2)),baselineMB:this.ie,heapMB:e,rssMB:s,cacheSize:this.e.size,maxCacheSize:this.s,watcherStrategy:this.x,staticWatchers:this.m.size,dynamicWatchers:this.h.size};this.Ve.push(r),this.Ve.length>10&&this.Ve.shift(),this._logger.warn(`Memory shedding activated (delta ${t.toFixed(2)} MB >= ${this.Oe} MB); cache size capped at ${this.s} and refresh interval stretched to ${this.S}ms`,r),this.O(),this.be=!1,this.X=0}}$r(){if(!this.s||this.s<=0)return;let e=this.e.size/this.s;e>=this.bt?this.He||(this.He=!0,this._logger.infoWithOptions({throttleKey:"cache-pressure",intervalMs:6e4},`Decoration cache usage is at ${(e*100).toFixed(1)}% of capacity`,{cacheSize:this.e.size,maxCacheSize:this.s})):e<this.bt*.5&&(this.He=!1)}Nr({badge:e,tooltip:t,color:s}){if(!this.Me){this.a.misses++,this.a.allocations++;let n=new h.FileDecoration(e||"??");return t&&(n.tooltip=t),s&&(n.color=s),n.propagate=!1,n}if(!e)return this.a.allocations++,new h.FileDecoration("??");let r=this.Ur(e,t,s);if(r&&this.C.has(r))return this.a.hits++,this.a.reuses++,this.C.get(r);let o=new h.FileDecoration(e);if(t&&(o.tooltip=t),s&&(o.color=s),o.propagate=!1,this.a.allocations++,r&&(this.C.set(r,o),this.D.push(r),this.D.length>this.I)){let n=this.D.shift();n&&n!==r&&this.C.delete(n)}return this.a.misses++,o}Ur(e,t,s){let r=e||"",o=t||"",n=this.zr(s);return`${r}::${n}::${o}`}zr(e){if(!e)return"none";if(typeof e=="string")return e;if(e.id)return e.id;try{return JSON.stringify(e)}catch{return String(e)}}J(e="unspecified"){this.C.size!==0&&(this.C.clear(),this.D.length=0,this._logger.debug(`\u{1F9FC} Cleared decoration pool (${e})`))}ss(e){let t=e?.get?e.get("decorationPoolSize"):void 0,s=e?.get?e.get("flyweightCacheSize"):void 0,r=this.ys(t,es,128,8192),o=this.ys(s,tt,512,16384),n=r!==this.I,c=o!==this.it||o!==this.nt;return n&&(this.I=r,this.Br(),this._logger.info(`Decoration pool capacity set to ${r}`)),c&&(this.it=o,this.nt=o,this.Es(this.se,this.rt,o,"badge"),this.Es(this.re,this.ot,o,"readable"),this._logger.info(`Flyweight cache capacity set to ${o}`)),{poolChanged:n,flyweightChanged:c}}ys(e,t,s,r){if(typeof e!="number"||!Number.isFinite(e))return Math.min(Math.max(t,s),r);let o=Math.floor(e);return o<s?s:o>r?r:o}Br(){if(!(this.D.length<=this.I)){for(;this.D.length>this.I;){let e=this.D.shift();e&&this.C.delete(e)}this._logger.debug(`Trimmed decoration pool to ${this.I} entries`)}}Es(e,t,s,r){if(!(!e||!t)&&!(t.length<=s)){for(;t.length>s;){let o=t.shift();o&&e.delete(o)}this._logger.debug(`Trimmed ${r} flyweight cache to ${s} entries`)}}_s(e="lightweight"){this.E&&(this.e.size>0&&this.e.clear(),this.J(e),this.se.size>0&&(this.se.clear(),this.rt.length=0),this.re.size>0&&(this.re.clear(),this.ot.length=0),this._logger.debug(`\u{1F9FD} Purged lightweight caches (${e})`))}Vr(){if(!this.E)return;if(this.Bt<=0){this._s("lightweight-interval-disabled");return}let e=this._metrics?.totalDecorations||0;e>0&&e%this.Bt===0&&this._s("lightweight-interval")}Gr({formatType:e,diffMinutes:t,diffHours:s,diffDays:r,diffWeeks:o,diffMonths:n,date:c}){let a=(l,u=null)=>({value:l,key:u?`badge:${e||"default"}:${u}`:null});switch(e){case"relative-short":case"relative-long":return t<1?a("\u25CF\u25CF","just"):t<60?a(`${Math.min(t,99)}m`,`m:${Math.min(t,99)}`):s<24?a(`${Math.min(s,23)}h`,`h:${Math.min(s,23)}`):r<7?a(`${r}d`,`d:${r}`):o<4?a(`${o}w`,`w:${o}`):n<12?a(`${n}M`,`M:${n}`):a("1y","y:1");case"absolute-short":case"absolute-long":{let l=c.getDate(),u=`${Pr[c.getMonth()]}${l<10?"0"+l:l}`,d=[c.getMonth(),l];return e==="absolute-long"&&d.push(c.getFullYear()),a(u,`abs:${d.join("-")}`)}case"technical":return t<60?a(`${t}m`,`tech:m:${t}`):s<24?a(`${s}h`,`tech:h:${s}`):a(`${r}d`,`tech:d:${r}`);case"minimal":return s<1?a("\u2022\u2022","min:now"):s<24?a("\u25CB\u25CB","min:hours"):a("\u2500\u2500","min:days");default:return t<60?a(`${t}m`,`smart:m:${t}`):s<24?a(`${s}h`,`smart:h:${s}`):a(`${r}d`,`smart:d:${r}`)}}Cs(e,t,s=null){let o=s!==null?s:new Date().getTime()-e.getTime();if(o<0)return this._logger.debug(`File has future modification time (diffMs: ${o}), treating as just modified`),"\u25CF\u25CF";let n=Math.floor(o/(1e3*60)),c=Math.floor(o/(1e3*60*60)),a=Math.floor(o/(1e3*60*60*24)),l=Math.floor(a/7),u=Math.floor(a/30),d=this.Gr({formatType:t,diffMinutes:n,diffHours:c,diffDays:a,diffWeeks:l,diffMonths:u,date:e});return this.ws(this.se,this.rt,this.it,d.key,()=>d.value,this.$)}ve(e,t="auto"){return Rr(e,t)}Hr(e,t,s,r,o){let n=e.toDateString()===t.toDateString();return s<1?{key:"readable:just",factory:()=>this.F.getString("justNow")}:s<60?{key:`readable:minutes:${s}`,factory:()=>this.F.getString("minutesAgo",s)}:r<24&&n?{key:`readable:hours:${r}`,factory:()=>this.F.getString("hoursAgo",r)}:o<7?o===1?{key:"readable:yesterday",factory:()=>this.F.getString("yesterday")}:{key:`readable:days:${o}`,factory:()=>this.F.getString("daysAgo",o)}:null}Kr(e,t,s=""){if(t==="none")return;let o=new Date().getTime()-e.getTime(),n=Math.floor(o/(1e3*60*60)),c=Math.floor(o/(1e3*60*60*24));switch(t){case"recency":return n<1?new h.ThemeColor("charts.green"):n<24?new h.ThemeColor("charts.yellow"):new h.ThemeColor("charts.red");case"file-type":{let a=Te(s);return[".js",".ts",".jsx",".tsx"].includes(a)?new h.ThemeColor("charts.blue"):[".css",".scss",".less"].includes(a)?new h.ThemeColor("charts.purple"):[".html",".htm",".xml"].includes(a)?new h.ThemeColor("charts.orange"):[".json",".yaml",".yml"].includes(a)?new h.ThemeColor("charts.green"):[".md",".txt",".log"].includes(a)?new h.ThemeColor("charts.yellow"):[".py",".rb",".php"].includes(a)?new h.ThemeColor("charts.red"):new h.ThemeColor("editorForeground")}case"subtle":return n<1?new h.ThemeColor("editorInfo.foreground"):c<7?new h.ThemeColor("editorWarning.foreground"):new h.ThemeColor("editorError.foreground");case"vibrant":return n<1?new h.ThemeColor("terminal.ansiGreen"):n<24?new h.ThemeColor("terminal.ansiYellow"):c<7?new h.ThemeColor("terminal.ansiMagenta"):new h.ThemeColor("terminal.ansiRed");case"custom":return n<1?new h.ThemeColor("explorerDates.customColor.veryRecent"):n<24?new h.ThemeColor("explorerDates.customColor.recent"):new h.ThemeColor("explorerDates.customColor.old");default:return}}jr({filePath:e,stat:t,diffMs:s,dateFormat:r,badgePriority:o,showFileSize:n,fileSizeFormat:c,gitBlame:a,showGitInfo:l}){let u=this.Cs(t.mtime,r,s),d=this.Ss(t.mtime),f=this.Ss(t.birthtime),p=u;if(this._logger.debug(`\u{1F3F7}\uFE0F Badge generation for ${I(e)}: badgePriority=${o}, showGitInfo=${l}, hasGitBlame=${!!a}, authorName=${a?.authorName}, previewMode=${!!this.o}`),o==="author"&&a?.authorName){let w=this.qr(a.authorName);w&&(p=w,this._logger.debug(`\u{1F3F7}\uFE0F Using author initials badge: "${w}" (from ${a.authorName})`))}else if(o==="size"&&n){let w=this.Yr(t.size);w&&(p=w,this._logger.debug(`\u{1F3F7}\uFE0F Using size badge: "${w}"`))}else this._logger.debug(`\u{1F3F7}\uFE0F Using time badge: "${u}" (badgePriority=${o})`);return{badge:u,displayBadge:p,readableModified:d,readableCreated:f,fileSizeLabel:n?this.ve(t.size,c):null}}async Xr({filePath:e,resourceUri:t,stat:s,badgeDetails:r,gitBlame:o,shouldUseAccessibleTooltips:n,fileSizeFormat:c,isCodeFile:a}){let l=I(e),u=Te(e);if(n){let p=this._accessibility?.getAccessibleTooltip?.(e,s.mtime,s.birthtime,s.size,o);if(p)return this._logger.info(`\u{1F50D} Using accessible tooltip (${p.length} chars): "${p.substring(0,50)}..."`),p;this._logger.info("\u{1F50D} Accessible tooltip generation failed, using rich tooltip")}let d=`\u{1F4C4} File: ${l}
`;d+=`\u{1F4DD} Last Modified: ${r.readableModified}
`,d+=`   ${this.kt(s.mtime)}

`,d+=`\u{1F4C5} Created: ${r.readableCreated}
`,d+=`   ${this.kt(s.birthtime)}

`;let f=r.fileSizeLabel||this.ve(s.size,c||"auto");if(d+=`\u{1F4CA} Size: ${f} (${s.size.toLocaleString()} bytes)
`,u&&(d+=`\u{1F3F7}\uFE0F Type: ${u.toUpperCase()} file
`),a)try{let p=t||e,_=(await this._fileSystem.readFile(p,"utf8")).split(`
`).length;d+=`\u{1F4CF} Lines: ${_.toLocaleString()}
`}catch{}return d+=`\u{1F4C2} Path: ${e}`,o&&(d+=`

\u{1F464} Last Modified By: ${o.authorName}`,o.authorEmail&&(d+=` (${o.authorEmail})`),o.authorDate&&(d+=`
   ${o.authorDate}`)),d}Jr({filePath:e,stat:t,badgeDetails:s}){let r=[];s?.readableModified&&r.push(`Modified ${s.readableModified}`);let o=s?.fileSizeLabel||(t?.size?this.ve(t.size,"auto"):null);return o&&r.push(o),`${I(e)} \u2014 ${r.filter(Boolean).join(" \u2022 ")||this.kt(t?.mtime||new Date)}`}Ss(e){let t=new Date,s=t.getTime()-e.getTime(),r=Math.floor(s/(1e3*60)),o=Math.floor(s/(1e3*60*60)),n=Math.floor(s/(1e3*60*60*24)),c=this.Hr(e,t,r,o,n);return c?this.ws(this.re,this.ot,this.nt,c.key,c.factory,this.W):e.getFullYear()===t.getFullYear()?this.F.formatDate(e,{month:"short",day:"numeric"}):this.F.formatDate(e,{month:"short",day:"numeric",year:"numeric"})}async Zr(e,t=null){if(rs)return null;let s=await this.Ys();if(!s||typeof s.getGitBlameInfo!="function")return null;try{return await s.getGitBlameInfo(e,t)}catch(r){return this._logger.warn("Git blame lookup failed",{filePath:e,message:r?.message||String(r)}),null}}qr(e){if(this.i)return this.i.getInitials(e);if(!e||typeof e!="string")return null;let t=e.trim().split(/\s+/).filter(Boolean);return t.length===0?null:t.length===1?t[0].substring(0,2).toUpperCase():(t[0][0]+(t[1][0]||"")).substring(0,2).toUpperCase()}Yr(e){if(typeof e!="number"||isNaN(e))return null;let t=["B","K","M","G","T"],s=0,r=e;for(;r>=1024&&s<t.length-1;)r=r/1024,s++;let o=Math.round(r),n=t[s];if(o<=9)return`${o}${n}`;let c=String(o);return c.length>=2?c.slice(0,2):c}kt(e){let t={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"};return e.toLocaleString("en-US",t)}vt(e){let t=Lr($(e));return this.N?`${this.N}${rt}${t}`:t}Qr(e){if(!e||typeof e!="string")return e;let t=e.indexOf(rt);return t===-1?e:e.slice(t+rt.length)}ei(e){let t=typeof e=="string"?e:JSON.stringify(e),s=0;for(let r=0;r<t.length;r++)s=(s<<5)-s+t.charCodeAt(r),s|=0;return Math.abs(s).toString(16)}ti(e){try{let t=e||h.workspace.getConfiguration("explorerDates"),s={dateDecorationFormat:t.get("dateDecorationFormat","smart"),showGitInfo:t.get("showGitInfo",!0),showFileSize:t.get("showFileSize",!1),fileSizeFormat:t.get("fileSizeFormat","auto"),colorScheme:t.get("colorScheme","recency"),highContrastMode:t.get("highContrastMode",!1),fadeOldFiles:t.get("fadeOldFiles",!1),fadeThreshold:t.get("fadeThreshold",72),badgePriority:t.get("badgePriority","time"),showDateDecorations:t.get("showDateDecorations",!0),excludedFolders:(t.get("excludedFolders",[])||[]).join("|"),excludedPatterns:(t.get("excludedPatterns",[])||[]).join("|"),customColors:JSON.stringify(t.get("customColors",{})),metadataVersion:2};return`ns-${this.ei(s).slice(0,8)}`}catch(t){return this._logger.debug(`Failed to build cache namespace: ${t.message}`),"ns-default"}}Qt(e){let t=this.ti(e);if(t&&t!==this.N){let s=this.N;return this.N=t,this._logger.info(`Cache namespace updated (${s||"unset"} \u2192 ${t})`),!0}return!1}si(e){return e?e.code==="ENOENT"?!0:typeof e.message=="string"&&e.message.includes("ENOENT"):!1}async ri(){return this.y<this.p?(this.y++,()=>this.vs()):new Promise(e=>{this.xe.push(()=>{this.y++,e(()=>this.vs())})})}vs(){for(this.y=Math.max(0,this.y-1);this.xe.length>0&&this.y<this.p;)this.xe.shift()()}ks(){return this.E||this.wt||this.t==="extreme"||this._performanceMode?Math.min(this.Ae,10):this.t==="large"?Math.min(this.Ae,14):this.Ae}async ii(e,t){this.te.has(e)||this.te.set(e,Promise.resolve());let r=this.te.get(e).then(async()=>{let o=await this.ri();try{return await t()}finally{o()}});return this.te.set(e,r),r}oi(){let e=Date.now();if(this.Dt||(this.Dt=e),e-this.Dt<3e4)return;this.Dt=e;let t=this.e.size||0,s=1e4,r=t/s;r>.8&&(this._logger.warn("\u{1F9E0} Memory pressure detected, performing cleanup",{cacheSize:t,maxSize:s,pressure:(r*100).toFixed(1)+"%"}),this.e.clear(),this.p=Math.max(5,this.p*.5),setTimeout(()=>{this.p=this.ks(),this._logger.info("\u{1F504} Restored scale-aware concurrency limits")},6e4))}ni(e,t){let s=Date.now()-t,r={badge:"\u26A1",tooltip:`High load mode - ${Fe.basename(e.fsPath)}`,color:new h.ThemeColor("charts.yellow")};return this._logger.info("\u26A1 Created minimal decoration for high load",{file:Fe.basename(e.fsPath),processingTimeMs:s}),r}async provideFileDecoration(e,t){if(this.st){if(!this.Nt){let f={throttleKey:"provider:disposed",throttleLimit:1,profile:"default"};typeof this._logger.infoWithOptions=="function"?this._logger.infoWithOptions(f,"\u{1F6AB} Provider disposed, rejecting operation"):this._logger.info("\u{1F6AB} Provider disposed, rejecting operation"),this.Nt=!0}return}let s=Date.now();if(!e){this._logger.error("\u274C Invalid URI provided to provideFileDecoration:",e);return}let r=e.fsPath;if(!r)return;let n=h.workspace.getConfiguration("explorerDates").get("performanceMode",!1);if(n&&typeof n!="boolean")return null;if(r&&r.includes("\0"))return this._logger.warn("\u{1F6AB} Skipping file with null character in path:",r),null;let c=$(e);if(!c){this._logger.error("\u274C Could not resolve path for URI in provideFileDecoration:",e);return}let a=I(c),l=R(c),u=e.scheme||"file";if(u!=="file"){this._logger.debug(`\u23ED\uFE0F Skipping decoration for ${a} (unsupported scheme: ${u})`);return}if(this.Ye(e,"provideFileDecoration")?.isValid){if(await this.Rr(e)){this._performanceMode||this._logger.debug(`\u274C File excluded: ${a}`);return}return this.ii(r,async()=>{try{if(this._logger.debug(`\u{1F4CA} Call context: token=${!!t}, cancelled=${t?.isCancellationRequested}`),t?.isCancellationRequested||this.st){this._logger.debug("\u{1F6AB} Operation cancelled early");return}this._performanceMode||(this._logger.debug(`\u{1F50D} VSCODE REQUESTED DECORATION: ${a} (${r})`),this._logger.debug(`\u{1F4CA} Call context: token=${!!t}, cancelled=${t?.isCancellationRequested}`));let f=h.workspace.getConfiguration("explorerDates"),p=(C,Et)=>{if(this.o&&Object.prototype.hasOwnProperty.call(this.o,C)){let _t=this.o[C];return this._logger.debug(`\u{1F3AD} Using preview value for ${C}: ${_t} (config has: ${f.get(C,Et)})`),_t}return f.get(C,Et)};if(this.o&&this._logger.infoWithOptions(this.ft,`\u{1F3AD} Processing ${a} in PREVIEW MODE with settings:`,()=>this.o),!p("showDateDecorations",!0)){this._performanceMode||this._logger.debug(`\u274C RETURNED UNDEFINED: Decorations disabled globally for ${a}`);return}this._logger.debug(`\u{1F50D} Processing file: ${a}`);let w=this.mr(e);this.Se(e,{reason:"decoration-request",visible:l?this.T.has(l):!1}),w?this._metrics.viewportPriorityDecorations++:this._metrics.viewportBackgroundDecorations++;let _=this.ne||this.Tt(this.B),T=this.vt(e);if(this.o)this._logger.debug(`\u{1F504} Skipping cache due to active preview settings for: ${a}`);else{let C=await this.Pr(T,a);if(C)return C}let L=this.xe.length,H=L>=this.p;if(this.y>this.p*.8&&H)return this._logger.warn("\u26A1 High load detected, switching to fast mode",{activeOps:this.y,threshold:this.p*.8,queued:L}),this.ni(e,s);if(this.oi(),this._metrics.cacheMisses++,this._logger.debug(`\u274C Cache miss for: ${a} (key: ${T.substring(0,50)}...)`),t?.isCancellationRequested){this._logger.debug(`Decoration cancelled for: ${r}`);return}let A=null;if(!w&&this._workspaceIntelligence?.incrementalIndexer){let C=this._workspaceIntelligence.incrementalIndexer.getIndexedStat(r);C&&(A=C,this._logger.debug(`Indexed stat hit for ${a}`))}let ge=Date.now();if(!A){try{A=await this._fileSystem.stat(e)}catch(C){if(this._metrics.fileStatTimeMs+=Date.now()-ge,this._metrics.fileStatCalls++,this.si(C)){this._logger.debug(`\u23ED\uFE0F Skipping decoration for ${a}: file not found (${C.message||C})`);return}throw C}this._workspaceIntelligence?.incrementalIndexer&&this._workspaceIntelligence.incrementalIndexer.primeFromStat(e,A)}if(this._metrics.fileStatTimeMs+=Date.now()-ge,this._metrics.fileStatCalls++,!(typeof A.isFile=="function"?A.isFile():!0))return;let O=ts(A.mtime),fe=ts(A.birthtime||A.ctime||A.mtime),re={mtime:O,birthtime:fe,size:A.size},pe=Date.now()-O.getTime(),Ie=p("dateDecorationFormat","smart"),P=this._performanceMode?"none":p("colorScheme","none"),g=p("highContrastMode",!1),E=this._performanceMode?!1:p("showFileSize",!1),F=p("fileSizeFormat","auto"),S=p("accessibilityMode",!1),B=this._performanceMode?!1:p("fadeOldFiles",!1),me=p("fadeThreshold",30),ie=this._performanceMode?"none":p("showGitInfo","none"),K=this._performanceMode?"time":p("badgePriority","time");_.enableColors||(P="none"),_.enableFileSize||(E=!1),_.enableAccessibility||(S=!1),_.enableGit||(ie="none"),this.E&&(P="none",E=!1,S=!1,ie="none",K="time"),!w&&_.applyBackgroundLimits&&(P="none",E=!1,ie="none",K!=="time"&&(K="time"));let $e=(ie!=="none"||K==="author")&&this.$e&&!this._performanceMode&&_.enableGit,wt=$e?ie:"none";K==="author"&&!$e&&(K="time");let bt=$e?await this.Zr(r,O.getTime()):null,we=this.jr({filePath:r,stat:re,diffMs:pe,dateFormat:Ie,badgePriority:K,showFileSize:E,fileSizeFormat:F,gitBlame:bt,showGitInfo:wt}),Ls=Te(r),Os=[".js",".ts",".jsx",".tsx",".py",".rb",".php",".java",".cpp",".c",".cs",".go",".rs",".kt",".swift"].includes(Ls),yt=S&&this._accessibility?.shouldEnhanceAccessibility(),We=w?_.enableRichTooltips?"rich":"summary":_.backgroundTooltipMode||"off";this._logger.debug(`\u{1F50D} Tooltip generation for ${a}: accessibilityMode=${S}, shouldUseAccessible=${yt}, preference=${We}, previewMode=${!!this.o}`);let ee;We==="rich"?ee=await this.Xr({filePath:r,resourceUri:e,stat:re,badgeDetails:we,gitBlame:wt==="none"?null:bt,shouldUseAccessibleTooltips:yt,fileSizeFormat:F,isCodeFile:Os}):We==="summary"?ee=this.Jr({filePath:r,stat:re,badgeDetails:we}):ee=void 0;let oe;P!=="none"&&(oe=this._themeIntegration?this._themeIntegration.applyThemeAwareColorScheme?.(P,r,pe):this.Kr(O,P,r)),this._logger.debug(`\u{1F3A8} Color scheme setting: ${P}, using color: ${oe?"yes":"no"}`);let be=Zt(we.displayBadge)||Zt(we.badge)||"??";this._accessibility?.shouldEnhanceAccessibility?.()&&(be=this._accessibility.getAccessibleBadge?.(be)||be);let M,W=oe;W&&(W=this.ai(W),this._logger.debug(`\u{1F3A8} Added enhanced color: ${W.id||W} (original: ${oe?.id||oe})`)),B&&Math.floor(pe/864e5)>me&&(W=new h.ThemeColor("editorGutter.commentRangeForeground")),g&&(W=new h.ThemeColor("editorWarning.foreground"),this._logger.info(`\u{1F506} Applied high contrast color (overriding colorScheme=${P})`));let Ne=ee&&ee.length<500?ee:void 0;try{M=this.Nr({badge:be,tooltip:Ne,color:W}),Ne&&this._logger.debug(`\u{1F4DD} Added tooltip (${Ne.length} chars)`)}catch(C){this._logger.error("\u274C Failed to create decoration:",C),M=new h.FileDecoration("!!"),M.propagate=!1}if(this._logger.debug(`\u{1F3A8} Color/contrast check for ${a}: colorScheme=${P}, highContrastMode=${g}, hasColor=${!!W}, previewMode=${!!this.o}`),this.o?this._logger.debug(`\u{1F504} Skipping cache storage due to preview mode for: ${a}`):await this.Ir(T,M,a,e),this._metrics.totalDecorations++,this.Wr(),this.Vr(),!M?.badge){this._logger.error(`\u274C Decoration badge is invalid for: ${a}`);return}let Ps=Date.now()-s;return this._performanceMode||(this._logger.infoWithOptions(this.ft,`\u2705 Decoration created for: ${a} (badge: ${M.badge||"undefined"}) - Cache key: ${T.substring(0,30)}...`),this._logger.infoWithOptions(this.ft,"\u{1F3AF} RETURNING DECORATION TO VSCODE:",()=>({file:a,badge:M.badge,hasTooltip:!!M.tooltip,hasColor:!!M.color,colorType:M.color?.constructor?.name,processingTimeMs:Ps,decorationType:M.constructor.name}))),M}catch(f){this._metrics.errors++;let p=s?Date.now()-s:0,w=I(e),_=$(e)||"unknown-uri",T=f&&typeof f.message=="string"?f.message:"Unknown error",L=f&&typeof f.stack=="string"?f.stack:"No stack available",H=f?.constructor?.name||"UnknownError";this._logger.error(`\u274C DECORATION ERROR for ${w}:`,{error:T,stack:L.split(`
`)[0]||L,processingTimeMs:p,uri:_}),this._logger.error(`\u274C CRITICAL ERROR DETAILS for ${w}: ${T}`),this._logger.error(`\u274C Error type: ${H}`),this._logger.error(`\u274C Full stack: ${L}`),this._logger.info(`\u274C RETURNED UNDEFINED: Error occurred for ${w}`);return}}).catch(f=>{this._logger.error("\u{1F512} File locking error",{filePath:r,error:f.message})})}}Y(e){if(this._performanceMode||this.E)return"minimal";let t="auto";try{t=((e||h.workspace.getConfiguration("explorerDates")).get("featureLevel","auto")||"auto").toLowerCase()}catch{t="auto"}if(it.includes(t))return t;switch(this.t){case"extreme":return"standard";case"large":return"standard";default:return"full"}}q(e,t="unspecified"){if(!e)return!1;it.includes(e)||(e="full");let s=this.B!==e||!this.ne;this.B=e;let r=s?this.Tt(e):this.ne||this.Tt(e);return this.ne=r,this.U=r.viewportWindowMs,s&&this._logger.info(`Feature level set to "${e}" (${t})`,{viewportWindowMs:this.U,applyBackgroundLimits:r.applyBackgroundLimits,backgroundTooltipMode:r.backgroundTooltipMode}),this.ci(r,t),s}Tt(e="full"){let t=it.includes(e)?e:"full";switch(t){case"enhanced":return{level:t,enableGit:!0,enableColors:!0,enableFileSize:!0,enableAccessibility:!0,enableRichTooltips:!0,applyBackgroundLimits:!0,backgroundTooltipMode:"summary",viewportWindowMs:Br};case"standard":return{level:t,enableGit:!1,enableColors:!0,enableFileSize:!1,enableAccessibility:!0,enableRichTooltips:!0,applyBackgroundLimits:!0,backgroundTooltipMode:"summary",viewportWindowMs:ls};case"minimal":return{level:t,enableGit:!1,enableColors:!1,enableFileSize:!1,enableAccessibility:!1,enableRichTooltips:!1,applyBackgroundLimits:!0,backgroundTooltipMode:"off",viewportWindowMs:ls};case"full":default:return{level:"full",enableGit:!0,enableColors:!0,enableFileSize:!0,enableAccessibility:!0,enableRichTooltips:!0,applyBackgroundLimits:!1,backgroundTooltipMode:"rich",viewportWindowMs:cs}}}ps(){return this.Be||this.E||this.wt}li(){if(this.t==="extreme")return null;if(this.t==="large"){let t=h.workspace.getConfiguration("explorerDates").get("badgeRefreshInterval",6e4);return Math.max(t,9e4)}return null}ui(e="unspecified"){let t=this.ks();if(t===this.p)return;let s=this.p;this.p=t,this._logger.info(`Adjusted concurrency cap ${s} -> ${t} (${e})`,{workspaceScale:this.t,performanceMode:this._performanceMode})}async gs(e,{reason:t="unspecified",refresh:s=!0}={}){if(e!==this._performanceMode){if(this._performanceMode=e,this._logger.info(`Performance mode ${e?"enabled":"disabled"} (${t})`),e?(this.Ke({permanent:!0}),this._logger.info("File watchers disabled for performance mode"),this.w&&(clearInterval(this.w),this.w=null,this._logger.info("Periodic refresh disabled for performance mode"))):(this.we("performance-mode-toggle"),this._logger.info("File watchers enabled (performance mode off)"),this.w||(this.O(),this._logger.info("Periodic refresh enabled (performance mode off)"))),s&&this.refreshAll({reason:"performance-mode-change"}),e)this._workspaceIntelligence?.dispose&&(this._workspaceIntelligence.dispose(),this._workspaceIntelligence=null);else if(!this._workspaceIntelligence)try{let o=await X().workspaceIntelligence();if(o){let{WorkspaceIntelligenceManager:n}=o;this._workspaceIntelligence=new n(this._fileSystem),await this._workspaceIntelligence.initialize({batchProcessor:this._batchProcessor,enableProgressiveAnalysis:this._shouldEnableProgressiveAnalysis()});let c=h.workspace.workspaceFolders;c?.length&&await this._workspaceIntelligence.analyzeWorkspace(c,{maxFiles:this._getIndexerMaxFiles()})}}catch(r){this._logger.debug("Workspace intelligence reinitialization failed after performance mode toggle",r)}}}ci(e,t="unspecified"){let s=e?.level||this.B;this.wt=this.t==="extreme";let r=this.ps();if(r!==this._performanceMode&&(this._logger.debug("Auto performance mode update",{reason:t,featureLevel:s,workspaceScale:this.t,desiredPerformanceMode:r}),this.gs(r,{reason:`${t}-auto`,refresh:!0}).catch(o=>this._logger.debug("Failed to toggle performance mode automatically",o))),this.ui(t),!this._performanceMode){let o=this.li(),n=o!==null&&o!==this.S,c=o===null&&this.S!==null;n?(this.S=o,this.O()):c&&(this.S=null,this.O())}}getMetrics(){let e=o=>{if(!o)return 0;let n=(o.reuses||0)+(o.allocations||0);return n?Number(((o.reuses||0)/n*100).toFixed(2)):0},t={...this._metrics,cacheSize:this.e.size,cacheBuckets:this.e.bucketCount,cacheHitRate:this._metrics.cacheHits+this._metrics.cacheMisses>0?(this._metrics.cacheHits/(this._metrics.cacheHits+this._metrics.cacheMisses)*100).toFixed(2)+"%":"0.00%",forceCacheBypass:this.Ie,decorationPoolEnabled:this.Me,flyweightsEnabled:this.Re,lightweightMode:this.E,memorySheddingEnabled:this.Le,memorySheddingActive:this.Pe,watcherStrategy:this.x,staticWatchers:this.m.size,dynamicWatchers:this.h.size,workspaceScale:this.t,workspaceFileCount:this.Ne,featureLevel:this.B,featureProfile:this.ne,viewportWindowMs:this.U,viewportVisibleFiles:this.T.size,viewportHistorySize:this._.size,softHeapAlertThresholdMB:this.Ge};if(t.decorationPool={size:this.C.size,hits:this.a.hits,misses:this.a.misses,allocations:this.a.allocations,reuses:this.a.reuses,reusePercent:e(this.a)},t.badgeFlyweight={...this.$,cacheSize:this.se.size,reusePercent:e(this.$)},t.readableFlyweight={...this.W,cacheSize:this.re.size,reusePercent:e(this.W)},t.allocationTelemetry={decorationPool:{allocations:this.a.allocations,reuses:this.a.reuses,reusePercent:e(this.a)},badgeFlyweight:{allocations:this.$.allocations,reuses:this.$.reuses,reusePercent:e(this.$)},readableFlyweight:{allocations:this.W.allocations,reuses:this.W.reuses,reusePercent:e(this.W)}},this._advancedCache&&(t.advancedCache=this._advancedCache.getStats()),this._batchProcessor?.getMetrics&&(t.batchProcessor=this._batchProcessor.getMetrics()),this._workspaceIntelligence?.getMetrics){let o=this._workspaceIntelligence.getMetrics()||{};o.incrementalIndexer&&(t.incrementalIndexer=o.incrementalIndexer),o.smartExclusion&&(t.smartExclusion=o.smartExclusion)}let s=Array.from(this.e.keys()).slice(0,5).map(o=>this.Qr(o)),r=this.s>0?Number((this.e.size/this.s).toFixed(3)):0;return t.cacheDebugging={memoryCacheKeys:s,cacheTimeout:this.l,maxCacheSize:this.s,cacheBuckets:this.e.bucketCount,keyStatsSize:this.Ht?this.Ht.size:0,cacheNamespace:this.N,cacheUsageRatio:r},t.cachePressure={warned:this.He,thresholdRatio:this.bt,usageRatio:r},t.memoryShedding={thresholdMB:this.Oe,softThresholdMB:this.Ge,active:this.Pe,events:this.Ve.slice(-5)},t.performanceTiming={avgGitBlameMs:this._metrics.gitBlameCalls>0?(this._metrics.gitBlameTimeMs/this._metrics.gitBlameCalls).toFixed(1):"0.0",avgFileStatMs:this._metrics.fileStatCalls>0?(this._metrics.fileStatTimeMs/this._metrics.fileStatCalls).toFixed(1):"0.0",totalGitBlameTimeMs:this._metrics.gitBlameTimeMs,totalFileStatTimeMs:this._metrics.fileStatTimeMs,gitBlameCalls:this._metrics.gitBlameCalls,fileStatCalls:this._metrics.fileStatCalls},t}async initializeAdvancedSystems(e){try{let t=await this._e();if(t?.initializeAdvancedSystems)return t.initializeAdvancedSystems(this,e);this._logger.info("Advanced systems chunk unavailable - skipping advanced initialization")}catch(t){this._logger.error("Failed to initialize advanced systems",t)}}async _maybeWarnAboutGitLimitations(){if(!this.Gt){this.Gt=!0;try{let e=this._extensionContext?.globalState,t=Ir.WEB_GIT_NOTICE;if(e?.get(t,!1))return;if(e?.update)try{await e.update(t,!0)}catch(r){this._logger.debug("Failed to persist Git limitation notice flag",r)}Promise.resolve().then(()=>{h.window.showInformationMessage("Explorer Dates: Git attribution badges are unavailable on VS Code for Web. Time-based decorations remain available.")})}catch(e){this._logger.debug("Failed to display Git limitation notice",e)}}}ai(e){let t={"charts.yellow":"list.warningForeground","charts.red":"list.errorForeground","charts.green":"list.highlightForeground","charts.blue":"symbolIcon.functionForeground","charts.purple":"symbolIcon.classForeground","charts.orange":"list.warningForeground","terminal.ansiYellow":"list.warningForeground","terminal.ansiGreen":"list.highlightForeground","terminal.ansiRed":"list.errorForeground","terminal.ansiBlue":"symbolIcon.functionForeground","terminal.ansiMagenta":"symbolIcon.classForeground","terminal.ansiCyan":"symbolIcon.stringForeground","editorGutter.commentRangeForeground":"list.deemphasizedForeground","editorWarning.foreground":"list.warningForeground","editorError.foreground":"list.errorForeground","editorInfo.foreground":"list.highlightForeground"},s=e.id||e,r=t[s];return r?(this._logger.debug(`\u{1F527} Enhanced color ${s} \u2192 ${r} for better selection visibility`),new h.ThemeColor(r)):e}Xe(e,t,s){if(!e||typeof e[t]!="function")return this._logger.debug(`Event API unavailable: ${t}`),null;try{return e[t](s)}catch(r){return this._logger.debug(`Failed to register listener (${t})`,r),null}}async dispose(){this.R||(this.R=!0,this.st=!0,this.dt++,this._logger.info("Disposing FileDateDecorationProvider",this.getMetrics()),this.te.clear(),this.Bs.clear(),this.y=0,this.w&&(clearInterval(this.w),this.w=null,this._logger.info("Cleared periodic refresh timer")),this.Z(),this._advancedCache?.dispose&&await this._advancedCache.dispose(),this.ms(),this._batchProcessor?.dispose&&this._batchProcessor.dispose(),this._accessibility&&typeof this._accessibility.dispose=="function"&&this._accessibility.dispose(),this._workspaceIntelligence?.dispose&&this._workspaceIntelligence.dispose(),this.pr(),this.e.clear(),this.J("dispose"),this.i&&(this.i.dispose(),this.i=null),this.f.dispose(),this.ht&&(this.ht.dispose(),this.ht=null),this.A&&(clearTimeout(this.A),this.A=null),this._telemetryReportTimer&&(clearTimeout(this._telemetryReportTimer),this._telemetryReportTimer=null),this.Ke({permanent:!0}),this._t(),this.dr(),this.r&&(this.r.dispose(),this.r=null))}};hs.exports={FileDateDecorationProvider:lt}});var Oe=b((Ai,ws)=>{var qr="__explorerDatesVscode",Z=null,Me=null,Re=!1;function Yr(){try{return globalThis[qr]}catch{return}}function ms(){if(Me)return Me;let i={get:()=>{},async update(){},inspect:()=>({defaultValue:void 0,globalValue:void 0,workspaceValue:void 0,workspaceFolderValue:void 0})};return Me={workspace:{workspaceFolders:[],getConfiguration:()=>i},ConfigurationTarget:{Global:1,Workspace:2,WorkspaceFolder:3}},Me}var Xr=new Set(["MODULE_NOT_FOUND","ERR_MODULE_NOT_FOUND","WEB_NATIVE_MODULE"]);function Jr(i){return!i||i.code&&Xr.has(i.code)?!0:(typeof i.message=="string"?i.message:"").includes("Cannot find module 'vscode'")}function de(){let i=Yr();if(i)return Z=ut(i),Re=!1,Z;if(Z&&!Re)return Z;try{Z=ut(require("vscode")),Re=!1}catch(e){if(Jr(e))Z=ut(ms()),Re=!0;else throw e}return Z}var D=new Proxy({},{get(i,e){return de()[e]},set(i,e,t){return de()[e]=t,!0},has(i,e){return e in de()},ownKeys(){return Reflect.ownKeys(de())},getOwnPropertyDescriptor(i,e){let t=Object.getOwnPropertyDescriptor(de(),e);return t&&(t.configurable=!0),t}}),Zr="explorerDates",gs="__explorerDatesConfigWrapped";function ps(i){return!i||typeof i!="object"?{get:()=>{},async update(){},inspect:()=>({defaultValue:void 0,globalValue:void 0,workspaceValue:void 0,workspaceFolderValue:void 0})}:(typeof i.get!="function"&&(i.get=()=>{}),typeof i.update!="function"&&(i.update=async()=>{}),typeof i.inspect!="function"&&(i.inspect=()=>({defaultValue:void 0,globalValue:void 0,workspaceValue:void 0,workspaceFolderValue:void 0})),i)}function ut(i){if(!i)return ms();i.ConfigurationTarget||(i.ConfigurationTarget={Global:1,Workspace:2,WorkspaceFolder:3}),i.workspace||(i.workspace={});let e=i.workspace.getConfiguration;if(typeof e=="function"&&!e[gs]){let t=function(...s){let r=e.apply(this,s);return ps(r)};t[gs]=!0,i.workspace.getConfiguration=t}else typeof e!="function"&&(i.workspace.getConfiguration=()=>ps());return Array.isArray(i.workspace.workspaceFolders)||(i.workspace.workspaceFolders=[]),i}var Le=class{constructor(e={}){this.hi=e.defaultSection||Zr}getValue(e,t={}){let{section:s,resource:r}=t,o=this.Ft(e,s);return this.xt(o.section,r).get(o.key)}inspect(e,t={}){let{section:s,resource:r}=t,o=this.Ft(e,s);return this.xt(o.section,r).inspect(o.key)}async updateSetting(e,t,s={}){let{scope:r="auto",resource:o,section:n,force:c=!1}=s,a=this.Ft(e,n),l=this.xt(a.section,o),u=this.di(r,o),d=l.get(a.key),f=l.inspect(a.key),p=this.gi(f,u);return t!==void 0&&this.fi(d,t)&&!c&&p!==void 0?{key:a.fullKey,updated:!1,reason:"unchanged"}:(await l.update(a.key,t,u),{key:a.fullKey,updated:!0})}async applySettings(e,t={}){let s=Array.isArray(e)?e:Object.entries(e).map(([o,n])=>({key:o,value:n})),r=[];for(let o of s){let n={...t,...o.options||{}};r.push(await this.updateSetting(o.key,o.value,n))}return r}async clearSetting(e,t={}){return this.updateSetting(e,void 0,t)}xt(e,t){return D.workspace.getConfiguration(e||void 0,t)}Ft(e,t){let s=t||this.hi;if(!s)return{section:void 0,key:e,fullKey:e};if(e.startsWith(`${s}.`)){let r=e.slice(s.length+1);return{section:s,key:r,fullKey:e}}return e.includes(".")?{section:void 0,key:e,fullKey:e}:{section:s,key:e,fullKey:`${s}.${e}`}}di(e,t){return e&&e!=="auto"?this.pi(e)||D.ConfigurationTarget.Workspace:t?D.ConfigurationTarget.WorkspaceFolder:D.workspace.workspaceFolders&&D.workspace.workspaceFolders.length>0?D.ConfigurationTarget.Workspace:D.ConfigurationTarget.Global}pi(e){switch(e){case"user":return D.ConfigurationTarget.Global;case"workspace":return D.ConfigurationTarget.Workspace;case"workspaceFolder":return D.ConfigurationTarget.WorkspaceFolder;default:return}}Ni(e){switch(e){case D.ConfigurationTarget.Global:return"user";case D.ConfigurationTarget.Workspace:return"workspace";case D.ConfigurationTarget.WorkspaceFolder:return"workspaceFolder";default:return"unknown"}}fi(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="object")try{return JSON.stringify(e)===JSON.stringify(t)}catch{return!1}return!1}gi(e,t){if(e)switch(t){case D.ConfigurationTarget.Global:return e.globalValue;case D.ConfigurationTarget.Workspace:return e.workspaceValue;case D.ConfigurationTarget.WorkspaceFolder:return e.workspaceFolderValue;default:return}}},ht=null;function Qr(i){return(!ht||i&&i.forceNew)&&(ht=new Le(i)),ht}ws.exports={SettingsCoordinator:Le,getSettingsCoordinator:Qr}});var bs=b((exports,module)=>{var vscode=require("vscode"),{fileSystem}=Se(),{getFileName,getRelativePath,getUriPath,normalizePath}=ae(),{ensureDate}=ce(),{getSettingsCoordinator}=Oe(),{SecureFileOperations,SecurityValidator,detectSecurityEnvironment}=Ye(),isWeb=!0,childProcess=null;function loadChildProcess(){return!childProcess&&!isWeb&&(childProcess=eval("require")("child_process")),childProcess}var SECURITY_WARNING_THROTTLE_MS_DEFAULT=Number(process.env.EXPLORER_DATES_SECURITY_WARNING_THROTTLE_MS||5e3),SECURITY_WARNING_THROTTLE_LIMIT=Number(process.env.EXPLORER_DATES_SECURITY_WARNING_CACHE||500),SECURITY_MAX_WARNINGS_DEFAULT=Number(process.env.EXPLORER_DATES_SECURITY_MAX_WARNINGS_PER_FILE??1),settingsCoordinator=getSettingsCoordinator(),securityEnvironment=detectSecurityEnvironment(),securityWarningLog=new Map;function dedupePaths(i=[]){let e=new Set,t=[];for(let s of i)!s||e.has(s)||(e.add(s),t.push(s));return t}function getExplicitBooleanSetting(i,e){if(!(!i||typeof i.inspect!="function"))try{let t=i.inspect(e);if(!t)return;let s=[t.workspaceFolderValue,t.workspaceValue,t.globalValue];for(let r of s)if(typeof r=="boolean")return r}catch{}}function normalizeSecurityPaths(i=[]){let e=Array.isArray(i)?i:i?[i]:[],t=[];for(let s of e){if(!s||typeof s!="string")continue;let r=s.trim().replace(/^['"]|['"]$/g,"");if(!r)continue;let o=normalizePath(r);o&&t.push(o)}return t}function parseEnvSecurityPaths(){let i=process.env.EXPLORER_DATES_SECURITY_EXTRA_PATHS;if(!i||typeof i!="string")return[];let e=process.platform==="win32"?";":":";return i.split(e).map(t=>t.trim()).filter(Boolean)}function isTestLikeEnvironment(){return securityEnvironment==="test"||process.env.EXPLORER_DATES_TEST_MODE==="1"||!1||process.env.VSCODE_TEST==="1"}function getSecurityValidationContext(){let i=vscode.workspace.getConfiguration("explorerDates"),e=i.get("security.allowTestPaths",!0),t=i.get("security.allowedExtraPaths",[]),r=(vscode.workspace.workspaceFolders||[]).map(L=>{try{return normalizePath(getUriPath(L.uri))}catch{return null}}).filter(Boolean),o=normalizeSecurityPaths(t),n=normalizeSecurityPaths(parseEnvSecurityPaths()),c=dedupePaths([...r,...o,...n]),a=getExplicitBooleanSetting(i,"security.enableBoundaryEnforcement"),l=getExplicitBooleanSetting(i,"security.enforceWorkspaceBoundaries"),u;typeof a=="boolean"?u=a:typeof l=="boolean"?u=l:u=securityEnvironment==="production";let d=e&&isTestLikeEnvironment(),f=u&&!d&&c.length>0,p=i.get("security.logThrottleWindowMs"),w=i.get("security.maxWarningsPerFile"),_=Number.isFinite(p)?Math.max(0,p):Number.isFinite(SECURITY_WARNING_THROTTLE_MS_DEFAULT)?Math.max(0,SECURITY_WARNING_THROTTLE_MS_DEFAULT):5e3,T=Number.isFinite(w)&&w>=0?w:Number.isFinite(SECURITY_MAX_WARNINGS_DEFAULT)&&SECURITY_MAX_WARNINGS_DEFAULT>=0?SECURITY_MAX_WARNINGS_DEFAULT:1;return{allowedPaths:f?c:[],enforceBoundaries:f,throttleMs:_,maxWarningsPerFile:T}}function shouldThrottleSecurityWarning(i,e,t){if(!i)return!1;let s=Date.now(),r=securityWarningLog.get(i)||{lastTimestamp:0,count:0};if(typeof t=="number"&&t>=0&&r.count>=t||typeof e=="number"&&e>0&&s-r.lastTimestamp<e)return!0;if(r.lastTimestamp=s,r.count=(r.count||0)+1,securityWarningLog.set(i,r),securityWarningLog.size>SECURITY_WARNING_THROTTLE_LIMIT){let o=Array.from(securityWarningLog.keys()),n=Math.ceil(o.length*.25);for(let c=0;c<n;c++)securityWarningLog.delete(o[c])}return!1}function getSanitizedPathForLog(i){let e="";if(typeof i=="string")e=i;else if(i&&(e=i.fsPath||i.path||"",!e&&typeof i.toString=="function"))try{e=i.toString(!0)}catch{e=i.toString()}return SecurityValidator.sanitizePath(e||"",{preserveExtension:!0})||"unknown"}function ensureSecureUri(i,e,t){if(!i)return null;let s=getSecurityValidationContext(),r=SecureFileOperations.validateFileUri(i,s.allowedPaths),o=getSanitizedPathForLog(i);if(!r.isValid){let n=`${t}:${o}`;if(!shouldThrottleSecurityWarning(n,s.throttleMs,s.maxWarningsPerFile)){let c=securityEnvironment==="production"?"warn":securityEnvironment==="development"?"info":"debug";(typeof e[c]=="function"?e[c].bind(e):e.warn.bind(e))(`Blocked ${t} due to insecure path`,{path:o,issue:r.issue,environment:securityEnvironment,enforceBoundaries:s.enforceBoundaries})}return securityEnvironment==="production"&&vscode.window.showWarningMessage("Explorer Dates blocked this file because its path failed security checks."),null}if(r.warnings?.length){let n=`warning:${t}:${o}:${r.warnings.join("|")}`;if(!shouldThrottleSecurityWarning(n,s.throttleMs,s.maxWarningsPerFile)){let c=securityEnvironment==="production"?"warn":securityEnvironment==="development"?"info":"debug";(typeof e[c]=="function"?e[c].bind(e):e.warn.bind(e))(`Security warnings for ${t}`,{path:o,warnings:r.warnings,environment:securityEnvironment,enforceBoundaries:s.enforceBoundaries})}}return i}function registerCoreCommands({context:i,fileDateProvider:e,logger:t,l10n:s}){let r=[];r.push(vscode.commands.registerCommand("explorerDates.refreshDateDecorations",()=>{try{if(e){e.clearAllCaches(),e.refreshAll();let o=s?.getString("refreshSuccess")||"Date decorations refreshed - all caches cleared";vscode.window.showInformationMessage(o),t.info("Date decorations refreshed manually with cache clear")}}catch(o){t.error("Failed to refresh decorations",o),vscode.window.showErrorMessage(`Failed to refresh decorations: ${o.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.previewConfiguration",o=>{try{e&&(e.applyPreviewSettings(o),t.info("Configuration preview applied",o))}catch(n){t.error("Failed to apply configuration preview",n)}})),r.push(vscode.commands.registerCommand("explorerDates.clearPreview",()=>{try{e&&(e.applyPreviewSettings(null),t.info("Configuration preview cleared"))}catch(o){t.error("Failed to clear configuration preview",o)}})),r.push(vscode.commands.registerCommand("explorerDates.showMetrics",async()=>{try{if(e){let o=e.getMetrics(),n=`Explorer Dates Metrics:
Total Decorations: ${o.totalDecorations}
Cache Size: ${o.cacheSize}
Cache Hits: ${o.cacheHits}
Cache Misses: ${o.cacheMisses}
Cache Hit Rate: ${o.cacheHitRate}
Errors: ${o.errors}`;o.advancedCache&&(n+=`

Advanced Cache:
Memory Items: ${o.advancedCache.memoryItems}
Memory Usage: ${(o.advancedCache.memoryUsage/1024/1024).toFixed(2)} MB
Memory Hit Rate: ${o.advancedCache.memoryHitRate}
Disk Hit Rate: ${o.advancedCache.diskHitRate}
Evictions: ${o.advancedCache.evictions}`),o.batchProcessor&&(n+=`

Batch Processor:
Queue Length: ${o.batchProcessor.queueLength}
Is Processing: ${o.batchProcessor.isProcessing}
Average Batch Time: ${o.batchProcessor.averageBatchTime.toFixed(2)}ms`),await vscode.window.showInformationMessage(n,{modal:!0},"View Rich Analytics")==="View Rich Analytics"&&await vscode.commands.executeCommand("explorerDates.showPerformanceAnalytics"),t.info("Metrics displayed",o)}}catch(o){t.error("Failed to show metrics",o),vscode.window.showErrorMessage(`Failed to show metrics: ${o.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.openLogs",()=>{try{t.show()}catch(o){t.error("Failed to open logs",o),vscode.window.showErrorMessage(`Failed to open logs: ${o.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.showCurrentConfig",()=>{try{let o=vscode.workspace.getConfiguration("explorerDates"),n={highContrastMode:o.get("highContrastMode"),badgePriority:o.get("badgePriority"),colorScheme:o.get("colorScheme"),accessibilityMode:o.get("accessibilityMode"),dateDecorationFormat:o.get("dateDecorationFormat"),showGitInfo:o.get("showGitInfo"),showFileSize:o.get("showFileSize")},c=`Current Explorer Dates Configuration:

${Object.entries(n).map(([a,l])=>`${a}: ${JSON.stringify(l)}`).join(`
`)}`;vscode.window.showInformationMessage(c,{modal:!0}),t.info("Current configuration displayed",n)}catch(o){t.error("Failed to show configuration",o)}})),r.push(vscode.commands.registerCommand("explorerDates.toggleDecorations",async()=>{try{let o=settingsCoordinator.getValue("showDateDecorations");await settingsCoordinator.updateSetting("showDateDecorations",!o,{scope:"user",reason:"toggle-decorations"});let n=o?s?.getString("decorationsDisabled")||"Date decorations disabled":s?.getString("decorationsEnabled")||"Date decorations enabled";vscode.window.showInformationMessage(n),t.info(`Date decorations toggled to: ${!o}`)}catch(o){t.error("Failed to toggle decorations",o),vscode.window.showErrorMessage(`Failed to toggle decorations: ${o.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.copyFileDate",async o=>{try{let n=o;if(!n&&vscode.window.activeTextEditor&&(n=vscode.window.activeTextEditor.document.uri),!n){vscode.window.showWarningMessage("No file selected");return}let c=ensureSecureUri(n,t,"copyFileDate");if(!c)return;n=c;let a=await fileSystem.stat(n),l=ensureDate(a.mtime).toLocaleString();await vscode.env.clipboard.writeText(l),vscode.window.showInformationMessage(`Copied to clipboard: ${l}`),t.info(`File date copied for: ${getSanitizedPathForLog(n)}`)}catch(n){t.error("Failed to copy file date",n),vscode.window.showErrorMessage(`Failed to copy file date: ${n.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.showFileDetails",async o=>{try{let n=o;if(!n&&vscode.window.activeTextEditor&&(n=vscode.window.activeTextEditor.document.uri),!n){vscode.window.showWarningMessage("No file selected");return}let c=ensureSecureUri(n,t,"showFileDetails");if(!c)return;n=c;let a=await fileSystem.stat(n),l=getFileName(n.fsPath||n.path),u=e?.ve(a.size,"auto")||`${a.size} bytes`,d=ensureDate(a.mtime).toLocaleString(),f=ensureDate(a.birthtime||a.mtime).toLocaleString(),p=`File: ${l}
Size: ${u}
Modified: ${d}
Created: ${f}
Path: ${n.fsPath||n.path}`;vscode.window.showInformationMessage(p,{modal:!0}),t.info(`File details shown for: ${getSanitizedPathForLog(n)}`)}catch(n){t.error("Failed to show file details",n),vscode.window.showErrorMessage(`Failed to show file details: ${n.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.toggleFadeOldFiles",async()=>{try{let o=settingsCoordinator.getValue("fadeOldFiles")??!1;await settingsCoordinator.updateSetting("fadeOldFiles",!o,{scope:"user",reason:"toggle-fade"});let n=o?"Fade old files disabled":"Fade old files enabled";vscode.window.showInformationMessage(n),t.info(`Fade old files toggled to: ${!o}`)}catch(o){t.error("Failed to toggle fade old files",o),vscode.window.showErrorMessage(`Failed to toggle fade old files: ${o.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.showFileHistory",async o=>{try{if(isWeb){vscode.window.showInformationMessage("Git history is unavailable on VS Code for Web.");return}let n=o;if(!n&&vscode.window.activeTextEditor&&(n=vscode.window.activeTextEditor.document.uri),!n){vscode.window.showWarningMessage("No file selected");return}let c=ensureSecureUri(n,t,"showFileHistory");if(!c)return;n=c;let a=vscode.workspace.getWorkspaceFolder(n);if(!a){vscode.window.showWarningMessage("File is not in a workspace");return}let l=getRelativePath(a.uri.fsPath||a.uri.path,n.fsPath||n.path),d=`git log --oneline -10 -- "${SecurityValidator.sanitizePath(l,{preserveExtension:!0})||l}"`;loadChildProcess().exec(d,{cwd:a.uri.fsPath,timeout:3e3},(p,w)=>{if(p){p.message.includes("not a git repository")?vscode.window.showWarningMessage("This file is not in a Git repository"):vscode.window.showErrorMessage(`Git error: ${p.message}`);return}if(!w.trim()){vscode.window.showInformationMessage("No Git history found for this file");return}let _=w.trim(),T=getFileName(n.fsPath||n.path);vscode.window.showInformationMessage(`Recent commits for ${T}:

${_}`,{modal:!0})}),t.info(`File history requested for: ${getSanitizedPathForLog(n)}`)}catch(n){t.error("Failed to show file history",n),vscode.window.showErrorMessage(`Failed to show file history: ${n.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.compareWithPrevious",async o=>{try{if(isWeb){vscode.window.showInformationMessage("Git comparisons are unavailable on VS Code for Web.");return}let n=o;if(!n&&vscode.window.activeTextEditor&&(n=vscode.window.activeTextEditor.document.uri),!n){vscode.window.showWarningMessage("No file selected");return}let c=ensureSecureUri(n,t,"compareWithPrevious");if(!c)return;if(n=c,!vscode.workspace.getWorkspaceFolder(n)){vscode.window.showWarningMessage("File is not in a workspace");return}await vscode.commands.executeCommand("git.openChange",n),t.info(`Git diff opened for: ${getSanitizedPathForLog(n)}`)}catch(n){t.error("Failed to compare with previous version",n),vscode.window.showErrorMessage(`Failed to compare with previous version: ${n.message}`)}})),r.forEach(o=>i.subscriptions.push(o))}module.exports={registerCoreCommands}});var Es=b((Mi,ys)=>{var z=require("vscode");function ei({context:i,logger:e,getOnboardingManager:t}){let s=[];s.push(z.commands.registerCommand("explorerDates.showFeatureTour",async()=>{try{let r=await t();if(!r){z.window.showWarningMessage("Onboarding system unavailable.");return}await r.showFeatureTour(),e.info("Feature tour opened")}catch(r){e.error("Failed to show feature tour",r),z.window.showErrorMessage(`Failed to show feature tour: ${r.message}`)}})),s.push(z.commands.registerCommand("explorerDates.showQuickSetup",async()=>{try{let r=await t();if(!r){z.window.showWarningMessage("Onboarding system unavailable.");return}await r.showQuickSetupWizard(),e.info("Quick setup wizard opened")}catch(r){e.error("Failed to show quick setup wizard",r),z.window.showErrorMessage(`Failed to show quick setup wizard: ${r.message}`)}})),s.push(z.commands.registerCommand("explorerDates.showWhatsNew",async()=>{try{let r=await t();if(!r){z.window.showWarningMessage("Onboarding system unavailable.");return}let o=i.extension.packageJSON.version;await r.showWhatsNew(o),e.info("What's new panel opened")}catch(r){e.error("Failed to show what's new",r),z.window.showErrorMessage(`Failed to show what's new: ${r.message}`)}})),s.forEach(r=>i.subscriptions.push(r))}ys.exports={registerOnboardingCommands:ei}});var gt=b((Ri,Cs)=>{var x=require("vscode"),{getLogger:ti}=V(),Q="explorerDates.",_s=["performanceMode","featureLevel","smartFileWatching","smartWatcherMaxPatterns","smartWatcherExtensions","enableSmartWatcherFallbacks","enableOnboardingSystem","enableExportReporting","enableAnalysisCommands","enableAdvancedCache","enableWorkspaceTemplates","enableWorkspaceIntelligence","enableExtensionApi","enableIncrementalWorkers","enableProgressiveAnalysis"],si=/^\.?explorer-dates.*\.json$/i,ri=new Set([`${Q}customColors`,`${Q}enableReporting`]),dt=class{constructor(e){this.mi=e,this._logger=ti()}async getOrganizationPlan(){let e=x.workspace.getConfiguration("explorerDates"),t=this.At();return this.Ds(e,t)}async organize(e={}){let t=x.workspace.getConfiguration("explorerDates"),s=this.At(),r=e.plan||await this.Ds(t,s),o={changed:!1,movedToWorkspace:[],reorderedWorkspace:!1,sortedFiles:[]};return!r.needsWork&&!e.force||(await this.wi(t,o,r.keysToMove),await this.bi(t,r.workspaceEntries,o,r.workspaceOutOfOrder),await this.yi(o,r.filesToSort)),o}async Ds(e,t){let s=this.Ei(e),r=this.Ts(e,t),o=this._i(r),n=await this.Fs(),c=await this.xs(n);return{keysToMove:s,workspaceEntries:r,workspaceOutOfOrder:o,filesToSort:c,needsWork:s.length>0||o||c.length>0}}Ei(e){let t=[];for(let s of _s){let r=e.inspect(s);if(!r)continue;let o=r.globalValue!==void 0,n=r.workspaceValue!==void 0,c=r.workspaceFolderValue!==void 0;o&&!n&&!c&&t.push(s)}return t}Ts(e,t){let s=[];for(let r of t){if(this.Ci(r))continue;let o=this.Si(r),n=e.inspect(o);n&&n.workspaceValue!==void 0&&s.push({fullKey:r,shortKey:o,value:n.workspaceValue})}return s}_i(e){if(!e||e.length===0)return!1;let t=[...e].sort((s,r)=>s.fullKey.localeCompare(r.fullKey));return!e.every((s,r)=>s.fullKey===t[r].fullKey)}async xs(e){if(!e||e.length===0)return[];let t=[];for(let s of e)await this.vi(s)&&t.push(s);return t}async Fs(){let e=this.ki();if(!e.length||!x.workspace.fs)return[];let t=new Map;for(let s of e){await this.As(s,t);let r=x.Uri.joinPath(s,".vscode");await this.As(r,t)}return Array.from(t.values())}async As(e,t){if(e)try{let s=await x.workspace.fs.readDirectory(e);for(let[r,o]of s){if(o!==x.FileType.File||!this.Di(r))continue;let n=x.Uri.joinPath(e,r),c=n.fsPath||n.path;t.has(c)||t.set(c,n)}}catch(s){if(s?.code==="FileNotFound"||s?.code==="ENOENT")return;this._logger.warn(`Failed to scan Explorer Dates directory ${e.fsPath||e.path}`,s)}}ki(){return(x.workspace.workspaceFolders||[]).map(e=>e?.uri).filter(Boolean)}Di(e=""){return si.test(e)}async wi(e,t,s){let r=Array.isArray(s)?s:_s;if(r.length)for(let o of r){let n=e.inspect(o);if(!n)continue;let c=n.globalValue!==void 0,a=n.workspaceValue!==void 0,l=n.workspaceFolderValue!==void 0;c&&!a&&!l&&(await e.update(o,n.globalValue,x.ConfigurationTarget.Workspace),await e.update(o,void 0,x.ConfigurationTarget.Global),t.movedToWorkspace.push(`${Q}${o}`),t.changed=!0,this._logger.info(`Moved ${Q}${o} from user settings to workspace settings.`))}}async bi(e,t,s,r=!1){let o=Array.isArray(t)&&t.length>0?t:this.Ts(e,this.At());if(o.length===0)return;let n=[...o].sort((a,l)=>a.fullKey.localeCompare(l.fullKey));if(!(!r&&o.every((a,l)=>a.fullKey===n[l].fullKey))){for(let a of o)await e.update(a.shortKey,void 0,x.ConfigurationTarget.Workspace);for(let a of n)await e.update(a.shortKey,a.value,x.ConfigurationTarget.Workspace);s.reorderedWorkspace=!0,s.changed=!0,this._logger.info("Reordered Explorer Dates workspace settings alphabetically.")}}async yi(e,t){let s=Array.isArray(t)?t:await this.xs(await this.Fs());if(s.length)for(let r of s)await this.Ti(r)&&(e.sortedFiles.push(this.Ze(r)),e.changed=!0)}async Ti(e){try{let t=await x.workspace.fs.readFile(e),s=Buffer.from(t).toString("utf8").trim();if(!s)return!1;let r=JSON.parse(s),o=this.Qe(r),n=JSON.stringify(o,null,2);return await x.workspace.fs.writeFile(e,Buffer.from(`${n}
`,"utf8")),this._logger.info(`Sorted Explorer Dates file: ${this.Ze(e)}`),!0}catch(t){return t?.code==="FileNotFound"||t?.code==="ENOENT"||this._logger.warn(`Failed to sort Explorer Dates file ${this.Ze(e)}`,t),!1}}async vi(e){try{let t=await x.workspace.fs.readFile(e),s=Buffer.from(t).toString("utf8").trim();if(!s)return!1;let r=JSON.parse(s),o=JSON.stringify(r,null,2),n=JSON.stringify(this.Qe(r),null,2);return o!==n}catch(t){return t?.code==="FileNotFound"||t?.code==="ENOENT"||this._logger.warn(`Failed to inspect Explorer Dates file ${this.Ze(e)}`,t),!1}}Qe(e){return Array.isArray(e)?e.map(t=>this.Qe(t)):e&&typeof e=="object"?Object.keys(e).sort((t,s)=>t.localeCompare(s)).reduce((t,s)=>(t[s]=this.Qe(e[s]),t),{}):e}At(){let e=this.mi?.extension?.packageJSON?.contributes?.configuration?.properties||{};return Object.keys(e).filter(t=>t.startsWith(Q))}Si(e){return e.startsWith(Q)?e.substring(Q.length):e}Ci(e){return ri.has(e)}Ze(e){return e?.fsPath||e?.path||String(e)}};Cs.exports={SettingsOrganizer:dt}});var Ts=b((Li,Ds)=>{var m=require("vscode"),{getSettingsCoordinator:ii}=Oe(),{SettingsOrganizer:oi}=gt(),Pe=ii(),Ss="explorerDates.resetToDefaults",ks=Symbol.for("explorerDates.resetToDefaults.registered");function ni(){return!!globalThis[ks]}function vs(){globalThis[ks]=!0}async function ai({context:i,logger:e,getSettingsMigrationManager:t}){let s=[];return s.push(m.commands.registerCommand("explorerDates.migrateSettings",async()=>{try{let r=await t();if(!r){m.window.showWarningMessage("Settings migration system unavailable.");return}m.window.showInformationMessage("Checking for settings that need migration...");let o=await r.migrateAllSettings(i),n=await r.autoOrganizeSettingsIfNeeded(i,{trigger:"manual-migrate",silent:!0}),c=[];o.length>0&&c.push(`${o.length} migration${o.length===1?"":"s"}`),n?.changed&&c.push("settings reorganized"),c.length===0?m.window.showInformationMessage("\u2705 All settings are up to date!"):m.window.showInformationMessage(`\u2705 Explorer Dates maintenance applied: ${c.join(" + ")}.`),e.info("Manual settings migration completed",{results:o,organizationSummary:n})}catch(r){e.error("Failed to run settings migration",r),m.window.showErrorMessage(`Failed to migrate settings: ${r.message}`)}})),s.push(m.commands.registerCommand("explorerDates.organizeSettings",async()=>{try{let o=await new oi(i).organize(),n=o.movedToWorkspace.length,c=o.sortedFiles.length,a=[o.reorderedWorkspace?"workspace settings reordered":null,n?`${n} setting(s) moved to workspace scope`:null,c?`${c} explorer-dates file(s) sorted`:null].filter(Boolean).join(" \u2022 ")||"No changes were necessary.";m.window.showInformationMessage(`Explorer Dates settings organized: ${a}`),e.info("Organize settings command executed",o)}catch(r){e.error("Failed to organize Explorer Dates settings",r),m.window.showErrorMessage(`Failed to organize settings: ${r.message}`)}})),s.push(m.commands.registerCommand("explorerDates.validateConfiguration",async()=>{try{let r=await t();if(!r){m.window.showWarningMessage("Settings validation system unavailable.");return}let o=await r.validateConfiguration();if(o.length===0)m.window.showInformationMessage("\u2705 Configuration is valid - no issues found!");else{let n=`Found ${o.length} configuration issue(s). Would you like to see details?`;await m.window.showWarningMessage(n,"Show Details","Dismiss")==="Show Details"&&await ci(o)}e.info("Configuration validation completed",{issuesFound:o.length,issues:o})}catch(r){e.error("Failed to validate configuration",r),m.window.showErrorMessage(`Failed to validate configuration: ${r.message}`)}})),s.push(m.commands.registerCommand("explorerDates.cleanLegacySettings",async()=>{try{let r=await t();if(!r){m.window.showWarningMessage("Settings migration system unavailable.");return}let o=await r.cleanupDeprecatedSettings();o?m.window.showInformationMessage("\u2705 Deprecated settings have been cleaned up!"):m.window.showInformationMessage("\u2139\uFE0F No deprecated settings found to clean up."),e.info("Legacy settings cleanup completed",{cleaned:o})}catch(r){e.error("Failed to clean legacy settings",r),m.window.showErrorMessage(`Failed to clean legacy settings: ${r.message}`)}})),s.push(m.commands.registerCommand("explorerDates.showMigrationHistory",async()=>{try{let r=await t();if(!r){m.window.showWarningMessage("Settings migration system unavailable.");return}let o=r.getMigrationHistory(i);if(o.length===0){m.window.showInformationMessage("No migration history found.");return}await li(o),e.info("Displayed migration history",{historyLength:o.length})}catch(r){e.error("Failed to show migration history",r),m.window.showErrorMessage(`Failed to show migration history: ${r.message}`)}})),s.push(m.commands.registerCommand("explorerDates.applyCustomColors",async()=>{try{let r=await m.window.showQuickPick([{label:"Copy to Clipboard",description:"Copy color configuration to clipboard"},{label:"Open Settings",description:"Open VS Code settings to workbench.colorCustomizations"},{label:"Apply Default Colors",description:"Apply default Explorer Dates colors"}],{placeHolder:"How would you like to set up custom colors?",ignoreFocusOut:!0});if(!r)return;let o={"explorerDates.customColor.veryRecent":"#00ff00","explorerDates.customColor.recent":"#ffff00","explorerDates.customColor.old":"#ff0000"};switch(r.label){case"Copy to Clipboard":let n=JSON.stringify({"workbench.colorCustomizations":o},null,2);await m.env.clipboard.writeText(n),m.window.showInformationMessage("Color configuration copied to clipboard!");break;case"Open Settings":await m.commands.executeCommand("workbench.action.openSettings","workbench.colorCustomizations");break;case"Apply Default Colors":let l={...m.workspace.getConfiguration("workbench").get("colorCustomizations",{}),...o};await Pe.updateSetting("workbench.colorCustomizations",l,{scope:"user",reason:"custom-colors-command"}),await Pe.updateSetting("colorScheme","custom",{scope:"user",reason:"custom-colors-command"}),m.window.showInformationMessage("\u2705 Custom colors applied successfully!");break}e.info("Custom colors command executed",{action:r.label})}catch(r){e.error("Failed to apply custom colors",r),m.window.showErrorMessage(`Failed to apply custom colors: ${r.message}`)}})),await ui({context:i,logger:e,subscriptions:s}),s.push(m.commands.registerCommand("explorerDates.exportConfiguration",async()=>{try{let r=m.workspace.getConfiguration("explorerDates"),o={},c=i.extension.packageJSON?.contributes?.configuration?.properties||{};for(let u of Object.keys(c))if(u.startsWith("explorerDates.")){let d=u.replace("explorerDates.",""),f=r.get(d);f!==void 0&&(o[u]=f)}let a=JSON.stringify(o,null,2),l=await m.window.showQuickPick([{label:"Copy to Clipboard",description:"Copy configuration to clipboard"},{label:"Save to File",description:"Save configuration to a JSON file"}],{placeHolder:"How would you like to export the configuration?"});if(!l)return;switch(l.label){case"Copy to Clipboard":await m.env.clipboard.writeText(a),m.window.showInformationMessage("Configuration copied to clipboard!");break;case"Save to File":let u=await m.window.showSaveDialog({defaultUri:m.Uri.file("explorer-dates-config.json"),filters:{JSON:["json"]}});u&&(await m.workspace.fs.writeFile(u,Buffer.from(a,"utf8")),m.window.showInformationMessage(`Configuration saved to ${u.fsPath}`));break}e.info("Configuration exported",{action:l.label,settingsCount:Object.keys(o).length})}catch(r){e.error("Failed to export configuration",r),m.window.showErrorMessage(`Failed to export configuration: ${r.message}`)}})),s}async function ci(i){let e=m.window.createWebviewPanel("explorerDatesConfigIssues","Explorer Dates - Configuration Issues",m.ViewColumn.One,{enableScripts:!1}),t=i.map(s=>`
        <div class="issue">
            <h3><code>${s.setting}</code></h3>
            <p><strong>Current value:</strong> <code>${JSON.stringify(s.value)}</code></p>
            <p><strong>Issue:</strong> ${s.message}</p>
        </div>
    `).join("");e.webview.html=`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Configuration Issues</title>
            <style>
                body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; }
                h1 { color: #d73a49; }
                .issue { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; margin: 10px 0; border-radius: 5px; }
                .issue h3 { margin-top: 0; color: #856404; }
                code { background: #f5f5f5; padding: 2px 4px; border-radius: 3px; }
            </style>
        </head>
        <body>
            <h1>\u26A0\uFE0F Configuration Issues Found</h1>
            ${t}
            <p><strong>To fix these issues:</strong> Open VS Code Settings and update the highlighted settings with valid values.</p>
        </body>
        </html>
    `}async function li(i){let e=m.window.createWebviewPanel("explorerDatesMigrationHistory","Explorer Dates - Migration History",m.ViewColumn.One,{enableScripts:!1}),t=i.slice().reverse().map((s,r)=>`
        <div class="migration-record">
            <h3>Migration #${i.length-r}</h3>
            <p><strong>Date:</strong> ${new Date(s.timestamp).toLocaleString()}</p>
            <p><strong>Extension Version:</strong> ${s.extensionVersion}</p>
            <p><strong>Settings Migrated:</strong></p>
            <ul>
                ${s.migratedSettings.map(o=>`<li><code>${o}</code></li>`).join("")}
            </ul>
        </div>
    `).join("");e.webview.html=`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Migration History</title>
            <style>
                body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; }
                h1 { color: #007ACC; }
                .migration-record { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 15px 0; border-radius: 5px; }
                .migration-record h3 { margin-top: 0; color: #495057; }
                code { background: #e9ecef; padding: 2px 4px; border-radius: 3px; }
                ul { line-height: 1.6; }
            </style>
        </head>
        <body>
            <h1>\u{1F4DC} Settings Migration History</h1>
            ${t}
        </body>
        </html>
    `}async function ui({context:i,logger:e,subscriptions:t}){if(ni()){e?.warn?.("Duplicate explorerDates.resetToDefaults registration skipped");return}let s;try{s=await m.commands.getCommands(!0)}catch(r){e?.warn?.("Unable to inspect VS Code command registry; proceeding with reset command registration",r)}if(Array.isArray(s)&&s.includes(Ss)){vs(),e?.warn?.("Detected existing explorerDates.resetToDefaults handler; skipping duplicate registration");return}vs(),t.push(m.commands.registerCommand(Ss,async()=>{try{if(await m.window.showWarningMessage("This will reset all Explorer Dates settings to their default values. Are you sure?",{modal:!0},"Reset Settings","Cancel")!=="Reset Settings")return;let n=i.extension.packageJSON?.contributes?.configuration?.properties||{},c=0;for(let a of Object.keys(n))if(a.startsWith("explorerDates.")){let l=a.replace("explorerDates.","");try{await Pe.clearSetting(l,{scope:"user",reason:"reset-to-defaults"}),await Pe.clearSetting(l,{scope:"workspace",reason:"reset-to-defaults"}),c++}catch(u){e.warn(`Failed to reset setting ${l}`,u)}}m.window.showInformationMessage(`\u2705 Reset ${c} settings to defaults.`),e.info("Settings reset to defaults",{resetCount:c})}catch(r){e.error("Failed to reset settings to defaults",r),m.window.showErrorMessage(`Failed to reset settings: ${r.message}`)}}))}Ds.exports={registerMigrationCommands:ai}});var Fs=b((exports,module)=>{var vscode=require("vscode"),fs=null,path=null;try{typeof process<"u"&&process.versions?.node}catch{fs=null,path=null}var textDecoder=typeof globalThis.TextDecoder=="function"?new globalThis.TextDecoder("utf-8"):new(require("util")).TextDecoder("utf-8"),TemplateStore=class{constructor(){this.Mt=new Map,this.Rt=null}initialize(e){this.Rt=e?.extensionUri??null}async getTemplate(e){if(this.Mt.has(e))return this.Mt.get(e);let t=await this.Fi(e);return this.Mt.set(e,t),t}async Fi(e){let t=`${e}.html`;if(this.Rt){let s=vscode.Uri.joinPath(this.Rt,"assets","templates",t),r=await vscode.workspace.fs.readFile(s);return textDecoder.decode(r)}if(fs&&path){let s=path.resolve(__dirname,"..","..","assets","templates",t);return await fs.promises.readFile(s,"utf8")}throw new Error(`TemplateStore: Unable to load template "${e}" (missing extension context)`)}},templateStore=new TemplateStore;module.exports={templateStore,initializeTemplateStore:i=>templateStore.initialize(i)}});var As=b((Oi,xs)=>{var G=require("vscode"),{getLogger:hi}=V(),{getSettingsCoordinator:di}=Oe(),{SettingsOrganizer:gi}=gt(),ft=class{constructor(){this._logger=hi(),this.d=new Set,this.c=di(),this.Lt=null,this.Ms=null}async migrateAllSettings(e){let t=[()=>this.migrateReportingSettings(),()=>this.migrateCustomColorSettings(),()=>this.validateFeatureFlags(),()=>this.cleanupDeprecatedSettings(),()=>this.trackMigrationMetrics(e)],s=[];for(let r of t)try{let o=await r();o&&s.push(o)}catch(o){this._logger.error("Settings migration failed:",o)}return s.length>0&&(this._logger.info("Settings migration completed",{migratedSettings:s}),this.xi(s)),s}async migrateReportingSettings(){let e=this.c.inspect("enableReporting"),t=this.c.inspect("enableExportReporting");if(e?.globalValue!==void 0&&t?.globalValue===void 0)try{await this.c.updateSetting("enableExportReporting",e.globalValue,{scope:"user",reason:"migrate-enableReporting-global"}),this.d.add("enableReporting\u2192enableExportReporting (Global)"),this._logger.info("Migrated global enableReporting to enableExportReporting",{oldValue:e.globalValue})}catch(s){this._logger.error("Failed to migrate global enableReporting setting",s)}if(e?.workspaceValue!==void 0&&t?.workspaceValue===void 0)try{await this.c.updateSetting("enableExportReporting",e.workspaceValue,{scope:"workspace",reason:"migrate-enableReporting-workspace"}),this.d.add("enableReporting\u2192enableExportReporting (Workspace)"),this._logger.info("Migrated workspace enableReporting to enableExportReporting",{oldValue:e.workspaceValue})}catch(s){this._logger.error("Failed to migrate workspace enableReporting setting",s)}if(e?.workspaceFolderValue!==void 0&&t?.workspaceFolderValue===void 0)try{await this.c.updateSetting("enableExportReporting",e.workspaceFolderValue,{scope:"workspaceFolder",reason:"migrate-enableReporting-folder"}),this.d.add("enableReporting\u2192enableExportReporting (WorkspaceFolder)"),this._logger.info("Migrated workspace folder enableReporting to enableExportReporting",{oldValue:e.workspaceFolderValue})}catch(s){this._logger.error("Failed to migrate workspace folder enableReporting setting",s)}return this.d.has("enableReporting\u2192enableExportReporting (Global)")||this.d.has("enableReporting\u2192enableExportReporting (Workspace)")||this.d.has("enableReporting\u2192enableExportReporting (WorkspaceFolder)")}async migrateCustomColorSettings(){let t=G.workspace.getConfiguration("explorerDates").get("customColors");if(!t||typeof t!="object")return!1;let s=this.c.getValue("workbench.colorCustomizations")||{};if(s["explorerDates.customColor.veryRecent"]!==void 0||s["explorerDates.customColor.recent"]!==void 0||s["explorerDates.customColor.old"]!==void 0)return!1;let o={...s,"explorerDates.customColor.veryRecent":t.veryRecent||"#00ff00","explorerDates.customColor.recent":t.recent||"#ffff00","explorerDates.customColor.old":t.old||"#ff0000"};try{return await this.c.updateSetting("workbench.colorCustomizations",o,{scope:"user",reason:"migrate-customColors"}),this.d.add("customColors\u2192workbench.colorCustomizations"),this._logger.info("Migrated custom colors to workbench.colorCustomizations",{oldColors:t,newColors:o}),!0}catch(n){return this._logger.error("Failed to migrate custom colors",n),!1}}async validateFeatureFlags(){let e={enableOnboardingSystem:{default:!0,type:"boolean"},enableExportReporting:{default:!0,type:"boolean"},enableAnalysisCommands:{default:!0,type:"boolean"},enableAdvancedCache:{default:!0,type:"boolean"},enableWorkspaceIntelligence:{default:!0,type:"boolean"},enableWorkspaceTemplates:{default:!0,type:"boolean"},enableExtensionApi:{default:!0,type:"boolean"},enableProgressiveAnalysis:{default:null,type:"boolean",allowNull:!0}},t=!1,s=[],r=[];for(let[o,n]of Object.entries(e)){let c=this.c.inspect(o),a=this.c.getValue(o),l=c?.globalValue!==void 0,u=c?.workspaceValue!==void 0;if(!l&&!u)r.push(o);else if(a!==void 0&&!(n.allowNull&&a===null?!0:typeof a===n.type))try{await this.c.updateSetting(o,n.default,{scope:"user",reason:`feature-flag-validation:${o}`}),s.push(`${o}: corrected type mismatch`),t=!0}catch(f){this._logger.error(`Failed to fix feature flag ${o}`,f)}}return t?(this.d.add("featureFlags\u2192validated"),this._logger.info("Validated feature flags",{fixes:s})):r.length>0&&this._logger.info("Feature flags relying on defaults (no migration needed)",{flags:r}),t}async cleanupDeprecatedSettings(){let e=["customColors","enableReporting"],t=[];for(let r of e){let o=this.c.inspect(r);(o?.globalValue!==void 0||o?.workspaceValue!==void 0||o?.workspaceFolderValue!==void 0)&&t.push(r)}if(t.length===0)return!1;if(await G.window.showInformationMessage(`Explorer Dates found ${t.length} deprecated setting(s). Would you like to remove them?`,{modal:!1},"Clean Up Now","Keep Old Settings","Ask Later")==="Clean Up Now"){for(let r of t)try{await this.c.clearSetting(r,{scope:"user",reason:"cleanup-deprecated"}),await this.c.clearSetting(r,{scope:"workspace",reason:"cleanup-deprecated"}),await this.c.clearSetting(r,{scope:"workspaceFolder",reason:"cleanup-deprecated"}),this._logger.info(`Removed deprecated setting: ${r}`)}catch(o){this._logger.error(`Failed to remove deprecated setting ${r}`,o)}return this.d.add("deprecatedSettings\u2192removed"),!0}return!1}async trackMigrationMetrics(e){if(this.d.size===0)return!1;let t=e.globalState.get("explorerDates.migrationHistory",[]),s={timestamp:new Date().toISOString(),extensionVersion:e.extension.packageJSON.version,migratedSettings:Array.from(this.d)};return t.push(s),t.length>5&&t.splice(0,t.length-5),await e.globalState.update("explorerDates.migrationHistory",t),this._logger.info("Recorded migration metrics",s),!0}async autoOrganizeSettingsIfNeeded(e,t={}){let s=this.Ai(e);if(!s)return null;try{let r=await s.getOrganizationPlan();if(!r?.needsWork)return this._logger.debug("Auto organization skipped - no Explorer Dates settings to tidy."),null;let o=await s.organize({plan:r});if(o?.changed){if(!t.silent){let n=[];o.movedToWorkspace.length&&n.push(`${o.movedToWorkspace.length} moved to workspace`),o.reorderedWorkspace&&n.push("workspace keys sorted"),o.sortedFiles.length&&n.push(`${o.sortedFiles.length} file(s) tidied`);let c=n.length?` (${n.join(" \u2022 ")})`:"";G.window.showInformationMessage(`Explorer Dates cleaned up project settings${c}.`)}this._logger.info("Explorer Dates settings auto-organized",{trigger:t.trigger||"unknown",summary:o})}return o}catch(r){return this._logger.warn("Automatic Explorer Dates settings organization failed",r),null}}Ai(e){return e?((!this.Lt||this.Ms!==e)&&(this.Lt=new gi(e),this.Ms=e),this.Lt):(this._logger.debug("Settings organizer unavailable - missing extension context."),null)}async xi(e){let s=`Explorer Dates updated ${e.length} setting(s) for compatibility. Your configuration has been preserved.`;switch(await G.window.showInformationMessage(s,{modal:!1},"View Changes","Open Settings")){case"View Changes":await this.Mi();break;case"Open Settings":await G.commands.executeCommand("workbench.action.openSettings","explorerDates");break}}async Mi(){let e=G.window.createWebviewPanel("explorerDatesMigration","Explorer Dates - Settings Migration",G.ViewColumn.One,{enableScripts:!1}),t=Array.from(this.d).map(s=>`<li><code>${s}</code></li>`).join("");e.webview.html=`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Settings Migration</title>
                <style>
                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; }
                    h1 { color: #007ACC; }
                    code { background: #f5f5f5; padding: 2px 4px; border-radius: 3px; }
                    ul { line-height: 1.6; }
                    .info { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 10px 0; }
                </style>
            </head>
            <body>
                <h1>\u{1F527} Settings Migration Completed</h1>
                
                <div class="info">
                    <strong>Good news!</strong> Explorer Dates automatically updated your settings to use the latest configuration options. Your preferences have been preserved.
                </div>

                <h2>Changes Made:</h2>
                <ul>
                    ${t}
                </ul>

                <h2>What This Means:</h2>
                <ul>
                    <li><strong>enableReporting \u2192 enableExportReporting:</strong> Consolidated naming for consistency</li>
                    <li><strong>customColors \u2192 workbench.colorCustomizations:</strong> Uses VS Code's standard color system</li>
                    <li><strong>Feature flags validated:</strong> Ensures proper types and values</li>
                    <li><strong>Deprecated settings cleaned:</strong> Removes unused configuration</li>
                </ul>

                <h2>Next Steps:</h2>
                <ul>
                    <li>Your extension will continue working as before</li>
                    <li>Check VS Code Settings if you want to customize further</li>
                    <li>Run "Explorer Dates: Validate Configuration" anytime to check for issues</li>
                </ul>
            </body>
            </html>
        `}async validateConfiguration(){let e=[],t=G.workspace.getConfiguration("explorerDates"),s=[{setting:"dateDecorationFormat",validate:r=>["smart","relative-short","relative-long","absolute-short","absolute-long"].includes(r),message:"Invalid date decoration format"},{setting:"colorScheme",validate:r=>["none","recency","file-type","subtle","vibrant","custom"].includes(r),message:"Invalid color scheme"},{setting:"badgePriority",validate:r=>["time","author","size"].includes(r),message:"Invalid badge priority"},{setting:"maxCacheSize",validate:r=>typeof r=="number"&&r>=100&&r<=5e4,message:"Cache size must be between 100 and 50,000"},{setting:"cacheTimeout",validate:r=>typeof r=="number"&&r>=5e3&&r<=3e5,message:"Cache timeout must be between 5,000 and 300,000 milliseconds"}];for(let r of s){let o=t.get(r.setting);o!==void 0&&!r.validate(o)&&e.push({setting:r.setting,value:o,message:r.message})}return e}getMigrationHistory(e){return e.globalState.get("explorerDates.migrationHistory",[])}};xs.exports={SettingsMigrationManager:ft}});var Ms=b((exports,module)=>{var vscode=require("vscode"),{FileDateDecorationProvider}=ds(),{getLogger}=V(),{getLocalization}=ze(),{fileSystem}=Se(),{registerCoreCommands}=bs(),{registerOnboardingCommands}=Es(),{registerMigrationCommands}=Ts(),{initializeTemplateStore}=Fs(),{SettingsMigrationManager}=As(),{ExtensionError,ERROR_CODES,ChunkLoadError,handleChunkFailure}=Ge(),{ensureDate}=ce(),{WEB_CHUNK_GLOBAL_KEY,LEGACY_WEB_CHUNK_GLOBAL_KEY}=le(),isWebEnvironment=typeof process<"u"&&!0,nodeFs=null,nodePath=null,webTextDecoder=typeof TextDecoder=="function"?new TextDecoder("utf-8"):null;if(!isWebEnvironment){try{nodeFs=require("fs")}catch{nodeFs=null}try{nodePath=require("path")}catch{nodePath=null}}var AUTO_SUGGESTION_DELAY_MS=3e3,CRITICAL_CHUNKS=["incrementalWorkers"];function resolveDefaultDistPath(){return!nodePath||typeof nodePath.basename!="function"||typeof nodePath.join!="function"?null:nodePath.basename(__dirname)==="dist"?__dirname:nodePath.join(__dirname,"dist")}var DEFAULT_DIST_PATH=resolveDefaultDistPath(),fileDateProvider,logger,l10n,runtimeAutoSuggestionTimer=null,activeRuntimeManager=null,activeTeamPersistenceManager=null;function getActiveLogger(){return logger||(logger=getLogger()),logger}var{registerFeatureFlagsGlobal}=et(),featureFlagsModule=X();registerFeatureFlagsGlobal(featureFlagsModule);var featureFlags=featureFlagsModule,{setFeatureChunkResolver}=featureFlagsModule,{generateDevLoaderMap}=Qe(),sourceChunkLoader=(()=>{return typeof process>"u",null;try{let localRequire=eval("require");return i=>{try{let t=generateDevLoaderMap(localRequire)[i]?.();return t?.default||t||null}catch(e){let t=new ExtensionError(ERROR_CODES.CHUNK_LOAD_FAILED,`Source chunk fallback failed for ${i}`,{chunkName:i,source:"development",error:e.message});return getActiveLogger().warn(t.message,t.context),null}}}catch{return null}})(),chunkLoader={loadedChunks:new Map,distPath:DEFAULT_DIST_PATH,extensionUri:null,webChunkPromises:new Map,Rs:new Set,Ls:new Set,initialize(i){nodePath&&(typeof i?.asAbsolutePath=="function"?this.distPath=i.asAbsolutePath("dist"):i?.extensionPath&&(this.distPath=nodePath.join(i.extensionPath,"dist"))),i?.extensionUri&&(this.extensionUri=i.extensionUri)},async loadChunk(i){if(this.loadedChunks.has(i))return this.loadedChunks.get(i);try{if(isWebEnvironment){let t=await this.Ri(i);return t&&(this.loadedChunks.set(i,t),getActiveLogger().info("Chunk loaded",{chunkName:i,target:"web"})),t}let e=this.Li(i);return e&&(this.loadedChunks.set(i,e),getActiveLogger().info("Chunk loaded",{chunkName:i,target:"node"})),e}catch(e){let t=e instanceof ExtensionError?e:new ExtensionError(ERROR_CODES.CHUNK_LOAD_FAILED,`Failed to load chunk ${i}`,{chunkName:i,target:isWebEnvironment?"web":"node",error:e?.message});return getActiveLogger().warn(t.message,t.context),null}},assertChunkArtifacts(i=[]){if(!nodeFs||!this.distPath||!Array.isArray(i)||i.length===0)return;let e=i.filter(t=>!this.Oi(t));if(e.length>0){let t=new ChunkLoadError(e.join(", "),"missing built artifacts",{recoverable:!1,context:{chunkNames:e,distPath:this.distPath,fix:'Run "npm run package-chunks" before packaging or testing.'}});throw handleChunkFailure(e.join(", "),t,{userFacing:!0}),t}},Oi(i){if(!nodeFs||!this.distPath)return!0;let e=nodePath.join(this.distPath,"chunks",`${i}.js`),t=nodePath.join(this.distPath,"web-chunks",`${i}.js`);return nodeFs.existsSync(e)&&nodeFs.existsSync(t)},Li(i){if(nodeFs&&nodePath&&this.distPath){let e=nodePath.join(this.distPath,"chunks",`${i}.js`);if(nodeFs.existsSync(e))try{let t=require(e);return t?.default&&(t=t.default),t}catch(t){let s=new ExtensionError(ERROR_CODES.CHUNK_LOAD_FAILED,`Failed to require built chunk ${i}`,{chunkName:i,path:e,error:t.message});getActiveLogger().warn(s.message,s.context)}}return sourceChunkLoader?sourceChunkLoader(i):(this.Os(i),null)},async Ri(i){if(!this.extensionUri){let e=new ExtensionError(ERROR_CODES.CHUNK_LOAD_FAILED,"Missing extensionUri for web chunk loading",{chunkName:i});return getActiveLogger().warn(e.message,e.context),null}if(!this.webChunkPromises.has(i)){let e=(async()=>{await this.Pi(i);let s=this.Ii()?.[i];if(!s)throw new Error(`Web chunk ${i} failed to register`);return s})();this.webChunkPromises.set(i,e)}return this.webChunkPromises.get(i)},async Pi(i){if(this.Rs.has(i))return;let e=vscode.Uri.joinPath(this.extensionUri,"dist","web-chunks",`${i}.js`);if(!vscode.workspace?.fs||!webTextDecoder)throw new Error("Workspace FS or TextDecoder unavailable for web chunk loading");try{let t=await vscode.workspace.fs.readFile(e),s=webTextDecoder.decode(t);new Function(s).call(globalThis),this.Ps(),this.Rs.add(i)}catch(t){throw this.Os(i),t}},Ii(){let i=globalThis[WEB_CHUNK_GLOBAL_KEY]||globalThis[LEGACY_WEB_CHUNK_GLOBAL_KEY]||null;return i&&this.Ps(),i},Ps(){let i=globalThis[WEB_CHUNK_GLOBAL_KEY]||globalThis[LEGACY_WEB_CHUNK_GLOBAL_KEY]||{};globalThis[WEB_CHUNK_GLOBAL_KEY]||(globalThis[WEB_CHUNK_GLOBAL_KEY]=i),globalThis[LEGACY_WEB_CHUNK_GLOBAL_KEY]||(globalThis[LEGACY_WEB_CHUNK_GLOBAL_KEY]=i)},Os(i){if(this.Ls.has(i))return;this.Ls.add(i);let e=new ChunkLoadError(i,"artifact unavailable",{recoverable:!1,context:{chunkName:i,distPath:this.distPath,fix:'Run "npm run package-chunks" to rebuild runtime chunks.'}});getActiveLogger().error(e.message,e),handleChunkFailure(i,e,{userFacing:!1})}},dynamicImports={async loadOnboarding(i){let e=await featureFlags.onboarding();return e?typeof e.createOnboardingManager=="function"?e.createOnboardingManager(i):e.OnboardingManager?new e.OnboardingManager(i):null:null},async loadExportReporting(i){let e=await featureFlags.exportReporting();return typeof e?.createExportReportingManager=="function"?e.createExportReportingManager(i):null},async loadWorkspaceTemplates(i){let e=await featureFlags.workspaceTemplates();return typeof e?.createWorkspaceTemplatesManager=="function"?e.createWorkspaceTemplatesManager(i):e?.WorkspaceTemplatesManager?new e.WorkspaceTemplatesManager(i):null},async loadAnalysisCommands(){return featureFlags.analysisCommands()},async loadExtensionApi(i){let e=await featureFlags.extensionApi();if(!e)return null;if(typeof e=="function"){if(e.name==="createExtensionApiManager")return e(i);try{return new e}catch{return null}}else{if(typeof e.createExtensionApiManager=="function")return e.createExtensionApiManager(i);if(e.ExtensionApiManager)return new e.ExtensionApiManager}return null}},onboardingManagerPromise=null,workspaceTemplatesManagerPromise=null,exportReportingManagerPromise=null,extensionApiManagerPromise=null;function shouldPrimeOnboardingChunk(i){if(!i?.globalState)return!0;let e=i.globalState.get("explorerDates.hasShownWelcome",!1),t=i.globalState.get("explorerDates.hasCompletedSetup",!1),s=i.globalState.get("explorerDates.onboardingVersion","0.0.0"),r=i.extension?.packageJSON?.version||"0.0.0";return!e||!t?!0:isMajorVersionUpdate(s,r)}function isMajorVersionUpdate(i,e){let t=o=>{let[n="0"]=(o||"").split("."),c=Number.parseInt(n,10);return Number.isFinite(c)?c:0},s=t(i);return t(e)>s}function ensureOnboardingManager(i){return onboardingManagerPromise||(onboardingManagerPromise=dynamicImports.loadOnboarding(i)),onboardingManagerPromise}function ensureWorkspaceTemplatesManager(i){return workspaceTemplatesManagerPromise||(workspaceTemplatesManagerPromise=dynamicImports.loadWorkspaceTemplates(i)),workspaceTemplatesManagerPromise}function ensureExportReportingManager(i){return exportReportingManagerPromise||(exportReportingManagerPromise=dynamicImports.loadExportReporting(i)),exportReportingManagerPromise}function ensureExtensionApiManager(i){return extensionApiManagerPromise||(extensionApiManagerPromise=dynamicImports.loadExtensionApi(i)),extensionApiManagerPromise}function raiseChunkUnavailable(i,e){let t=`${i} is not available because the required "${e}" runtime chunk failed to load. Reinstall Explorer Dates or run "npm run package-chunks" and reload VS Code.`;throw getActiveLogger().warn(t,{chunkName:e}),vscode.window.showErrorMessage(t),new ChunkLoadError(e,"chunk missing at runtime",{recoverable:!1,context:{featureLabel:i}})}function initializeStatusBar(i){let e=vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Right,100);e.command="explorerDates.showFileDetails",e.tooltip="Click to show detailed file information";let t=async()=>{try{let o=vscode.window.activeTextEditor;if(!o){e.hide();return}let n=o.document.uri;if(n.scheme!=="file"){e.hide();return}let c=await fileSystem.stat(n),a=ensureDate(c.mtime),l=fileDateProvider.Cs(a,"smart"),u=fileDateProvider.ve(c.size,"auto");e.text=`$(clock) ${l} $(file) ${u}`,e.show()}catch(o){e.hide(),logger.debug("Failed to update status bar",o)}},s=vscode.window.onDidChangeActiveTextEditor(t),r=vscode.window.onDidChangeTextEditorSelection(t);return t(),i.subscriptions.push(e,s,r),e}async function activate(i){try{logger=getLogger(),l10n=getLocalization(),i.subscriptions.push(l10n),initializeTemplateStore(i),chunkLoader.initialize(i),chunkLoader.assertChunkArtifacts(CRITICAL_CHUNKS),setFeatureChunkResolver(g=>chunkLoader.loadChunk(g)),logger.info("Explorer Dates: Extension activated");let e=new SettingsMigrationManager;try{await e.migrateAllSettings(i)}catch(g){logger.warn("Settings migration encountered issues:",g)}try{await e.autoOrganizeSettingsIfNeeded(i,{trigger:"activation",silent:!0})}catch(g){logger.warn("Settings organization encountered issues:",g)}let t=vscode.env.uiKind===vscode.UIKind.Web;await vscode.commands.executeCommand("setContext","explorerDates.gitFeaturesAvailable",!t);let s=vscode.workspace.getConfiguration("explorerDates"),r=s.get("enableExportReporting",s.get("enableReporting",!0)),o=s.get("enableExtensionApi",!0),n=s.get("enableOnboardingSystem",!0);fileDateProvider=new FileDateDecorationProvider;let c=vscode.window.registerFileDecorationProvider(fileDateProvider);i.subscriptions.push(c),i.subscriptions.push(fileDateProvider),i.subscriptions.push(logger),await fileDateProvider.initializeAdvancedSystems(i),await fileDateProvider.checkWorkspaceSize();let a=null,l=!1,u=async()=>{if(!o)throw new Error("Extension API is disabled via explorerDates.enableExtensionApi");return a||(a=await ensureExtensionApiManager(i),a&&i.subscriptions&&i.subscriptions.push(a)),a},d=async()=>{if(!r)throw new Error("Reporting is disabled via explorerDates.enableExportReporting");if(!l){let F=vscode.workspace.getConfiguration("explorerDates").get("performanceMode",!1),S=process.env.EXPLORER_DATES_LIGHTWEIGHT_MODE==="1";(F||S)&&logger.warn("Initializing Export Reporting Manager while performance/lightweight mode is active; activity tracking will remain suppressed.")}let g=await ensureExportReportingManager(i);return g&&!l&&(i.subscriptions.push(g),l=!0),g},f=null,p=null,w=async()=>(p||(p=(async()=>{let g=await u();return f=g?g.getApi():null,f})()),p);o?(i.exports=w,i.exportsAsync=w):(i.exports=void 0,i.exportsAsync=void 0,logger.info("Explorer Dates API exports disabled via explorerDates.enableExtensionApi"));let _=s.get("showWelcomeOnStartup",!0);if(n&&_)if(shouldPrimeOnboardingChunk(i)){let g=await ensureOnboardingManager(i);g&&await g.shouldShowOnboarding()&&setTimeout(()=>{g.showWelcomeMessage()},5e3)}else logger.debug("Skipping onboarding preload \u2013 user already completed onboarding for this major version.");registerCoreCommands({context:i,fileDateProvider,logger,l10n});let T=async()=>{let g=await dynamicImports.loadAnalysisCommands();if(!g)return vscode.window.showWarningMessage("Analysis commands unavailable."),null;let E=g.registerAnalysisCommands||g;return typeof E!="function"?(vscode.window.showWarningMessage("Analysis commands registration function not found."),null):E({context:i,fileDateProvider,logger,chunkLoader})};if(s.get("enableAnalysisCommands",!0))try{await T(),logger.info("Analysis commands registered successfully")}catch(g){logger.warn("Failed to register analysis commands:",g)}registerOnboardingCommands({context:i,logger,getOnboardingManager:()=>ensureOnboardingManager(i)});let H=await registerMigrationCommands({context:i,logger,getSettingsMigrationManager:()=>Promise.resolve(e)});i.subscriptions.push(...H);let pt=vscode.commands.registerCommand("explorerDates.openTemplateManager",async()=>{try{if(!vscode.workspace.getConfiguration("explorerDates").get("enableWorkspaceTemplates",!0))throw vscode.window.showInformationMessage("Workspace templates are disabled. Enable explorerDates.enableWorkspaceTemplates to use this command."),new Error("Workspace templates feature disabled via settings.");await featureFlags.workspaceTemplates()||raiseChunkUnavailable("Workspace templates","workspaceTemplates");let S=await ensureWorkspaceTemplatesManager(i);S||raiseChunkUnavailable("Workspace templates","workspaceTemplates"),await S.showTemplateManager(),logger.info("Template manager opened")}catch(g){throw logger.error("Failed to open template manager",g),vscode.window.showErrorMessage(`Failed to open template manager: ${g.message}`),g}});i.subscriptions.push(pt);let A=vscode.commands.registerCommand("explorerDates.saveTemplate",async()=>{try{if(!vscode.workspace.getConfiguration("explorerDates").get("enableWorkspaceTemplates",!0))throw vscode.window.showInformationMessage("Workspace templates are disabled. Enable explorerDates.enableWorkspaceTemplates to save templates."),new Error("Workspace templates feature disabled via settings.");await featureFlags.workspaceTemplates()||raiseChunkUnavailable("Workspace templates","workspaceTemplates");let S=await vscode.window.showInputBox({prompt:"Enter template name",placeHolder:"e.g., My Project Setup"});if(S){let B=await vscode.window.showInputBox({prompt:"Enter description (optional)",placeHolder:"Brief description of this template"})||"",me=await ensureWorkspaceTemplatesManager(i);me||raiseChunkUnavailable("Workspace templates","workspaceTemplates"),await me.saveCurrentConfiguration(S,B)}logger.info("Template saved")}catch(g){throw logger.error("Failed to save template",g),vscode.window.showErrorMessage(`Failed to save template: ${g.message}`),g}});i.subscriptions.push(A);let ge=vscode.commands.registerCommand("explorerDates.generateReport",async()=>{try{if(!r)throw vscode.window.showInformationMessage("Reporting features are disabled. Enable explorerDates.enableExportReporting to generate reports."),new Error("Reporting features disabled via settings.");await featureFlags.exportReporting()||raiseChunkUnavailable("Export reporting","exportReporting");let E=await d();E||raiseChunkUnavailable("Export reporting","exportReporting"),await E.showReportDialog(),logger.info("Report generation started")}catch(g){throw logger.error("Failed to generate report",g),vscode.window.showErrorMessage(`Failed to generate report: ${g.message}`),g}});i.subscriptions.push(ge);let mt=vscode.commands.registerCommand("explorerDates.showApiInfo",async()=>{try{if(!o)throw vscode.window.showInformationMessage("Explorer Dates API is disabled via settings."),new Error("Explorer Dates API disabled via settings.");await featureFlags.extensionApi()||raiseChunkUnavailable("Extension API","extensionApi");let E=vscode.window.createWebviewPanel("apiInfo","Explorer Dates API Information",vscode.ViewColumn.One,{enableScripts:!0}),F=await chunkLoader.loadChunk("diagnostics");if(!F)throw new Error("Diagnostics chunk failed to load");F.ensureInitialized(i);let S=await w();if(!S)throw new Error("API factory returned null - extension API may be disabled");E.webview.html=await F.getApiInformationHtml(S),logger.info("API information panel opened")}catch(g){throw logger.error("Failed to show API information",g),vscode.window.showErrorMessage(`Failed to show API information: ${g.message}`),g}});i.subscriptions.push(mt);let O,fe=vscode.workspace.getConfiguration("explorerDates"),re=fe.get("performanceMode",!1);fe.get("showStatusBar",!1)&&!re&&(O=initializeStatusBar(i));let Ie=vscode.workspace.onDidChangeConfiguration(g=>{if(g.affectsConfiguration("explorerDates.showStatusBar")||g.affectsConfiguration("explorerDates.performanceMode")){let E=vscode.workspace.getConfiguration("explorerDates"),F=E.get("showStatusBar",!1),S=E.get("performanceMode",!1),B=F&&!S;B&&!O?O=initializeStatusBar(i):!B&&O&&(O.dispose(),O=null)}});i.subscriptions.push(Ie),logger.info("Explorer Dates: Date decorations ready");let P=async()=>{let g=await featureFlags.loadFeatureModule("runtimeManagement");return g?.registerRuntimeCommands?g.registerRuntimeCommands:(logger.warn("Runtime chunk missing; runtime commands not initialized"),null)};try{let g=await P();if(g){let{runtimeManager:E,teamPersistenceManager:F}=g(i);activeRuntimeManager?.dispose&&activeRuntimeManager.dispose(),activeTeamPersistenceManager?.dispose&&activeTeamPersistenceManager.dispose(),activeRuntimeManager=E,activeTeamPersistenceManager=F,process.env.EXPLORER_DATES_TEST_MODE!=="1"?runtimeAutoSuggestionTimer=setTimeout(async()=>{try{await E.checkAutoSuggestion(),await F.validateTeamConfiguration()}catch(B){logger.debug("Runtime system auto-suggestion failed:",B)}},AUTO_SUGGESTION_DELAY_MS):logger.debug("Skipping runtime auto-suggestion timer in test mode"),logger.info("Runtime chunk management system initialized")}else logger.warn("Runtime chunk management system unavailable")}catch(g){logger.error("Failed to initialize runtime chunk management:",g)}if(o)return w}catch(e){let t=`${l10n?l10n.getString("activationError"):"Explorer Dates failed to activate"}: ${e.message}`;throw getActiveLogger().error("Extension activation failed",e),vscode.window.showErrorMessage(t),e}}async function deactivate(){try{getActiveLogger().info("Explorer Dates extension is being deactivated"),runtimeAutoSuggestionTimer&&(clearTimeout(runtimeAutoSuggestionTimer),runtimeAutoSuggestionTimer=null),activeRuntimeManager?.dispose&&(activeRuntimeManager.dispose(),activeRuntimeManager=null),activeTeamPersistenceManager?.dispose&&(activeTeamPersistenceManager.dispose(),activeTeamPersistenceManager=null),fileDateProvider&&typeof fileDateProvider.dispose=="function"&&await fileDateProvider.dispose(),getActiveLogger().info("Explorer Dates extension deactivated successfully")}catch(i){getActiveLogger().error("Explorer Dates: Error during deactivation",i)}}module.exports={activate,deactivate}});var Rs=Ms();module.exports={activate:Rs.activate,deactivate:Rs.deactivate};
