var _=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var Y=_((exports,module)=>{var vscode=require("vscode"),isWebRuntime=!1,inspectValue=isWebRuntime?i=>{if(typeof i=="string")return i;try{return JSON.stringify(i,null,2)}catch{return"<<unable to serialize log arg>>"}}:eval("require")("util").inspect,DEFAULT_LOG_PROFILE="default",SUPPORTED_PROFILES=new Set(["default","stress","soak"]),LOG_LEVEL_ORDER=["debug","info","warn","error"],DEFAULT_CONSOLE_LEVEL="warn",TEST_CONSOLE_LEVEL=process.env.NODE_ENV==="test"||process.env.EXPLORER_DATES_TEST_MODE==="1"?"warn":null,Logger=class{constructor(){this.g=vscode.window.createOutputChannel("Explorer Dates"),this.ke=!1,this.r=null,this.De=process.env.NODE_ENV==="test"||process.env.EXPLORER_DATES_TEST_MODE==="1",this.ee=(process.env.EXPLORER_DATES_LOG_PROFILE||DEFAULT_LOG_PROFILE).toLowerCase(),SUPPORTED_PROFILES.has(this.ee)||(this.ee=DEFAULT_LOG_PROFILE),this.te=new Map,this.Ot=DEFAULT_CONSOLE_LEVEL,this.Pt(),this.r=vscode.workspace.onDidChangeConfiguration(e=>{(e.affectsConfiguration("explorerDates.enableLogging")||e.affectsConfiguration("explorerDates.consoleLogLevel"))&&this.Pt()})}Pt(){let e=vscode.workspace.getConfiguration("explorerDates");this.ke=e.get("enableLogging",!1);let t=(process.env.EXPLORER_DATES_LOG_LEVEL||"").toLowerCase(),s=(e.get("consoleLogLevel",DEFAULT_CONSOLE_LEVEL)||"").toLowerCase(),r=TEST_CONSOLE_LEVEL||t||s||DEFAULT_CONSOLE_LEVEL;this.Ot=LOG_LEVEL_ORDER.includes(r)?r:DEFAULT_CONSOLE_LEVEL,TEST_CONSOLE_LEVEL&&(this.ke=!1)}setLogProfile(e=DEFAULT_LOG_PROFILE){let t=(e||DEFAULT_LOG_PROFILE).toLowerCase();this.ee=SUPPORTED_PROFILES.has(t)?t:DEFAULT_LOG_PROFILE,this.resetThrottle()}resetThrottle(e){if(e){this.te.delete(e);return}this.te.clear()}debug(e,...t){this.ke&&this.Te("debug",null,e,t)}info(e,...t){this.Te("info",null,e,t)}infoWithOptions(e,t,...s){this.Te("info",e||null,t,s)}warn(e,...t){this.Te("warn",null,e,t)}error(e,t,...s){let n=`[${new Date().toISOString()}] [ERROR] ${e}`;this.De||(this.g.appendLine(n),t instanceof Error?(this.g.appendLine(`Error: ${t.message}`),t.stack&&this.g.appendLine(`Stack: ${t.stack}`)):t&&this.g.appendLine(this.et(t)));let o=this.It(s);o.length>0&&!this.De&&o.forEach(l=>this.g.appendLine(this.et(l)));let a=[];t!=null&&a.push(t),o.length>0&&a.push(...o),this.tt("error",n,a)}show(){this.g.show()}clear(){this.g.clear()}dispose(){var t;this.g.dispose(),this.r&&(this.r.dispose(),this.r=null);let e="__explorerDatesLogger";typeof global<"u"&&global[e]===this?global[e]=null:typeof globalThis<"u"&&globalThis[e]===this?globalThis[e]=null:typeof globalThis<"u"&&((t=globalThis.window)==null?void 0:t[e])===this&&(globalThis.window[e]=null),loggerInstance===this&&(loggerInstance=null)}Te(e,t,s,r){if(e==="debug"&&!this.ke||this.Is(e,t))return;let o=`[${new Date().toISOString()}] [${e.toUpperCase()}] ${s}`;this.De||this.g.appendLine(o);let a=this.It(r);a.length>0&&!this.De&&a.forEach(l=>this.g.appendLine(this.et(l))),this.tt(e,o,a)}It(e){return!e||e.length===0?[]:e.map(t=>{if(typeof t!="function")return t;try{return t()}catch(s){return`<<log arg threw: ${s.message}>>`}})}et(e){try{return typeof e=="string"?e:typeof e=="object"?JSON.stringify(e,null,2):inspectValue(e)}catch(t){return`<<failed to serialize log arg: ${t.message}>>`}}Is(e,t){if(e!=="info"||!t||!t.throttleKey)return!1;let s=(t.profile||"stress").toLowerCase();if(!this.Ws(s))return!1;let r=Number(t.throttleLimit)||50,n=t.throttleKey,o=this.te.get(n)||{count:0,suppressed:0,noticeLogged:!1};if(o.count<r)return o.count+=1,this.te.set(n,o),!1;if(o.suppressed+=1,!o.noticeLogged){o.noticeLogged=!0;let a=`[${new Date().toISOString()}] [INFO] \u23F8\uFE0F Suppressing further logs for "${n}" after ${r} entries (profile=${this.ee})`;this.g.appendLine(a),this.tt("info",a)}return this.te.set(n,o),!0}Ws(e){let t=this.ee||DEFAULT_LOG_PROFILE;return e==="default"?t===DEFAULT_LOG_PROFILE:t===e}$s(e){let t=LOG_LEVEL_ORDER.indexOf(this.Ot),s=LOG_LEVEL_ORDER.indexOf(e);return t===-1||s===-1?!1:s>=t}tt(e,t,s=[]){if(!this.$s(e))return;(e==="warn"?console.warn:e==="error"?console.error:console.log).call(console,t,...s)}},GLOBAL_LOGGER_KEY="__explorerDatesLogger";function getLogger(){return typeof global<"u"?(global[GLOBAL_LOGGER_KEY]||(global[GLOBAL_LOGGER_KEY]=new Logger),global[GLOBAL_LOGGER_KEY]):typeof globalThis<"u"?(globalThis[GLOBAL_LOGGER_KEY]||(globalThis[GLOBAL_LOGGER_KEY]=new Logger),globalThis.window&&(globalThis.window[GLOBAL_LOGGER_KEY]=globalThis[GLOBAL_LOGGER_KEY]),globalThis[GLOBAL_LOGGER_KEY]):(loggerInstance||(loggerInstance=new Logger),loggerInstance)}var loggerInstance=null;module.exports={Logger,getLogger}});var Ze=_((Di,Mt)=>{var Je=require("vscode"),Me={en:{now:"now",minutes:"m",hours:"h",days:"d",weeks:"w",months:"mo",years:"y",justNow:"just now",minutesAgo:i=>`${i} minute${i!==1?"s":""} ago`,hoursAgo:i=>`${i} hour${i!==1?"s":""} ago`,yesterday:"yesterday",daysAgo:i=>`${i} day${i!==1?"s":""} ago`,lastModified:"Last modified",refreshSuccess:"Date decorations refreshed",activationError:"Explorer Dates failed to activate",errorAccessingFile:"Error accessing file for decoration"},es:{now:"ahora",minutes:"m",hours:"h",days:"d",weeks:"s",months:"m",years:"a",justNow:"ahora mismo",minutesAgo:i=>`hace ${i} minuto${i!==1?"s":""}`,hoursAgo:i=>`hace ${i} hora${i!==1?"s":""}`,yesterday:"ayer",daysAgo:i=>`hace ${i} d\xEDa${i!==1?"s":""}`,lastModified:"\xDAltima modificaci\xF3n",refreshSuccess:"Decoraciones de fecha actualizadas",activationError:"Explorer Dates no se pudo activar",errorAccessingFile:"Error al acceder al archivo para decoraci\xF3n"},fr:{now:"maintenant",minutes:"m",hours:"h",days:"j",weeks:"s",months:"m",years:"a",justNow:"\xE0 l'instant",minutesAgo:i=>`il y a ${i} minute${i!==1?"s":""}`,hoursAgo:i=>`il y a ${i} heure${i!==1?"s":""}`,yesterday:"hier",daysAgo:i=>`il y a ${i} jour${i!==1?"s":""}`,lastModified:"Derni\xE8re modification",refreshSuccess:"D\xE9corations de date actualis\xE9es",activationError:"\xC9chec de l'activation d'Explorer Dates",errorAccessingFile:"Erreur lors de l'acc\xE8s au fichier pour la d\xE9coration"},de:{now:"jetzt",minutes:"Min",hours:"Std",days:"T",weeks:"W",months:"Mon",years:"J",justNow:"gerade eben",minutesAgo:i=>`vor ${i} Minute${i!==1?"n":""}`,hoursAgo:i=>`vor ${i} Stunde${i!==1?"n":""}`,yesterday:"gestern",daysAgo:i=>`vor ${i} Tag${i!==1?"en":""}`,lastModified:"Zuletzt ge\xE4ndert",refreshSuccess:"Datumsdekorationen aktualisiert",activationError:"Explorer Dates konnte nicht aktiviert werden",errorAccessingFile:"Fehler beim Zugriff auf Datei f\xFCr Dekoration"},ja:{now:"\u4ECA",minutes:"\u5206",hours:"\u6642\u9593",days:"\u65E5",weeks:"\u9031",months:"\u30F6\u6708",years:"\u5E74",justNow:"\u305F\u3063\u305F\u4ECA",minutesAgo:i=>`${i}\u5206\u524D`,hoursAgo:i=>`${i}\u6642\u9593\u524D`,yesterday:"\u6628\u65E5",daysAgo:i=>`${i}\u65E5\u524D`,lastModified:"\u6700\u7D42\u66F4\u65B0",refreshSuccess:"\u65E5\u4ED8\u88C5\u98FE\u304C\u66F4\u65B0\u3055\u308C\u307E\u3057\u305F",activationError:"Explorer Dates\u306E\u30A2\u30AF\u30C6\u30A3\u30D9\u30FC\u30B7\u30E7\u30F3\u306B\u5931\u6557\u3057\u307E\u3057\u305F",errorAccessingFile:"\u30D5\u30A1\u30A4\u30EB\u30A2\u30AF\u30BB\u30B9\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F"},zh:{now:"\u73B0\u5728",minutes:"\u5206\u949F",hours:"\u5C0F\u65F6",days:"\u5929",weeks:"\u5468",months:"\u6708",years:"\u5E74",justNow:"\u521A\u521A",minutesAgo:i=>`${i}\u5206\u949F\u524D`,hoursAgo:i=>`${i}\u5C0F\u65F6\u524D`,yesterday:"\u6628\u5929",daysAgo:i=>`${i}\u5929\u524D`,lastModified:"\u6700\u540E\u4FEE\u6539",refreshSuccess:"\u65E5\u671F\u88C5\u9970\u5DF2\u5237\u65B0",activationError:"Explorer Dates \u6FC0\u6D3B\u5931\u8D25",errorAccessingFile:"\u8BBF\u95EE\u6587\u4EF6\u88C5\u9970\u65F6\u51FA\u9519"}},Re=class{constructor(){this.Fe="en",this.r=null,this.Wt(),this.r=Je.workspace.onDidChangeConfiguration(e=>{e.affectsConfiguration("explorerDates.locale")&&this.Wt()})}Wt(){let t=Je.workspace.getConfiguration("explorerDates").get("locale","auto");t==="auto"&&(t=Je.env.language.split("-")[0]),Me[t]||(t="en"),this.Fe=t}getString(e,...t){let r=(Me[this.Fe]||Me.en)[e];return typeof r=="function"?r(...t):r||Me.en[e]||e}getCurrentLocale(){return this.Fe}formatDate(e,t={}){try{return e.toLocaleDateString(this.Fe,t)}catch{return e.toLocaleDateString("en",t)}}dispose(){this.r&&(this.r.dispose(),this.r=null),me===this&&(me=null)}},me=null;function Hs(){return me||(me=new Re),me}Mt.exports={LocalizationManager:Re,getLocalization:Hs}});var Qe=_((Ti,Rt)=>{var ue=require("vscode");function Ks(){var i,e;try{return((i=ue==null?void 0:ue.env)==null?void 0:i.uiKind)===((e=ue==null?void 0:ue.UIKind)==null?void 0:e.Web)}catch{return!1}}Rt.exports={isWebEnvironment:Ks}});var we=_((Fi,Ot)=>{function Q(i=""){return i?i.replace(/\\/g,"/"):""}function js(i=""){let e=Q(i);return e?e.split("/").filter(Boolean):[]}function Lt(i=""){let e=js(i);return e.length?e[e.length-1]:""}function qs(i=""){let e=Lt(i),t=e.lastIndexOf(".");return t<=0?"":e.substring(t).toLowerCase()}function Ys(i=""){let e=Q(i),t=e.lastIndexOf("/");return t===-1?"":e.substring(0,t)}function Xs(...i){return Q(i.filter(Boolean).join("/")).replace(/\/+/g,"/")}function Js(i=""){return Q(i).toLowerCase()}function Zs(i=""){if(!i)return"";if(typeof i=="string")return i;if(typeof i.fsPath=="string"&&i.fsPath.length>0)return i.fsPath;if(typeof i.path=="string"&&i.path.length>0)return i.path;if(typeof i.toString=="function")try{return i.toString(!0)}catch{return i.toString()}return String(i)}function Qs(i="",e=""){let t=Q(i),s=Q(e);return t&&s.startsWith(t)?s.substring(t.length).replace(/^\/+/,""):s}Ot.exports={normalizePath:Q,getFileName:Lt,getExtension:qs,getDirectory:Ys,joinPath:Xs,getCacheKey:Js,getUriPath:Zs,getRelativePath:Qs}});var tt=_((Ai,It)=>{var Le=class extends Error{constructor(e,t,s={}){super(t),this.code=e,this.context=s,this.name="ExtensionError"}},Pt={FILE_PERMISSION_DENIED:"FILE_PERMISSION_DENIED",WORKSPACE_TOO_LARGE:"WORKSPACE_TOO_LARGE",CHUNK_LOAD_FAILED:"CHUNK_LOAD_FAILED"};function er(i){if(!i)return!1;let e=i.code||(i==null?void 0:i.name);return["EACCES","EPERM","EROFS","NoPermissions"].includes(e)}var et=class extends Le{constructor(e,t,s={}){let{recoverable:r=!0,context:n={}}=s;super(Pt.CHUNK_LOAD_FAILED,`Failed to load ${e}: ${t}`,{chunkName:e,recoverable:r,...n}),this.name="ChunkLoadError",this.chunkName=e,this.recoverable=r}};function tr(i,e,t={}){let s=require("vscode"),{userFacing:r=!0}=t,n=(e==null?void 0:e.recoverable)??!0;r&&!n&&s.window.showErrorMessage(`Explorer Dates: ${i} feature unavailable. Please reinstall or rebuild the extension.`)}It.exports={ExtensionError:Le,ERROR_CODES:Pt,isPermissionError:er,ChunkLoadError:et,handleChunkFailure:tr}});var be=_((xi,Nt)=>{function Wt(){return typeof performance<"u"&&performance.now&&performance.timeOrigin?Math.floor(performance.timeOrigin+performance.now()):typeof Date=="function"&&Date.now?Date.now():16409952e5}function $t(i){return!!(i&&typeof i=="object"&&typeof i.getTime=="function")}function he(i){if(!i||isNaN(i))return"Invalid Date";if(typeof Intl<"u"&&Intl.DateTimeFormat)try{return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(i)}catch{}let e=864e5,t=36e5,s=6e4,r=1e3,n=1970,o=Math.floor(i/e),a=i%e,l=Math.floor(a/t),c=Math.floor(a%t/s),h=Math.floor(a%s/r),u=n+Math.floor(o/365.25),f=Math.floor(o%365.25/30.44)+1,m=Math.floor(o%30.44)+1,w=String(Math.min(f,12)).padStart(2,"0"),y=String(Math.min(m,31)).padStart(2,"0"),W=String(l).padStart(2,"0"),O=String(c).padStart(2,"0"),oe=String(h).padStart(2,"0");return`${w}/${y}/${u}, ${W}:${O}:${oe}`}function sr(i){if($t(i))return i;let e=typeof Date=="function"&&Date.prototype&&Date.prototype.constructor===Date;if(i==null){if(!e){let t=Wt();return{getTime:()=>t,toLocaleString:()=>he(t),toString:()=>he(t)}}return new Date}if(typeof i=="number")return e?new Date(i):{getTime:()=>i,toLocaleString:()=>he(i),toString:()=>he(i)};if(typeof i=="string"){let t=0;if(e)t=Date.parse(i);else{let s=parseFloat(i);t=isNaN(s)?0:s}return e?new Date(i):{getTime:()=>t,toLocaleString:()=>he(t),toString:()=>he(t)}}return e?new Date(i):{getTime:()=>0,toLocaleString:()=>"Invalid Date",toString:()=>"Invalid Date"}}Nt.exports={ensureDate:sr,isDateLike:$t,getCurrentTimestamp:Wt}});var Pe=_((Mi,Ut)=>{var T=require("vscode"),{isWebEnvironment:rr}=Qe(),{normalizePath:ir}=we(),{ExtensionError:nr,ERROR_CODES:or,isPermissionError:ar}=tt(),{ensureDate:st}=be(),zt=!1,lr=process.env.EXPLORER_DATES_FORCE_VSCODE_FS==="1",F=null;if(!zt&&!lr)try{F=require("fs").promises}catch{F=null}var Oe=class{constructor(){this.isWeb=zt||rr()}k(e){if(!e)return"";if(typeof e=="string")return e;if(e&&typeof e=="object"&&typeof e.fsPath=="string")return e.fsPath;if(e&&typeof e=="object"&&typeof e.path=="string")return e.path;if(typeof e=="object"){if(typeof e.fsPath=="string")return e.fsPath;if(typeof e.path=="string")return e.path}return String(e)}D(e){if(e&&typeof e=="object"&&typeof e.scheme=="string"&&typeof e.path=="string")return e;if(typeof e=="string")return T.Uri.file(e);if(e&&typeof e=="object"){if(e.uri&&e.uri!==e)try{return this.D(e.uri)}catch{}if(typeof e.fsPath=="string"&&e.fsPath.length>0)return T.Uri.file(e.fsPath);if(typeof e.path=="string"&&e.path.length>0)return T.Uri.file(e.path);if(typeof e.href=="string"&&e.href.length>0)return T.Uri.parse(e.href);if(typeof e.scheme=="string")return T.Uri.from({scheme:e.scheme,authority:e.authority||"",path:e.path||e.fsPath||"",query:e.query||"",fragment:e.fragment||""});if(typeof e.toString=="function")try{let t=e.toString(!0);if(t&&t!=="[object Object]")return T.Uri.parse(t)}catch{let t=e.toString();if(t&&t!=="[object Object]")return T.Uri.parse(t)}}throw new Error(`Unsupported target type: ${typeof e}`)}async stat(e){if(!this.isWeb&&F)return F.stat(this.k(e));let t=this.D(e),s=await T.workspace.fs.stat(t);return{...s,mtime:st(s.mtime),ctime:st(s.ctime),birthtime:st(s.ctime),isFile:()=>s.type===T.FileType.File,isDirectory:()=>s.type===T.FileType.Directory}}async readFile(e,t="utf8"){if(!this.isWeb&&F)return F.readFile(this.k(e),t);let s=this.D(e),r=await T.workspace.fs.readFile(s);return t===null||t==="binary"?r:new TextDecoder(t).decode(r)}async writeFile(e,t,s="utf8"){let r=this.k(e);try{if(!this.isWeb&&F)return F.writeFile(r,t,s);let n=this.D(e),o=typeof t=="string"?new TextEncoder().encode(t):t;await T.workspace.fs.writeFile(n,o)}catch(n){this.$t("write file",r,n)}}async mkdir(e,t={recursive:!0}){let s=this.k(e);try{if(!this.isWeb&&F)return F.mkdir(s,t);let r=this.D(e);await T.workspace.fs.createDirectory(r)}catch(r){this.$t("create directory",s,r)}}async readdir(e,t={withFileTypes:!1}){if(!this.isWeb&&F)return F.readdir(this.k(e),t);let s=this.D(e),r=await T.workspace.fs.readDirectory(s);return t.withFileTypes?r.map(([n,o])=>({name:n,isDirectory:()=>o===T.FileType.Directory,isFile:()=>o===T.FileType.File})):r.map(([n])=>n)}async delete(e,t={recursive:!1}){if(!this.isWeb&&F){let r=this.k(e);return t.recursive?F.rm?F.rm(r,t):F.rmdir(r,t):F.unlink(r)}let s=this.D(e);await T.workspace.fs.delete(s,t)}async exists(e){try{return await this.stat(e),!0}catch{return!1}}async ensureDirectory(e){let t=ir(this.k(e));await this.mkdir(t,{recursive:!0})}$t(e,t,s){throw ar(s)?new nr(or.FILE_PERMISSION_DENIED,`Permission denied while attempting to ${e}`,{path:t,code:s.code}):s}},cr=new Oe;Ut.exports={FileSystemAdapter:Oe,fileSystem:cr}});var ye=_((Ri,Vt)=>{var ur=["Ja","Fe","Mr","Ap","My","Jn","Jl","Au","Se","Oc","No","De"],hr=Number(process.env.EXPLORER_DATES_DECORATION_POOL_SIZE||2048),dr=Number(process.env.EXPLORER_DATES_FLYWEIGHT_CACHE_SIZE||4096),gr=Number(process.env.EXPLORER_DATES_WORKSPACE_BALANCED_THRESHOLD||15e3),fr=Number(process.env.EXPLORER_DATES_WORKSPACE_LARGE_THRESHOLD||25e4),Bt=Number(process.env.EXPLORER_DATES_WORKSPACE_EXTREME_THRESHOLD||4e5),pr=Number(process.env.EXPLORER_DATES_WORKSPACE_SCAN_MAX_RESULTS||Math.min(Bt+1,50001)),mr={ADVANCED_CACHE:"explorerDates.advancedCache",ADVANCED_CACHE_METADATA:"explorerDates.advancedCacheMetadata",TEMPLATE_STORE:"explorerDates.templates",WEB_GIT_NOTICE:"explorerDates.webGitNotice"},wr="explorerDatesChunks",br="__explorerDatesChunks";Vt.exports={DEFAULT_CACHE_TIMEOUT:12e4,DEFAULT_MAX_CACHE_SIZE:1e4,DEFAULT_PERSISTENT_CACHE_TTL:864e5,DEFAULT_DECORATION_POOL_SIZE:hr,DEFAULT_FLYWEIGHT_CACHE_SIZE:dr,MAX_BADGE_LENGTH:2,MONTH_ABBREVIATIONS:ur,WORKSPACE_SCALE_BALANCED_THRESHOLD:gr,WORKSPACE_SCALE_LARGE_THRESHOLD:fr,WORKSPACE_SCALE_EXTREME_THRESHOLD:Bt,WORKSPACE_SCAN_MAX_RESULTS:pr,GLOBAL_STATE_KEYS:mr,WEB_CHUNK_GLOBAL_KEY:wr,LEGACY_WEB_CHUNK_GLOBAL_KEY:br}});var Kt=_((Li,Ht)=>{var{MAX_BADGE_LENGTH:Gt}=ye();function yr(i=0,e="auto"){let t=typeof i=="number"&&!Number.isNaN(i)?i:0;if(e==="bytes")return`~${t}B`;let s=t/1024;if(e==="kb")return`~${s.toFixed(1)}K`;let r=s/1024;return e==="mb"?`~${r.toFixed(1)}M`:t<1024?`~${t}B`:s<1024?`~${Math.round(s)}K`:`~${r.toFixed(1)}M`}function Er(i){if(i)return i.length>Gt?i.substring(0,Gt):i}Ht.exports={formatFileSize:yr,trimBadge:Er}});var ot=_((Oi,Xt)=>{var{normalizePath:rt,getUriPath:_r}=we(),{getLogger:Cr}=Y(),Sr=Cr(),Ee=240,it=255,jt=/[\x00-\x1f\x7f<>:"|?*]/g,vr=/[\x00-\x1f\x7f<>:"|?*]/,kr=[/\.\./,/\.\.[\\/]/,/[\\/]\.\./,/^\.\.$/,/^\.\.[\\/]/,/[\\/]\.\.$/],qt=new Set(["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"]),Yt=new Set([".exe",".scr",".bat",".cmd",".pif",".vbs",".js",".jar",".com",".msi",".dll",".dmg",".pkg",".deb",".rpm"]),Dr=new Set([".js",".jsx",".ts",".tsx",".mjs",".cjs",".py",".rb",".rs",".go",".php",".java",".kt",".swift",".cs",".c",".cpp",".h",".hpp",".html",".css",".scss",".less",".json",".jsonc",".md",".mdx",".txt",".sh",".bash",".yml",".yaml"]),Tr=()=>process.env.EXPLORER_DATES_TEST_MODE==="1"||process.env.NODE_ENV==="test"||process.env.VSCODE_TEST==="1"?"test":process.env.EXPLORER_DATES_DEV_MODE==="1"||process.env.NODE_ENV==="development"?"development":"production",de=class{static hasPathTraversal(e){let t=this.I(e);if(!t||typeof t!="string")return!1;let s=rt(t);return kr.some(r=>r.test(s))}static hasDangerousChars(e){let t=this.I(e);return!t||typeof t!="string"?!1:vr.test(t)}static isWindowsReservedName(e){if(!e||typeof e!="string")return!1;let t=e.split(".")[0].toUpperCase();return qt.has(t)}static isSuspiciousExtension(e,t={}){let{workspaceContext:s=!0}=t;if(!e||typeof e!="string")return!1;let r=e.toLowerCase(),n=r.startsWith(".")?r:`.${r}`;return s&&Dr.has(n)?!1:Yt.has(n)}static isPathTooLong(e){let t=this.I(e);return!t||typeof t!="string"?!1:t.length>Ee}static isFilenameTooLong(e){return!e||typeof e!="string"?!1:e.length>it}static validatePath(e,t={}){let{allowSuspiciousExtensions:s=!1,allowWindowsReservedNames:r=!1,strictLength:n=!0,workspaceContext:o=!0}=t,a=this.I(e),l=[],c=[];if(!a||typeof a!="string")return{isValid:!1,path:a,issues:["Invalid or empty path"],warnings:[],isSafe:!1};this.hasPathTraversal(a)&&l.push("Path contains directory traversal attempts"),this.hasDangerousChars(a)&&l.push("Path contains dangerous characters"),n&&this.isPathTooLong(a)&&l.push(`Path exceeds maximum length (${Ee})`);let h=a.split(/[/\\]/).pop()||"";n&&this.isFilenameTooLong(h)&&l.push(`Filename exceeds maximum length (${it})`),!r&&this.isWindowsReservedName(h)&&c.push("Filename is a Windows reserved name");let u=h.includes(".")?h.split(".").pop():"";return!s&&this.isSuspiciousExtension(u,{workspaceContext:o})&&c.push("File extension is potentially suspicious"),{isValid:l.length===0,path:a,filename:h,extension:u,issues:l,warnings:c,isSafe:l.length===0&&c.length===0}}static sanitizePath(e,t={}){let{replacementChar:s="_",preserveExtension:r=!0}=t,n=this.I(e);if(!n||typeof n!="string")return"";n=n.replace(/\x00/g,"");let o=n.startsWith("/"),a=rt(n).split("/").filter(Boolean),l=[];for(let c of a){if(c===".."){l.length>0&&l.pop();continue}c!=="."&&l.push(c)}if(n=(o?"/":"")+l.join("/"),n=n.replace(jt,s),r){let c=n.split("/"),h=c[c.length-1];if(h&&this.isWindowsReservedName(h)){let u=h.split(".");u[0]=u[0]+"_safe",c[c.length-1]=u.join("."),n=c.join("/")}}return n.length>Ee&&(n=n.substring(0,Ee),Sr.warn("Path truncated due to length:",n)),n}static isWithinBoundaries(e,t=[]){let s=this.I(e);if(!s||!Array.isArray(t)||t.length===0)return!1;let r=s.split("/").filter(Boolean),n=[];for(let a of r)a===".."?n.length>0&&n.pop():a!=="."&&n.push(a);let o="/"+n.join("/");return t.some(a=>{let l=rt(a);return o.startsWith(l)})}static validateRegexPattern(e){if(!e||typeof e!="string")return{isValid:!1,issue:"Invalid pattern"};let t=[/\([^)]*\+[^)]*\)\+/,/\([^)]*\*[^)]*\)\*/,/\([^)]*\+[^)]*\)\*/,/\([^)]*\*[^)]*\)\+/,/\+.*\*|{\d+,}.*\*/,/\([^|]*\|[^)]*\)\*/];for(let s of t)if(s.test(e))return{isValid:!1,issue:"Pattern may cause catastrophic backtracking (ReDoS)"};try{return new RegExp(e),{isValid:!0}}catch(s){return{isValid:!1,issue:`Invalid regex syntax: ${s.message}`}}}static I(e){if(!e)return"";if(typeof e=="string")return e;try{return _r(e)}catch{return String(e)}}},nt=class{static validateFileUri(e,t=[]){if(!e||typeof e!="object")return{isValid:!1,issue:"Invalid URI object"};if(e.scheme!=="file"&&e.scheme!=="vscode-vfs")return{isValid:!1,issue:`Unsupported URI scheme: ${e.scheme}`};let s=de.validatePath(e);return s.isValid?t.length>0&&!de.isWithinBoundaries(e,t)?{isValid:!1,issue:"Path is outside allowed workspace boundaries"}:{isValid:!0,warnings:s.warnings}:{isValid:!1,issue:`Path validation failed: ${s.issues.join(", ")}`}}static validateExclusionPatterns(e){if(!Array.isArray(e))return{isValid:!1,issue:"Patterns must be an array"};let t=[],s=[];for(let r of e){if(typeof r!="string"){s.push(`Invalid pattern type: ${typeof r}`);continue}let n=r.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\?/g,"."),o=de.validateRegexPattern(n);t.push({pattern:r,isValid:o.isValid,issue:o.issue}),o.isValid||s.push(`Pattern "${r}": ${o.issue}`)}return{isValid:s.length===0,results:t,issues:s}}};Xt.exports={SecurityValidator:de,SecureFileOperations:nt,detectSecurityEnvironment:Tr,MAX_SAFE_PATH_LENGTH:Ee,MAX_SAFE_FILENAME_LENGTH:it,DANGEROUS_PATH_CHARS:jt,WINDOWS_RESERVED_NAMES:Array.from(qt),SUSPICIOUS_EXTENSIONS:Array.from(Yt)}});var ss=_((Pi,ts)=>{var V=require("vscode"),{getLogger:Fr}=Y(),{WORKSPACE_SCALE_BALANCED_THRESHOLD:Jt,WORKSPACE_SCALE_LARGE_THRESHOLD:We,WORKSPACE_SCALE_EXTREME_THRESHOLD:Zt,WORKSPACE_SCAN_MAX_RESULTS:Qt}=ye(),at=Fr(),Ie=null;function es(i){return i&&(i.fsPath||i.path)||null}function lt(i,e){let t=es(i);!t||typeof e!="number"||(Ie={workspaceKey:t,fileCount:e,timestamp:Date.now()})}function ct(i){let e=es(i);return!e||!Ie||Ie.workspaceKey!==e?null:Ie}function Ar(i,e="default"){if(!i)return`unknown-workspace-${e}`;let t=i.fsPath||i.path||"",s=t.split("/").pop()||"workspace",r=Math.abs(t.split("").reduce((o,a)=>(o=(o<<5)-o+a.charCodeAt(0),o&o),0)).toString(36).substr(0,8),n=Math.abs(e.split("").reduce((o,a)=>(o=(o<<5)-o+a.charCodeAt(0),o&o),0)).toString(36).substr(0,4);return`${s}-${r}-${n}`}async function xr(i){try{if(!i)return"unknown";let e=ct(i),t;e?t=e.fileCount:(t=(await V.workspace.findFiles("**/*",null,Qt)).length,lt(i,t));let s="small";t>=Zt?s="extreme":t>=We?s="large":t>=1e3&&(s="medium");let r=V.env.remoteName,n=V.env.uiKind===V.UIKind.Web,o=s==="medium"&&t>=Jt&&t<We;if(s==="extreme"||s==="large"&&(r||n))return"minimal";if(s==="large"||o||r||n)return"balanced";try{let l=(await V.workspace.fs.readDirectory(i)).map(([c])=>c.toLowerCase());if(l.includes("package.json")||l.includes("yarn.lock"))return"web-development";if(l.some(c=>c.endsWith(".ipynb"))||l.includes("requirements.txt"))return"data-science";if(l.includes("docker-compose.yml")||l.includes(".enterprise"))return"enterprise"}catch(a){at.debug("Project type detection failed:",a)}return"full"}catch(e){return at.error("Workspace profile detection failed:",e),"unknown"}}async function Mr(i){if(!i)return null;try{let e=ct(i),t;e?t=e.fileCount:(t=(await V.workspace.findFiles("**/*",null,Qt)).length,lt(i,t));let s="small";t>=Zt?s="extreme":t>=We?s="large":t>=1e3&&(s="medium");let r=!!V.env.remoteName,n=V.env.uiKind===V.UIKind.Web,o=n?"web":r?"remote":"local",a=s==="medium"&&t>=Jt&&t<We;return{workspaceSize:s,fileCount:t,remoteType:o,isRemoteEnvironment:r||n,timestamp:Date.now(),mediumBalanced:a}}catch(e){return at.error("Workspace environment analysis failed:",e),null}}ts.exports={generateWorkspaceKey:Ar,detectWorkspaceProfile:xr,analyzeWorkspaceEnvironment:Mr,setCachedWorkspaceMetrics:lt,getCachedWorkspaceMetrics:ct}});var is=_((Ii,rs)=>{var E={onboarding:34,analysisCommands:23,exportReporting:17,extensionApi:15,workspaceTemplates:14,advancedCache:28,workspaceIntelligence:31,incrementalWorkers:19},te=99,ee={minimal:{id:"minimal",name:"Minimal",description:"Core decorations only, smallest bundle (~99KB)",targetBundleSize:te,settings:{"explorerDates.enableOnboardingSystem":!1,"explorerDates.enableAnalysisCommands":!1,"explorerDates.enableExportReporting":!1,"explorerDates.enableExtensionApi":!1,"explorerDates.enableWorkspaceTemplates":!1,"explorerDates.enableAdvancedCache":!1,"explorerDates.enableWorkspaceIntelligence":!1,"explorerDates.enableIncrementalWorkers":!1,"explorerDates.performanceMode":!0,"explorerDates.showDateDecorations":!0,"explorerDates.dateDecorationFormat":"relative-short"},targetScenarios:["Resource-constrained environments","Basic file dates only","Large remote workspaces"]},balanced:{id:"balanced",name:"Balanced",description:"Essential features with optimization (~200KB)",targetBundleSize:te+E.onboarding+E.workspaceTemplates+E.advancedCache+E.analysisCommands,settings:{"explorerDates.enableOnboardingSystem":!0,"explorerDates.enableAnalysisCommands":!0,"explorerDates.enableExportReporting":!1,"explorerDates.enableExtensionApi":!1,"explorerDates.enableWorkspaceTemplates":!0,"explorerDates.enableAdvancedCache":!0,"explorerDates.enableWorkspaceIntelligence":!1,"explorerDates.enableIncrementalWorkers":!1,"explorerDates.performanceMode":!0,"explorerDates.smartFileWatching":!0},targetScenarios:["Most development workflows","Remote environments","Medium to large workspaces"]},"web-development":{id:"web-development",name:"Web Development",description:"Optimized for web projects (~240KB)",targetBundleSize:te+E.onboarding+E.analysisCommands+E.workspaceTemplates+E.advancedCache+E.incrementalWorkers,settings:{"explorerDates.enableOnboardingSystem":!0,"explorerDates.enableAnalysisCommands":!0,"explorerDates.enableExportReporting":!1,"explorerDates.enableExtensionApi":!1,"explorerDates.enableWorkspaceTemplates":!0,"explorerDates.enableAdvancedCache":!0,"explorerDates.enableWorkspaceIntelligence":!1,"explorerDates.enableIncrementalWorkers":!0,"explorerDates.showGitInfo":"author","explorerDates.colorScheme":"file-type"},targetScenarios:["JavaScript/TypeScript projects","Node.js development","Frontend frameworks"]},enterprise:{id:"enterprise",name:"Enterprise",description:"Full feature set with reporting and API (~380KB)",targetBundleSize:Object.values(E).reduce((i,e)=>i+e,te),settings:{"explorerDates.enableOnboardingSystem":!0,"explorerDates.enableAnalysisCommands":!0,"explorerDates.enableExportReporting":!0,"explorerDates.enableExtensionApi":!0,"explorerDates.enableWorkspaceTemplates":!0,"explorerDates.enableAdvancedCache":!0,"explorerDates.enableWorkspaceIntelligence":!0,"explorerDates.enableIncrementalWorkers":!0,"explorerDates.persistentCache":!0,"explorerDates.smartExclusions":!0},targetScenarios:["Team lead workflows","Analytics and reporting needs","API integration requirements","Full workspace intelligence"]},"data-science":{id:"data-science",name:"Data Science",description:"Optimized for data workflows (~280KB)",targetBundleSize:te+E.onboarding+E.analysisCommands+E.exportReporting+E.workspaceIntelligence+E.advancedCache,settings:{"explorerDates.enableOnboardingSystem":!0,"explorerDates.enableAnalysisCommands":!0,"explorerDates.enableExportReporting":!0,"explorerDates.enableExtensionApi":!1,"explorerDates.enableWorkspaceTemplates":!1,"explorerDates.enableAdvancedCache":!0,"explorerDates.enableWorkspaceIntelligence":!0,"explorerDates.enableIncrementalWorkers":!1,"explorerDates.dateDecorationFormat":"iso-detailed"},targetScenarios:["Jupyter notebooks","Python data analysis","Research workflows"]}},Rr=new Set(["enableOnboardingSystem","enableAnalysisCommands","enableExportReporting","enableExtensionApi","enableWorkspaceTemplates","enableAdvancedCache","enableWorkspaceIntelligence","enableIncrementalWorkers","performanceMode","smartFileWatching"]);function Lr(i){let e=te;return i["explorerDates.enableOnboardingSystem"]&&(e+=E.onboarding),i["explorerDates.enableAnalysisCommands"]&&(e+=E.analysisCommands),i["explorerDates.enableExportReporting"]&&(e+=E.exportReporting),i["explorerDates.enableExtensionApi"]&&(e+=E.extensionApi),i["explorerDates.enableWorkspaceTemplates"]&&(e+=E.workspaceTemplates),i["explorerDates.enableAdvancedCache"]&&(e+=E.advancedCache),i["explorerDates.enableWorkspaceIntelligence"]&&(e+=E.workspaceIntelligence),i["explorerDates.enableIncrementalWorkers"]&&(e+=E.incrementalWorkers),e}function Or(i){switch(i){case"minimal":case"extreme":return ee.minimal;case"balanced":return ee.balanced;case"web-development":return ee["web-development"];case"data-science":return ee["data-science"];case"enterprise":return ee.enterprise;default:return ee.balanced}}rs.exports={PRESET_DEFINITIONS:ee,CHUNK_SIZES:E,BASE_BUNDLE_SIZE:te,RESTART_REQUIRED_SETTINGS:Rr,calculateBundleSize:Lr,getDefaultPresetForProfile:Or}});var ut=_((Wi,ns)=>{var $e={onboarding:"src/chunks/onboarding-chunk",onboardingAssets:"src/chunks/onboarding-assets-chunk",reporting:"src/chunks/reporting-chunk",templates:"src/chunks/templates-chunk",analysis:"src/chunks/analysis-chunk",diagnostics:"src/chunks/diagnostics-chunk",extensionApi:"src/chunks/extension-api-chunk",advancedCache:"src/chunks/advancedCache-chunk",batchProcessor:"src/chunks/batchProcessor-chunk",decorationsAdvanced:"src/chunks/decorations-advanced",workspaceIntelligence:"src/chunks/workspaceIntelligence",incrementalWorkers:"src/chunks/incrementalWorkers",uiAdapters:"src/chunks/ui-adapters",gitInsights:"src/chunks/gitInsights-chunk",smartWatcherFallback:"src/chunks/smartWatcherFallback-chunk",runtimeManagement:"src/chunks/runtime-management"};function Pr(i){return $e[i]||null}function Ir(){return Object.keys($e)}function Wr(i){let e={};for(let[t,s]of Object.entries($e))e[t]=()=>i(`./${s}`);return e}ns.exports={CHUNK_MAP:$e,getChunkSourcePath:Pr,getAllChunkNames:Ir,generateDevLoaderMap:Wr}});var ht=_((exports,module)=>{var FEATURE_FLAGS_GLOBAL_KEY="__explorerDatesFeatureFlags";function registerFeatureFlagsGlobal(i){if(i)try{typeof globalThis<"u"&&(globalThis[FEATURE_FLAGS_GLOBAL_KEY]=i)}catch{}}function loadFeatureFlagsFallback(){try{let dynamicRequire=typeof eval=="function"?eval("require"):null;if(typeof dynamicRequire=="function")return dynamicRequire("../featureFlags")}catch{}return null}function getFeatureFlagsGlobal(){try{if(typeof globalThis<"u"&&globalThis[FEATURE_FLAGS_GLOBAL_KEY])return globalThis[FEATURE_FLAGS_GLOBAL_KEY]}catch{}return loadFeatureFlagsFallback()}module.exports={FEATURE_FLAGS_GLOBAL_KEY,registerFeatureFlagsGlobal,getFeatureFlagsGlobal}});var se=_((exports,module)=>{var{getLogger}=Y(),{CHUNK_SIZES}=is(),{getChunkSourcePath,getAllChunkNames}=ut(),{registerFeatureFlagsGlobal}=ht(),featureLogger=null,DEFAULT_CHUNK_TIMEOUT_MS=Number(process.env.EXPLORER_DATES_CHUNK_TIMEOUT||(process.env.NODE_ENV==="test"?1e3:5e3)),NETWORK_ERROR_CODES=new Set(["ENOTFOUND","ECONNRESET","ECONNREFUSED","EAI_AGAIN","ETIMEDOUT","EHOSTUNREACH"]),BUILT_CHUNK_CACHE=new Map,CHUNK_METHOD_ALIASES={reporting:"exportReporting",templates:"workspaceTemplates",analysis:"analysisCommands"},DEV_CHUNK_PATH_CACHE=new Map;function getDevChunkImportPath(i){if(DEV_CHUNK_PATH_CACHE.has(i))return DEV_CHUNK_PATH_CACHE.get(i);let e=getChunkSourcePath(i);if(!e)return DEV_CHUNK_PATH_CACHE.set(i,null),null;let t=e;return t.startsWith("src/")&&(t=t.slice(4)),t.startsWith("./")||(t=`./${t}`),DEV_CHUNK_PATH_CACHE.set(i,t),t}function resolveNodeDependencies(){if(nativeDepsResolved)return!!(nativePath&&nativeFs);if(nativeDepsResolved=!0,!isNodeLikeRuntime())return!1;try{nativePath=eval("require")("path"),nativeFs=eval("require")("fs")}catch{nativePath=null,nativeFs=null}return!!(nativePath&&nativeFs)}var nativeDepsResolved=!1,nativePath=null,nativeFs=null;function isWebRuntime(){try{return typeof navigator<"u"&&(navigator!=null&&navigator.userAgent)?navigator.userAgent.includes("vscode-web")||navigator.userAgent.includes("Code - Web"):typeof process<"u"&&!1}catch{return!1}}function isNodeLikeRuntime(){var i;return typeof process<"u"&&!!((i=process.versions)!=null&&i.node)&&!isWebRuntime()}function getChunkTimeoutMs(){return DEFAULT_CHUNK_TIMEOUT_MS>0?DEFAULT_CHUNK_TIMEOUT_MS:0}function logFeature(i,e,t){featureLogger||(featureLogger=getLogger());let s=featureLogger;typeof s[i]=="function"?s[i](e,t):s.info(e,t)}function logFeatureDisabled(i,e){logFeature("info","Feature disabled via configuration",{feature:i,savedKB:e&&CHUNK_SIZES[e]!==void 0?CHUNK_SIZES[e]:void 0})}function isLikelyNetworkIssue(i){if(!i)return!1;if(i.code&&NETWORK_ERROR_CODES.has(i.code))return!0;let e=(i.message||"").toLowerCase();return e.includes("network")||e.includes("fetch")||e.includes("timed out")}function runWithChunkTimeout(i,e){let t=getChunkTimeoutMs(),s=()=>{try{return Promise.resolve(i())}catch(r){return Promise.reject(r)}};return t?new Promise((r,n)=>{let o=!1,a=setTimeout(()=>{if(o)return;o=!0;let l=new Error(`Chunk "${e}" load timed out after ${t}ms`);l.code="CHUNK_TIMEOUT",n(l)},t);s().then(l=>{o||(o=!0,clearTimeout(a),r(l))}).catch(l=>{o||(o=!0,clearTimeout(a),n(l))})}):s()}function logResolverFailure(i,e){if(!e)return;let t={chunkName:i,error:e.message,code:e.code,networkIssue:isLikelyNetworkIssue(e),timedOut:e.code==="CHUNK_TIMEOUT"},s=t.networkIssue||t.timedOut?"warn":"error";logFeature(s,"Chunk resolver failed",t)}function tryLoadBuiltChunk(i){if(!i||!resolveNodeDependencies()||typeof(nativeFs==null?void 0:nativeFs.existsSync)!="function")return null;if(BUILT_CHUNK_CACHE.has(i))return BUILT_CHUNK_CACHE.get(i);let e=[];typeof __dirname=="string"&&nativePath&&(e.push(nativePath.join(__dirname,"chunks",`${i}.js`)),e.push(nativePath.join(__dirname,"..","dist","chunks",`${i}.js`)));for(let t of e)try{if(!t||!nativeFs.existsSync(t))continue;let s=require(t),r=(s==null?void 0:s.default)||s;return BUILT_CHUNK_CACHE.set(i,r||null),r&&logFeature("info","Loaded chunk via built artifact fallback",{chunkName:i,path:t}),r}catch(s){logFeature("warn","Built chunk fallback failed",{chunkName:i,path:t,error:s.message})}return BUILT_CHUNK_CACHE.set(i,null),null}function tryRequireDevChunk(i){if(isWebRuntime())return null;let e=getDevChunkImportPath(i);if(!e)return null;try{let t=require(e);return(t==null?void 0:t.default)||t}catch(t){(t.code!=="MODULE_NOT_FOUND"||typeof t.message=="string"&&!t.message.includes(e))&&logFeature("debug","Dev chunk require failed",{chunkName:i,importPath:e,error:t.message})}return null}function tryRequireLocalBuiltChunk(i){if(isWebRuntime())return null;let e=`./chunks/${i}`;try{let t=require(e);return(t==null?void 0:t.default)||t}catch(t){t.code==="MODULE_NOT_FOUND"||logFeature("debug","Local chunk require failed",{chunkName:i,importPath:e,error:t.message})}return null}function getSavingsKey(i){return i in CHUNK_SIZES?i:CHUNK_METHOD_ALIASES[i]||null}function announceChunkSavings(i){let e=getSavingsKey(i);if(!e)return;let t=CHUNK_SIZES[e];if(!t)return;let r=`\u{1F4BE} ${e===i||!i?e:`${e} (requested as "${i}")`} chunk unavailable - keeping the feature disabled is saving ~${t}KB`;logFeature("info","Chunk savings applied",{chunkName:e,requestedName:i,savedKB:t})}var getFeatureConfig=()=>{try{let e=require("vscode").workspace.getConfiguration("explorerDates");return{enableOnboarding:e.get("enableOnboardingSystem",!0),enableExportReporting:e.get("enableExportReporting",!0),enableWorkspaceTemplates:e.get("enableWorkspaceTemplates",!0),enableAnalysisCommands:e.get("enableAnalysisCommands",!0),enableAdvancedCache:e.get("enableAdvancedCache",!0),enableWorkspaceIntelligence:e.get("enableWorkspaceIntelligence",!0),enableIncrementalWorkers:e.get("enableIncrementalWorkers",!1),enableExtensionApi:e.get("enableExtensionApi",!0)}}catch{return{enableOnboarding:!0,enableExportReporting:!0,enableWorkspaceTemplates:!0,enableAnalysisCommands:!0,enableAdvancedCache:!0,enableWorkspaceIntelligence:!0,enableIncrementalWorkers:!1,enableExtensionApi:!0}}},featureLoaders=new Map,chunkResolver=null;function setFeatureChunkResolver(i){if(i&&typeof i!="function")throw new Error("Feature chunk resolver must be a function");chunkResolver=i||null}function registerFeatureLoader(i,e){if(typeof e!="function")throw new Error(`Feature loader for "${i}" must be a function`);featureLoaders.set(i,e)}function unregisterFeatureLoader(i){featureLoaders.delete(i)}function clearFeatureLoaders(){featureLoaders.clear()}async function loadFeatureModule(i){let e=featureLoaders.get(i);if(!e&&chunkResolver&&(e=()=>chunkResolver(i)),!e)return logFeature("warn","No loader registered for feature",{feature:i}),null;try{return await runWithChunkTimeout(()=>e(),i)}catch(t){return logFeature("warn","Feature loader failed",{feature:i,error:t.message,code:t.code,networkIssue:isLikelyNetworkIssue(t)}),announceChunkSavings(i),null}}function registerDefaultLoaders(){getAllChunkNames().forEach(e=>{featureLoaders.has(e)||registerFeatureLoader(e,createDefaultLoader(e))})}function createDefaultLoader(i){return async()=>{if(chunkResolver&&typeof chunkResolver=="function")try{let r=await runWithChunkTimeout(()=>chunkResolver(i),i);if(r)return r;logFeature("info","Chunk resolver returned no module",{chunkName:i})}catch(r){logResolverFailure(i,r)}let e=tryRequireDevChunk(i);if(e)return e;let t=tryRequireLocalBuiltChunk(i);if(t)return t;let s=tryLoadBuiltChunk(i);return s||(logFeature("warn","No built artifact available for chunk",{chunkName:i}),null)}}var featureFlags={async onboarding(){return getFeatureConfig().enableOnboarding?loadFeatureModule("onboarding"):(logFeatureDisabled("onboarding","onboarding"),null)},async exportReporting(){return getFeatureConfig().enableExportReporting?loadFeatureModule("reporting"):(logFeatureDisabled("exportReporting","exportReporting"),null)},async workspaceTemplates(){return getFeatureConfig().enableWorkspaceTemplates?loadFeatureModule("templates"):(logFeatureDisabled("workspaceTemplates","workspaceTemplates"),null)},async analysisCommands(){return getFeatureConfig().enableAnalysisCommands?loadFeatureModule("analysis"):(logFeatureDisabled("analysisCommands","analysisCommands"),null)},async advancedCache(){return getFeatureConfig().enableAdvancedCache?loadFeatureModule("advancedCache"):(logFeatureDisabled("advancedCache","advancedCache"),null)},async workspaceIntelligence(){return getFeatureConfig().enableWorkspaceIntelligence?loadFeatureModule("workspaceIntelligence"):(logFeatureDisabled("workspaceIntelligence","workspaceIntelligence"),null)},async incrementalWorkers(){return getFeatureConfig().enableIncrementalWorkers?loadFeatureModule("incrementalWorkers"):(logFeatureDisabled("incrementalWorkers","incrementalWorkers"),null)},async extensionApi(){return getFeatureConfig().enableExtensionApi?loadFeatureModule("extensionApi"):(logFeatureDisabled("extensionApi","extensionApi"),null)},async uiAdapters(){return loadFeatureModule("uiAdapters")},async batchProcessor(){return loadFeatureModule("batchProcessor")},async decorationsAdvanced(){return loadFeatureModule("decorationsAdvanced")},async gitInsights(){return loadFeatureModule("gitInsights")},isEnabled(i){let e=getFeatureConfig();return{onboarding:e.enableOnboarding,exportReporting:e.enableExportReporting,workspaceTemplates:e.enableWorkspaceTemplates,analysisCommands:e.enableAnalysisCommands,advancedCache:e.enableAdvancedCache,workspaceIntelligence:e.enableWorkspaceIntelligence,incrementalWorkers:e.enableIncrementalWorkers,extensionApi:e.enableExtensionApi}[i]??!0},getEnabledFeatures(){let i=getFeatureConfig(),e=[];return i.enableOnboarding&&e.push("onboarding"),i.enableExportReporting&&e.push("exportReporting"),i.enableWorkspaceTemplates&&e.push("workspaceTemplates"),i.enableAnalysisCommands&&e.push("analysisCommands"),i.enableAdvancedCache&&e.push("advancedCache"),i.enableWorkspaceIntelligence&&e.push("workspaceIntelligence"),i.enableIncrementalWorkers&&e.push("incrementalWorkers"),i.enableExtensionApi&&e.push("extensionApi"),e},calculateSavings(){let i=getFeatureConfig(),e=0;return i.enableOnboarding||(e+=34),i.enableExportReporting||(e+=17),i.enableExtensionApi||(e+=15),i.enableWorkspaceTemplates||(e+=14),i.enableWorkspaceIntelligence||(e+=12),i.enableAnalysisCommands||(e+=8),i.enableAdvancedCache||(e+=5),e}};for(let[i,e]of Object.entries(CHUNK_METHOD_ALIASES))!featureFlags[i]&&typeof featureFlags[e]=="function"&&(featureFlags[i]=(...t)=>featureFlags[e](...t));function calculateSavings(i){i||(i=getFeatureConfig());let e=267,t=0;i.enableOnboarding||(t+=34),i.enableExportReporting||(t+=17),i.enableExtensionApi||(t+=15),i.enableWorkspaceTemplates||(t+=14),i.enableWorkspaceIntelligence||(t+=12),i.enableIncrementalWorkers||(t+=19),i.enableAnalysisCommands||(t+=8),i.enableAdvancedCache||(t+=5);let s=e-t,r=t>0?Math.round(t/e*100):0;return{baseSize:`${e}KB`,totalSavings:`${t}KB`,optimizedSize:`${s}KB`,percentage:r}}registerDefaultLoaders();var exportedFeatureFlags={...featureFlags,getFeatureConfig,calculateSavings,registerFeatureLoader,setFeatureChunkResolver,unregisterFeatureLoader,clearFeatureLoaders,loadFeatureModule,registerDefaultLoaders};registerFeatureFlagsGlobal(exportedFeatureFlags);module.exports=exportedFeatureFlags});var _s=_(($i,Es)=>{var d=require("vscode"),{getLogger:$r}=Y(),{getLocalization:Nr}=Ze(),{fileSystem:zr}=Pe(),{formatFileSize:Ur,trimBadge:os}=Kt(),{getFileName:wt,getExtension:Ne,getCacheKey:Br,normalizePath:I,getUriPath:z}=we(),{DEFAULT_CACHE_TIMEOUT:as,DEFAULT_MAX_CACHE_SIZE:Vr,MONTH_ABBREVIATIONS:Gr,GLOBAL_STATE_KEYS:Hr,DEFAULT_DECORATION_POOL_SIZE:ls,DEFAULT_FLYWEIGHT_CACHE_SIZE:dt,WORKSPACE_SCALE_LARGE_THRESHOLD:gt,WORKSPACE_SCALE_EXTREME_THRESHOLD:ys,WORKSPACE_SCAN_MAX_RESULTS:Kr}=ye(),{isWebEnvironment:bt}=Qe(),{ensureDate:cs}=be(),{SecurityValidator:jr,SecureFileOperations:qr,detectSecurityEnvironment:us}=ot(),{setCachedWorkspaceMetrics:Yr}=ss(),hs=process.env.EXPLORER_DATES_DISABLE_GIT_FEATURES==="1",G=null;try{bt()||(G=require("path"))}catch{G=null}var ze={basename:i=>{if(G)return G.basename(i);let e=i.replace(/\\/g,"/"),t=e.lastIndexOf("/");return t===-1?e:e.substring(t+1)},dirname:i=>{if(G)return G.dirname(i);let e=i.replace(/\\/g,"/"),t=e.lastIndexOf("/");return t===-1?".":e.substring(0,t)}},Ue=3e4,ft="::",ds=Number(process.env.EXPLORER_DATES_MAX_DYNAMIC_WATCHERS||200),gs=Number(process.env.EXPLORER_DATES_WATCHER_TTL_MS||600*1e3),ps=["ts","tsx","js","jsx","mjs","cjs","mts","cts","vue","py","go","rb","rs","java","kt","swift","cs","cpp","c","php","scala","sql","md","mdx","json","jsonc","yml","yaml","toml","ini","txt","html","css","scss"],Xr=new Map([["src",100],["app",95],["apps",95],["packages",90],["services",85],["service",80],["client",75],["clients",70],["server",70],["servers",65],["lib",65],["libs",60],["api",60],["apis",60],["components",55],["modules",55],["feature",50],["features",50],["extensions",45],["scripts",45],["tools",45],["examples",40],["docs",35],["config",35],["test",30],["tests",30],["spec",30],["specs",30],["demo",25],["demos",25]]),re=Number(process.env.EXPLORER_DATES_WORKSPACE_SCAN_TIMEOUT||7e3),ms=ys,Be="__root__",ws=300*1e3,Jr=600*1e3,bs=900*1e3,Zr=Number(process.env.EXPLORER_DATES_VIEWPORT_HISTORY_LIMIT||400),pt=["full","enhanced","standard","minimal"],Qr=Math.max(100,Number(process.env.EXPLORER_DATES_INDEXER_MAX_FILES||2e3)),ei="EXPLORER_DATES_SECURITY_EXTRA_PATHS",mt=Number(process.env.EXPLORER_DATES_SECURITY_WARNING_THROTTLE_MS||5e3),ti=Number(process.env.EXPLORER_DATES_SECURITY_WARNING_CACHE||500),_e=Number(process.env.EXPLORER_DATES_SECURITY_MAX_WARNINGS_PER_FILE??1),N=(i="")=>{let e=typeof i=="string"?i:z(i),t=I(e);return wt(t)||t||"unknown"},yt=class{constructor(){this.o=new Map,this.b=new Map,this.u=0}get size(){return this.u}get bucketCount(){return this.o.size}clear(){this.o.clear(),this.b.clear(),this.u=0}get(e){if(!e)return;let t=this.b.get(e);if(!t)return;let s=this.o.get(t);if(!s){this.b.delete(e);return}return s.lastAccess=Date.now(),s.entries.get(e)}set(e,t,s={}){if(!e)return;let r=s.folderKey||this.Ns(e),n=this.zs(r),o=n.entries.has(e);n.entries.set(e,t),n.lastAccess=Date.now(),o||this.u++,this.b.set(e,r)}delete(e){if(!e)return!1;let t=this.b.get(e);if(!t)return!1;let s=this.o.get(t);if(!s)return this.b.delete(e),!1;let r=s.entries.delete(e);return r&&(this.u=Math.max(0,this.u-1),s.entries.size===0&&this.o.delete(t)),this.b.delete(e),r}*entries(){for(let e of this.o.values())yield*e.entries.entries()}*keys(){for(let e of this.o.values())yield*e.entries.keys()}*values(){for(let e of this.o.values())yield*e.entries.values()}[Symbol.iterator](){return this.entries()}enforceLimit(e=0,t){if(!e||this.u<=e)return 0;let s=Math.max(Math.floor(e*.2),this.u-e,1),r=0,n=Array.from(this.o.entries()).map(([o,a])=>({folderKey:o,bucket:a}));n.sort((o,a)=>(o.bucket.lastAccess||0)-(a.bucket.lastAccess||0));for(let{folderKey:o,bucket:a}of n){if(r>=s)break;if(!a.entries.size){this.o.delete(o);continue}let l=a.entries.size,c=s-r;if(l<=c){r+=this.Us(o,a);continue}let h=Array.from(a.entries.entries());h.sort((f,m)=>(f[1].timestamp||0)-(m[1].timestamp||0));let u=Math.min(c,Math.max(1,Math.ceil(l*.5)));for(let f=0;f<u&&f<h.length;f++){let[m]=h[f];a.entries.delete(m),this.b.delete(m),r++,this.u=Math.max(0,this.u-1)}a.entries.size?a.lastAccess=Date.now():this.o.delete(o)}return r>0&&t&&t.debug(`Hierarchical cache eviction removed ${r} entries (${this.u} remaining)`),r}zs(e){return this.o.has(e)||this.o.set(e,{entries:new Map,lastAccess:Date.now()}),this.o.get(e)}Us(e,t){if(!t)return 0;let s=t.entries.size;for(let r of t.entries.keys())this.b.delete(r);return this.o.delete(e),this.u=Math.max(0,this.u-s),s}Ns(e){if(!e||typeof e!="string")return Be;let t=I(e);if(!t)return Be;let s=t.lastIndexOf("/");return s===-1?Be:t.slice(0,s)||Be}},si=!1,Et=class{constructor(){this.f=new d.EventEmitter,this.onDidChangeFileDecorations=this.f.event,this.e=new yt,this.se=new Map,this.Bs=new Map,this.Ae=[],this.xe=20,this.p=this.xe,this.y=0,this.st=!1,this.Nt=!1,this.S=new Map,this.T=[],this.a={hits:0,misses:0,allocations:0,reuses:0},this.W=ls,this.re=new Map,this.rt=[],this.it=dt,this.$={hits:0,misses:0,allocations:0,reuses:0},this.ie=new Map,this.nt=[],this.ot=dt,this.N={hits:0,misses:0,allocations:0,reuses:0},this.Me=process.env.EXPLORER_DATES_ENABLE_DECORATION_POOL!=="0",this.Re=process.env.EXPLORER_DATES_ENABLE_FLYWEIGHTS!=="0",this.E=process.env.EXPLORER_DATES_LIGHTWEIGHT_MODE==="1",this.Le=process.env.EXPLORER_DATES_MEMORY_SHEDDING==="1",this.Oe=Number(process.env.EXPLORER_DATES_MEMORY_SHED_THRESHOLD_MB||3),this.Pe=!1,this.ne=this.Le?this.zt():0,this.Vs=Number(process.env.EXPLORER_DATES_MEMORY_SHED_CACHE_LIMIT||1e3),this.Ut=Number(process.env.EXPLORER_DATES_MEMORY_SHED_REFRESH_MS||6e4),this.v=null,this.Ie=process.env.EXPLORER_DATES_FORCE_CACHE_BYPASS==="1",this.Bt=Number(process.env.EXPLORER_DATES_LIGHTWEIGHT_PURGE_INTERVAL||400),this._isWeb=si||bt(),this.at=as*4,this.Vt=this.at,this.lt=0,this.s=Vr,this._fileSystem=zr,this.We=!this._isWeb,this.Gt=!1,this.i=null,this.oe=null,this._allocationTelemetryEnabled=process.env.NODE_ENV==="development"||process.env.EXPLORER_DATES_TELEMETRY==="1",this._telemetryReportInterval=Number(process.env.EXPLORER_DATES_TELEMETRY_INTERVAL_MS||6e4),this._telemetryReportTimer=null,this.z=null,this.Ht=new Map,this.F=new Set,this._=new Map,this.Kt=Zr,this.U=ws,this.jt=Date.now(),this.B=[],this.V="full",this.C=null,this._logger=$r(),this.A=Nr(),this._workspaceIntelligence=null,this._batchProcessor=null,this._batchProcessorModule=null,this._progressiveLoadingJobs=new Set,this._progressiveLoadingEnabled=!1,this.ae=null,this.$e=null,this._advancedCache=null,this.r=null,this.m=new Set,this.G=void 0,this.h=new Map,this.H=[],this.le=null,this.K=!0,this._enableWatcherFallbacks="auto",this._smartWatcherFallbackManager=null,this.ce=null,this.x="none",this.j=new Map,this.Ne=null,this.t="unknown",this.Gs=process.env.EXPLORER_DATES_LOG_WATCHERS==="1",this.ze=us(),this.qt=!0,this.ct=[],this.Yt=!0,this.ut=!1,this.Xt=!1,this.ue=new Map,this.Ue=mt,this.he=Number.isFinite(_e)?Math.max(0,_e):1,this.ht=typeof d.workspace.onDidChangeWorkspaceFolders=="function"?d.workspace.onDidChangeWorkspaceFolders(s=>this.Hs(s)):null,this.M=null,this.ge=null,this.fe=null,this.R=null,this.pe=!1,this.dt=0,this.L=!1,this._themeIntegration=null,this._accessibility=null,this.gt=!1,this.ft={profile:"stress",throttleKey:"decorations:request",throttleLimit:Number(process.env.EXPLORER_DATES_LOG_INFO_LIMIT||50)},this._metrics={totalDecorations:0,cacheHits:0,cacheMisses:0,cacheEvictions:0,errors:0,gitBlameTimeMs:0,gitBlameCalls:0,fileStatTimeMs:0,fileStatCalls:0,viewportPriorityDecorations:0,viewportBackgroundDecorations:0},this.w=null,this.O=6e4,this.q=new Set,this.me=!1,this.pt=!1;let e=d.workspace.getConfiguration("explorerDates"),t=e.get("cacheTimeout",Ue);this.mt=this.Jt(e,t),this.c=this.Zt(t),this.Be=e.get("performanceMode",!1),this.Qt=!1,this._performanceMode=this.Be,this.ts(e),this.ss(e),this.rs(e),this.E&&(this._performanceMode=!0,this.Me=!1,this.Re=!1,this.c=Math.min(this.c,5e3),this.s=Math.min(this.s,64),this._logger.info("Lightweight mode: decoration pooling and flyweight caches disabled; cache timeout capped at 5s")),this._performanceMode||this.we(),this.Ks(),this._performanceMode||this.P(),this.Y(this.X(e),"initialization"),this.js(),this._logger.info(`FileDateDecorationProvider initialized (performanceMode: ${this._performanceMode})`),this.Ie&&this._logger.warn("Force cache bypass mode enabled - decoration caches will be skipped"),this.Me||this._logger.warn("Decoration pool disabled via EXPLORER_DATES_ENABLE_DECORATION_POOL=0"),this.Re||this._logger.warn("Flyweight caches disabled via EXPLORER_DATES_ENABLE_FLYWEIGHTS=0"),this.E&&this._logger.warn("Lightweight mode enabled via EXPLORER_DATES_LIGHTWEIGHT_MODE=1 (performanceMode forced on)"),this.Le&&this._logger.warn(`Memory shedding enabled (threshold ${this.Oe} MB); will stretch refresh interval and shrink cache if exceeded.`),this.Ve=[],this.Ge=Number(process.env.EXPLORER_DATES_SOFT_HEAP_ALERT_MB||2),this.J=0,this.be=!1,this.wt=Number(process.env.EXPLORER_DATES_CACHE_PRESSURE_RATIO||.7),this.He=!1,this.n=null,this._extensionContext=null,this.is()}async is(){let e=d.workspace.getConfiguration("explorerDates"),t=e.get("autoThemeAdaptation",!0),s=e.get("accessibilityMode",!1);if(t||s)try{let r=await this.qs();r&&(this._themeIntegration=t?r.themeManager:null,this._accessibility=s?r.accessibilityManager:null,this.gt=!0,this._logger.debug(`\u{1F50C} UI adapters loaded: theme=${!!this._themeIntegration}, accessibility=${!!this._accessibility}`))}catch(r){this._logger.error("Failed to load UI adapters chunk:",r),this._themeIntegration=null,this._accessibility=null,this.gt=!1}else this._logger.debug("\u{1F50C} UI adapters not loaded (features disabled)")}async qs(){try{let t=await se().uiAdapters();return t?typeof t.createUIAdapters=="function"?await t.createUIAdapters():t:null}catch(e){return this._logger.warn("UI adapters chunk not available:",e.message),null}}async Ys(){return hs?(this.We=!1,null):this.oe?this.oe:this.i?this.i:(this.oe=(async()=>{try{let t=await se().gitInsights();if(!t)throw new Error("Git insights chunk failed to load");let s=null;if(typeof t=="function"?s=t:t&&typeof t.getGitInsightsManager=="function"?s=t.getGitInsightsManager:t&&typeof t.default=="function"&&(s=t.default),typeof s!="function")throw new Error("Git insights chunk missing getGitInsightsManager export");if(this.i=s(),!this.i||typeof this.i.initialize!="function")throw new Error("Git insights manager factory returned invalid instance");let r=d.workspace.getConfiguration("explorerDates");return await this.i.initialize({enableWorker:r.get("enableWorkerThreads",!0),enableWasm:r.get("enableWasmDigest",!0)}),this.We=await this.i.isGitAvailable(),this._logger.debug("\u{1F527} Git insights manager loaded and initialized"),this.i}catch(e){return this._logger.error("Failed to load git insights:",e),this.i=null,this.We=!1,null}finally{this.oe=null}})(),this.oe)}async Xs(){this._themeIntegration&&typeof this._themeIntegration.dispose=="function"&&this._themeIntegration.dispose(),this._accessibility&&typeof this._accessibility.dispose=="function"&&this._accessibility.dispose(),this._themeIntegration=null,this._accessibility=null,this.gt=!1,await this.is()}applyPreviewSettings(e){let t=!!this.n;e&&typeof e=="object"?(this.n=Object.assign({},e),this._logger.info("\u{1F504} Applied preview settings",this.n)):(this.n=null,this._logger.info("\u{1F504} Cleared preview settings"));let s=this.e.size;if(this.e.clear(),this.Z("preview-mode-change"),this._logger.info(`\u{1F5D1}\uFE0F Cleared memory cache (${s} items) for preview mode change`),this._advancedCache)try{typeof this._advancedCache.clear=="function"?(this._advancedCache.clear(),this._logger.info("\u{1F5D1}\uFE0F Cleared advanced cache for preview mode change")):this._logger.warn("\u26A0\uFE0F Advanced cache does not support clear operation")}catch(r){this._logger.warn("\u26A0\uFE0F Failed to clear advanced cache:",r.message)}this.n&&!t?this._logger.info("\u{1F3AD} Entered preview mode - caching disabled"):!this.n&&t&&this._logger.info("\u{1F3AD} Exited preview mode - caching re-enabled"),this.f.fire(void 0),this._logger.info("\u{1F504} Fired decoration refresh event for preview change")}async testDecorationProvider(){this._logger.info("\u{1F9EA} Testing decoration provider functionality...");let e=d.workspace.workspaceFolders;if(!e||e.length===0){this._logger.error("\u274C No workspace folders available for testing");return}let t=d.Uri.joinPath(e[0].uri,"package.json");try{let s=await this.provideFileDecoration(t);this._logger.info("\u{1F9EA} Test decoration result:",{file:"package.json",success:!!s,badge:s==null?void 0:s.badge,hasTooltip:!!(s!=null&&s.tooltip),hasColor:!!(s!=null&&s.color)}),this.f.fire(t),this._logger.info("\u{1F504} Fired decoration change event for test file")}catch(s){this._logger.error("\u274C Test decoration failed:",s)}}forceRefreshAllDecorations(){this._logger.info("\u{1F504} Force refreshing ALL decorations..."),this.Q(),this.e.clear(),this.Z("force-refresh"),this._advancedCache&&this._advancedCache.clear(),this.f.fire(void 0),this._logger.info("\u{1F504} Triggered global decoration refresh")}startProviderCallMonitoring(){this.bt=0,this.ye=new Set;let e=this.provideFileDecoration.bind(this);this.provideFileDecoration=async(t,s)=>{this.bt++;let r=z(t)||(t==null?void 0:t.toString(!0))||"unknown";return this.ye.add(I(r)),this._logger.info(`\u{1F50D} Provider called ${this.bt} times for: ${N(t||r)}`),await e(t,s)},this._logger.info("\u{1F4CA} Started provider call monitoring")}getProviderCallStats(){return{totalCalls:this.bt||0,uniqueFiles:this.ye?this.ye.size:0,calledFiles:this.ye?Array.from(this.ye):[]}}async checkWorkspaceSize(){if(this.ge)return this.ge;if(!this.fe){this.pe=!1;let s=this.Js().then(r=>(this.pe&&(this.pe=!1,this._logger.info("Workspace size scan completed after watchdog fallback; applied actual workspace metrics",{workspaceFileCount:this.Ne,workspaceScale:this.t})),r)).catch(r=>{this._logger.debug("Workspace size check failed (non-critical):",r)});this.fe=s.finally(()=>{this.fe=null})}let e=this.Zs(),t=e?[this.fe,e]:[this.fe];return this.ge=Promise.race(t).finally(()=>{this.Qs(),this.ge=null}),this.ge}async er(e){let t=Number.isFinite(re)?re:0,s=d.workspace.findFiles("**/*",null,e);if(!t||t<=0)return s;try{return await new Promise((r,n)=>{let o=null,a=(l,c=!1)=>{o&&(clearTimeout(o),o=null),c?n(l):r(l)};o=setTimeout(()=>a(null),t),s.then(l=>a(l),l=>a(l,!0))})}catch(r){return this._logger.warn("Workspace scan failed, assuming large workspace",{error:r.message}),null}}Zs(){if(this.pe)return Promise.resolve();let e=Number(process.env.EXPLORER_DATES_WORKSPACE_SCAN_WATCHDOG_MS),t=Number.isFinite(re)&&re>0?re:5e3,s=Number.isFinite(e)?e:Math.min(2e4,Math.max(3e3,t+2e3));return!Number.isFinite(s)||s<=0?null:(this.R&&clearTimeout(this.R),new Promise(r=>{this.R=setTimeout(()=>{this.R=null,this.pe=!0,this.Ne=ms,this.t="extreme";try{let n=d.workspace.getConfiguration("explorerDates");this.Y(this.X(n),"workspace-scale-watchdog")}catch{this.Y(this.X(),"workspace-scale-watchdog")}this._logger.warn(`Workspace size check exceeded ${s}ms; forcing extreme scale fallback`),r()},s)}))}Qs(){this.R&&(clearTimeout(this.R),this.R=null)}async Js(){var h;let e=d.workspace.getConfiguration("explorerDates"),t=e.get("forceEnableForLargeWorkspaces",!1),s=e.get("performanceMode",!1),r=t||s,n=d.workspace.workspaceFolders;if(!n||n.length===0)return;this._logger.info("Checking workspace size for large workspace detection...");let o=await this.er(Kr),a=!Array.isArray(o),l=a?ms:o.length;if(a){let u=re?`${re}ms`:"the configured timeout";this._logger.warn(`Workspace scan exceeded ${u}; defaulting to extreme scale`)}else{let u=`${gt}+`;this._logger.info(`Workspace contains ${l>=gt?u:l} files`)}let c=this.t;this.Ne=l,this.t=l>=ys?"extreme":l>=gt?"large":"normal";try{let u=(h=n[0])==null?void 0:h.uri;Yr(u,l)}catch(u){this._logger.debug("Unable to cache workspace file count",u)}c!==this.t&&this.K&&!this._performanceMode&&(this._logger.info(`Workspace scale changed ${c} -> ${this.t}; recalibrating watchers`),this.we("workspace-scale-update")),this._batchProcessor&&typeof this._batchProcessor.setWorkspaceScale=="function"&&this._batchProcessor.setWorkspaceScale(this.t||"normal"),this.Y(this.X(e),"workspace-scale-change"),r&&this._logger.debug("Large workspace prompt suppressed (force/performance mode), but scaling adjustments applied")}_getIndexerMaxFiles(){let e=Qr;return this.t==="extreme"?Math.min(600,e):this.t==="large"?Math.min(1200,e):e}_shouldEnableProgressiveAnalysis(){let t=d.workspace.getConfiguration("explorerDates").get("enableProgressiveAnalysis");return t===!0||t===!1?t:this.t==="large"||this.t==="extreme"}we(e="initial"){if(this._performanceMode||this.L){let r=this.L?"provider disposed":"performance mode enabled";this._logger.debug(`Skipping file watcher setup (${e}) - ${r}`);return}this.G||(this.G={pending:!0});let t=++this.dt;(async()=>{if(this.ce)try{await this.ce}catch(n){this._logger.debug("Previous watcher setup promise rejected",n)}let r=this.tr(e,t);this.ce=r;try{await r}finally{this.ce===r&&(this.ce=null)}})().catch(r=>{this._logger.error("Failed to configure file watchers",r)})}async tr(e,t){if(this.Ee(t))return;if(this.Ke({permanent:!1}),this.Ee(t)){this.je("post-dispose");return}this.G={pending:!0};let s=d.workspace.workspaceFolders;if(!s||s.length===0){this._logger.debug("No workspace folders detected; skipping watcher setup"),this.x="none";return}if(bt()){this._logger.info("File watchers are unavailable in web environments; skipping watcher setup"),this.x="none";return}let r=d.workspace.getConfiguration("explorerDates"),n=process.env.EXPLORER_DATES_DISABLE_SMART_WATCHERS==="1";this.K=!n&&r.get("smartFileWatching",!0),this._enableWatcherFallbacks=this.K&&r.get("enableSmartWatcherFallbacks","auto");let o=r.get("smartWatcherMaxPatterns",20),a=this.sr(r.get("smartWatcherExtensions",ps)),l=this.rr(o);if(this.ir={maxPatterns:l,extensions:a},this.Ee(t)){this.je("post-config");return}if(!this.K){this._logger.info("Smart file watching disabled; falling back to global watcher"),await this.qe("disabled");return}let c=[];try{c=await this.nr(s,this.ir)}catch(h){this._logger.error("Smart watcher analysis failed, falling back to global watcher",h),await this.qe("analysis-failed");return}if(this.Ee(t)){this.je("post-analysis");return}if(!c||c.length===0){this._logger.warn("Smart watcher analysis yielded no targets; falling back to global watcher"),await this.qe("no-targets");return}for(let h of c)try{let u=await this.ns(h.pattern,h.label);u&&(this.yt(u,h.label),this.m.add(u))}catch(u){this._logger.debug(`Failed to create watcher for pattern ${h.label}`,u)}if(this.m.size===0){this._logger.warn("Smart watcher setup produced zero watchers; using global fallback"),await this.qe("no-watchers-created");return}if(this.Ee(t)){this.je("post-creation");return}this.G=this.m.values().next().value||void 0,this.x="smart",this._logger.info(`Smart file watching enabled (${this.m.size} base watcher${this.m.size===1?"":"s"})`,{reason:e,patterns:c.map(h=>h.label)}),this.or()}Ee(e){return!!(this.L||this._performanceMode||typeof e=="number"&&e!==this.dt)}je(e="unknown"){let t=this._performanceMode||this.L;this.Ke({permanent:t}),this._logger.debug(`Watcher setup aborted (${e})`,{permanentAbort:t,disposed:this.L,performanceMode:this._performanceMode})}async _e(){return this.$e?this.$e:(this.$e=(async()=>{try{let t=await se().decorationsAdvanced();return this.ae=t||null,this.ae}catch(e){return this._logger.debug("Failed to load decorationsAdvanced chunk",e),this.ae=null,null}})(),this.$e)}async ns(e,t="unknown"){try{let r=await this._e();if(r!=null&&r.createWatcherWithFallback)return await r.createWatcherWithFallback(this,e,t)}catch(r){this._logger.debug(`Advanced watcher chunk failed for ${t}`,r)}let s=()=>{if(this._enableWatcherFallbacks===!1)return!1;if(this._enableWatcherFallbacks==="auto"||this._enableWatcherFallbacks===!0){let r=process.platform,n=process.env.WSL_DISTRO_NAME||process.env.WSLENV,o=d.env.remoteName,a=process.env.DOCKER_CONTAINER;return n||o||a||r==="android"}return!1};try{let r=d.workspace.createFileSystemWatcher(e);return this._logger.debug(`Native watcher created for ${t}`),r}catch(r){return this._logger.debug(`Native watcher failed for ${t}:`,r),s()?this.ar(e,t):null}}async ar(e,t){try{let s=await this._e();if(s!=null&&s.createFallbackWatcher)return await s.createFallbackWatcher(this,e,t)}catch(s){this._logger.warn(`Fallback watcher creation failed for ${t}:`,s)}try{if(!this._smartWatcherFallbackManager){let{loadFeatureModule:s}=se(),r=await s("smartWatcherFallback");if(r){let{SmartWatcherFallbackManager:n}=r;this._smartWatcherFallbackManager=new n({logger:this._logger}),await this._smartWatcherFallbackManager.initialize()}}if(this._smartWatcherFallbackManager){let r=await(await this._smartWatcherFallbackManager.getFallback()).createWatcherWithFallback(e);return this._logger.debug(`Fallback watcher created for ${t}`),r}}catch(s){this._logger.warn(`Fallback watcher creation failed for ${t}:`,s)}return null}async qe(e="global-default"){this.Et();let t=await this.ns("**/*",`global:${e}`);t?(this.yt(t,`global:${e}`),this.m.add(t),this.G=t,this.x="global",this._logger.info(`Global watcher activated (${e})`)):this._logger.error(`Failed to create global watcher (${e})`)}yt(e,t="unknown"){e&&(e.onDidChange(s=>this._t(s,"change",t)),e.onDidCreate(s=>this._t(s,"create",t)),e.onDidDelete(s=>this._t(s,"delete",t)))}_t(e,t,s="unknown"){if(!e||e.scheme!=="file")return;let r=this.Ye(e,`watcher:${t}`);if(!(r!=null&&r.isValid))return;let n=this.lr();if(n<=0){this.os(e,t,s);return}let o=`${e.toString()}:${t}`,a=this.j.get(o);a&&clearTimeout(a.timer);let l=setTimeout(()=>{this.j.delete(o),this.os(e,t,s)},n);this.j.set(o,{timer:l,source:s})}os(e,t,s){var r;t==="delete"?this.clearDecoration(e):this.refreshDecoration(e),(r=this._workspaceIntelligence)!=null&&r.incrementalIndexer&&this._workspaceIntelligence.incrementalIndexer.queueDelta(e,t),this.Gs&&this._logger.debug(`Watcher event processed (${t}) for ${N(e)} via ${s}`)}lr(){if(this._performanceMode)return 0;switch(this.t){case"extreme":return 600;case"large":return 250;default:return 100}}Hs(e){let t=((e==null?void 0:e.added)||[]).map(n=>n.uri).filter(Boolean),s=((e==null?void 0:e.removed)||[]).map(n=>n.uri).filter(Boolean);if(t.length===0&&s.length===0)return;let r=async()=>{if(this._logger.info("Workspace folders changed",{added:t.length,removed:s.length}),await this.checkWorkspaceSize(),!this._performanceMode&&(this.we("workspace-change"),await this.as().catch(n=>{this._logger.debug("Failed to reconfigure progressive loading after workspace change",n)}),this._workspaceIntelligence)){let n=(d.workspace.workspaceFolders||[]).map(o=>({uri:o.uri}));await this._workspaceIntelligence.onWorkspaceFoldersChanged({added:n,removed:s.map(o=>({uri:o}))})}};this.M&&clearTimeout(this.M),this.M=setTimeout(()=>{this.M=null,r().catch(n=>this._logger.debug("Workspace folder change handling failed",n))},250)}Ke(e={}){var s;let t=e.permanent===!0;if((s=this.m)!=null&&s.size){for(let r of this.m)try{r.dispose()}catch(n){this._logger.debug("Failed to dispose file watcher",n)}this.m.clear()}this.G=t?null:void 0,this.Et(),this.ls(!0),this.cr(),this.x="none"}cr(){var e;if((e=this.j)!=null&&e.size){for(let t of this.j.values())clearTimeout(t.timer);this.j.clear()}}or(){if(!this.K||this.H.length>0)return;let e=(s,r)=>{let n=this.Xe(d.window,s,r);n&&this.H.push(n)},t=(s,r)=>{let n=this.Xe(d.workspace,s,r);n&&this.H.push(n)};e("onDidChangeVisibleTextEditors",s=>{(s||[]).forEach(r=>{var n;return this.Ce((n=r==null?void 0:r.document)==null?void 0:n.uri,"visible-editor")})}),e("onDidChangeActiveTextEditor",s=>{var r;this.Ce((r=s==null?void 0:s.document)==null?void 0:r.uri,"active-editor")}),t("onDidOpenTextDocument",s=>{this.Ce(s==null?void 0:s.uri,"open-document")}),t("onDidSaveTextDocument",s=>{this.Ce(s==null?void 0:s.uri,"save-document")}),this.ur(),this.hr()}Et(){var e;if((e=this.H)!=null&&e.length){for(let t of this.H)try{t.dispose()}catch(s){this._logger.debug("Failed to dispose watcher listener",s)}this.H=[]}this.cs()}dr(){if(this._smartWatcherFallbackManager){try{this._smartWatcherFallbackManager.dispose()}catch(e){this._logger.debug("Error disposing smart watcher fallback manager:",e)}this._smartWatcherFallbackManager=null}}ur(){var t;(Array.isArray((t=d.window)==null?void 0:t.visibleTextEditors)?d.window.visibleTextEditors:[]).forEach(s=>{var r;return this.Ce((r=s==null?void 0:s.document)==null?void 0:r.uri,"visible-seed")})}hr(){this.le||(this.le=setInterval(()=>this.ls(),gs))}cs(){this.le&&(clearInterval(this.le),this.le=null)}ls(e=!1){var s;if(!((s=this.h)!=null&&s.size))return;let t=Date.now()-gs;for(let[r,n]of this.h.entries())if(e||n.lastUsed<t){try{n.watcher.dispose()}catch(o){this._logger.debug(`Failed to dispose dynamic watcher for ${r}`,o)}this.h.delete(r)}this.h.size||this.cs()}Ce(e,t="editor"){if(!this.K||!e||e.scheme!=="file"||!G)return;let s=ze.dirname(e.fsPath||"");if(!s)return;let r=I(s),n=this.h.get(r);if(n){n.lastUsed=Date.now();return}this.h.size>=ds&&this.gr();try{let o=new d.RelativePattern(r,"**/*"),a=d.workspace.createFileSystemWatcher(o),l=ze.basename(r)||"root";this.yt(a,`dynamic:${t}:${l}`),this.h.set(r,{watcher:a,lastUsed:Date.now(),source:t})}catch(o){this._logger.debug(`Failed to create dynamic watcher for ${r}`,o)}}gr(){var s;let e=null,t=Number.POSITIVE_INFINITY;for(let[r,n]of this.h.entries())n.lastUsed<t&&(t=n.lastUsed,e=r);if(e){let r=this.h.get(e);try{(s=r==null?void 0:r.watcher)==null||s.dispose()}catch(n){this._logger.debug(`Failed to evict watcher for ${e}`,n)}this.h.delete(e)}}js(){var s,r,n,o;if(this.B.length>0)return;let e=(a,l)=>{let c=this.Xe(d.window,a,l);c&&this.B.push(c)},t=(a,l)=>{let c=this.Xe(d.workspace,a,l);c&&this.B.push(c)};e("onDidChangeVisibleTextEditors",a=>{this.us(a)}),e("onDidChangeActiveTextEditor",a=>{var l;this.Se((l=a==null?void 0:a.document)==null?void 0:l.uri,{reason:"active-editor"})}),t("onDidOpenTextDocument",a=>{this.Se(a==null?void 0:a.uri,{reason:"open-document"})}),t("onDidSaveTextDocument",a=>{this.Se(a==null?void 0:a.uri,{reason:"save-document"})}),this.us(Array.isArray((s=d.window)==null?void 0:s.visibleTextEditors)?d.window.visibleTextEditors:[]),(o=(n=(r=d.window)==null?void 0:r.activeTextEditor)==null?void 0:n.document)!=null&&o.uri&&this.Se(d.window.activeTextEditor.document.uri,{reason:"initial-active"})}pr(){var e;if((e=this.B)!=null&&e.length){for(let t of this.B)try{t.dispose()}catch(s){this._logger.debug("Failed to dispose viewport listener",s)}this.B=[],this.F.clear(),this._.clear()}}us(e){var s;if(this.F.clear(),!Array.isArray(e))return;let t=Date.now();for(let r of e){let n=(s=r==null?void 0:r.document)==null?void 0:s.uri;if(!n||n.scheme!=="file")continue;let o=I(z(n));o&&(this.F.add(o),this._.set(o,t))}this.Ct()}Se(e,t={}){if(!e||e.scheme!=="file")return;let s=I(z(e));if(!s)return;let r=Date.now();this._.set(s,r),t.visible&&this.F.add(s),this._.size>this.Kt?this.Ct(!0):r-this.jt>this.U&&this.Ct()}Ct(e=!1){let t=Date.now(),s=t-this.U*2;for(let[r,n]of this._.entries())(e||n<s||this._.size>this.Kt&&n<t)&&this._.delete(r);this.jt=t}mr(e){if(!e||e.scheme!=="file"||this._performanceMode||this.V==="full")return!0;let t=I(z(e));if(!t||this.F.has(t))return!0;let s=this._.get(t);return s?Date.now()-s<=this.U:!1}async nr(e,t){let s=[],r=d.workspace.getConfiguration("explorerDates"),n=this.wr(r),o=Math.max(1,t.maxPatterns),a=o,l=e.length;for(let c of e){if(a<=0)break;let h=Math.max(1,Math.floor(a/l)),u=await this.br(c,n),f=new d.RelativePattern(c,"*.{md,mdx,json,jsonc,yml,yaml,ts,tsx,js,jsx}");if(s.push({pattern:f,label:`root:${c.name}`}),a-=1,a<=0)break;let m=Math.min(Math.max(h-1,0),a);if(m>0){let y=(await this.yr(c,{excludedSet:u,extensions:t.extensions,limit:m})).slice(0,m);s.push(...y),a-=y.length}l-=1}return s.slice(0,o)}wr(e){let t=new Set,s=e.get("excludedFolders",[]);for(let n of s)this.Je(t,n);return["node_modules",".git",".hg",".svn","dist","build","out",".vscode",".idea",".cache",".parcel-cache",".yarn",".pnpm-store","tmp","temp","coverage",".next","logs","old-builds"].forEach(n=>this.Je(t,n)),t}async br(e,t){var r;let s=new Set(t);if(!e||!((r=this._workspaceIntelligence)!=null&&r.smartExclusion))return s;try{let n=await this._workspaceIntelligence.smartExclusion.getCombinedExclusions(e.uri),o=(n==null?void 0:n.folders)||[],a=(n==null?void 0:n.patterns)||[];for(let l of o)this.Je(s,l,{onlyRootSegment:!0});for(let l of a)this.Je(s,l,{onlyRootSegment:!0});(o.length||a.length)&&this._logger&&s.size>t.size&&this._logger.debug("Merged smart exclusion hints for watcher setup",{workspace:e.name,totalExclusions:s.size})}catch(n){this._logger.debug("Failed to merge smart exclusion data for watcher setup",n)}return s}Je(e,t,s={}){if(!t)return;let{onlyRootSegment:r=!1}=s,n=typeof t=="string"?t:typeof(t==null?void 0:t.toString)=="function"?t.toString():"";if(!n||typeof n!="string")return;let o=n.trim();if(!o)return;let l=o.replace(/\\/g,"/").replace(/\*\*/g,"").replace(/\*/g,"").split("/").map(c=>c.trim()).filter(Boolean);if(!l.length){if(o.includes("*")||o.includes("?"))return;e.add(o.toLowerCase());return}if(r){e.add(l[0].toLowerCase());return}for(let c of l)e.add(c.toLowerCase())}Er(e=[]){if(!Array.isArray(e))return[];let t=new Set,s=[];for(let r of e)!r||t.has(r)||(t.add(r),s.push(r));return s}hs(e=[]){let t=Array.isArray(e)?e:e?[e]:[],s=[];for(let r of t){if(!r||typeof r!="string")continue;let n=r.trim().replace(/^['"]|['"]$/g,"");if(!n)continue;let o=I(n);o?s.push(o):this._logger.debug(`Ignored invalid security path entry: ${r}`)}return s}ds(e,t){if(!(!e||typeof e.inspect!="function"))try{let s=e.inspect(t);if(!s||typeof s!="object")return;let r=[s.workspaceFolderValue,s.workspaceValue,s.globalValue];for(let n of r)if(typeof n=="boolean")return n;return}catch{return}}_r(){let e=process.env[ei];if(!e||typeof e!="string")return[];let t=G&&G.delimiter||(process.platform==="win32"?";":":");return e.split(t).map(s=>s.trim()).filter(Boolean)}Cr(){return process.env.EXPLORER_DATES_TEST_MODE==="1"||process.env.NODE_ENV==="test"||process.env.VSCODE_TEST==="1"}ss(e){let t=e||d.workspace.getConfiguration("explorerDates"),s=t.get("security.allowTestPaths",!0),r=t.get("security.allowedExtraPaths",[]);this.ze=us();let n=this.ds(t,"security.enableBoundaryEnforcement"),o=this.ds(t,"security.enforceWorkspaceBoundaries"),a;typeof n=="boolean"?a=n:typeof o=="boolean"?a=o:a=this.ze==="production";let l=this.hs(r),c=this.hs(this._r());this.ct=this.Er([...l,...c]),this.qt=a!==!1,this.Yt=s!==!1,this.ut=this.Yt&&(this.ze==="test"||this.Cr()),this.ut&&!this.Xt&&(this._logger.warn("Security workspace boundary enforcement relaxed (test environment detected)"),this.Xt=!0);let h=t.get("security.logThrottleWindowMs"),u=t.get("security.maxWarningsPerFile"),f=Number.isFinite(h)?Math.max(0,h):Number.isFinite(mt)?Math.max(0,mt):5e3;this.Ue=f;let m=Number.isFinite(_e)&&_e>=0?_e:1;Number.isFinite(u)&&u>=0?this.he=u:this.he=m}Sr(){let e=d.workspace.workspaceFolders||[],t=[],s=new Set,r=n=>{if(!n)return;let o=I(n);!o||s.has(o)||(s.add(o),t.push(o))};return e.forEach(n=>{try{r(z(n.uri))}catch{}}),Array.isArray(this.ct)&&this.ct.forEach(n=>r(n)),t}vr(e){if(!e)return!1;let t=Date.now(),s=this.ue.get(e)||{lastTimestamp:0,count:0};if(typeof this.he=="number"&&this.he>=0&&s.count>=this.he||typeof this.Ue=="number"&&this.Ue>0&&t-s.lastTimestamp<this.Ue)return!0;if(s.lastTimestamp=t,s.count=(s.count||0)+1,this.ue.set(e,s),this.ue.size>ti){let r=Array.from(this.ue.keys()),n=Math.ceil(r.length*.25);for(let o=0;o<n;o++)this.ue.delete(r[o])}return!1}gs(e,t,s={},r={}){let n=`${e}:${t}`;if(this.vr(n))return;let o=this.ze||"production",a=o==="production"?r.level||"warn":o==="development"?"info":"debug";(typeof this._logger[a]=="function"?this._logger[a].bind(this._logger):this._logger.warn.bind(this._logger))(`${e}: ${t}`,{environment:o,...s})}kr(e){let t="";if(typeof e=="string")t=e;else if(e&&(t=e.fsPath||e.path||"",!t&&typeof e.toString=="function"))try{t=e.toString(!0)}catch{t=e.toString()}return jr.sanitizePath(t||"",{preserveExtension:!0})||"unknown"}Ye(e,t="operation"){var a;if(!e)return{isValid:!1,issue:"Missing URI"};let s=this.Sr(),r=this.qt&&!this.ut&&s.length>0,n=qr.validateFileUri(e,r?s:[]),o=this.kr(e);return n.isValid?(a=n.warnings)!=null&&a.length&&this.gs(`Security warnings for ${t}`,o,{warnings:n.warnings,enforceBoundaries:r},{level:"info"}):this.gs(`Security validation blocked ${t}`,o,{issue:n.issue,enforceBoundaries:r}),n}async yr(e,t){if(t.limit<=0)return[];let s=[];try{s=await this._fileSystem.readdir(e.uri,{withFileTypes:!0})}catch(o){return this._logger.debug(`Failed to read workspace folder ${e.name}`,o),[]}let r=[];for(let o of s){if(!o.isDirectory())continue;let a=o.name.toLowerCase();if(this.Dr(a,t.excludedSet))continue;let l=Xr.get(a)||(a.startsWith(".")?1:10);r.push({name:o.name,score:l})}return r.sort((o,a)=>a.score-o.score),r.slice(0,t.limit).map(o=>({pattern:new d.RelativePattern(e,this.Tr(o.name,t.extensions)),label:`dir:${e.name}/${o.name}`}))}Dr(e,t){return!!(!e||t.has(e)||e.startsWith("."))}Tr(e,t){return!t||t.length===0?`${e}/**/*`:t.length===1?`${e}/**/*.${t[0]}`:`${e}/**/*.{${t.join(",")}}`}sr(e){let t=Array.isArray(e)&&e.length>0?e:ps;return Array.from(new Set(t.map(s=>(s||"").toString().trim().replace(/^\./,"").toLowerCase()).filter(Boolean)))}rr(e){let t=Math.max(1,Math.min(e,ds)),s=this.Fr();return s?Math.min(t,s):t}Fr(){switch(this.t){case"extreme":return 8;case"large":return 14;default:return null}}P(){let e=d.workspace.getConfiguration("explorerDates"),t=e.get("badgeRefreshInterval",6e4),s=this.v||t;if(this.O=s,this._logger.info(`Setting up periodic refresh with interval: ${this.O}ms`),this.w&&(clearInterval(this.w),this.w=null),this.Q(),!e.get("showDateDecorations",!0)){this._logger.info("Decorations disabled, skipping periodic refresh setup");return}this.w=setInterval(()=>{if(this.me){this._logger.debug("Periodic refresh skipped - incremental refresh already running");return}this._logger.debug("Periodic refresh triggered - scheduling incremental refresh"),this.Ar("periodic")},this.O),this._logger.info("Periodic refresh timer started")}xr(e,t){if(t!=null&&t.uri)return t.uri;if(!e)return null;try{return d.Uri.file(e)}catch(s){return this._logger.debug(`Failed to rebuild URI from cache key: ${e}`,s),null}}Q(){var e;if((e=this.q)!=null&&e.size){for(let t of this.q)clearTimeout(t);this.q.clear()}this.me=!1}Ar(e="manual"){if(this.pt){this._logger.debug(`Incremental refresh (${e}) skipped - refresh already pending`);return}this.me&&(this._logger.debug(`Incremental refresh (${e}) already in progress, cancelling pending timers and rescheduling`),this.Q());let t=Array.from(this.e.entries());if(t.length===0){this._logger.debug(`No cached decorations to refresh for ${e}, falling back to global refresh`),this.f.fire(void 0);return}let s=t.map(([l,c])=>{let h=this.xr(l,c);return h?{cacheKey:l,uri:h}:null}).filter(Boolean);if(s.length===0){this._logger.debug(`Failed to resolve URIs for ${e} incremental refresh, firing global refresh`),this.f.fire(void 0);return}let r=40,n=Math.ceil(s.length/r),o=Math.min(4e3,Math.max(750,Math.floor(this.O*.25))),a=n>1?Math.max(25,Math.floor(o/n)):0;this.me=!0,this.pt=!0,this._logger.debug(`Incremental refresh (${e}) scheduled for ${s.length} items in ${n} batches (spacing: ${a}ms)`);for(let l=0;l<n;l++){let c=s.slice(l*r,(l+1)*r),h=l===0?0:a*l,u=setTimeout(()=>{try{c.forEach(({cacheKey:f,uri:m})=>{this.Mr(f),this.f.fire(m)})}finally{this.q.delete(u),this.q.size===0&&(this.me=!1,this.pt=!1,this._logger.debug(`Incremental refresh (${e}) completed`))}},h);this.q.add(u)}}Mr(e){if(!e)return;let t=this.e.get(e);if(t){let s=Date.now()-t.timestamp;s>this.c*.75?(t.forceRefresh=!0,this._logger.debug(`Marked stale entry for refresh: ${e} (age: ${Math.round(s/1e3)}s)`)):this._logger.debug(`Skipped refresh for fresh entry: ${e} (age: ${Math.round(s/1e3)}s, threshold: ${Math.round(this.c*.75/1e3)}s)`)}if(this._advancedCache)try{let s=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this._advancedCache.invalidateByPattern(s)}catch(s){this._logger.debug(`Could not invalidate advanced cache for ${e}: ${s.message}`)}}Ks(){this.r&&this.r.dispose(),this.r=d.workspace.onDidChangeConfiguration(async e=>{if(e.affectsConfiguration("explorerDates")){this._logger.debug("Configuration changed, updating settings");let t=d.workspace.getConfiguration("explorerDates"),s=t.get("cacheTimeout",Ue);this.mt=this.Jt(t,s),this.c=this.Zt(s),this.s=t.get("maxCacheSize",1e4);let r=this.ts(t);if(e.affectsConfiguration("explorerDates.performanceMode")){let l=t.get("performanceMode",!1);l!==this.Be&&(this.Be=l,await this.ps(this.ms(),{reason:"configuration-change"}),this.Y(this.X(t),"performance-mode-change"))}e.affectsConfiguration("explorerDates.featureLevel")&&this.Y(this.X(t),"configuration-change"),e.affectsConfiguration("explorerDates.badgeRefreshInterval")&&(this.O=t.get("badgeRefreshInterval",6e4),this._logger.info(`Badge refresh interval updated to: ${this.O}ms`),this._performanceMode||this.P());let n=e.affectsConfiguration("explorerDates.showDateDecorations")||e.affectsConfiguration("explorerDates.dateDecorationFormat")||e.affectsConfiguration("explorerDates.excludedFolders")||e.affectsConfiguration("explorerDates.excludedPatterns")||e.affectsConfiguration("explorerDates.highContrastMode")||e.affectsConfiguration("explorerDates.fadeOldFiles")||e.affectsConfiguration("explorerDates.fadeThreshold")||e.affectsConfiguration("explorerDates.colorScheme")||e.affectsConfiguration("explorerDates.showGitInfo")||e.affectsConfiguration("explorerDates.customColors")||e.affectsConfiguration("explorerDates.showFileSize")||e.affectsConfiguration("explorerDates.fileSizeFormat")||e.affectsConfiguration("explorerDates.featureLevel");(e.affectsConfiguration("explorerDates.security.enforceWorkspaceBoundaries")||e.affectsConfiguration("explorerDates.security.allowedExtraPaths")||e.affectsConfiguration("explorerDates.security.allowTestPaths"))&&this.ss(t),(e.affectsConfiguration("explorerDates.decorationPoolSize")||e.affectsConfiguration("explorerDates.flyweightCacheSize"))&&this.rs(t),(n||r)&&this.refreshAll({preservePersistentCache:!0,reason:n?"configuration-change":"namespace-change"});let a=e.affectsConfiguration("explorerDates.smartFileWatching")||e.affectsConfiguration("explorerDates.smartWatcherMaxPatterns")||e.affectsConfiguration("explorerDates.smartWatcherExtensions")||e.affectsConfiguration("explorerDates.excludedFolders")||e.affectsConfiguration("explorerDates.smartExclusions");!this._performanceMode&&a&&this.we("configuration-change"),e.affectsConfiguration("explorerDates.progressiveLoading")&&this.as().catch(l=>{this._logger.error("Failed to reconfigure progressive loading",l)}),(e.affectsConfiguration("explorerDates.autoThemeAdaptation")||e.affectsConfiguration("explorerDates.accessibilityMode"))&&(this._logger.debug("UI adapters configuration changed, reloading..."),await this.Xs()),e.affectsConfiguration("explorerDates.showDateDecorations")&&!this._performanceMode&&this.P()}})}Jt(e,t){if(typeof t=="number"&&t!==Ue)return!0;if(!e||typeof e.inspect!="function")return!1;try{let s=e.inspect("cacheTimeout");if(!s)return!1;if(typeof s=="object"&&(typeof s.globalValue=="number"||typeof s.workspaceValue=="number"||typeof s.workspaceFolderValue=="number"))return!0;if(s.cacheTimeout&&typeof s.cacheTimeout=="object"){let r=s.cacheTimeout;if(typeof r.globalValue=="number"||typeof r.workspaceValue=="number"||typeof r.workspaceFolderValue=="number"){let o=r.globalValue??r.workspaceValue??r.workspaceFolderValue;return typeof o=="number"&&o!==Ue}}}catch{return!1}return!1}Zt(e){return this._isWeb||this.mt?e:Math.max(this.at,e||this.at)}async Wi(){let e=await this._e();return e!=null&&e.loadBatchProcessorIfNeeded?e.loadBatchProcessorIfNeeded(this):null}async as(){let e=await this._e();if(e!=null&&e.applyProgressiveLoadingSetting)return e.applyProgressiveLoadingSetting(this);this._progressiveLoadingEnabled=!1,this.ws()}ws(){var e;if((e=this.ae)!=null&&e.cancelProgressiveWarmupJobs){this.ae.cancelProgressiveWarmupJobs(this);return}if(this._batchProcessor)for(let t of this._progressiveLoadingJobs)this._batchProcessor.cancelBatch(t);this._progressiveLoadingJobs.clear()}refreshDecoration(e){if(!e)return;let t=this.Ye(e,"refreshDecoration");if(!(t!=null&&t.isValid))return;let s=this.St(e);if(this.e.delete(s),this._advancedCache)try{this._advancedCache.invalidateByPattern(s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))}catch(r){this._logger.debug(`Could not invalidate advanced cache for ${N(e)}: ${r.message}`)}this.f.fire(e),this._logger.debug(`\u{1F504} Refreshed decoration cache for: ${N(e)}`)}clearDecoration(e){if(!e)return;let t=this.Ye(e,"clearDecoration");if(!(t!=null&&t.isValid))return;let s=this.St(e);this.e.delete(s),this._advancedCache&&this._logger.debug(`Advanced cache entry will expire naturally: ${N(e)}`),this.f.fire(e),this._logger.debug(`\u{1F5D1}\uFE0F Cleared decoration cache for: ${N(e)}`)}clearAllCaches(){this.Q();let e=this.e.size;this.e.clear(),this.Z("clearAllCaches"),this._logger.info(`Cleared memory cache (was ${e} items)`),this._advancedCache&&(this._advancedCache.clear(),this._logger.info("Cleared advanced cache")),this._metrics.cacheHits=0,this._metrics.cacheMisses=0,this._logger.info("All caches cleared successfully")}refreshAll(e={}){let{preservePersistentCache:t=!1,reason:s="manual-refresh"}=e;this.Q(),this.e.clear(),this.Z("refreshAll"),this.i&&this.i.clearCache(),this._advancedCache&&(t&&typeof this._advancedCache.resetRuntimeOnly=="function"?this._advancedCache.resetRuntimeOnly():this._advancedCache.clear()),this.f.fire(void 0);let r=t?" (persistent cache preserved)":"";this._logger.info(`All decorations refreshed (${s})${r}`)}async Rr(e){let t=d.workspace.getConfiguration("explorerDates"),s=z(e);if(!s)return!1;let r=I(s),n=wt(r),o=Ne(s),a=t.get("forceShowForFileTypes",[]);if(a.length>0&&a.includes(o))return this._logger.debug(`File type ${o} is forced to show: ${s}`),!1;let l=t.get("enableTroubleShootingMode",!1);l&&this._logger.info(`\u{1F50D} Checking exclusion for: ${n} (ext: ${o})`);let c=t.get("excludedFolders",["node_modules",".git","dist","build","out",".vscode-test"]),h=t.get("excludedPatterns",["**/*.tmp","**/*.log","**/.git/**","**/node_modules/**"]);for(let u of c){let f=u.replace(/^\/+|\/+$/g,"");if(r.includes(`/${f}/`)||r.endsWith(`/${f}`))return l?this._logger.info(`\u274C File excluded by folder: ${s} (${u})`):this._logger.debug(`File excluded by folder: ${s} (${u})`),!0}for(let u of h)if(u.includes("node_modules")&&r.includes("/node_modules/")||u.includes(".git/**")&&r.includes("/.git/")||u.includes("*.tmp")&&n.endsWith(".tmp")||u.includes("*.log")&&n.endsWith(".log"))return!0;return l&&this._logger.info(`\u2705 File NOT excluded: ${n} (ext: ${o})`),!1}async $i(e){var a;let t=d.workspace.getConfiguration("explorerDates"),s=z(e);if(!s)return!1;let r=I(s),n=wt(r),o=d.workspace.getWorkspaceFolder(e);if(o){let l=(a=this._workspaceIntelligence)!=null&&a.smartExclusion?await this._workspaceIntelligence.smartExclusion.getCombinedExclusions(o.uri):null;for(let c of l.folders)if(new RegExp(`(^|/)${c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(/|$)`).test(r))return this._logger.debug(`File excluded by folder rule: ${s} (folder: ${c})`),!0;for(let c of l.patterns){let h=c.replace(/\*\*/g,".*").replace(/\*/g,"[^/\\\\]*").replace(/\?/g,"."),u=new RegExp(h);if(u.test(r)||u.test(n))return this._logger.debug(`File excluded by pattern: ${s} (pattern: ${c})`),!0}}else{let l=t.get("excludedFolders",[]),c=t.get("excludedPatterns",[]);for(let h of l)if(new RegExp(`(^|/)${h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(/|$)`).test(r))return!0;for(let h of c){let u=h.replace(/\*\*/g,".*").replace(/\*/g,"[^/\\\\]*").replace(/\?/g,"."),f=new RegExp(u);if(f.test(r)||f.test(n))return!0}}return!1}Lr(){if(this.e.size<=this.s)return;let e=this.e.enforceLimit(this.s,this._logger);e>0&&(this._metrics.cacheEvictions+=e)}Or(){if(this._isWeb||this.mt)return;let e=this._metrics.cacheHits+this._metrics.cacheMisses;if(e<200)return;let t=this._metrics.cacheHits/e;if(t<.9||this.c>=this.Vt||e<=this.lt||e-this.lt<100)return;let r=this.c;this.c=Math.min(this.c+as,this.Vt),this.lt=e,this._logger.info("\u2699\uFE0F Cache timeout extended (max 8min)",{previousTimeout:r,newTimeout:this.c,hitRate:Number(t.toFixed(2)),totalLookups:e})}async Pr(e,t){if(this.Ie)return this._logger.debug(`\u26A0\uFE0F Cache bypass enabled - recalculating decoration for: ${t}`),null;if(this._advancedCache)try{let r=await this._advancedCache.get(e);if(r)return this._metrics.cacheHits++,this._logger.debug(`\u{1F9E0} Advanced cache hit for: ${t}`),r}catch(r){this._logger.debug(`Advanced cache error: ${r.message}`)}let s=this.e.get(e);if(s){if(s.forceRefresh)this.e.delete(e),this._logger.debug(`\u{1F6AB} Memory cache bypassed (forced refresh) for: ${t}`);else if(Date.now()-s.timestamp<this.c)return this._metrics.cacheHits++,this._logger.debug(`\u{1F4BE} Memory cache hit for: ${t}`),s.decoration}return null}async Ir(e,t,s,r){if(this.Ie)return;this.Lr();let n={decoration:t,timestamp:Date.now()};if(r&&(n.uri=r),this.e.set(e,n),this.Wr(),this._advancedCache)try{await this._advancedCache.set(e,t,{ttl:this.c}),this._logger.debug(`\u{1F9E0} Stored in advanced cache: ${s}`)}catch(o){this._logger.debug(`Failed to store in advanced cache: ${o.message}`)}this.Or()}bs(e,t,s,r,n,o){if(!this.Re||!r)return o&&(o.misses++,o.allocations++),n();if(e.has(r))return o&&(o.hits++,o.reuses++),e.get(r);o&&(o.misses++,o.allocations++);let a=n();if(e.set(r,a),t.push(r),t.length>s){let l=t.shift();l&&e.delete(l)}return a}zt(){try{let e=process!=null&&process.memoryUsage?process.memoryUsage().heapUsed:0;return Number((e/1024/1024).toFixed(2))}catch{return 0}}ys(){try{let e=process!=null&&process.memoryUsage?process.memoryUsage().rss:0;return Number((e/1024/1024).toFixed(2))}catch{return 0}}$r(){if(!this.Le||this.Pe)return;let e=this.zt();if(!e)return;if(!this.ne){this.ne=e,this.J=0,this.be=!1;return}let t=e-this.ne;if(t>=this.Ge?(this.J++,this.J>=2&&!this.be&&(this.be=!0,this._logger.warn("Memory pressure warning (soft threshold exceeded twice)",{deltaMB:Number(t.toFixed(2)),baselineMB:this.ne,heapMB:e,rssMB:this.ys(),cacheSize:this.e.size,cacheLimit:this.s}))):this.J>0&&(this.J=0,t<this.Ge*.5&&(this.be=!1)),t>=this.Oe){this.Pe=!0,this.s=Math.min(this.s,this.Vs),this.v=Math.max(this.v||this.O||this.Ut,this.Ut);let s=this.ys(),r={timestamp:new Date().toISOString(),deltaMB:Number(t.toFixed(2)),baselineMB:this.ne,heapMB:e,rssMB:s,cacheSize:this.e.size,maxCacheSize:this.s,watcherStrategy:this.x,staticWatchers:this.m.size,dynamicWatchers:this.h.size};this.Ve.push(r),this.Ve.length>10&&this.Ve.shift(),this._logger.warn(`Memory shedding activated (delta ${t.toFixed(2)} MB >= ${this.Oe} MB); cache size capped at ${this.s} and refresh interval stretched to ${this.v}ms`,r),this.P(),this.be=!1,this.J=0}}Wr(){if(!this.s||this.s<=0)return;let e=this.e.size/this.s;e>=this.wt?this.He||(this.He=!0,this._logger.infoWithOptions({throttleKey:"cache-pressure",intervalMs:6e4},`Decoration cache usage is at ${(e*100).toFixed(1)}% of capacity`,{cacheSize:this.e.size,maxCacheSize:this.s})):e<this.wt*.5&&(this.He=!1)}Nr({badge:e,tooltip:t,color:s}){if(!this.Me){this.a.misses++,this.a.allocations++;let o=new d.FileDecoration(e||"??");return t&&(o.tooltip=t),s&&(o.color=s),o.propagate=!1,o}if(!e)return this.a.allocations++,new d.FileDecoration("??");let r=this.zr(e,t,s);if(r&&this.S.has(r))return this.a.hits++,this.a.reuses++,this.S.get(r);let n=new d.FileDecoration(e);if(t&&(n.tooltip=t),s&&(n.color=s),n.propagate=!1,this.a.allocations++,r&&(this.S.set(r,n),this.T.push(r),this.T.length>this.W)){let o=this.T.shift();o&&o!==r&&this.S.delete(o)}return this.a.misses++,n}zr(e,t,s){let r=e||"",n=t||"",o=this.Ur(s);return`${r}::${o}::${n}`}Ur(e){if(!e)return"none";if(typeof e=="string")return e;if(e.id)return e.id;try{return JSON.stringify(e)}catch{return String(e)}}Z(e="unspecified"){this.S.size!==0&&(this.S.clear(),this.T.length=0,this._logger.debug(`\u{1F9FC} Cleared decoration pool (${e})`))}rs(e){let t=e!=null&&e.get?e.get("decorationPoolSize"):void 0,s=e!=null&&e.get?e.get("flyweightCacheSize"):void 0,r=this.Es(t,ls,128,8192),n=this.Es(s,dt,512,16384),o=r!==this.W,a=n!==this.it||n!==this.ot;return o&&(this.W=r,this.Br(),this._logger.info(`Decoration pool capacity set to ${r}`)),a&&(this.it=n,this.ot=n,this._s(this.re,this.rt,n,"badge"),this._s(this.ie,this.nt,n,"readable"),this._logger.info(`Flyweight cache capacity set to ${n}`)),{poolChanged:o,flyweightChanged:a}}Es(e,t,s,r){if(typeof e!="number"||!Number.isFinite(e))return Math.min(Math.max(t,s),r);let n=Math.floor(e);return n<s?s:n>r?r:n}Br(){if(!(this.T.length<=this.W)){for(;this.T.length>this.W;){let e=this.T.shift();e&&this.S.delete(e)}this._logger.debug(`Trimmed decoration pool to ${this.W} entries`)}}_s(e,t,s,r){if(!(!e||!t)&&!(t.length<=s)){for(;t.length>s;){let n=t.shift();n&&e.delete(n)}this._logger.debug(`Trimmed ${r} flyweight cache to ${s} entries`)}}Cs(e="lightweight"){this.E&&(this.e.size>0&&this.e.clear(),this.Z(e),this.re.size>0&&(this.re.clear(),this.rt.length=0),this.ie.size>0&&(this.ie.clear(),this.nt.length=0),this._logger.debug(`\u{1F9FD} Purged lightweight caches (${e})`))}Vr(){var t;if(!this.E)return;if(this.Bt<=0){this.Cs("lightweight-interval-disabled");return}let e=((t=this._metrics)==null?void 0:t.totalDecorations)||0;e>0&&e%this.Bt===0&&this.Cs("lightweight-interval")}Gr({formatType:e,diffMinutes:t,diffHours:s,diffDays:r,diffWeeks:n,diffMonths:o,date:a}){let l=(c,h=null)=>({value:c,key:h?`badge:${e||"default"}:${h}`:null});switch(e){case"relative-short":case"relative-long":return t<1?l("\u25CF\u25CF","just"):t<60?l(`${Math.min(t,99)}m`,`m:${Math.min(t,99)}`):s<24?l(`${Math.min(s,23)}h`,`h:${Math.min(s,23)}`):r<7?l(`${r}d`,`d:${r}`):n<4?l(`${n}w`,`w:${n}`):o<12?l(`${o}M`,`M:${o}`):l("1y","y:1");case"absolute-short":case"absolute-long":{let c=a.getDate(),h=`${Gr[a.getMonth()]}${c<10?"0"+c:c}`,u=[a.getMonth(),c];return e==="absolute-long"&&u.push(a.getFullYear()),l(h,`abs:${u.join("-")}`)}case"technical":return t<60?l(`${t}m`,`tech:m:${t}`):s<24?l(`${s}h`,`tech:h:${s}`):l(`${r}d`,`tech:d:${r}`);case"minimal":return s<1?l("\u2022\u2022","min:now"):s<24?l("\u25CB\u25CB","min:hours"):l("\u2500\u2500","min:days");default:return t<60?l(`${t}m`,`smart:m:${t}`):s<24?l(`${s}h`,`smart:h:${s}`):l(`${r}d`,`smart:d:${r}`)}}Ss(e,t,s=null){let n=s!==null?s:new Date().getTime()-e.getTime();if(n<0)return this._logger.debug(`File has future modification time (diffMs: ${n}), treating as just modified`),"\u25CF\u25CF";let o=Math.floor(n/(1e3*60)),a=Math.floor(n/(1e3*60*60)),l=Math.floor(n/(1e3*60*60*24)),c=Math.floor(l/7),h=Math.floor(l/30),u=this.Gr({formatType:t,diffMinutes:o,diffHours:a,diffDays:l,diffWeeks:c,diffMonths:h,date:e});return this.bs(this.re,this.rt,this.it,u.key,()=>u.value,this.$)}ve(e,t="auto"){return Ur(e,t)}Hr(e,t,s,r,n){let o=e.toDateString()===t.toDateString();return s<1?{key:"readable:just",factory:()=>this.A.getString("justNow")}:s<60?{key:`readable:minutes:${s}`,factory:()=>this.A.getString("minutesAgo",s)}:r<24&&o?{key:`readable:hours:${r}`,factory:()=>this.A.getString("hoursAgo",r)}:n<7?n===1?{key:"readable:yesterday",factory:()=>this.A.getString("yesterday")}:{key:`readable:days:${n}`,factory:()=>this.A.getString("daysAgo",n)}:null}Kr(e,t,s=""){if(t==="none")return;let n=new Date().getTime()-e.getTime(),o=Math.floor(n/(1e3*60*60)),a=Math.floor(n/(1e3*60*60*24));switch(t){case"recency":return o<1?new d.ThemeColor("charts.green"):o<24?new d.ThemeColor("charts.yellow"):new d.ThemeColor("charts.red");case"file-type":{let l=Ne(s);return[".js",".ts",".jsx",".tsx"].includes(l)?new d.ThemeColor("charts.blue"):[".css",".scss",".less"].includes(l)?new d.ThemeColor("charts.purple"):[".html",".htm",".xml"].includes(l)?new d.ThemeColor("charts.orange"):[".json",".yaml",".yml"].includes(l)?new d.ThemeColor("charts.green"):[".md",".txt",".log"].includes(l)?new d.ThemeColor("charts.yellow"):[".py",".rb",".php"].includes(l)?new d.ThemeColor("charts.red"):new d.ThemeColor("editorForeground")}case"subtle":return o<1?new d.ThemeColor("editorInfo.foreground"):a<7?new d.ThemeColor("editorWarning.foreground"):new d.ThemeColor("editorError.foreground");case"vibrant":return o<1?new d.ThemeColor("terminal.ansiGreen"):o<24?new d.ThemeColor("terminal.ansiYellow"):a<7?new d.ThemeColor("terminal.ansiMagenta"):new d.ThemeColor("terminal.ansiRed");case"custom":return o<1?new d.ThemeColor("explorerDates.customColor.veryRecent"):o<24?new d.ThemeColor("explorerDates.customColor.recent"):new d.ThemeColor("explorerDates.customColor.old");default:return}}jr({filePath:e,stat:t,diffMs:s,dateFormat:r,badgePriority:n,showFileSize:o,fileSizeFormat:a,gitBlame:l,showGitInfo:c}){let h=this.Ss(t.mtime,r,s),u=this.vs(t.mtime),f=this.vs(t.birthtime),m=h;if(this._logger.debug(`\u{1F3F7}\uFE0F Badge generation for ${N(e)}: badgePriority=${n}, showGitInfo=${c}, hasGitBlame=${!!l}, authorName=${l==null?void 0:l.authorName}, previewMode=${!!this.n}`),n==="author"&&(l!=null&&l.authorName)){let w=this.qr(l.authorName);w&&(m=w,this._logger.debug(`\u{1F3F7}\uFE0F Using author initials badge: "${w}" (from ${l.authorName})`))}else if(n==="size"&&o){let w=this.Yr(t.size);w&&(m=w,this._logger.debug(`\u{1F3F7}\uFE0F Using size badge: "${w}"`))}else this._logger.debug(`\u{1F3F7}\uFE0F Using time badge: "${h}" (badgePriority=${n})`);return{badge:h,displayBadge:m,readableModified:u,readableCreated:f,fileSizeLabel:o?this.ve(t.size,a):null}}async Xr({filePath:e,resourceUri:t,stat:s,badgeDetails:r,gitBlame:n,shouldUseAccessibleTooltips:o,fileSizeFormat:a,isCodeFile:l}){var m,w;let c=N(e),h=Ne(e);if(o){let y=(w=(m=this._accessibility)==null?void 0:m.getAccessibleTooltip)==null?void 0:w.call(m,e,s.mtime,s.birthtime,s.size,n);if(y)return this._logger.info(`\u{1F50D} Using accessible tooltip (${y.length} chars): "${y.substring(0,50)}..."`),y;this._logger.info("\u{1F50D} Accessible tooltip generation failed, using rich tooltip")}let u=`\u{1F4C4} File: ${c}
`;u+=`\u{1F4DD} Last Modified: ${r.readableModified}
`,u+=`   ${this.vt(s.mtime)}

`,u+=`\u{1F4C5} Created: ${r.readableCreated}
`,u+=`   ${this.vt(s.birthtime)}

`;let f=r.fileSizeLabel||this.ve(s.size,a||"auto");if(u+=`\u{1F4CA} Size: ${f} (${s.size.toLocaleString()} bytes)
`,h&&(u+=`\u{1F3F7}\uFE0F Type: ${h.toUpperCase()} file
`),l)try{let y=t||e,O=(await this._fileSystem.readFile(y,"utf8")).split(`
`).length;u+=`\u{1F4CF} Lines: ${O.toLocaleString()}
`}catch{}return u+=`\u{1F4C2} Path: ${e}`,n&&(u+=`

\u{1F464} Last Modified By: ${n.authorName}`,n.authorEmail&&(u+=` (${n.authorEmail})`),n.authorDate&&(u+=`
   ${n.authorDate}`)),u}Jr({filePath:e,stat:t,badgeDetails:s}){let r=[];s!=null&&s.readableModified&&r.push(`Modified ${s.readableModified}`);let n=(s==null?void 0:s.fileSizeLabel)||(t!=null&&t.size?this.ve(t.size,"auto"):null);return n&&r.push(n),`${N(e)} \u2014 ${r.filter(Boolean).join(" \u2022 ")||this.vt((t==null?void 0:t.mtime)||new Date)}`}vs(e){let t=new Date,s=t.getTime()-e.getTime(),r=Math.floor(s/(1e3*60)),n=Math.floor(s/(1e3*60*60)),o=Math.floor(s/(1e3*60*60*24)),a=this.Hr(e,t,r,n,o);return a?this.bs(this.ie,this.nt,this.ot,a.key,a.factory,this.N):e.getFullYear()===t.getFullYear()?this.A.formatDate(e,{month:"short",day:"numeric"}):this.A.formatDate(e,{month:"short",day:"numeric",year:"numeric"})}async Zr(e,t=null){if(hs)return null;let s=await this.Ys();if(!s||typeof s.getGitBlameInfo!="function")return null;try{return await s.getGitBlameInfo(e,t)}catch(r){return this._logger.warn("Git blame lookup failed",{filePath:e,message:(r==null?void 0:r.message)||String(r)}),null}}qr(e){if(this.i)return this.i.getInitials(e);if(!e||typeof e!="string")return null;let t=e.trim().split(/\s+/).filter(Boolean);return t.length===0?null:t.length===1?t[0].substring(0,2).toUpperCase():(t[0][0]+(t[1][0]||"")).substring(0,2).toUpperCase()}Yr(e){if(typeof e!="number"||isNaN(e))return null;let t=["B","K","M","G","T"],s=0,r=e;for(;r>=1024&&s<t.length-1;)r=r/1024,s++;let n=Math.round(r),o=t[s];if(n<=9)return`${n}${o}`;let a=String(n);return a.length>=2?a.slice(0,2):a}vt(e){let t={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"};return e.toLocaleString("en-US",t)}St(e){let t=Br(z(e));return this.z?`${this.z}${ft}${t}`:t}Qr(e){if(!e||typeof e!="string")return e;let t=e.indexOf(ft);return t===-1?e:e.slice(t+ft.length)}ei(e){let t=typeof e=="string"?e:JSON.stringify(e),s=0;for(let r=0;r<t.length;r++)s=(s<<5)-s+t.charCodeAt(r),s|=0;return Math.abs(s).toString(16)}ti(e){try{let t=e||d.workspace.getConfiguration("explorerDates"),s={dateDecorationFormat:t.get("dateDecorationFormat","smart"),showGitInfo:t.get("showGitInfo",!0),showFileSize:t.get("showFileSize",!1),fileSizeFormat:t.get("fileSizeFormat","auto"),colorScheme:t.get("colorScheme","recency"),highContrastMode:t.get("highContrastMode",!1),fadeOldFiles:t.get("fadeOldFiles",!1),fadeThreshold:t.get("fadeThreshold",72),badgePriority:t.get("badgePriority","time"),showDateDecorations:t.get("showDateDecorations",!0),excludedFolders:(t.get("excludedFolders",[])||[]).join("|"),excludedPatterns:(t.get("excludedPatterns",[])||[]).join("|"),customColors:JSON.stringify(t.get("customColors",{})),metadataVersion:2};return`ns-${this.ei(s).slice(0,8)}`}catch(t){return this._logger.debug(`Failed to build cache namespace: ${t.message}`),"ns-default"}}ts(e){let t=this.ti(e);if(t&&t!==this.z){let s=this.z;return this.z=t,this._logger.info(`Cache namespace updated (${s||"unset"} \u2192 ${t})`),!0}return!1}si(e){return e?e.code==="ENOENT"?!0:typeof e.message=="string"&&e.message.includes("ENOENT"):!1}async ri(){return this.y<this.p?(this.y++,()=>this.ks()):new Promise(e=>{this.Ae.push(()=>{this.y++,e(()=>this.ks())})})}ks(){for(this.y=Math.max(0,this.y-1);this.Ae.length>0&&this.y<this.p;)this.Ae.shift()()}Ds(){return this.E||this.Qt||this.t==="extreme"||this._performanceMode?Math.min(this.xe,10):this.t==="large"?Math.min(this.xe,14):this.xe}async ii(e,t){this.se.has(e)||this.se.set(e,Promise.resolve());let r=this.se.get(e).then(async()=>{let n=await this.ri();try{return await t()}finally{n()}});return this.se.set(e,r),r}ni(){let e=Date.now();if(this.kt||(this.kt=e),e-this.kt<3e4)return;this.kt=e;let t=this.e.size||0,s=1e4,r=t/s;r>.8&&(this._logger.warn("\u{1F9E0} Memory pressure detected, performing cleanup",{cacheSize:t,maxSize:s,pressure:(r*100).toFixed(1)+"%"}),this.e.clear(),this.p=Math.max(5,this.p*.5),setTimeout(()=>{this.p=this.Ds(),this._logger.info("\u{1F504} Restored scale-aware concurrency limits")},6e4))}oi(e,t){let s=Date.now()-t,r={badge:"\u26A1",tooltip:`High load mode - ${ze.basename(e.fsPath)}`,color:new d.ThemeColor("charts.yellow")};return this._logger.info("\u26A1 Created minimal decoration for high load",{file:ze.basename(e.fsPath),processingTimeMs:s}),r}async provideFileDecoration(e,t){if(this.st){if(!this.Nt){let f={throttleKey:"provider:disposed",throttleLimit:1,profile:"default"};typeof this._logger.infoWithOptions=="function"?this._logger.infoWithOptions(f,"\u{1F6AB} Provider disposed, rejecting operation"):this._logger.info("\u{1F6AB} Provider disposed, rejecting operation"),this.Nt=!0}return}let s=Date.now();if(!e){this._logger.error("\u274C Invalid URI provided to provideFileDecoration:",e);return}let r=e.fsPath;if(!r)return;let o=d.workspace.getConfiguration("explorerDates").get("performanceMode",!1);if(o&&typeof o!="boolean")return null;if(r&&r.includes("\0"))return this._logger.warn("\u{1F6AB} Skipping file with null character in path:",r),null;let a=z(e);if(!a){this._logger.error("\u274C Could not resolve path for URI in provideFileDecoration:",e);return}let l=N(a),c=I(a),h=e.scheme||"file";if(h!=="file"){this._logger.debug(`\u23ED\uFE0F Skipping decoration for ${l} (unsupported scheme: ${h})`);return}let u=this.Ye(e,"provideFileDecoration");if(u!=null&&u.isValid){if(await this.Rr(e)){this._performanceMode||this._logger.debug(`\u274C File excluded: ${l}`);return}return this.ii(r,async()=>{var f,m,w,y,W,O,oe,Se,ve,ke;try{if(this._logger.debug(`\u{1F4CA} Call context: token=${!!t}, cancelled=${t==null?void 0:t.isCancellationRequested}`),t!=null&&t.isCancellationRequested||this.st){this._logger.debug("\u{1F6AB} Operation cancelled early");return}this._performanceMode||(this._logger.debug(`\u{1F50D} VSCODE REQUESTED DECORATION: ${l} (${r})`),this._logger.debug(`\u{1F4CA} Call context: token=${!!t}, cancelled=${t==null?void 0:t.isCancellationRequested}`));let M=d.workspace.getConfiguration("explorerDates"),S=(C,pe)=>{if(this.n&&Object.prototype.hasOwnProperty.call(this.n,C)){let xt=this.n[C];return this._logger.debug(`\u{1F3AD} Using preview value for ${C}: ${xt} (config has: ${M.get(C,pe)})`),xt}return M.get(C,pe)};if(this.n&&this._logger.infoWithOptions(this.ft,`\u{1F3AD} Processing ${l} in PREVIEW MODE with settings:`,()=>this.n),!S("showDateDecorations",!0)){this._performanceMode||this._logger.debug(`\u274C RETURNED UNDEFINED: Decorations disabled globally for ${l}`);return}this._logger.debug(`\u{1F50D} Processing file: ${l}`);let $=this.mr(e);this.Se(e,{reason:"decoration-request",visible:c?this.F.has(c):!1}),$?this._metrics.viewportPriorityDecorations++:this._metrics.viewportBackgroundDecorations++;let P=this.C||this.Dt(this.V),K=this.St(e);if(this.n)this._logger.debug(`\u{1F504} Skipping cache due to active preview settings for: ${l}`);else{let C=await this.Pr(K,l);if(C)return C}let j=this.Ae.length,ge=j>=this.p;if(this.y>this.p*.8&&ge)return this._logger.warn("\u26A1 High load detected, switching to fast mode",{activeOps:this.y,threshold:this.p*.8,queued:j}),this.oi(e,s);if(this.ni(),this._metrics.cacheMisses++,this._logger.debug(`\u274C Cache miss for: ${l} (key: ${K.substring(0,50)}...)`),t!=null&&t.isCancellationRequested){this._logger.debug(`Decoration cancelled for: ${r}`);return}let b=null;if(!$&&((f=this._workspaceIntelligence)!=null&&f.incrementalIndexer)){let C=this._workspaceIntelligence.incrementalIndexer.getIndexedStat(r);C&&(b=C,this._logger.debug(`Indexed stat hit for ${l}`))}let k=Date.now();if(!b){try{b=await this._fileSystem.stat(e)}catch(C){if(this._metrics.fileStatTimeMs+=Date.now()-k,this._metrics.fileStatCalls++,this.si(C)){this._logger.debug(`\u23ED\uFE0F Skipping decoration for ${l}: file not found (${C.message||C})`);return}throw C}(m=this._workspaceIntelligence)!=null&&m.incrementalIndexer&&this._workspaceIntelligence.incrementalIndexer.primeFromStat(e,b)}if(this._metrics.fileStatTimeMs+=Date.now()-k,this._metrics.fileStatCalls++,!(typeof b.isFile=="function"?b.isFile():!0))return;let v=cs(b.mtime),ae=cs(b.birthtime||b.ctime||b.mtime),q={mtime:v,birthtime:ae,size:b.size},U=Date.now()-v.getTime(),De=S("dateDecorationFormat","smart"),L=this._performanceMode?"none":S("colorScheme","none"),le=S("highContrastMode",!1),Te=this._performanceMode?!1:S("showFileSize",!1),Dt=S("fileSizeFormat","auto"),Fe=S("accessibilityMode",!1),zs=this._performanceMode?!1:S("fadeOldFiles",!1),Us=S("fadeThreshold",30),fe=this._performanceMode?"none":S("showGitInfo","none"),J=this._performanceMode?"time":S("badgePriority","time");P.enableColors||(L="none"),P.enableFileSize||(Te=!1),P.enableAccessibility||(Fe=!1),P.enableGit||(fe="none"),this.E&&(L="none",Te=!1,Fe=!1,fe="none",J="time"),!$&&P.applyBackgroundLimits&&(L="none",Te=!1,fe="none",J!=="time"&&(J="time"));let qe=(fe!=="none"||J==="author")&&this.We&&!this._performanceMode&&P.enableGit,Tt=qe?fe:"none";J==="author"&&!qe&&(J="time");let Ft=qe?await this.Zr(r,v.getTime()):null,Ae=this.jr({filePath:r,stat:q,diffMs:U,dateFormat:De,badgePriority:J,showFileSize:Te,fileSizeFormat:Dt,gitBlame:Ft,showGitInfo:Tt}),Bs=Ne(r),Vs=[".js",".ts",".jsx",".tsx",".py",".rb",".php",".java",".cpp",".c",".cs",".go",".rs",".kt",".swift"].includes(Bs),At=Fe&&((w=this._accessibility)==null?void 0:w.shouldEnhanceAccessibility()),Ye=$?P.enableRichTooltips?"rich":"summary":P.backgroundTooltipMode||"off";this._logger.debug(`\u{1F50D} Tooltip generation for ${l}: accessibilityMode=${Fe}, shouldUseAccessible=${At}, preference=${Ye}, previewMode=${!!this.n}`);let ce;Ye==="rich"?ce=await this.Xr({filePath:r,resourceUri:e,stat:q,badgeDetails:Ae,gitBlame:Tt==="none"?null:Ft,shouldUseAccessibleTooltips:At,fileSizeFormat:Dt,isCodeFile:Vs}):Ye==="summary"?ce=this.Jr({filePath:r,stat:q,badgeDetails:Ae}):ce=void 0;let Z;L!=="none"&&(Z=this._themeIntegration?(W=(y=this._themeIntegration).applyThemeAwareColorScheme)==null?void 0:W.call(y,L,r,U):this.Kr(v,L,r)),this._logger.debug(`\u{1F3A8} Color scheme setting: ${L}, using color: ${Z?"yes":"no"}`);let xe=os(Ae.displayBadge)||os(Ae.badge)||"??";(oe=(O=this._accessibility)==null?void 0:O.shouldEnhanceAccessibility)!=null&&oe.call(O)&&(xe=((ve=(Se=this._accessibility).getAccessibleBadge)==null?void 0:ve.call(Se,xe))||xe);let R,B=Z;B&&(B=this.ai(B),this._logger.debug(`\u{1F3A8} Added enhanced color: ${B.id||B} (original: ${(Z==null?void 0:Z.id)||Z})`)),zs&&Math.floor(U/864e5)>Us&&(B=new d.ThemeColor("editorGutter.commentRangeForeground")),le&&(B=new d.ThemeColor("editorWarning.foreground"),this._logger.info(`\u{1F506} Applied high contrast color (overriding colorScheme=${L})`));let Xe=ce&&ce.length<500?ce:void 0;try{R=this.Nr({badge:xe,tooltip:Xe,color:B}),Xe&&this._logger.debug(`\u{1F4DD} Added tooltip (${Xe.length} chars)`)}catch(C){this._logger.error("\u274C Failed to create decoration:",C),R=new d.FileDecoration("!!"),R.propagate=!1}if(this._logger.debug(`\u{1F3A8} Color/contrast check for ${l}: colorScheme=${L}, highContrastMode=${le}, hasColor=${!!B}, previewMode=${!!this.n}`),this.n?this._logger.debug(`\u{1F504} Skipping cache storage due to preview mode for: ${l}`):await this.Ir(K,R,l,e),this._metrics.totalDecorations++,this.$r(),this.Vr(),!(R!=null&&R.badge)){this._logger.error(`\u274C Decoration badge is invalid for: ${l}`);return}let Gs=Date.now()-s;return this._performanceMode||(this._logger.infoWithOptions(this.ft,`\u2705 Decoration created for: ${l} (badge: ${R.badge||"undefined"}) - Cache key: ${K.substring(0,30)}...`),this._logger.infoWithOptions(this.ft,"\u{1F3AF} RETURNING DECORATION TO VSCODE:",()=>{var C,pe;return{file:l,badge:R.badge,hasTooltip:!!R.tooltip,hasColor:!!R.color,colorType:(pe=(C=R.color)==null?void 0:C.constructor)==null?void 0:pe.name,processingTimeMs:Gs,decorationType:R.constructor.name}})),R}catch(M){this._metrics.errors++;let S=s?Date.now()-s:0,$=N(e),P=z(e)||"unknown-uri",K=M&&typeof M.message=="string"?M.message:"Unknown error",j=M&&typeof M.stack=="string"?M.stack:"No stack available",ge=((ke=M==null?void 0:M.constructor)==null?void 0:ke.name)||"UnknownError";this._logger.error(`\u274C DECORATION ERROR for ${$}:`,{error:K,stack:j.split(`
`)[0]||j,processingTimeMs:S,uri:P}),this._logger.error(`\u274C CRITICAL ERROR DETAILS for ${$}: ${K}`),this._logger.error(`\u274C Error type: ${ge}`),this._logger.error(`\u274C Full stack: ${j}`),this._logger.info(`\u274C RETURNED UNDEFINED: Error occurred for ${$}`);return}}).catch(f=>{this._logger.error("\u{1F512} File locking error",{filePath:r,error:f.message})})}}X(e){if(this._performanceMode||this.E)return"minimal";let t="auto";try{t=((e||d.workspace.getConfiguration("explorerDates")).get("featureLevel","auto")||"auto").toLowerCase()}catch{t="auto"}if(pt.includes(t))return t;switch(this.t){case"extreme":return"standard";case"large":return"standard";default:return"full"}}Y(e,t="unspecified"){if(!e)return!1;pt.includes(e)||(e="full");let s=this.V!==e||!this.C;this.V=e;let r=s?this.Dt(e):this.C||this.Dt(e);return this.C=r,this.U=r.viewportWindowMs,s&&this._logger.info(`Feature level set to "${e}" (${t})`,{viewportWindowMs:this.U,applyBackgroundLimits:r.applyBackgroundLimits,backgroundTooltipMode:r.backgroundTooltipMode}),this.li(r,t),s}Dt(e="full"){let t=pt.includes(e)?e:"full";switch(t){case"enhanced":return{level:t,enableGit:!0,enableColors:!0,enableFileSize:!0,enableAccessibility:!0,enableRichTooltips:!0,applyBackgroundLimits:!0,backgroundTooltipMode:"summary",viewportWindowMs:Jr};case"standard":return{level:t,enableGit:!1,enableColors:!0,enableFileSize:!1,enableAccessibility:!0,enableRichTooltips:!0,applyBackgroundLimits:!0,backgroundTooltipMode:"summary",viewportWindowMs:bs};case"minimal":return{level:t,enableGit:!1,enableColors:!1,enableFileSize:!1,enableAccessibility:!1,enableRichTooltips:!1,applyBackgroundLimits:!0,backgroundTooltipMode:"off",viewportWindowMs:bs};case"full":default:return{level:"full",enableGit:!0,enableColors:!0,enableFileSize:!0,enableAccessibility:!0,enableRichTooltips:!0,applyBackgroundLimits:!1,backgroundTooltipMode:"rich",viewportWindowMs:ws}}}ms(){return this.Be||this.E}ci(){if(this.t==="extreme")return null;if(this.t==="large"){let t=d.workspace.getConfiguration("explorerDates").get("badgeRefreshInterval",6e4);return Math.max(t,9e4)}return null}ui(e="unspecified"){let t=this.Ds();if(t===this.p)return;let s=this.p;this.p=t,this._logger.info(`Adjusted concurrency cap ${s} -> ${t} (${e})`,{workspaceScale:this.t,performanceMode:this._performanceMode})}async ps(e,{reason:t="unspecified",refresh:s=!0}={}){var r;if(e!==this._performanceMode){if(this._performanceMode=e,this._logger.info(`Performance mode ${e?"enabled":"disabled"} (${t})`),e?(this.Ke({permanent:!0}),this._logger.info("File watchers disabled for performance mode"),this.w&&(clearInterval(this.w),this.w=null,this._logger.info("Periodic refresh disabled for performance mode"))):(this.we("performance-mode-toggle"),this._logger.info("File watchers enabled (performance mode off)"),this.w||(this.P(),this._logger.info("Periodic refresh enabled (performance mode off)"))),s&&this.refreshAll({reason:"performance-mode-change"}),e)(r=this._workspaceIntelligence)!=null&&r.dispose&&(this._workspaceIntelligence.dispose(),this._workspaceIntelligence=null);else if(!this._workspaceIntelligence)try{let o=await se().workspaceIntelligence();if(o){let{WorkspaceIntelligenceManager:a}=o;this._workspaceIntelligence=new a(this._fileSystem),await this._workspaceIntelligence.initialize({batchProcessor:this._batchProcessor,enableProgressiveAnalysis:this._shouldEnableProgressiveAnalysis()});let l=d.workspace.workspaceFolders;l!=null&&l.length&&await this._workspaceIntelligence.analyzeWorkspace(l,{maxFiles:this._getIndexerMaxFiles()})}}catch(n){this._logger.debug("Workspace intelligence reinitialization failed after performance mode toggle",n)}}}li(e,t="unspecified"){var n,o;let s=(e==null?void 0:e.level)||this.V;this.Qt=!1;let r=this.ms();if(r!==this._performanceMode&&(this._logger.debug("Auto performance mode update",{reason:t,featureLevel:s,workspaceScale:this.t,desiredPerformanceMode:r}),this.ps(r,{reason:`${t}-auto`,refresh:!0}).catch(a=>this._logger.debug("Failed to toggle performance mode automatically",a))),this.ui(t),!this._performanceMode&&(this.t==="large"||this.t==="extreme")){let a={...this.C,applyBackgroundLimits:!0,backgroundTooltipMode:((n=this.C)==null?void 0:n.backgroundTooltipMode)==="rich"?"summary":(o=this.C)==null?void 0:o.backgroundTooltipMode};this.C=a}if(!this._performanceMode){let a=this.ci(),l=a!==null&&a!==this.v,c=a===null&&this.v!==null;l?(this.v=a,this.P()):c&&(this.v=null,this.P())}}getMetrics(){var n,o;let e=a=>{if(!a)return 0;let l=(a.reuses||0)+(a.allocations||0);return l?Number(((a.reuses||0)/l*100).toFixed(2)):0},t={...this._metrics,cacheSize:this.e.size,cacheBuckets:this.e.bucketCount,cacheHitRate:this._metrics.cacheHits+this._metrics.cacheMisses>0?(this._metrics.cacheHits/(this._metrics.cacheHits+this._metrics.cacheMisses)*100).toFixed(2)+"%":"0.00%",forceCacheBypass:this.Ie,decorationPoolEnabled:this.Me,flyweightsEnabled:this.Re,lightweightMode:this.E,memorySheddingEnabled:this.Le,memorySheddingActive:this.Pe,watcherStrategy:this.x,staticWatchers:this.m.size,dynamicWatchers:this.h.size,workspaceScale:this.t,workspaceFileCount:this.Ne,featureLevel:this.V,featureProfile:this.C,viewportWindowMs:this.U,viewportVisibleFiles:this.F.size,viewportHistorySize:this._.size,softHeapAlertThresholdMB:this.Ge};if(t.decorationPool={size:this.S.size,hits:this.a.hits,misses:this.a.misses,allocations:this.a.allocations,reuses:this.a.reuses,reusePercent:e(this.a)},t.badgeFlyweight={...this.$,cacheSize:this.re.size,reusePercent:e(this.$)},t.readableFlyweight={...this.N,cacheSize:this.ie.size,reusePercent:e(this.N)},t.allocationTelemetry={decorationPool:{allocations:this.a.allocations,reuses:this.a.reuses,reusePercent:e(this.a)},badgeFlyweight:{allocations:this.$.allocations,reuses:this.$.reuses,reusePercent:e(this.$)},readableFlyweight:{allocations:this.N.allocations,reuses:this.N.reuses,reusePercent:e(this.N)}},this._advancedCache&&(t.advancedCache=this._advancedCache.getStats()),(n=this._batchProcessor)!=null&&n.getMetrics&&(t.batchProcessor=this._batchProcessor.getMetrics()),(o=this._workspaceIntelligence)!=null&&o.getMetrics){let a=this._workspaceIntelligence.getMetrics()||{};a.incrementalIndexer&&(t.incrementalIndexer=a.incrementalIndexer),a.smartExclusion&&(t.smartExclusion=a.smartExclusion)}let s=Array.from(this.e.keys()).slice(0,5).map(a=>this.Qr(a)),r=this.s>0?Number((this.e.size/this.s).toFixed(3)):0;return t.cacheDebugging={memoryCacheKeys:s,cacheTimeout:this.c,maxCacheSize:this.s,cacheBuckets:this.e.bucketCount,keyStatsSize:this.Ht?this.Ht.size:0,cacheNamespace:this.z,cacheUsageRatio:r},t.cachePressure={warned:this.He,thresholdRatio:this.wt,usageRatio:r},t.memoryShedding={thresholdMB:this.Oe,softThresholdMB:this.Ge,active:this.Pe,events:this.Ve.slice(-5)},t.performanceTiming={avgGitBlameMs:this._metrics.gitBlameCalls>0?(this._metrics.gitBlameTimeMs/this._metrics.gitBlameCalls).toFixed(1):"0.0",avgFileStatMs:this._metrics.fileStatCalls>0?(this._metrics.fileStatTimeMs/this._metrics.fileStatCalls).toFixed(1):"0.0",totalGitBlameTimeMs:this._metrics.gitBlameTimeMs,totalFileStatTimeMs:this._metrics.fileStatTimeMs,gitBlameCalls:this._metrics.gitBlameCalls,fileStatCalls:this._metrics.fileStatCalls},t}async initializeAdvancedSystems(e){try{let t=await this._e();if(t!=null&&t.initializeAdvancedSystems)return t.initializeAdvancedSystems(this,e);this._logger.info("Advanced systems chunk unavailable - skipping advanced initialization")}catch(t){this._logger.error("Failed to initialize advanced systems",t)}}async _maybeWarnAboutGitLimitations(){var e;if(!this.Gt){this.Gt=!0;try{let t=(e=this._extensionContext)==null?void 0:e.globalState,s=Hr.WEB_GIT_NOTICE;if(t==null?void 0:t.get(s,!1))return;if(t!=null&&t.update)try{await t.update(s,!0)}catch(n){this._logger.debug("Failed to persist Git limitation notice flag",n)}Promise.resolve().then(()=>{d.window.showInformationMessage("Explorer Dates: Git attribution badges are unavailable on VS Code for Web. Time-based decorations remain available.")})}catch(t){this._logger.debug("Failed to display Git limitation notice",t)}}}ai(e){let t={"charts.yellow":"list.warningForeground","charts.red":"list.errorForeground","charts.green":"list.highlightForeground","charts.blue":"symbolIcon.functionForeground","charts.purple":"symbolIcon.classForeground","charts.orange":"list.warningForeground","terminal.ansiYellow":"list.warningForeground","terminal.ansiGreen":"list.highlightForeground","terminal.ansiRed":"list.errorForeground","terminal.ansiBlue":"symbolIcon.functionForeground","terminal.ansiMagenta":"symbolIcon.classForeground","terminal.ansiCyan":"symbolIcon.stringForeground","editorGutter.commentRangeForeground":"list.deemphasizedForeground","editorWarning.foreground":"list.warningForeground","editorError.foreground":"list.errorForeground","editorInfo.foreground":"list.highlightForeground"},s=e.id||e,r=t[s];return r?(this._logger.debug(`\u{1F527} Enhanced color ${s} \u2192 ${r} for better selection visibility`),new d.ThemeColor(r)):e}Xe(e,t,s){if(!e||typeof e[t]!="function")return this._logger.debug(`Event API unavailable: ${t}`),null;try{return e[t](s)}catch(r){return this._logger.debug(`Failed to register listener (${t})`,r),null}}async dispose(){var e,t,s;this.L||(this.L=!0,this.st=!0,this.dt++,this._logger.info("Disposing FileDateDecorationProvider",this.getMetrics()),this.se.clear(),this.Bs.clear(),this.y=0,this.w&&(clearInterval(this.w),this.w=null,this._logger.info("Cleared periodic refresh timer")),this.Q(),(e=this._advancedCache)!=null&&e.dispose&&await this._advancedCache.dispose(),this.ws(),(t=this._batchProcessor)!=null&&t.dispose&&this._batchProcessor.dispose(),this._accessibility&&typeof this._accessibility.dispose=="function"&&this._accessibility.dispose(),(s=this._workspaceIntelligence)!=null&&s.dispose&&this._workspaceIntelligence.dispose(),this.pr(),this.e.clear(),this.Z("dispose"),this.i&&(this.i.dispose(),this.i=null),this.f.dispose(),this.ht&&(this.ht.dispose(),this.ht=null),this.M&&(clearTimeout(this.M),this.M=null),this._telemetryReportTimer&&(clearTimeout(this._telemetryReportTimer),this._telemetryReportTimer=null),this.Ke({permanent:!0}),this.Et(),this.dr(),this.r&&(this.r.dispose(),this.r=null))}};Es.exports={FileDateDecorationProvider:Et}});var Ke=_((Ni,ks)=>{var ri="__explorerDatesVscode",ie=null,Ve=null,Ge=!1;function ii(){try{return globalThis[ri]}catch{return}}function vs(){if(Ve)return Ve;let i={get:()=>{},async update(){},inspect:()=>({defaultValue:void 0,globalValue:void 0,workspaceValue:void 0,workspaceFolderValue:void 0})};return Ve={workspace:{workspaceFolders:[],getConfiguration:()=>i},ConfigurationTarget:{Global:1,Workspace:2,WorkspaceFolder:3}},Ve}var ni=new Set(["MODULE_NOT_FOUND","ERR_MODULE_NOT_FOUND","WEB_NATIVE_MODULE"]);function oi(i){return!i||i.code&&ni.has(i.code)?!0:(typeof i.message=="string"?i.message:"").includes("Cannot find module 'vscode'")}function Ce(){let i=ii();if(i)return ie=_t(i),Ge=!1,ie;if(ie&&!Ge)return ie;try{ie=_t(require("vscode")),Ge=!1}catch(e){if(oi(e))ie=_t(vs()),Ge=!0;else throw e}return ie}var A=new Proxy({},{get(i,e){return Ce()[e]},set(i,e,t){return Ce()[e]=t,!0},has(i,e){return e in Ce()},ownKeys(){return Reflect.ownKeys(Ce())},getOwnPropertyDescriptor(i,e){let t=Object.getOwnPropertyDescriptor(Ce(),e);return t&&(t.configurable=!0),t}}),ai="explorerDates",Cs="__explorerDatesConfigWrapped";function Ss(i){return!i||typeof i!="object"?{get:()=>{},async update(){},inspect:()=>({defaultValue:void 0,globalValue:void 0,workspaceValue:void 0,workspaceFolderValue:void 0})}:(typeof i.get!="function"&&(i.get=()=>{}),typeof i.update!="function"&&(i.update=async()=>{}),typeof i.inspect!="function"&&(i.inspect=()=>({defaultValue:void 0,globalValue:void 0,workspaceValue:void 0,workspaceFolderValue:void 0})),i)}function _t(i){if(!i)return vs();i.ConfigurationTarget||(i.ConfigurationTarget={Global:1,Workspace:2,WorkspaceFolder:3}),i.workspace||(i.workspace={});let e=i.workspace.getConfiguration;if(typeof e=="function"&&!e[Cs]){let t=function(...s){let r=e.apply(this,s);return Ss(r)};t[Cs]=!0,i.workspace.getConfiguration=t}else typeof e!="function"&&(i.workspace.getConfiguration=()=>Ss());return Array.isArray(i.workspace.workspaceFolders)||(i.workspace.workspaceFolders=[]),i}var He=class{constructor(e={}){this.hi=e.defaultSection||ai}getValue(e,t={}){let{section:s,resource:r}=t,n=this.Tt(e,s);return this.Ft(n.section,r).get(n.key)}inspect(e,t={}){let{section:s,resource:r}=t,n=this.Tt(e,s);return this.Ft(n.section,r).inspect(n.key)}async updateSetting(e,t,s={}){let{scope:r="auto",resource:n,section:o,force:a=!1}=s,l=this.Tt(e,o),c=this.Ft(l.section,n),h=this.di(r,n),u=c.get(l.key),f=c.inspect(l.key),m=this.gi(f,h);return t!==void 0&&this.fi(u,t)&&!a&&m!==void 0?{key:l.fullKey,updated:!1,reason:"unchanged"}:(await c.update(l.key,t,h),{key:l.fullKey,updated:!0})}async applySettings(e,t={}){let s=Array.isArray(e)?e:Object.entries(e).map(([n,o])=>({key:n,value:o})),r=[];for(let n of s){let o={...t,...n.options||{}};r.push(await this.updateSetting(n.key,n.value,o))}return r}async clearSetting(e,t={}){return this.updateSetting(e,void 0,t)}Ft(e,t){return A.workspace.getConfiguration(e||void 0,t)}Tt(e,t){let s=t||this.hi;if(!s)return{section:void 0,key:e,fullKey:e};if(e.startsWith(`${s}.`)){let r=e.slice(s.length+1);return{section:s,key:r,fullKey:e}}return e.includes(".")?{section:void 0,key:e,fullKey:e}:{section:s,key:e,fullKey:`${s}.${e}`}}di(e,t){return e&&e!=="auto"?this.pi(e)||A.ConfigurationTarget.Workspace:t?A.ConfigurationTarget.WorkspaceFolder:A.workspace.workspaceFolders&&A.workspace.workspaceFolders.length>0?A.ConfigurationTarget.Workspace:A.ConfigurationTarget.Global}pi(e){switch(e){case"user":return A.ConfigurationTarget.Global;case"workspace":return A.ConfigurationTarget.Workspace;case"workspaceFolder":return A.ConfigurationTarget.WorkspaceFolder;default:return}}Ni(e){switch(e){case A.ConfigurationTarget.Global:return"user";case A.ConfigurationTarget.Workspace:return"workspace";case A.ConfigurationTarget.WorkspaceFolder:return"workspaceFolder";default:return"unknown"}}fi(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="object")try{return JSON.stringify(e)===JSON.stringify(t)}catch{return!1}return!1}gi(e,t){if(e)switch(t){case A.ConfigurationTarget.Global:return e.globalValue;case A.ConfigurationTarget.Workspace:return e.workspaceValue;case A.ConfigurationTarget.WorkspaceFolder:return e.workspaceFolderValue;default:return}}},Ct=null;function li(i){return(!Ct||i&&i.forceNew)&&(Ct=new He(i)),Ct}ks.exports={SettingsCoordinator:He,getSettingsCoordinator:li}});var Ds=_((exports,module)=>{var vscode=require("vscode"),{fileSystem}=Pe(),{getFileName,getRelativePath,getUriPath,normalizePath}=we(),{ensureDate}=be(),{getSettingsCoordinator}=Ke(),{SecureFileOperations,SecurityValidator,detectSecurityEnvironment}=ot(),isWeb=!1,childProcess=null;function loadChildProcess(){return!childProcess&&!isWeb&&(childProcess=eval("require")("child_process")),childProcess}var SECURITY_WARNING_THROTTLE_MS_DEFAULT=Number(process.env.EXPLORER_DATES_SECURITY_WARNING_THROTTLE_MS||5e3),SECURITY_WARNING_THROTTLE_LIMIT=Number(process.env.EXPLORER_DATES_SECURITY_WARNING_CACHE||500),SECURITY_MAX_WARNINGS_DEFAULT=Number(process.env.EXPLORER_DATES_SECURITY_MAX_WARNINGS_PER_FILE??1),settingsCoordinator=getSettingsCoordinator(),securityEnvironment=detectSecurityEnvironment(),securityWarningLog=new Map;function dedupePaths(i=[]){let e=new Set,t=[];for(let s of i)!s||e.has(s)||(e.add(s),t.push(s));return t}function getExplicitBooleanSetting(i,e){if(!(!i||typeof i.inspect!="function"))try{let t=i.inspect(e);if(!t)return;let s=[t.workspaceFolderValue,t.workspaceValue,t.globalValue];for(let r of s)if(typeof r=="boolean")return r}catch{}}function normalizeSecurityPaths(i=[]){let e=Array.isArray(i)?i:i?[i]:[],t=[];for(let s of e){if(!s||typeof s!="string")continue;let r=s.trim().replace(/^['"]|['"]$/g,"");if(!r)continue;let n=normalizePath(r);n&&t.push(n)}return t}function parseEnvSecurityPaths(){let i=process.env.EXPLORER_DATES_SECURITY_EXTRA_PATHS;if(!i||typeof i!="string")return[];let e=process.platform==="win32"?";":":";return i.split(e).map(t=>t.trim()).filter(Boolean)}function isTestLikeEnvironment(){return securityEnvironment==="test"||process.env.EXPLORER_DATES_TEST_MODE==="1"||process.env.NODE_ENV==="test"||process.env.VSCODE_TEST==="1"}function getSecurityValidationContext(){let i=vscode.workspace.getConfiguration("explorerDates"),e=i.get("security.allowTestPaths",!0),t=i.get("security.allowedExtraPaths",[]),r=(vscode.workspace.workspaceFolders||[]).map(O=>{try{return normalizePath(getUriPath(O.uri))}catch{return null}}).filter(Boolean),n=normalizeSecurityPaths(t),o=normalizeSecurityPaths(parseEnvSecurityPaths()),a=dedupePaths([...r,...n,...o]),l=getExplicitBooleanSetting(i,"security.enableBoundaryEnforcement"),c=getExplicitBooleanSetting(i,"security.enforceWorkspaceBoundaries"),h;typeof l=="boolean"?h=l:typeof c=="boolean"?h=c:h=securityEnvironment==="production";let u=e&&isTestLikeEnvironment(),f=h&&!u&&a.length>0,m=i.get("security.logThrottleWindowMs"),w=i.get("security.maxWarningsPerFile"),y=Number.isFinite(m)?Math.max(0,m):Number.isFinite(SECURITY_WARNING_THROTTLE_MS_DEFAULT)?Math.max(0,SECURITY_WARNING_THROTTLE_MS_DEFAULT):5e3,W=Number.isFinite(w)&&w>=0?w:Number.isFinite(SECURITY_MAX_WARNINGS_DEFAULT)&&SECURITY_MAX_WARNINGS_DEFAULT>=0?SECURITY_MAX_WARNINGS_DEFAULT:1;return{allowedPaths:f?a:[],enforceBoundaries:f,throttleMs:y,maxWarningsPerFile:W}}function shouldThrottleSecurityWarning(i,e,t){if(!i)return!1;let s=Date.now(),r=securityWarningLog.get(i)||{lastTimestamp:0,count:0};if(typeof t=="number"&&t>=0&&r.count>=t||typeof e=="number"&&e>0&&s-r.lastTimestamp<e)return!0;if(r.lastTimestamp=s,r.count=(r.count||0)+1,securityWarningLog.set(i,r),securityWarningLog.size>SECURITY_WARNING_THROTTLE_LIMIT){let n=Array.from(securityWarningLog.keys()),o=Math.ceil(n.length*.25);for(let a=0;a<o;a++)securityWarningLog.delete(n[a])}return!1}function getSanitizedPathForLog(i){let e="";if(typeof i=="string")e=i;else if(i&&(e=i.fsPath||i.path||"",!e&&typeof i.toString=="function"))try{e=i.toString(!0)}catch{e=i.toString()}return SecurityValidator.sanitizePath(e||"",{preserveExtension:!0})||"unknown"}function ensureSecureUri(i,e,t){var o;if(!i)return null;let s=getSecurityValidationContext(),r=SecureFileOperations.validateFileUri(i,s.allowedPaths),n=getSanitizedPathForLog(i);if(!r.isValid){let a=`${t}:${n}`;if(!shouldThrottleSecurityWarning(a,s.throttleMs,s.maxWarningsPerFile)){let l=securityEnvironment==="production"?"warn":securityEnvironment==="development"?"info":"debug";(typeof e[l]=="function"?e[l].bind(e):e.warn.bind(e))(`Blocked ${t} due to insecure path`,{path:n,issue:r.issue,environment:securityEnvironment,enforceBoundaries:s.enforceBoundaries})}return securityEnvironment==="production"&&vscode.window.showWarningMessage("Explorer Dates blocked this file because its path failed security checks."),null}if((o=r.warnings)!=null&&o.length){let a=`warning:${t}:${n}:${r.warnings.join("|")}`;if(!shouldThrottleSecurityWarning(a,s.throttleMs,s.maxWarningsPerFile)){let l=securityEnvironment==="production"?"warn":securityEnvironment==="development"?"info":"debug";(typeof e[l]=="function"?e[l].bind(e):e.warn.bind(e))(`Security warnings for ${t}`,{path:n,warnings:r.warnings,environment:securityEnvironment,enforceBoundaries:s.enforceBoundaries})}}return i}function registerCoreCommands({context:i,fileDateProvider:e,logger:t,l10n:s}){let r=[];r.push(vscode.commands.registerCommand("explorerDates.refreshDateDecorations",()=>{try{if(e){e.clearAllCaches(),e.refreshAll();let n=(s==null?void 0:s.getString("refreshSuccess"))||"Date decorations refreshed - all caches cleared";vscode.window.showInformationMessage(n),t.info("Date decorations refreshed manually with cache clear")}}catch(n){t.error("Failed to refresh decorations",n),vscode.window.showErrorMessage(`Failed to refresh decorations: ${n.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.previewConfiguration",n=>{try{e&&(e.applyPreviewSettings(n),t.info("Configuration preview applied",n))}catch(o){t.error("Failed to apply configuration preview",o)}})),r.push(vscode.commands.registerCommand("explorerDates.clearPreview",()=>{try{e&&(e.applyPreviewSettings(null),t.info("Configuration preview cleared"))}catch(n){t.error("Failed to clear configuration preview",n)}})),r.push(vscode.commands.registerCommand("explorerDates.showMetrics",async()=>{try{if(e){let n=e.getMetrics(),o=`Explorer Dates Metrics:
Total Decorations: ${n.totalDecorations}
Cache Size: ${n.cacheSize}
Cache Hits: ${n.cacheHits}
Cache Misses: ${n.cacheMisses}
Cache Hit Rate: ${n.cacheHitRate}
Errors: ${n.errors}`;n.advancedCache&&(o+=`

Advanced Cache:
Memory Items: ${n.advancedCache.memoryItems}
Memory Usage: ${(n.advancedCache.memoryUsage/1024/1024).toFixed(2)} MB
Memory Hit Rate: ${n.advancedCache.memoryHitRate}
Disk Hit Rate: ${n.advancedCache.diskHitRate}
Evictions: ${n.advancedCache.evictions}`),n.batchProcessor&&(o+=`

Batch Processor:
Queue Length: ${n.batchProcessor.queueLength}
Is Processing: ${n.batchProcessor.isProcessing}
Average Batch Time: ${n.batchProcessor.averageBatchTime.toFixed(2)}ms`),await vscode.window.showInformationMessage(o,{modal:!0},"View Rich Analytics")==="View Rich Analytics"&&await vscode.commands.executeCommand("explorerDates.showPerformanceAnalytics"),t.info("Metrics displayed",n)}}catch(n){t.error("Failed to show metrics",n),vscode.window.showErrorMessage(`Failed to show metrics: ${n.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.openLogs",()=>{try{t.show()}catch(n){t.error("Failed to open logs",n),vscode.window.showErrorMessage(`Failed to open logs: ${n.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.showCurrentConfig",()=>{try{let n=vscode.workspace.getConfiguration("explorerDates"),o={highContrastMode:n.get("highContrastMode"),badgePriority:n.get("badgePriority"),colorScheme:n.get("colorScheme"),accessibilityMode:n.get("accessibilityMode"),dateDecorationFormat:n.get("dateDecorationFormat"),showGitInfo:n.get("showGitInfo"),showFileSize:n.get("showFileSize")},a=`Current Explorer Dates Configuration:

${Object.entries(o).map(([l,c])=>`${l}: ${JSON.stringify(c)}`).join(`
`)}`;vscode.window.showInformationMessage(a,{modal:!0}),t.info("Current configuration displayed",o)}catch(n){t.error("Failed to show configuration",n)}})),r.push(vscode.commands.registerCommand("explorerDates.toggleDecorations",async()=>{try{let n=settingsCoordinator.getValue("showDateDecorations");await settingsCoordinator.updateSetting("showDateDecorations",!n,{scope:"user",reason:"toggle-decorations"});let o=n?(s==null?void 0:s.getString("decorationsDisabled"))||"Date decorations disabled":(s==null?void 0:s.getString("decorationsEnabled"))||"Date decorations enabled";vscode.window.showInformationMessage(o),t.info(`Date decorations toggled to: ${!n}`)}catch(n){t.error("Failed to toggle decorations",n),vscode.window.showErrorMessage(`Failed to toggle decorations: ${n.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.copyFileDate",async n=>{try{let o=n;if(!o&&vscode.window.activeTextEditor&&(o=vscode.window.activeTextEditor.document.uri),!o){vscode.window.showWarningMessage("No file selected");return}let a=ensureSecureUri(o,t,"copyFileDate");if(!a)return;o=a;let l=await fileSystem.stat(o),c=ensureDate(l.mtime).toLocaleString();await vscode.env.clipboard.writeText(c),vscode.window.showInformationMessage(`Copied to clipboard: ${c}`),t.info(`File date copied for: ${getSanitizedPathForLog(o)}`)}catch(o){t.error("Failed to copy file date",o),vscode.window.showErrorMessage(`Failed to copy file date: ${o.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.showFileDetails",async n=>{try{let o=n;if(!o&&vscode.window.activeTextEditor&&(o=vscode.window.activeTextEditor.document.uri),!o){vscode.window.showWarningMessage("No file selected");return}let a=ensureSecureUri(o,t,"showFileDetails");if(!a)return;o=a;let l=await fileSystem.stat(o),c=getFileName(o.fsPath||o.path),h=(e==null?void 0:e.ve(l.size,"auto"))||`${l.size} bytes`,u=ensureDate(l.mtime).toLocaleString(),f=ensureDate(l.birthtime||l.mtime).toLocaleString(),m=`File: ${c}
Size: ${h}
Modified: ${u}
Created: ${f}
Path: ${o.fsPath||o.path}`;vscode.window.showInformationMessage(m,{modal:!0}),t.info(`File details shown for: ${getSanitizedPathForLog(o)}`)}catch(o){t.error("Failed to show file details",o),vscode.window.showErrorMessage(`Failed to show file details: ${o.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.toggleFadeOldFiles",async()=>{try{let n=settingsCoordinator.getValue("fadeOldFiles")??!1;await settingsCoordinator.updateSetting("fadeOldFiles",!n,{scope:"user",reason:"toggle-fade"});let o=n?"Fade old files disabled":"Fade old files enabled";vscode.window.showInformationMessage(o),t.info(`Fade old files toggled to: ${!n}`)}catch(n){t.error("Failed to toggle fade old files",n),vscode.window.showErrorMessage(`Failed to toggle fade old files: ${n.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.showFileHistory",async n=>{try{if(isWeb){vscode.window.showInformationMessage("Git history is unavailable on VS Code for Web.");return}let o=n;if(!o&&vscode.window.activeTextEditor&&(o=vscode.window.activeTextEditor.document.uri),!o){vscode.window.showWarningMessage("No file selected");return}let a=ensureSecureUri(o,t,"showFileHistory");if(!a)return;o=a;let l=vscode.workspace.getWorkspaceFolder(o);if(!l){vscode.window.showWarningMessage("File is not in a workspace");return}let c=getRelativePath(l.uri.fsPath||l.uri.path,o.fsPath||o.path),u=`git log --oneline -10 -- "${SecurityValidator.sanitizePath(c,{preserveExtension:!0})||c}"`;loadChildProcess().exec(u,{cwd:l.uri.fsPath,timeout:3e3},(m,w)=>{if(m){m.message.includes("not a git repository")?vscode.window.showWarningMessage("This file is not in a Git repository"):vscode.window.showErrorMessage(`Git error: ${m.message}`);return}if(!w.trim()){vscode.window.showInformationMessage("No Git history found for this file");return}let y=w.trim(),W=getFileName(o.fsPath||o.path);vscode.window.showInformationMessage(`Recent commits for ${W}:

${y}`,{modal:!0})}),t.info(`File history requested for: ${getSanitizedPathForLog(o)}`)}catch(o){t.error("Failed to show file history",o),vscode.window.showErrorMessage(`Failed to show file history: ${o.message}`)}})),r.push(vscode.commands.registerCommand("explorerDates.compareWithPrevious",async n=>{try{if(isWeb){vscode.window.showInformationMessage("Git comparisons are unavailable on VS Code for Web.");return}let o=n;if(!o&&vscode.window.activeTextEditor&&(o=vscode.window.activeTextEditor.document.uri),!o){vscode.window.showWarningMessage("No file selected");return}let a=ensureSecureUri(o,t,"compareWithPrevious");if(!a)return;if(o=a,!vscode.workspace.getWorkspaceFolder(o)){vscode.window.showWarningMessage("File is not in a workspace");return}await vscode.commands.executeCommand("git.openChange",o),t.info(`Git diff opened for: ${getSanitizedPathForLog(o)}`)}catch(o){t.error("Failed to compare with previous version",o),vscode.window.showErrorMessage(`Failed to compare with previous version: ${o.message}`)}})),r.forEach(n=>i.subscriptions.push(n))}module.exports={registerCoreCommands}});var Fs=_((zi,Ts)=>{var H=require("vscode");function ci({context:i,logger:e,getOnboardingManager:t}){let s=[];s.push(H.commands.registerCommand("explorerDates.showFeatureTour",async()=>{try{let r=await t();if(!r){H.window.showWarningMessage("Onboarding system unavailable.");return}await r.showFeatureTour(),e.info("Feature tour opened")}catch(r){e.error("Failed to show feature tour",r),H.window.showErrorMessage(`Failed to show feature tour: ${r.message}`)}})),s.push(H.commands.registerCommand("explorerDates.showQuickSetup",async()=>{try{let r=await t();if(!r){H.window.showWarningMessage("Onboarding system unavailable.");return}await r.showQuickSetupWizard(),e.info("Quick setup wizard opened")}catch(r){e.error("Failed to show quick setup wizard",r),H.window.showErrorMessage(`Failed to show quick setup wizard: ${r.message}`)}})),s.push(H.commands.registerCommand("explorerDates.showWhatsNew",async()=>{try{let r=await t();if(!r){H.window.showWarningMessage("Onboarding system unavailable.");return}let n=i.extension.packageJSON.version;await r.showWhatsNew(n),e.info("What's new panel opened")}catch(r){e.error("Failed to show what's new",r),H.window.showErrorMessage(`Failed to show what's new: ${r.message}`)}})),s.forEach(r=>i.subscriptions.push(r))}Ts.exports={registerOnboardingCommands:ci}});var vt=_((Ui,xs)=>{var x=require("vscode"),{getLogger:ui}=Y(),ne="explorerDates.",As=["performanceMode","featureLevel","smartFileWatching","smartWatcherMaxPatterns","smartWatcherExtensions","enableSmartWatcherFallbacks","enableOnboardingSystem","enableExportReporting","enableAnalysisCommands","enableAdvancedCache","enableWorkspaceTemplates","enableWorkspaceIntelligence","enableExtensionApi","enableIncrementalWorkers","enableProgressiveAnalysis"],hi=/^\.?explorer-dates.*\.json$/i,di=new Set([`${ne}customColors`,`${ne}enableReporting`]),St=class{constructor(e){this.mi=e,this._logger=ui()}async getOrganizationPlan(){let e=x.workspace.getConfiguration("explorerDates"),t=this.At();return this.Ts(e,t)}async organize(e={}){let t=x.workspace.getConfiguration("explorerDates"),s=this.At(),r=e.plan||await this.Ts(t,s),n={changed:!1,movedToWorkspace:[],reorderedWorkspace:!1,sortedFiles:[]};return!r.needsWork&&!e.force||(await this.wi(t,n,r.keysToMove),await this.bi(t,r.workspaceEntries,n,r.workspaceOutOfOrder),await this.yi(n,r.filesToSort)),n}async Ts(e,t){let s=this.Ei(e),r=this.Fs(e,t),n=this._i(r),o=await this.As(),a=await this.xs(o);return{keysToMove:s,workspaceEntries:r,workspaceOutOfOrder:n,filesToSort:a,needsWork:s.length>0||n||a.length>0}}Ei(e){let t=[];for(let s of As){let r=e.inspect(s);if(!r)continue;let n=r.globalValue!==void 0,o=r.workspaceValue!==void 0,a=r.workspaceFolderValue!==void 0;n&&!o&&!a&&t.push(s)}return t}Fs(e,t){let s=[];for(let r of t){if(this.Ci(r))continue;let n=this.Si(r),o=e.inspect(n);o&&o.workspaceValue!==void 0&&s.push({fullKey:r,shortKey:n,value:o.workspaceValue})}return s}_i(e){if(!e||e.length===0)return!1;let t=[...e].sort((s,r)=>s.fullKey.localeCompare(r.fullKey));return!e.every((s,r)=>s.fullKey===t[r].fullKey)}async xs(e){if(!e||e.length===0)return[];let t=[];for(let s of e)await this.vi(s)&&t.push(s);return t}async As(){let e=this.ki();if(!e.length||!x.workspace.fs)return[];let t=new Map;for(let s of e){await this.Ms(s,t);let r=x.Uri.joinPath(s,".vscode");await this.Ms(r,t)}return Array.from(t.values())}async Ms(e,t){if(e)try{let s=await x.workspace.fs.readDirectory(e);for(let[r,n]of s){if(n!==x.FileType.File||!this.Di(r))continue;let o=x.Uri.joinPath(e,r),a=o.fsPath||o.path;t.has(a)||t.set(a,o)}}catch(s){if((s==null?void 0:s.code)==="FileNotFound"||(s==null?void 0:s.code)==="ENOENT")return;this._logger.warn(`Failed to scan Explorer Dates directory ${e.fsPath||e.path}`,s)}}ki(){return(x.workspace.workspaceFolders||[]).map(e=>e==null?void 0:e.uri).filter(Boolean)}Di(e=""){return hi.test(e)}async wi(e,t,s){let r=Array.isArray(s)?s:As;if(r.length)for(let n of r){let o=e.inspect(n);if(!o)continue;let a=o.globalValue!==void 0,l=o.workspaceValue!==void 0,c=o.workspaceFolderValue!==void 0;a&&!l&&!c&&(await e.update(n,o.globalValue,x.ConfigurationTarget.Workspace),await e.update(n,void 0,x.ConfigurationTarget.Global),t.movedToWorkspace.push(`${ne}${n}`),t.changed=!0,this._logger.info(`Moved ${ne}${n} from user settings to workspace settings.`))}}async bi(e,t,s,r=!1){let n=Array.isArray(t)&&t.length>0?t:this.Fs(e,this.At());if(n.length===0)return;let o=[...n].sort((l,c)=>l.fullKey.localeCompare(c.fullKey));if(!(!r&&n.every((l,c)=>l.fullKey===o[c].fullKey))){for(let l of n)await e.update(l.shortKey,void 0,x.ConfigurationTarget.Workspace);for(let l of o)await e.update(l.shortKey,l.value,x.ConfigurationTarget.Workspace);s.reorderedWorkspace=!0,s.changed=!0,this._logger.info("Reordered Explorer Dates workspace settings alphabetically.")}}async yi(e,t){let s=Array.isArray(t)?t:await this.xs(await this.As());if(s.length)for(let r of s)await this.Ti(r)&&(e.sortedFiles.push(this.Ze(r)),e.changed=!0)}async Ti(e){try{let t=await x.workspace.fs.readFile(e),s=Buffer.from(t).toString("utf8").trim();if(!s)return!1;let r=JSON.parse(s),n=this.Qe(r),o=JSON.stringify(n,null,2);return await x.workspace.fs.writeFile(e,Buffer.from(`${o}
`,"utf8")),this._logger.info(`Sorted Explorer Dates file: ${this.Ze(e)}`),!0}catch(t){return(t==null?void 0:t.code)==="FileNotFound"||(t==null?void 0:t.code)==="ENOENT"||this._logger.warn(`Failed to sort Explorer Dates file ${this.Ze(e)}`,t),!1}}async vi(e){try{let t=await x.workspace.fs.readFile(e),s=Buffer.from(t).toString("utf8").trim();if(!s)return!1;let r=JSON.parse(s),n=JSON.stringify(r,null,2),o=JSON.stringify(this.Qe(r),null,2);return n!==o}catch(t){return(t==null?void 0:t.code)==="FileNotFound"||(t==null?void 0:t.code)==="ENOENT"||this._logger.warn(`Failed to inspect Explorer Dates file ${this.Ze(e)}`,t),!1}}Qe(e){return Array.isArray(e)?e.map(t=>this.Qe(t)):e&&typeof e=="object"?Object.keys(e).sort((t,s)=>t.localeCompare(s)).reduce((t,s)=>(t[s]=this.Qe(e[s]),t),{}):e}At(){var t,s,r,n,o;let e=((o=(n=(r=(s=(t=this.mi)==null?void 0:t.extension)==null?void 0:s.packageJSON)==null?void 0:r.contributes)==null?void 0:n.configuration)==null?void 0:o.properties)||{};return Object.keys(e).filter(a=>a.startsWith(ne))}Si(e){return e.startsWith(ne)?e.substring(ne.length):e}Ci(e){return di.has(e)}Ze(e){return(e==null?void 0:e.fsPath)||(e==null?void 0:e.path)||String(e)}};xs.exports={SettingsOrganizer:St}});var Ps=_((Bi,Os)=>{var p=require("vscode"),{getSettingsCoordinator:gi}=Ke(),{SettingsOrganizer:fi}=vt(),je=gi(),Ms="explorerDates.resetToDefaults",Ls=Symbol.for("explorerDates.resetToDefaults.registered");function pi(){return!!globalThis[Ls]}function Rs(){globalThis[Ls]=!0}async function mi({context:i,logger:e,getSettingsMigrationManager:t}){let s=[];return s.push(p.commands.registerCommand("explorerDates.migrateSettings",async()=>{try{let r=await t();if(!r){p.window.showWarningMessage("Settings migration system unavailable.");return}p.window.showInformationMessage("Checking for settings that need migration...");let n=await r.migrateAllSettings(i),o=await r.autoOrganizeSettingsIfNeeded(i,{trigger:"manual-migrate",silent:!0}),a=[];n.length>0&&a.push(`${n.length} migration${n.length===1?"":"s"}`),o!=null&&o.changed&&a.push("settings reorganized"),a.length===0?p.window.showInformationMessage("\u2705 All settings are up to date!"):p.window.showInformationMessage(`\u2705 Explorer Dates maintenance applied: ${a.join(" + ")}.`),e.info("Manual settings migration completed",{results:n,organizationSummary:o})}catch(r){e.error("Failed to run settings migration",r),p.window.showErrorMessage(`Failed to migrate settings: ${r.message}`)}})),s.push(p.commands.registerCommand("explorerDates.organizeSettings",async()=>{try{let n=await new fi(i).organize(),o=n.movedToWorkspace.length,a=n.sortedFiles.length,l=[n.reorderedWorkspace?"workspace settings reordered":null,o?`${o} setting(s) moved to workspace scope`:null,a?`${a} explorer-dates file(s) sorted`:null].filter(Boolean).join(" \u2022 ")||"No changes were necessary.";p.window.showInformationMessage(`Explorer Dates settings organized: ${l}`),e.info("Organize settings command executed",n)}catch(r){e.error("Failed to organize Explorer Dates settings",r),p.window.showErrorMessage(`Failed to organize settings: ${r.message}`)}})),s.push(p.commands.registerCommand("explorerDates.validateConfiguration",async()=>{try{let r=await t();if(!r){p.window.showWarningMessage("Settings validation system unavailable.");return}let n=await r.validateConfiguration();if(n.length===0)p.window.showInformationMessage("\u2705 Configuration is valid - no issues found!");else{let o=`Found ${n.length} configuration issue(s). Would you like to see details?`;await p.window.showWarningMessage(o,"Show Details","Dismiss")==="Show Details"&&await wi(n)}e.info("Configuration validation completed",{issuesFound:n.length,issues:n})}catch(r){e.error("Failed to validate configuration",r),p.window.showErrorMessage(`Failed to validate configuration: ${r.message}`)}})),s.push(p.commands.registerCommand("explorerDates.cleanLegacySettings",async()=>{try{let r=await t();if(!r){p.window.showWarningMessage("Settings migration system unavailable.");return}let n=await r.cleanupDeprecatedSettings();n?p.window.showInformationMessage("\u2705 Deprecated settings have been cleaned up!"):p.window.showInformationMessage("\u2139\uFE0F No deprecated settings found to clean up."),e.info("Legacy settings cleanup completed",{cleaned:n})}catch(r){e.error("Failed to clean legacy settings",r),p.window.showErrorMessage(`Failed to clean legacy settings: ${r.message}`)}})),s.push(p.commands.registerCommand("explorerDates.showMigrationHistory",async()=>{try{let r=await t();if(!r){p.window.showWarningMessage("Settings migration system unavailable.");return}let n=r.getMigrationHistory(i);if(n.length===0){p.window.showInformationMessage("No migration history found.");return}await bi(n),e.info("Displayed migration history",{historyLength:n.length})}catch(r){e.error("Failed to show migration history",r),p.window.showErrorMessage(`Failed to show migration history: ${r.message}`)}})),s.push(p.commands.registerCommand("explorerDates.applyCustomColors",async()=>{try{let r=await p.window.showQuickPick([{label:"Copy to Clipboard",description:"Copy color configuration to clipboard"},{label:"Open Settings",description:"Open VS Code settings to workbench.colorCustomizations"},{label:"Apply Default Colors",description:"Apply default Explorer Dates colors"}],{placeHolder:"How would you like to set up custom colors?",ignoreFocusOut:!0});if(!r)return;let n={"explorerDates.customColor.veryRecent":"#00ff00","explorerDates.customColor.recent":"#ffff00","explorerDates.customColor.old":"#ff0000"};switch(r.label){case"Copy to Clipboard":let o=JSON.stringify({"workbench.colorCustomizations":n},null,2);await p.env.clipboard.writeText(o),p.window.showInformationMessage("Color configuration copied to clipboard!");break;case"Open Settings":await p.commands.executeCommand("workbench.action.openSettings","workbench.colorCustomizations");break;case"Apply Default Colors":let c={...p.workspace.getConfiguration("workbench").get("colorCustomizations",{}),...n};await je.updateSetting("workbench.colorCustomizations",c,{scope:"user",reason:"custom-colors-command"}),await je.updateSetting("colorScheme","custom",{scope:"user",reason:"custom-colors-command"}),p.window.showInformationMessage("\u2705 Custom colors applied successfully!");break}e.info("Custom colors command executed",{action:r.label})}catch(r){e.error("Failed to apply custom colors",r),p.window.showErrorMessage(`Failed to apply custom colors: ${r.message}`)}})),await yi({context:i,logger:e,subscriptions:s}),s.push(p.commands.registerCommand("explorerDates.exportConfiguration",async()=>{var r,n;try{let o=p.workspace.getConfiguration("explorerDates"),a={},l=i.extension.packageJSON,c=((n=(r=l==null?void 0:l.contributes)==null?void 0:r.configuration)==null?void 0:n.properties)||{};for(let f of Object.keys(c))if(f.startsWith("explorerDates.")){let m=f.replace("explorerDates.",""),w=o.get(m);w!==void 0&&(a[f]=w)}let h=JSON.stringify(a,null,2),u=await p.window.showQuickPick([{label:"Copy to Clipboard",description:"Copy configuration to clipboard"},{label:"Save to File",description:"Save configuration to a JSON file"}],{placeHolder:"How would you like to export the configuration?"});if(!u)return;switch(u.label){case"Copy to Clipboard":await p.env.clipboard.writeText(h),p.window.showInformationMessage("Configuration copied to clipboard!");break;case"Save to File":let f=await p.window.showSaveDialog({defaultUri:p.Uri.file("explorer-dates-config.json"),filters:{JSON:["json"]}});f&&(await p.workspace.fs.writeFile(f,Buffer.from(h,"utf8")),p.window.showInformationMessage(`Configuration saved to ${f.fsPath}`));break}e.info("Configuration exported",{action:u.label,settingsCount:Object.keys(a).length})}catch(o){e.error("Failed to export configuration",o),p.window.showErrorMessage(`Failed to export configuration: ${o.message}`)}})),s}async function wi(i){let e=p.window.createWebviewPanel("explorerDatesConfigIssues","Explorer Dates - Configuration Issues",p.ViewColumn.One,{enableScripts:!1}),t=i.map(s=>`
        <div class="issue">
            <h3><code>${s.setting}</code></h3>
            <p><strong>Current value:</strong> <code>${JSON.stringify(s.value)}</code></p>
            <p><strong>Issue:</strong> ${s.message}</p>
        </div>
    `).join("");e.webview.html=`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Configuration Issues</title>
            <style>
                body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; }
                h1 { color: #d73a49; }
                .issue { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; margin: 10px 0; border-radius: 5px; }
                .issue h3 { margin-top: 0; color: #856404; }
                code { background: #f5f5f5; padding: 2px 4px; border-radius: 3px; }
            </style>
        </head>
        <body>
            <h1>\u26A0\uFE0F Configuration Issues Found</h1>
            ${t}
            <p><strong>To fix these issues:</strong> Open VS Code Settings and update the highlighted settings with valid values.</p>
        </body>
        </html>
    `}async function bi(i){let e=p.window.createWebviewPanel("explorerDatesMigrationHistory","Explorer Dates - Migration History",p.ViewColumn.One,{enableScripts:!1}),t=i.slice().reverse().map((s,r)=>`
        <div class="migration-record">
            <h3>Migration #${i.length-r}</h3>
            <p><strong>Date:</strong> ${new Date(s.timestamp).toLocaleString()}</p>
            <p><strong>Extension Version:</strong> ${s.extensionVersion}</p>
            <p><strong>Settings Migrated:</strong></p>
            <ul>
                ${s.migratedSettings.map(n=>`<li><code>${n}</code></li>`).join("")}
            </ul>
        </div>
    `).join("");e.webview.html=`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Migration History</title>
            <style>
                body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; }
                h1 { color: #007ACC; }
                .migration-record { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 15px 0; border-radius: 5px; }
                .migration-record h3 { margin-top: 0; color: #495057; }
                code { background: #e9ecef; padding: 2px 4px; border-radius: 3px; }
                ul { line-height: 1.6; }
            </style>
        </head>
        <body>
            <h1>\u{1F4DC} Settings Migration History</h1>
            ${t}
        </body>
        </html>
    `}async function yi({context:i,logger:e,subscriptions:t}){var r,n,o;if(pi()){(r=e==null?void 0:e.warn)==null||r.call(e,"Duplicate explorerDates.resetToDefaults registration skipped");return}let s;try{s=await p.commands.getCommands(!0)}catch(a){(n=e==null?void 0:e.warn)==null||n.call(e,"Unable to inspect VS Code command registry; proceeding with reset command registration",a)}if(Array.isArray(s)&&s.includes(Ms)){Rs(),(o=e==null?void 0:e.warn)==null||o.call(e,"Detected existing explorerDates.resetToDefaults handler; skipping duplicate registration");return}Rs(),t.push(p.commands.registerCommand(Ms,async()=>{var a,l;try{if(await p.window.showWarningMessage("This will reset all Explorer Dates settings to their default values. Are you sure?",{modal:!0},"Reset Settings","Cancel")!=="Reset Settings")return;let h=i.extension.packageJSON,u=((l=(a=h==null?void 0:h.contributes)==null?void 0:a.configuration)==null?void 0:l.properties)||{},f=0;for(let m of Object.keys(u))if(m.startsWith("explorerDates.")){let w=m.replace("explorerDates.","");try{await je.clearSetting(w,{scope:"user",reason:"reset-to-defaults"}),await je.clearSetting(w,{scope:"workspace",reason:"reset-to-defaults"}),f++}catch(y){e.warn(`Failed to reset setting ${w}`,y)}}p.window.showInformationMessage(`\u2705 Reset ${f} settings to defaults.`),e.info("Settings reset to defaults",{resetCount:f})}catch(c){e.error("Failed to reset settings to defaults",c),p.window.showErrorMessage(`Failed to reset settings: ${c.message}`)}}))}Os.exports={registerMigrationCommands:mi}});var Ws=_((exports,module)=>{var vscode=require("vscode"),fs=null,path=null,Is;try{typeof process<"u"&&((Is=process.versions)!=null&&Is.node)&&(fs=eval("require")("fs"),path=eval("require")("path"))}catch{fs=null,path=null}var textDecoder=typeof globalThis.TextDecoder=="function"?new globalThis.TextDecoder("utf-8"):new(require("util")).TextDecoder("utf-8"),TemplateStore=class{constructor(){this.xt=new Map,this.Mt=null}initialize(e){this.Mt=(e==null?void 0:e.extensionUri)??null}async getTemplate(e){if(this.xt.has(e))return this.xt.get(e);let t=await this.Fi(e);return this.xt.set(e,t),t}async Fi(e){let t=`${e}.html`;if(this.Mt){let s=vscode.Uri.joinPath(this.Mt,"assets","templates",t),r=await vscode.workspace.fs.readFile(s);return textDecoder.decode(r)}if(fs&&path){let s=path.resolve(__dirname,"..","..","assets","templates",t);return await fs.promises.readFile(s,"utf8")}throw new Error(`TemplateStore: Unable to load template "${e}" (missing extension context)`)}},templateStore=new TemplateStore;module.exports={templateStore,initializeTemplateStore:i=>templateStore.initialize(i)}});var Ns=_((Vi,$s)=>{var X=require("vscode"),{getLogger:Ei}=Y(),{getSettingsCoordinator:_i}=Ke(),{SettingsOrganizer:Ci}=vt(),kt=class{constructor(){this._logger=Ei(),this.d=new Set,this.l=_i(),this.Rt=null,this.Rs=null}async migrateAllSettings(e){let t=[()=>this.migrateReportingSettings(),()=>this.migrateCustomColorSettings(),()=>this.validateFeatureFlags(),()=>this.cleanupDeprecatedSettings(),()=>this.trackMigrationMetrics(e)],s=[];for(let r of t)try{let n=await r();n&&s.push(n)}catch(n){this._logger.error("Settings migration failed:",n)}return s.length>0&&(this._logger.info("Settings migration completed",{migratedSettings:s}),this.Ai(s)),s}async migrateReportingSettings(){let e=this.l.inspect("enableReporting"),t=this.l.inspect("enableExportReporting");if((e==null?void 0:e.globalValue)!==void 0&&(t==null?void 0:t.globalValue)===void 0)try{await this.l.updateSetting("enableExportReporting",e.globalValue,{scope:"user",reason:"migrate-enableReporting-global"}),this.d.add("enableReporting\u2192enableExportReporting (Global)"),this._logger.info("Migrated global enableReporting to enableExportReporting",{oldValue:e.globalValue})}catch(s){this._logger.error("Failed to migrate global enableReporting setting",s)}if((e==null?void 0:e.workspaceValue)!==void 0&&(t==null?void 0:t.workspaceValue)===void 0)try{await this.l.updateSetting("enableExportReporting",e.workspaceValue,{scope:"workspace",reason:"migrate-enableReporting-workspace"}),this.d.add("enableReporting\u2192enableExportReporting (Workspace)"),this._logger.info("Migrated workspace enableReporting to enableExportReporting",{oldValue:e.workspaceValue})}catch(s){this._logger.error("Failed to migrate workspace enableReporting setting",s)}if((e==null?void 0:e.workspaceFolderValue)!==void 0&&(t==null?void 0:t.workspaceFolderValue)===void 0)try{await this.l.updateSetting("enableExportReporting",e.workspaceFolderValue,{scope:"workspaceFolder",reason:"migrate-enableReporting-folder"}),this.d.add("enableReporting\u2192enableExportReporting (WorkspaceFolder)"),this._logger.info("Migrated workspace folder enableReporting to enableExportReporting",{oldValue:e.workspaceFolderValue})}catch(s){this._logger.error("Failed to migrate workspace folder enableReporting setting",s)}return this.d.has("enableReporting\u2192enableExportReporting (Global)")||this.d.has("enableReporting\u2192enableExportReporting (Workspace)")||this.d.has("enableReporting\u2192enableExportReporting (WorkspaceFolder)")}async migrateCustomColorSettings(){let t=X.workspace.getConfiguration("explorerDates").get("customColors");if(!t||typeof t!="object")return!1;let s=this.l.getValue("workbench.colorCustomizations")||{};if(s["explorerDates.customColor.veryRecent"]!==void 0||s["explorerDates.customColor.recent"]!==void 0||s["explorerDates.customColor.old"]!==void 0)return!1;let n={...s,"explorerDates.customColor.veryRecent":t.veryRecent||"#00ff00","explorerDates.customColor.recent":t.recent||"#ffff00","explorerDates.customColor.old":t.old||"#ff0000"};try{return await this.l.updateSetting("workbench.colorCustomizations",n,{scope:"user",reason:"migrate-customColors"}),this.d.add("customColors\u2192workbench.colorCustomizations"),this._logger.info("Migrated custom colors to workbench.colorCustomizations",{oldColors:t,newColors:n}),!0}catch(o){return this._logger.error("Failed to migrate custom colors",o),!1}}async validateFeatureFlags(){let e={enableOnboardingSystem:{default:!0,type:"boolean"},enableExportReporting:{default:!0,type:"boolean"},enableAnalysisCommands:{default:!0,type:"boolean"},enableAdvancedCache:{default:!0,type:"boolean"},enableWorkspaceIntelligence:{default:!0,type:"boolean"},enableWorkspaceTemplates:{default:!0,type:"boolean"},enableExtensionApi:{default:!0,type:"boolean"},enableProgressiveAnalysis:{default:null,type:"boolean",allowNull:!0}},t=!1,s=[],r=[];for(let[n,o]of Object.entries(e)){let a=this.l.inspect(n),l=this.l.getValue(n),c=(a==null?void 0:a.globalValue)!==void 0,h=(a==null?void 0:a.workspaceValue)!==void 0;if(!c&&!h)r.push(n);else if(l!==void 0&&!(o.allowNull&&l===null?!0:typeof l===o.type))try{await this.l.updateSetting(n,o.default,{scope:"user",reason:`feature-flag-validation:${n}`}),s.push(`${n}: corrected type mismatch`),t=!0}catch(f){this._logger.error(`Failed to fix feature flag ${n}`,f)}}return t?(this.d.add("featureFlags\u2192validated"),this._logger.info("Validated feature flags",{fixes:s})):r.length>0&&this._logger.info("Feature flags relying on defaults (no migration needed)",{flags:r}),t}async cleanupDeprecatedSettings(){let e=["customColors","enableReporting"],t=[];for(let r of e){let n=this.l.inspect(r);((n==null?void 0:n.globalValue)!==void 0||(n==null?void 0:n.workspaceValue)!==void 0||(n==null?void 0:n.workspaceFolderValue)!==void 0)&&t.push(r)}if(t.length===0)return!1;if(await X.window.showInformationMessage(`Explorer Dates found ${t.length} deprecated setting(s). Would you like to remove them?`,{modal:!1},"Clean Up Now","Keep Old Settings","Ask Later")==="Clean Up Now"){for(let r of t)try{await this.l.clearSetting(r,{scope:"user",reason:"cleanup-deprecated"}),await this.l.clearSetting(r,{scope:"workspace",reason:"cleanup-deprecated"}),await this.l.clearSetting(r,{scope:"workspaceFolder",reason:"cleanup-deprecated"}),this._logger.info(`Removed deprecated setting: ${r}`)}catch(n){this._logger.error(`Failed to remove deprecated setting ${r}`,n)}return this.d.add("deprecatedSettings\u2192removed"),!0}return!1}async trackMigrationMetrics(e){if(this.d.size===0)return!1;let t=e.globalState.get("explorerDates.migrationHistory",[]),s={timestamp:new Date().toISOString(),extensionVersion:e.extension.packageJSON.version,migratedSettings:Array.from(this.d)};return t.push(s),t.length>5&&t.splice(0,t.length-5),await e.globalState.update("explorerDates.migrationHistory",t),this._logger.info("Recorded migration metrics",s),!0}async autoOrganizeSettingsIfNeeded(e,t={}){let s=this.xi(e);if(!s)return null;try{let r=await s.getOrganizationPlan();if(!(r!=null&&r.needsWork))return this._logger.debug("Auto organization skipped - no Explorer Dates settings to tidy."),null;let n=await s.organize({plan:r});if(n!=null&&n.changed){if(!t.silent){let o=[];n.movedToWorkspace.length&&o.push(`${n.movedToWorkspace.length} moved to workspace`),n.reorderedWorkspace&&o.push("workspace keys sorted"),n.sortedFiles.length&&o.push(`${n.sortedFiles.length} file(s) tidied`);let a=o.length?` (${o.join(" \u2022 ")})`:"";X.window.showInformationMessage(`Explorer Dates cleaned up project settings${a}.`)}this._logger.info("Explorer Dates settings auto-organized",{trigger:t.trigger||"unknown",summary:n})}return n}catch(r){return this._logger.warn("Automatic Explorer Dates settings organization failed",r),null}}xi(e){return e?((!this.Rt||this.Rs!==e)&&(this.Rt=new Ci(e),this.Rs=e),this.Rt):(this._logger.debug("Settings organizer unavailable - missing extension context."),null)}async Ai(e){let s=`Explorer Dates updated ${e.length} setting(s) for compatibility. Your configuration has been preserved.`;switch(await X.window.showInformationMessage(s,{modal:!1},"View Changes","Open Settings")){case"View Changes":await this.Mi();break;case"Open Settings":await X.commands.executeCommand("workbench.action.openSettings","explorerDates");break}}async Mi(){let e=X.window.createWebviewPanel("explorerDatesMigration","Explorer Dates - Settings Migration",X.ViewColumn.One,{enableScripts:!1}),t=Array.from(this.d).map(s=>`<li><code>${s}</code></li>`).join("");e.webview.html=`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Settings Migration</title>
                <style>
                    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; }
                    h1 { color: #007ACC; }
                    code { background: #f5f5f5; padding: 2px 4px; border-radius: 3px; }
                    ul { line-height: 1.6; }
                    .info { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 10px 0; }
                </style>
            </head>
            <body>
                <h1>\u{1F527} Settings Migration Completed</h1>
                
                <div class="info">
                    <strong>Good news!</strong> Explorer Dates automatically updated your settings to use the latest configuration options. Your preferences have been preserved.
                </div>

                <h2>Changes Made:</h2>
                <ul>
                    ${t}
                </ul>

                <h2>What This Means:</h2>
                <ul>
                    <li><strong>enableReporting \u2192 enableExportReporting:</strong> Consolidated naming for consistency</li>
                    <li><strong>customColors \u2192 workbench.colorCustomizations:</strong> Uses VS Code's standard color system</li>
                    <li><strong>Feature flags validated:</strong> Ensures proper types and values</li>
                    <li><strong>Deprecated settings cleaned:</strong> Removes unused configuration</li>
                </ul>

                <h2>Next Steps:</h2>
                <ul>
                    <li>Your extension will continue working as before</li>
                    <li>Check VS Code Settings if you want to customize further</li>
                    <li>Run "Explorer Dates: Validate Configuration" anytime to check for issues</li>
                </ul>
            </body>
            </html>
        `}async validateConfiguration(){let e=[],t=X.workspace.getConfiguration("explorerDates"),s=[{setting:"dateDecorationFormat",validate:r=>["smart","relative-short","relative-long","absolute-short","absolute-long"].includes(r),message:"Invalid date decoration format"},{setting:"colorScheme",validate:r=>["none","recency","file-type","subtle","vibrant","custom"].includes(r),message:"Invalid color scheme"},{setting:"badgePriority",validate:r=>["time","author","size"].includes(r),message:"Invalid badge priority"},{setting:"maxCacheSize",validate:r=>typeof r=="number"&&r>=100&&r<=5e4,message:"Cache size must be between 100 and 50,000"},{setting:"cacheTimeout",validate:r=>typeof r=="number"&&r>=5e3&&r<=3e5,message:"Cache timeout must be between 5,000 and 300,000 milliseconds"}];for(let r of s){let n=t.get(r.setting);n!==void 0&&!r.validate(n)&&e.push({setting:r.setting,value:n,message:r.message})}return e}getMigrationHistory(e){return e.globalState.get("explorerDates.migrationHistory",[])}};$s.exports={SettingsMigrationManager:kt}});var vscode=require("vscode"),{FileDateDecorationProvider}=_s(),{getLogger}=Y(),{getLocalization}=Ze(),{fileSystem}=Pe(),{registerCoreCommands}=Ds(),{registerOnboardingCommands}=Fs(),{registerMigrationCommands}=Ps(),{initializeTemplateStore}=Ws(),{SettingsMigrationManager}=Ns(),{ExtensionError,ERROR_CODES,ChunkLoadError,handleChunkFailure}=tt(),{ensureDate}=be(),{WEB_CHUNK_GLOBAL_KEY,LEGACY_WEB_CHUNK_GLOBAL_KEY}=ye(),isWebEnvironment=typeof process<"u"&&!1,nodeFs=null,nodePath=null,webTextDecoder=typeof TextDecoder=="function"?new TextDecoder("utf-8"):null;if(!isWebEnvironment){try{nodeFs=require("fs")}catch{nodeFs=null}try{nodePath=require("path")}catch{nodePath=null}}var AUTO_SUGGESTION_DELAY_MS=3e3,CRITICAL_CHUNKS=["incrementalWorkers"];function resolveDefaultDistPath(){return!nodePath||typeof nodePath.basename!="function"||typeof nodePath.join!="function"?null:nodePath.basename(__dirname)==="dist"?__dirname:nodePath.join(__dirname,"dist")}var DEFAULT_DIST_PATH=resolveDefaultDistPath(),fileDateProvider,logger,l10n,runtimeAutoSuggestionTimer=null,activeRuntimeManager=null,activeTeamPersistenceManager=null,ANALYSIS_WARNING_WORKSPACE_KEY="explorerDates.analysisCommandsDisabledWarningByWorkspace";function getActiveLogger(){return logger||(logger=getLogger()),logger}function getWorkspaceId(){var e,t;let i=(e=vscode.workspace.workspaceFolders)==null?void 0:e[0];return((t=i==null?void 0:i.uri)==null?void 0:t.toString())||"global"}function hasShownAnalysisWarning(i){return!!i.globalState.get(ANALYSIS_WARNING_WORKSPACE_KEY,{})[getWorkspaceId()]}async function setAnalysisWarningShown(i,e){let t=i.globalState.get(ANALYSIS_WARNING_WORKSPACE_KEY,{});t[getWorkspaceId()]=e,await i.globalState.update(ANALYSIS_WARNING_WORKSPACE_KEY,t)}var{registerFeatureFlagsGlobal}=ht(),featureFlagsModule=se();registerFeatureFlagsGlobal(featureFlagsModule);var featureFlags=featureFlagsModule,{setFeatureChunkResolver}=featureFlagsModule,{generateDevLoaderMap}=ut(),sourceChunkLoader=(()=>{if(typeof process>"u"||process.env.NODE_ENV==="production")return null;try{let localRequire=eval("require");return i=>{var e;try{let t=generateDevLoaderMap(localRequire),s=(e=t[i])==null?void 0:e.call(t);return(s==null?void 0:s.default)||s||null}catch(t){let s=new ExtensionError(ERROR_CODES.CHUNK_LOAD_FAILED,`Source chunk fallback failed for ${i}`,{chunkName:i,source:"development",error:t.message});return getActiveLogger().warn(s.message,s.context),null}}}catch{return null}})(),chunkLoader={loadedChunks:new Map,distPath:DEFAULT_DIST_PATH,extensionUri:null,webChunkPromises:new Map,Ls:new Set,Lt:new Set,initialize(i){nodePath&&(typeof(i==null?void 0:i.asAbsolutePath)=="function"?this.distPath=i.asAbsolutePath("dist"):i!=null&&i.extensionPath&&(this.distPath=nodePath.join(i.extensionPath,"dist"))),i!=null&&i.extensionUri&&(this.extensionUri=i.extensionUri)},async loadChunk(i){if(this.loadedChunks.has(i))return this.loadedChunks.get(i);try{if(isWebEnvironment){let t=await this.Ri(i);return t&&(this.loadedChunks.set(i,t),getActiveLogger().info("Chunk loaded",{chunkName:i,target:"web"})),t}let e=this.Li(i);return e&&(this.loadedChunks.set(i,e),getActiveLogger().info("Chunk loaded",{chunkName:i,target:"node"})),e}catch(e){let t=e instanceof ExtensionError?e:new ExtensionError(ERROR_CODES.CHUNK_LOAD_FAILED,`Failed to load chunk ${i}`,{chunkName:i,target:isWebEnvironment?"web":"node",error:e==null?void 0:e.message});return getActiveLogger().warn(t.message,t.context),null}},assertChunkArtifacts(i=[]){if(!nodeFs||!this.distPath||!Array.isArray(i)||i.length===0)return;let e=i.filter(t=>!this.Oi(t));if(e.length>0){let t=new ChunkLoadError(e.join(", "),"missing built artifacts",{recoverable:!1,context:{chunkNames:e,distPath:this.distPath,fix:'Run "npm run package-chunks" before packaging or testing.'}});throw handleChunkFailure(e.join(", "),t,{userFacing:!0}),t}},Oi(i){if(!nodeFs||!this.distPath)return!0;let e=nodePath.join(this.distPath,"chunks",`${i}.js`),t=nodePath.join(this.distPath,"web-chunks",`${i}.js`);return nodeFs.existsSync(e)&&nodeFs.existsSync(t)},Li(i){if(nodeFs&&nodePath&&this.distPath){let e=nodePath.join(this.distPath,"chunks",`${i}.js`);if(nodeFs.existsSync(e))try{let t=require(e);return t!=null&&t.default&&(t=t.default),t}catch(t){let s=new ExtensionError(ERROR_CODES.CHUNK_LOAD_FAILED,`Failed to require built chunk ${i}`,{chunkName:i,path:e,error:t.message});getActiveLogger().warn(s.message,s.context)}}return sourceChunkLoader?sourceChunkLoader(i):(this.Os(i),null)},async Ri(i){if(!this.extensionUri){let e=new ExtensionError(ERROR_CODES.CHUNK_LOAD_FAILED,"Missing extensionUri for web chunk loading",{chunkName:i});return getActiveLogger().warn(e.message,e.context),null}if(!this.webChunkPromises.has(i)){let e=(async()=>{await this.Pi(i);let t=this.Ii(),s=t==null?void 0:t[i];if(!s)throw new Error(`Web chunk ${i} failed to register`);return s})();this.webChunkPromises.set(i,e)}return this.webChunkPromises.get(i)},async Pi(i){var t;if(this.Ls.has(i))return;let e=vscode.Uri.joinPath(this.extensionUri,"dist","web-chunks",`${i}.js`);if(!((t=vscode.workspace)!=null&&t.fs)||!webTextDecoder)throw new Error("Workspace FS or TextDecoder unavailable for web chunk loading");try{let s=await vscode.workspace.fs.readFile(e),r=webTextDecoder.decode(s);new Function(r).call(globalThis),this.Ps(),this.Ls.add(i)}catch(s){throw this.Os(i),s}},Ii(){let i=globalThis[WEB_CHUNK_GLOBAL_KEY]||globalThis[LEGACY_WEB_CHUNK_GLOBAL_KEY]||null;return i&&this.Ps(),i},Ps(){let i=globalThis[WEB_CHUNK_GLOBAL_KEY]||globalThis[LEGACY_WEB_CHUNK_GLOBAL_KEY]||{};globalThis[WEB_CHUNK_GLOBAL_KEY]||(globalThis[WEB_CHUNK_GLOBAL_KEY]=i),globalThis[LEGACY_WEB_CHUNK_GLOBAL_KEY]||(globalThis[LEGACY_WEB_CHUNK_GLOBAL_KEY]=i)},Os(i){if(this.Lt.has(i))return;this.Lt.add(i);let e=new ChunkLoadError(i,"artifact unavailable",{recoverable:!1,context:{chunkName:i,distPath:this.distPath,fix:'Run "npm run package-chunks" to rebuild runtime chunks.'}});getActiveLogger().error(e.message,e),handleChunkFailure(i,e,{userFacing:!1})}},dynamicImports={async loadOnboarding(i){let e=await featureFlags.onboarding();return e?typeof e.createOnboardingManager=="function"?e.createOnboardingManager(i):e.OnboardingManager?new e.OnboardingManager(i):null:null},async loadExportReporting(i){let e=await featureFlags.exportReporting();return typeof(e==null?void 0:e.createExportReportingManager)=="function"?e.createExportReportingManager(i):null},async loadWorkspaceTemplates(i){let e=await featureFlags.workspaceTemplates();return typeof(e==null?void 0:e.createWorkspaceTemplatesManager)=="function"?e.createWorkspaceTemplatesManager(i):e!=null&&e.WorkspaceTemplatesManager?new e.WorkspaceTemplatesManager(i):null},async loadAnalysisCommands(){return featureFlags.analysisCommands()},async loadExtensionApi(i){let e=await featureFlags.extensionApi();if(!e)return null;if(typeof e=="function"){if(e.name==="createExtensionApiManager")return e(i);try{return new e}catch{return null}}else{if(typeof e.createExtensionApiManager=="function")return e.createExtensionApiManager(i);if(e.ExtensionApiManager)return new e.ExtensionApiManager}return null}},onboardingManagerPromise=null,workspaceTemplatesManagerPromise=null,exportReportingManagerPromise=null,extensionApiManagerPromise=null;function shouldPrimeOnboardingChunk(i){var n,o;if(!(i!=null&&i.globalState))return!0;let e=i.globalState.get("explorerDates.hasShownWelcome",!1),t=i.globalState.get("explorerDates.hasCompletedSetup",!1),s=i.globalState.get("explorerDates.onboardingVersion","0.0.0"),r=((o=(n=i.extension)==null?void 0:n.packageJSON)==null?void 0:o.version)||"0.0.0";return!e||!t?!0:isMajorVersionUpdate(s,r)}function isMajorVersionUpdate(i,e){let t=n=>{let[o="0"]=(n||"").split("."),a=Number.parseInt(o,10);return Number.isFinite(a)?a:0},s=t(i);return t(e)>s}function ensureOnboardingManager(i){return onboardingManagerPromise||(onboardingManagerPromise=dynamicImports.loadOnboarding(i)),onboardingManagerPromise}function ensureWorkspaceTemplatesManager(i){return workspaceTemplatesManagerPromise||(workspaceTemplatesManagerPromise=dynamicImports.loadWorkspaceTemplates(i)),workspaceTemplatesManagerPromise}function ensureExportReportingManager(i){return exportReportingManagerPromise||(exportReportingManagerPromise=dynamicImports.loadExportReporting(i)),exportReportingManagerPromise}function ensureExtensionApiManager(i){return extensionApiManagerPromise||(extensionApiManagerPromise=dynamicImports.loadExtensionApi(i)),extensionApiManagerPromise}function raiseChunkUnavailable(i,e){let t=`${i} is not available because the required "${e}" runtime chunk failed to load. Reinstall Explorer Dates or run "npm run package-chunks" and reload VS Code.`;throw getActiveLogger().warn(t,{chunkName:e}),vscode.window.showErrorMessage(t),new ChunkLoadError(e,"chunk missing at runtime",{recoverable:!1,context:{featureLabel:i}})}function initializeStatusBar(i){let e=vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Right,100);e.command="explorerDates.showFileDetails",e.tooltip="Click to show detailed file information";let t=async()=>{try{let n=vscode.window.activeTextEditor;if(!n){e.hide();return}let o=n.document.uri;if(o.scheme!=="file"){e.hide();return}let a=await fileSystem.stat(o),l=ensureDate(a.mtime),c=fileDateProvider.Ss(l,"smart"),h=fileDateProvider.ve(a.size,"auto");e.text=`$(clock) ${c} $(file) ${h}`,e.show()}catch(n){e.hide(),logger.debug("Failed to update status bar",n)}},s=vscode.window.onDidChangeActiveTextEditor(t),r=vscode.window.onDidChangeTextEditorSelection(t);return t(),i.subscriptions.push(e,s,r),e}async function activate(i){try{logger=getLogger(),l10n=getLocalization(),i.subscriptions.push(l10n),initializeTemplateStore(i),chunkLoader.initialize(i),chunkLoader.assertChunkArtifacts(CRITICAL_CHUNKS),setFeatureChunkResolver(g=>chunkLoader.loadChunk(g)),logger.info("Explorer Dates: Extension activated");let e=new SettingsMigrationManager;try{await e.migrateAllSettings(i)}catch(g){logger.warn("Settings migration encountered issues:",g)}try{await e.autoOrganizeSettingsIfNeeded(i,{trigger:"activation",silent:!0})}catch(g){logger.warn("Settings organization encountered issues:",g)}let t=vscode.env.uiKind===vscode.UIKind.Web;await vscode.commands.executeCommand("setContext","explorerDates.gitFeaturesAvailable",!t);let s=vscode.workspace.getConfiguration("explorerDates"),r=s.get("enableExportReporting",s.get("enableReporting",!0)),n=s.get("enableExtensionApi",!0),o=s.get("enableOnboardingSystem",!0),a=s.get("enableAnalysisCommands",!0);fileDateProvider=new FileDateDecorationProvider;let l=vscode.window.registerFileDecorationProvider(fileDateProvider);i.subscriptions.push(l),i.subscriptions.push(fileDateProvider),i.subscriptions.push(logger),await fileDateProvider.initializeAdvancedSystems(i),await fileDateProvider.checkWorkspaceSize();let c=null,h=!1,u=async()=>{if(!n)throw new Error("Extension API is disabled via explorerDates.enableExtensionApi");return c||(c=await ensureExtensionApiManager(i),c&&i.subscriptions&&i.subscriptions.push(c)),c},f=async()=>{if(!r)throw new Error("Reporting is disabled via explorerDates.enableExportReporting");if(!h){let k=vscode.workspace.getConfiguration("explorerDates").get("performanceMode",!1),D=process.env.EXPLORER_DATES_LIGHTWEIGHT_MODE==="1";(k||D)&&logger.warn("Initializing Export Reporting Manager while performance/lightweight mode is active; activity tracking will remain suppressed.")}let g=await ensureExportReportingManager(i);return g&&!h&&(i.subscriptions.push(g),h=!0),g},m=null,w=null,y=async()=>(w||(w=(async()=>{let g=await u();return m=g?g.getApi():null,m})()),w);n?(i.exports=y,i.exportsAsync=y):(i.exports=void 0,i.exportsAsync=void 0,logger.info("Explorer Dates API exports disabled via explorerDates.enableExtensionApi"));let W=s.get("showWelcomeOnStartup",!0);if(o&&W)if(shouldPrimeOnboardingChunk(i)){let g=await ensureOnboardingManager(i);g&&await g.shouldShowOnboarding()&&setTimeout(()=>{g.showWelcomeMessage()},5e3)}else logger.debug("Skipping onboarding preload \u2013 user already completed onboarding for this major version.");registerCoreCommands({context:i,fileDateProvider,logger,l10n});let O=async()=>{let g=await dynamicImports.loadAnalysisCommands();if(!g){let D=Array.from((chunkLoader==null?void 0:chunkLoader.Lt)||[]).includes("analysis")?'Analysis chunk is missing. Rebuild with "npm run package-bundle" and reload.':"Analysis bundle did not load. Rebuild the extension and reload.";return vscode.window.showWarningMessage(`Analysis commands unavailable. ${D}`),null}let b=g.registerAnalysisCommands||g;return typeof b!="function"?(vscode.window.showWarningMessage("Analysis commands registration function not found."),null):b({context:i,fileDateProvider,logger,chunkLoader})};if(a){try{await O(),logger.info("Analysis commands registered successfully")}catch(g){logger.warn("Failed to register analysis commands:",g),vscode.window.showWarningMessage("Explorer Dates analysis commands failed to initialize. Check build artifacts for the analysis chunk and reload.")}await setAnalysisWarningShown(i,!1)}else try{hasShownAnalysisWarning(i)||vscode.window.showInformationMessage("Explorer Dates analysis commands are disabled. Shortcuts like Ctrl+Shift+M/H/A will not work until you enable explorerDates.enableAnalysisCommands.","Enable Now","Dismiss").then(async b=>{var D;let k=process.env.EXPLORER_DATES_TEST_MODE==="1"?"Dismiss":b;if(k==="Enable Now")try{let v=s.inspect("enableAnalysisCommands"),ae=vscode.workspace.workspaceFolders||[],q=!1;for(let U of ae){let De=vscode.workspace.getConfiguration("explorerDates",U.uri),L=De.inspect("enableAnalysisCommands");if((L==null?void 0:L.workspaceFolderValue)===!1)try{await De.update("enableAnalysisCommands",!0,vscode.ConfigurationTarget.WorkspaceFolder)}catch(le){q=!0,logger.warn("Failed to auto-enable analysis commands for workspace folder",{folder:(D=U.uri)==null?void 0:D.toString(),error:le==null?void 0:le.message})}}if((v==null?void 0:v.workspaceValue)===!1)try{await s.update("enableAnalysisCommands",!0,vscode.ConfigurationTarget.Workspace)}catch(U){q=!0,logger.warn("Failed to auto-enable analysis commands for workspace scope",U)}if((v==null?void 0:v.globalValue)===!1)try{await s.update("enableAnalysisCommands",!0,vscode.ConfigurationTarget.Global)}catch(U){q=!0,logger.warn("Failed to auto-enable analysis commands for user scope",U)}q?(await setAnalysisWarningShown(i,!1),vscode.window.showWarningMessage("Enable partially succeeded. Update explorerDates.enableAnalysisCommands in remaining workspace folders manually.")):(await setAnalysisWarningShown(i,!1),await vscode.commands.executeCommand("workbench.action.reloadWindow"))}catch(v){await setAnalysisWarningShown(i,!1),vscode.window.showWarningMessage("Enable failed: update explorerDates.enableAnalysisCommands in workspace settings."),logger.warn("Failed to auto-enable analysis commands",v)}else k==="Dismiss"?await setAnalysisWarningShown(i,!0):await setAnalysisWarningShown(i,!1)})}catch(g){logger.debug("Unable to show analysis disabled warning",g)}registerOnboardingCommands({context:i,logger,getOnboardingManager:()=>ensureOnboardingManager(i)});let oe=await registerMigrationCommands({context:i,logger,getSettingsMigrationManager:()=>Promise.resolve(e)});i.subscriptions.push(...oe);let Se=vscode.commands.registerCommand("explorerDates.openTemplateManager",async()=>{try{if(!vscode.workspace.getConfiguration("explorerDates").get("enableWorkspaceTemplates",!0))throw vscode.window.showInformationMessage("Workspace templates are disabled. Enable explorerDates.enableWorkspaceTemplates to use this command."),new Error("Workspace templates feature disabled via settings.");await featureFlags.workspaceTemplates()||raiseChunkUnavailable("Workspace templates","workspaceTemplates");let D=await ensureWorkspaceTemplatesManager(i);D||raiseChunkUnavailable("Workspace templates","workspaceTemplates"),await D.showTemplateManager(),logger.info("Template manager opened")}catch(g){throw logger.error("Failed to open template manager",g),vscode.window.showErrorMessage(`Failed to open template manager: ${g.message}`),g}});i.subscriptions.push(Se);let ve=vscode.commands.registerCommand("explorerDates.saveTemplate",async()=>{try{if(!vscode.workspace.getConfiguration("explorerDates").get("enableWorkspaceTemplates",!0))throw vscode.window.showInformationMessage("Workspace templates are disabled. Enable explorerDates.enableWorkspaceTemplates to save templates."),new Error("Workspace templates feature disabled via settings.");await featureFlags.workspaceTemplates()||raiseChunkUnavailable("Workspace templates","workspaceTemplates");let D=await vscode.window.showInputBox({prompt:"Enter template name",placeHolder:"e.g., My Project Setup"});if(D){let v=await vscode.window.showInputBox({prompt:"Enter description (optional)",placeHolder:"Brief description of this template"})||"",ae=await ensureWorkspaceTemplatesManager(i);ae||raiseChunkUnavailable("Workspace templates","workspaceTemplates"),await ae.saveCurrentConfiguration(D,v)}logger.info("Template saved")}catch(g){throw logger.error("Failed to save template",g),vscode.window.showErrorMessage(`Failed to save template: ${g.message}`),g}});i.subscriptions.push(ve);let ke=vscode.commands.registerCommand("explorerDates.generateReport",async()=>{try{if(!r)throw vscode.window.showInformationMessage("Reporting features are disabled. Enable explorerDates.enableExportReporting to generate reports."),new Error("Reporting features disabled via settings.");await featureFlags.exportReporting()||raiseChunkUnavailable("Export reporting","exportReporting");let b=await f();b||raiseChunkUnavailable("Export reporting","exportReporting"),await b.showReportDialog(),logger.info("Report generation started")}catch(g){throw logger.error("Failed to generate report",g),vscode.window.showErrorMessage(`Failed to generate report: ${g.message}`),g}});i.subscriptions.push(ke);let M=vscode.commands.registerCommand("explorerDates.showApiInfo",async()=>{try{if(!n)throw vscode.window.showInformationMessage("Explorer Dates API is disabled via settings."),new Error("Explorer Dates API disabled via settings.");await featureFlags.extensionApi()||raiseChunkUnavailable("Extension API","extensionApi");let b=vscode.window.createWebviewPanel("apiInfo","Explorer Dates API Information",vscode.ViewColumn.One,{enableScripts:!0}),k=await chunkLoader.loadChunk("diagnostics");if(!k)throw new Error("Diagnostics chunk failed to load");k.ensureInitialized(i);let D=await y();if(!D)throw new Error("API factory returned null - extension API may be disabled");b.webview.html=await k.getApiInformationHtml(D),logger.info("API information panel opened")}catch(g){throw logger.error("Failed to show API information",g),vscode.window.showErrorMessage(`Failed to show API information: ${g.message}`),g}});i.subscriptions.push(M);let S,$=vscode.workspace.getConfiguration("explorerDates"),P=$.get("performanceMode",!1);$.get("showStatusBar",!1)&&!P&&(S=initializeStatusBar(i));let j=vscode.workspace.onDidChangeConfiguration(g=>{if(g.affectsConfiguration("explorerDates.showStatusBar")||g.affectsConfiguration("explorerDates.performanceMode")){let b=vscode.workspace.getConfiguration("explorerDates"),k=b.get("showStatusBar",!1),D=b.get("performanceMode",!1),v=k&&!D;v&&!S?S=initializeStatusBar(i):!v&&S&&(S.dispose(),S=null)}});i.subscriptions.push(j),logger.info("Explorer Dates: Date decorations ready");let ge=async()=>{let g=await featureFlags.loadFeatureModule("runtimeManagement");return g!=null&&g.registerRuntimeCommands?g.registerRuntimeCommands:(logger.warn("Runtime chunk missing; runtime commands not initialized"),null)};try{let g=await ge();if(g){let{runtimeManager:b,teamPersistenceManager:k}=g(i);activeRuntimeManager!=null&&activeRuntimeManager.dispose&&activeRuntimeManager.dispose(),activeTeamPersistenceManager!=null&&activeTeamPersistenceManager.dispose&&activeTeamPersistenceManager.dispose(),activeRuntimeManager=b,activeTeamPersistenceManager=k,process.env.EXPLORER_DATES_TEST_MODE!=="1"?runtimeAutoSuggestionTimer=setTimeout(async()=>{try{await b.checkAutoSuggestion(),await k.validateTeamConfiguration()}catch(v){logger.debug("Runtime system auto-suggestion failed:",v)}},AUTO_SUGGESTION_DELAY_MS):logger.debug("Skipping runtime auto-suggestion timer in test mode"),logger.info("Runtime chunk management system initialized")}else logger.warn("Runtime chunk management system unavailable")}catch(g){logger.error("Failed to initialize runtime chunk management:",g)}if(n)return y}catch(e){let t=`${l10n?l10n.getString("activationError"):"Explorer Dates failed to activate"}: ${e.message}`;throw getActiveLogger().error("Extension activation failed",e),vscode.window.showErrorMessage(t),e}}async function deactivate(){try{getActiveLogger().info("Explorer Dates extension is being deactivated"),runtimeAutoSuggestionTimer&&(clearTimeout(runtimeAutoSuggestionTimer),runtimeAutoSuggestionTimer=null),activeRuntimeManager!=null&&activeRuntimeManager.dispose&&(activeRuntimeManager.dispose(),activeRuntimeManager=null),activeTeamPersistenceManager!=null&&activeTeamPersistenceManager.dispose&&(activeTeamPersistenceManager.dispose(),activeTeamPersistenceManager=null),fileDateProvider&&typeof fileDateProvider.dispose=="function"&&await fileDateProvider.dispose(),getActiveLogger().info("Explorer Dates extension deactivated successfully")}catch(i){getActiveLogger().error("Explorer Dates: Error during deactivation",i)}}module.exports={activate,deactivate};
