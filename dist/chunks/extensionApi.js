var d=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports);var f=d((exports,module)=>{var vscode=require("vscode"),isWebRuntime=process.env.VSCODE_WEB==="true",inspectValue=isWebRuntime?l=>{if(typeof l=="string")return l;try{return JSON.stringify(l,null,2)}catch{return"<<unable to serialize log arg>>"}}:eval("require")("util").inspect,DEFAULT_LOG_PROFILE="default",SUPPORTED_PROFILES=new Set(["default","stress","soak"]),LOG_LEVEL_ORDER=["debug","info","warn","error"],DEFAULT_CONSOLE_LEVEL="warn",Logger=class{constructor(){this.e=vscode.window.createOutputChannel("Explorer Dates"),this.c=!1,this.t=null,this.i=(process.env.EXPLORER_DATES_LOG_PROFILE||DEFAULT_LOG_PROFILE).toLowerCase(),SUPPORTED_PROFILES.has(this.i)||(this.i=DEFAULT_LOG_PROFILE),this.o=new Map,this.u=DEFAULT_CONSOLE_LEVEL,this.h(),this.t=vscode.workspace.onDidChangeConfiguration(e=>{(e.affectsConfiguration("explorerDates.enableLogging")||e.affectsConfiguration("explorerDates.consoleLogLevel"))&&this.h()})}h(){let e=vscode.workspace.getConfiguration("explorerDates");this.c=e.get("enableLogging",!1);let t=(e.get("consoleLogLevel",DEFAULT_CONSOLE_LEVEL)||"").toLowerCase();this.u=LOG_LEVEL_ORDER.includes(t)?t:DEFAULT_CONSOLE_LEVEL}setLogProfile(e=DEFAULT_LOG_PROFILE){let t=(e||DEFAULT_LOG_PROFILE).toLowerCase();this.i=SUPPORTED_PROFILES.has(t)?t:DEFAULT_LOG_PROFILE,this.resetThrottle()}resetThrottle(e){if(e){this.o.delete(e);return}this.o.clear()}debug(e,...t){this.c&&this.n("debug",null,e,t)}info(e,...t){this.n("info",null,e,t)}infoWithOptions(e,t,...r){this.n("info",e||null,t,r)}warn(e,...t){this.n("warn",null,e,t)}error(e,t,...r){let o=`[${new Date().toISOString()}] [ERROR] ${e}`;this.e.appendLine(o),t instanceof Error?(this.e.appendLine(`Error: ${t.message}`),t.stack&&this.e.appendLine(`Stack: ${t.stack}`)):t&&this.e.appendLine(this.l(t));let n=this.g(r);n.length>0&&n.forEach(a=>this.e.appendLine(this.l(a))),this.f("error",o,[t,...n])}show(){this.e.show()}clear(){this.e.clear()}dispose(){this.e.dispose(),this.t&&(this.t.dispose(),this.t=null),loggerInstance===this&&(loggerInstance=null)}n(e,t,r,i){if(e==="debug"&&!this.c||this.L(e,t))return;let n=`[${new Date().toISOString()}] [${e.toUpperCase()}] ${r}`;this.e.appendLine(n);let a=this.g(i);a.length>0&&a.forEach(E=>this.e.appendLine(this.l(E))),this.f(e,n,a)}g(e){return!e||e.length===0?[]:e.map(t=>{if(typeof t!="function")return t;try{return t()}catch(r){return`<<log arg threw: ${r.message}>>`}})}l(e){try{return typeof e=="string"?e:typeof e=="object"?JSON.stringify(e,null,2):inspectValue(e)}catch(t){return`<<failed to serialize log arg: ${t.message}>>`}}L(e,t){if(e!=="info"||!t||!t.throttleKey)return!1;let r=(t.profile||"stress").toLowerCase();if(!this.D(r))return!1;let i=Number(t.throttleLimit)||50,o=t.throttleKey,n=this.o.get(o)||{count:0,suppressed:0,noticeLogged:!1};if(n.count<i)return n.count+=1,this.o.set(o,n),!1;if(n.suppressed+=1,!n.noticeLogged){n.noticeLogged=!0;let a=`[${new Date().toISOString()}] [INFO] \u23F8\uFE0F Suppressing further logs for "${o}" after ${i} entries (profile=${this.i})`;this.e.appendLine(a),this.f("info",a)}return this.o.set(o,n),!0}D(e){let t=this.i||DEFAULT_LOG_PROFILE;return e==="default"?t===DEFAULT_LOG_PROFILE:t===e}E(e){let t=LOG_LEVEL_ORDER.indexOf(this.u),r=LOG_LEVEL_ORDER.indexOf(e);return t===-1||r===-1?!1:r>=t}f(e,t,r=[]){if(!this.E(e))return;(e==="warn"?console.warn:e==="error"?console.error:console.log).call(console,t,...r)}},loggerInstance=null;function getLogger(){return loggerInstance||(loggerInstance=new Logger),loggerInstance}module.exports={Logger,getLogger}});var L=d((v,p)=>{var c=require("vscode"),{getLogger:m}=f(),s=m(),u=class{constructor(){this.s=new Map}on(e,t){let r=this.s.get(e)||[];return r.push(t),this.s.set(e,r),this}off(e,t){let r=this.s.get(e);if(!r)return this;let i=r.indexOf(t);return i!==-1&&r.splice(i,1),this}emit(e,...t){let r=this.s.get(e);return r&&r.slice().forEach(i=>{try{i(...t)}catch(o){s.error(`Explorer Dates API handler failed for "${e}":`,o)}}),this}},h=class extends u{constructor(){super(),this.plugins=new Map,this.api=null,this.decorationProviders=new Map,this.t=null,this.initialize(),this.m()}initialize(){this.api=this.createPublicApi(),s.info("Extension API Manager initialized")}createPublicApi(){return{getFileDecorations:this.getFileDecorations.bind(this),refreshDecorations:this.refreshDecorations.bind(this),registerPlugin:this.registerPlugin.bind(this),unregisterPlugin:this.unregisterPlugin.bind(this),registerDecorationProvider:this.registerDecorationProvider.bind(this),unregisterDecorationProvider:this.unregisterDecorationProvider.bind(this),onDecorationChanged:this.onDecorationChanged.bind(this),onFileScanned:this.onFileScanned.bind(this),formatDate:this.formatDate.bind(this),getFileStats:this.getFileStats.bind(this),version:"1.1.0",apiVersion:"1.0.0"}}async getFileDecorations(e){if(!this.r("getFileDecorations"))return[];try{let t=[];for(let r of e){let i=c.Uri.file(r),o=await this.getDecorationForFile(i);o&&t.push({uri:i.toString(),decoration:o})}return t}catch(t){return s.error("Failed to get file decorations:",t),[]}}async getDecorationForFile(e){if(!this.r("getDecorationForFile"))return null;try{let t=await c.workspace.fs.stat(e),r=new Date(t.mtime),i={badge:this.formatDate(r,"smart"),color:void 0,tooltip:`Modified: ${r.toLocaleString()}`};for(let[o,n]of this.decorationProviders)try{let a=await n.provideDecoration(e,t,i);a&&(i={...i,...a})}catch(a){s.error(`Decoration provider ${o} failed:`,a)}return i}catch(t){return s.error("Failed to get decoration for file:",t),null}}async refreshDecorations(e=null){if(!this.r("refreshDecorations"))return!1;try{return this.emit("decorationRefreshRequested",e),s.info("Decoration refresh requested"),!0}catch(t){return s.error("Failed to refresh decorations:",t),!1}}registerPlugin(e,t){if(!this.a(`registerPlugin:${e}`))return!1;try{if(!this.validatePlugin(t))throw new Error("Invalid plugin structure");return this.plugins.set(e,{...t,registeredAt:new Date,active:!0}),typeof t.activate=="function"&&t.activate(this.api),this.emit("pluginRegistered",{pluginId:e,plugin:t}),s.info(`Plugin registered: ${e}`),!0}catch(r){return s.error(`Failed to register plugin ${e}:`,r),!1}}unregisterPlugin(e){if(!this.a(`unregisterPlugin:${e}`))return!1;try{let t=this.plugins.get(e);return t?(typeof t.deactivate=="function"&&t.deactivate(),this.plugins.delete(e),this.emit("pluginUnregistered",{pluginId:e}),s.info(`Plugin unregistered: ${e}`),!0):!1}catch(t){return s.error(`Failed to unregister plugin ${e}:`,t),!1}}registerDecorationProvider(e,t){if(!this.a(`registerDecorationProvider:${e}`))return!1;try{if(!this.validateDecorationProvider(t))throw new Error("Invalid decoration provider");return this.decorationProviders.set(e,t),this.emit("decorationProviderRegistered",{providerId:e,provider:t}),s.info(`Decoration provider registered: ${e}`),!0}catch(r){return s.error(`Failed to register decoration provider ${e}:`,r),!1}}unregisterDecorationProvider(e){if(!this.a(`unregisterDecorationProvider:${e}`))return!1;try{let t=this.decorationProviders.delete(e);return t&&(this.emit("decorationProviderUnregistered",{providerId:e}),s.info(`Decoration provider unregistered: ${e}`)),t}catch(t){return s.error(`Failed to unregister decoration provider ${e}:`,t),!1}}onDecorationChanged(e){return this.on("decorationChanged",e),()=>this.off("decorationChanged",e)}onFileScanned(e){return this.on("fileScanned",e),()=>this.off("fileScanned",e)}formatDate(e,t=null){if(!this.r("formatDate"))return"";try{let r=c.workspace.getConfiguration("explorerDates"),i=t||r.get("displayFormat","smart"),n=new Date-e,a=Math.floor(n/(1e3*60*60*24));switch(i){case"relative-short":return this.getRelativeTimeShort(n);case"relative-long":return this.getRelativeTimeLong(n);case"absolute-short":return e.toLocaleDateString("en-US",{month:"short",day:"numeric"});case"absolute-long":return e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});case"smart":default:return a<7?this.getRelativeTimeShort(n):e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}catch(r){return s.error("Failed to format date:",r),e.toLocaleDateString()}}async getFileStats(e){if(!this.r("getFileStats"))return null;try{let t=c.Uri.file(e),r=await c.workspace.fs.stat(t);return{path:e,size:r.size,created:new Date(r.ctime),modified:new Date(r.mtime),type:r.type===c.FileType.Directory?"directory":"file"}}catch(t){return s.error("Failed to get file stats:",t),null}}getApi(){return this.api}getRegisteredPlugins(){let e=[];for(let[t,r]of this.plugins)e.push({id:t,name:r.name,version:r.version,author:r.author,active:r.active,registeredAt:r.registeredAt});return e}validatePlugin(e){return!(!e||typeof e!="object"||!e.name||!e.version||e.activate&&typeof e.activate!="function"||e.deactivate&&typeof e.deactivate!="function")}validateDecorationProvider(e){return!(!e||typeof e!="object"||typeof e.provideDecoration!="function")}getRelativeTimeShort(e){let t=Math.floor(e/1e3),r=Math.floor(t/60),i=Math.floor(r/60),o=Math.floor(i/24);if(t<60)return`${t}s`;if(r<60)return`${r}m`;if(i<24)return`${i}h`;if(o<30)return`${o}d`;let n=Math.floor(o/30);return n<12?`${n}mo`:`${Math.floor(n/12)}y`}getRelativeTimeLong(e){let t=Math.floor(e/1e3),r=Math.floor(t/60),i=Math.floor(r/60),o=Math.floor(i/24);if(t<60)return`${t} second${t!==1?"s":""} ago`;if(r<60)return`${r} minute${r!==1?"s":""} ago`;if(i<24)return`${i} hour${i!==1?"s":""} ago`;if(o<30)return`${o} day${o!==1?"s":""} ago`;let n=Math.floor(o/30);if(n<12)return`${n} month${n!==1?"s":""} ago`;let a=Math.floor(n/12);return`${a} year${a!==1?"s":""} ago`}getColorForAge(e){if(!c.workspace.getConfiguration("explorerDates").get("colorCoding",!1))return;let o=(new Date-e)/(1e3*60*60);return o<1?new c.ThemeColor("charts.green"):o<24?new c.ThemeColor("charts.yellow"):o<168?new c.ThemeColor("charts.orange"):new c.ThemeColor("charts.red")}createExamplePlugin(){return{name:"File Size Display",version:"1.0.0",author:"Explorer Dates",description:"Adds file size to decorations",activate:e=>{e.registerDecorationProvider("fileSize",{provideDecoration:async(t,r,i)=>{let o=this.formatFileSize(r.size);return{badge:`${i.badge} \u2022 ${o}`,tooltip:`${i.tooltip}
Size: ${o}`}}}),s.info("File Size Display plugin activated")},deactivate:()=>{s.info("File Size Display plugin deactivated")}}}m(){this.t&&this.t.dispose(),this.t=c.workspace.onDidChangeConfiguration(e=>{(e.affectsConfiguration("explorerDates.enableExtensionApi")||e.affectsConfiguration("explorerDates.allowExternalPlugins"))&&s.info("Explorer Dates API configuration changed",{apiEnabled:this.d(),externalPluginsAllowed:this.p()})})}d(){return c.workspace.getConfiguration("explorerDates").get("enableExtensionApi",!0)}p(){return c.workspace.getConfiguration("explorerDates").get("allowExternalPlugins",!0)}r(e){return this.d()?!0:(s.warn(`Explorer Dates API request "${e}" ignored because enableExtensionApi is disabled.`),!1)}a(e){return this.r(e)?this.p()?!0:(s.warn(`Explorer Dates plugin request "${e}" ignored because allowExternalPlugins is disabled.`),!1):!1}formatFileSize(e){if(e===0)return"0 B";let t=1024,r=["B","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(1))+" "+r[i]}dispose(){this.t&&(this.t.dispose(),this.t=null),this.plugins.clear(),this.decorationProviders.clear(),s.info("Extension API Manager disposed")}};p.exports={ExtensionApiManager:h}});var{ExtensionApiManager:g}=L(),{getLogger:w}=f(),P=w();function D(l){try{let e=new g;return l&&l.subscriptions&&l.subscriptions.push(e),e}catch(e){return P.error("Failed to create Extension API Manager:",e),null}}module.exports={ExtensionApiManager:g,createExtensionApiManager:D,default:{ExtensionApiManager:g,createExtensionApiManager:D}};
