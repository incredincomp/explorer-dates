var f=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var y=f((exports,module)=>{var vscode=require("vscode"),isWebRuntime=process.env.VSCODE_WEB==="true",inspectValue=isWebRuntime?i=>{if(typeof i=="string")return i;try{return JSON.stringify(i,null,2)}catch{return"<<unable to serialize log arg>>"}}:eval("require")("util").inspect,DEFAULT_LOG_PROFILE="default",SUPPORTED_PROFILES=new Set(["default","stress","soak"]),LOG_LEVEL_ORDER=["debug","info","warn","error"],DEFAULT_CONSOLE_LEVEL="warn",Logger=class{constructor(){this.i=vscode.window.createOutputChannel("Explorer Dates"),this.y=!1,this.r=null,this.u=(process.env.EXPLORER_DATES_LOG_PROFILE||DEFAULT_LOG_PROFILE).toLowerCase(),SUPPORTED_PROFILES.has(this.u)||(this.u=DEFAULT_LOG_PROFILE),this.p=new Map,this.b=DEFAULT_CONSOLE_LEVEL,this.C(),this.r=vscode.workspace.onDidChangeConfiguration(t=>{(t.affectsConfiguration("explorerDates.enableLogging")||t.affectsConfiguration("explorerDates.consoleLogLevel"))&&this.C()})}C(){let t=vscode.workspace.getConfiguration("explorerDates");this.y=t.get("enableLogging",!1);let e=(t.get("consoleLogLevel",DEFAULT_CONSOLE_LEVEL)||"").toLowerCase();this.b=LOG_LEVEL_ORDER.includes(e)?e:DEFAULT_CONSOLE_LEVEL}setLogProfile(t=DEFAULT_LOG_PROFILE){let e=(t||DEFAULT_LOG_PROFILE).toLowerCase();this.u=SUPPORTED_PROFILES.has(e)?e:DEFAULT_LOG_PROFILE,this.resetThrottle()}resetThrottle(t){if(t){this.p.delete(t);return}this.p.clear()}debug(t,...e){this.y&&this.g("debug",null,t,e)}info(t,...e){this.g("info",null,t,e)}infoWithOptions(t,e,...s){this.g("info",t||null,e,s)}warn(t,...e){this.g("warn",null,t,e)}error(t,e,...s){let r=`[${new Date().toISOString()}] [ERROR] ${t}`;this.i.appendLine(r),e instanceof Error?(this.i.appendLine(`Error: ${e.message}`),e.stack&&this.i.appendLine(`Stack: ${e.stack}`)):e&&this.i.appendLine(this._(e));let o=this.R(s);o.length>0&&o.forEach(h=>this.i.appendLine(this._(h))),this.D("error",r,[e,...o])}show(){this.i.show()}clear(){this.i.clear()}dispose(){this.i.dispose(),this.r&&(this.r.dispose(),this.r=null);let t="__explorerDatesLogger";typeof global<"u"&&global[t]===this?global[t]=null:typeof globalThis<"u"&&globalThis[t]===this?globalThis[t]=null:typeof window<"u"&&window[t]===this&&(window[t]=null),loggerInstance===this&&(loggerInstance=null)}g(t,e,s,n){if(t==="debug"&&!this.y||this.k(t,e))return;let o=`[${new Date().toISOString()}] [${t.toUpperCase()}] ${s}`;this.i.appendLine(o);let h=this.R(n);h.length>0&&h.forEach(p=>this.i.appendLine(this._(p))),this.D(t,o,h)}R(t){return!t||t.length===0?[]:t.map(e=>{if(typeof e!="function")return e;try{return e()}catch(s){return`<<log arg threw: ${s.message}>>`}})}_(t){try{return typeof t=="string"?t:typeof t=="object"?JSON.stringify(t,null,2):inspectValue(t)}catch(e){return`<<failed to serialize log arg: ${e.message}>>`}}k(t,e){if(t!=="info"||!e||!e.throttleKey)return!1;let s=(e.profile||"stress").toLowerCase();if(!this.x(s))return!1;let n=Number(e.throttleLimit)||50,r=e.throttleKey,o=this.p.get(r)||{count:0,suppressed:0,noticeLogged:!1};if(o.count<n)return o.count+=1,this.p.set(r,o),!1;if(o.suppressed+=1,!o.noticeLogged){o.noticeLogged=!0;let h=`[${new Date().toISOString()}] [INFO] \u23F8\uFE0F Suppressing further logs for "${r}" after ${n} entries (profile=${this.u})`;this.i.appendLine(h),this.D("info",h)}return this.p.set(r,o),!0}x(t){let e=this.u||DEFAULT_LOG_PROFILE;return t==="default"?e===DEFAULT_LOG_PROFILE:e===t}M(t){let e=LOG_LEVEL_ORDER.indexOf(this.b),s=LOG_LEVEL_ORDER.indexOf(t);return e===-1||s===-1?!1:s>=e}D(t,e,s=[]){if(!this.M(t))return;(t==="warn"?console.warn:t==="error"?console.error:console.log).call(console,e,...s)}},GLOBAL_LOGGER_KEY="__explorerDatesLogger";function getLogger(){return typeof global<"u"?(global[GLOBAL_LOGGER_KEY]||(global[GLOBAL_LOGGER_KEY]=new Logger),global[GLOBAL_LOGGER_KEY]):typeof globalThis<"u"?(globalThis[GLOBAL_LOGGER_KEY]||(globalThis[GLOBAL_LOGGER_KEY]=new Logger),globalThis[GLOBAL_LOGGER_KEY]):typeof window<"u"?(window[GLOBAL_LOGGER_KEY]||(window[GLOBAL_LOGGER_KEY]=new Logger),window[GLOBAL_LOGGER_KEY]):(loggerInstance||(loggerInstance=new Logger),loggerInstance)}var loggerInstance=null;module.exports={Logger,getLogger}});var O=f((St,D)=>{var _=require("vscode");function tt(){try{return _?.env?.uiKind===_?.UIKind?.Web}catch{return!1}}D.exports={isWebEnvironment:tt}});var A=f((wt,w)=>{function l(i=""){return i?i.replace(/\\/g,"/"):""}function et(i=""){let t=l(i);return t?t.split("/").filter(Boolean):[]}function S(i=""){let t=et(i);return t.length?t[t.length-1]:""}function st(i=""){let t=S(i),e=t.lastIndexOf(".");return e<=0?"":t.substring(e).toLowerCase()}function it(i=""){let t=l(i),e=t.lastIndexOf("/");return e===-1?"":t.substring(0,e)}function nt(...i){return l(i.filter(Boolean).join("/")).replace(/\/+/g,"/")}function rt(i=""){return l(i).toLowerCase()}function ot(i=""){if(!i)return"";if(typeof i=="string")return i;if(typeof i.fsPath=="string"&&i.fsPath.length>0)return i.fsPath;if(typeof i.path=="string"&&i.path.length>0)return i.path;if(typeof i.toString=="function")try{return i.toString(!0)}catch{return i.toString()}return String(i)}function ct(i="",t=""){let e=l(i),s=l(t);return e&&s.startsWith(e)?s.substring(e.length).replace(/^\/+/,""):s}w.exports={normalizePath:l,getFileName:S,getExtension:st,getDirectory:it,joinPath:nt,getCacheKey:rt,getUriPath:ot,getRelativePath:ct}});var b=f((At,T)=>{var E=class extends Error{constructor(t,e,s={}){super(e),this.code=t,this.context=s,this.name="ExtensionError"}},at={FILE_PERMISSION_DENIED:"FILE_PERMISSION_DENIED",WORKSPACE_TOO_LARGE:"WORKSPACE_TOO_LARGE",CHUNK_LOAD_FAILED:"CHUNK_LOAD_FAILED"};function ht(i){if(!i)return!1;let t=i.code||i?.name;return["EACCES","EPERM","EROFS","NoPermissions"].includes(t)}T.exports={ExtensionError:E,ERROR_CODES:at,isPermissionError:ht}});var F=f((Tt,I)=>{function C(){return typeof performance<"u"&&performance.now&&performance.timeOrigin?Math.floor(performance.timeOrigin+performance.now()):typeof Date=="function"&&Date.now?Date.now():16409952e5}function R(i){return!!(i&&typeof i=="object"&&typeof i.getTime=="function")}function u(i){if(!i||isNaN(i))return"Invalid Date";if(typeof Intl<"u"&&Intl.DateTimeFormat)try{return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(i)}catch{}let t=864e5,e=36e5,s=6e4,n=1e3,r=1970,o=4,h=Math.floor(i/t),p=i%t,B=Math.floor(p/e),W=Math.floor(p%e/s),K=Math.floor(p%s/n),V=r+Math.floor(h/365.25),q=Math.floor(h%365.25/30.44)+1,Y=Math.floor(h%30.44)+1,j=String(Math.min(q,12)).padStart(2,"0"),J=String(Math.min(Y,31)).padStart(2,"0"),X=String(B).padStart(2,"0"),Z=String(W).padStart(2,"0"),Q=String(K).padStart(2,"0");return`${j}/${J}/${V}, ${X}:${Z}:${Q}`}function ft(i){if(R(i))return i;let t=typeof Date=="function"&&Date.prototype&&Date.prototype.constructor===Date;if(i==null){if(!t){let e=C();return{getTime:()=>e,toLocaleString:()=>u(e),toString:()=>u(e)}}return new Date}if(typeof i=="number")return t?new Date(i):{getTime:()=>i,toLocaleString:()=>u(i),toString:()=>u(i)};if(typeof i=="string"){let e=0;if(t)e=Date.parse(i);else{let s=parseFloat(i);e=isNaN(s)?0:s}return t?new Date(i):{getTime:()=>e,toLocaleString:()=>u(e),toString:()=>u(e)}}return t?new Date(i):{getTime:()=>0,toLocaleString:()=>"Invalid Date",toString:()=>"Invalid Date"}}I.exports={ensureDate:ft,isDateLike:R,getCurrentTimestamp:C}});var k=f((bt,G)=>{var c=require("vscode"),{isWebEnvironment:lt}=O(),{normalizePath:ut}=A(),{ExtensionError:pt,ERROR_CODES:dt,isPermissionError:Et}=b(),{ensureDate:g}=F(),P=process.env.VSCODE_WEB==="true",gt=process.env.EXPLORER_DATES_FORCE_VSCODE_FS==="1",a=null;if(!P&&!gt)try{a=require("fs").promises}catch{a=null}var d=class{constructor(){this.isWeb=P||lt()}c(t){if(!t)return"";if(typeof t=="string")return t;if(t&&typeof t=="object"&&typeof t.fsPath=="string")return t.fsPath;if(t&&typeof t=="object"&&typeof t.path=="string")return t.path;if(typeof t=="object"){if(typeof t.fsPath=="string")return t.fsPath;if(typeof t.path=="string")return t.path}return String(t)}a(t){if(t&&typeof t=="object"&&typeof t.scheme=="string"&&typeof t.path=="string")return t;if(typeof t=="string")return c.Uri.file(t);if(t&&typeof t=="object"){if(t.uri&&t.uri!==t)try{return this.a(t.uri)}catch{}if(typeof t.fsPath=="string"&&t.fsPath.length>0)return c.Uri.file(t.fsPath);if(typeof t.path=="string"&&t.path.length>0)return c.Uri.file(t.path);if(typeof t.href=="string"&&t.href.length>0)return c.Uri.parse(t.href);if(typeof t.scheme=="string")return c.Uri.from({scheme:t.scheme,authority:t.authority||"",path:t.path||t.fsPath||"",query:t.query||"",fragment:t.fragment||""});if(typeof t.toString=="function")try{let e=t.toString(!0);if(e&&e!=="[object Object]")return c.Uri.parse(e)}catch{let e=t.toString();if(e&&e!=="[object Object]")return c.Uri.parse(e)}}throw new Error(`Unsupported target type: ${typeof t}`)}async stat(t){if(!this.isWeb&&a)return a.stat(this.c(t));let e=this.a(t),s=await c.workspace.fs.stat(e);return{...s,mtime:g(s.mtime),ctime:g(s.ctime),birthtime:g(s.ctime),isFile:()=>s.type===c.FileType.File,isDirectory:()=>s.type===c.FileType.Directory}}async readFile(t,e="utf8"){if(!this.isWeb&&a)return a.readFile(this.c(t),e);let s=this.a(t),n=await c.workspace.fs.readFile(s);return e===null||e==="binary"?n:new TextDecoder(e).decode(n)}async writeFile(t,e,s="utf8"){let n=this.c(t);try{if(!this.isWeb&&a)return a.writeFile(n,e,s);let r=this.a(t),o=typeof e=="string"?new TextEncoder().encode(e):e;await c.workspace.fs.writeFile(r,o)}catch(r){this.I("write file",n,r)}}async mkdir(t,e={recursive:!0}){let s=this.c(t);try{if(!this.isWeb&&a)return a.mkdir(s,e);let n=this.a(t);await c.workspace.fs.createDirectory(n)}catch(n){this.I("create directory",s,n)}}async readdir(t,e={withFileTypes:!1}){if(!this.isWeb&&a)return a.readdir(this.c(t),e);let s=this.a(t),n=await c.workspace.fs.readDirectory(s);return e.withFileTypes?n.map(([r,o])=>({name:r,isDirectory:()=>o===c.FileType.Directory,isFile:()=>o===c.FileType.File})):n.map(([r])=>r)}async delete(t,e={recursive:!1}){if(!this.isWeb&&a){let n=this.c(t);return e.recursive?a.rm?a.rm(n,e):a.rmdir(n,e):a.unlink(n)}let s=this.a(t);await c.workspace.fs.delete(s,e)}async exists(t){try{return await this.stat(t),!0}catch{return!1}}async ensureDirectory(t){let e=ut(this.c(t));await this.mkdir(e,{recursive:!0})}I(t,e,s){throw Et(s)?new pt(dt.FILE_PERMISSION_DENIED,`Permission denied while attempting to ${t}`,{path:e,code:s.code}):s}},Lt=new d;G.exports={FileSystemAdapter:d,fileSystem:Lt}});var M=f((Ct,x)=>{var mt=["Ja","Fe","Mr","Ap","My","Jn","Jl","Au","Se","Oc","No","De"],yt={ADVANCED_CACHE:"explorerDates.advancedCache",ADVANCED_CACHE_METADATA:"explorerDates.advancedCacheMetadata",TEMPLATE_STORE:"explorerDates.templates",WEB_GIT_NOTICE:"explorerDates.webGitNotice"};x.exports={DEFAULT_CACHE_TIMEOUT:12e4,DEFAULT_MAX_CACHE_SIZE:1e4,DEFAULT_PERSISTENT_CACHE_TTL:864e5,MAX_BADGE_LENGTH:2,MONTH_ABBREVIATIONS:mt,GLOBAL_STATE_KEYS:yt}});var H=f((Rt,$)=>{var U=require("vscode"),{getLogger:_t}=y(),{fileSystem:Dt}=k(),{GLOBAL_STATE_KEYS:N,DEFAULT_PERSISTENT_CACHE_TTL:v}=M(),L=class{constructor(t){this.t=_t(),this.X=t,this.s=new Map,this.L=50*1024*1024,this.h=0,this.o=!0,this.n=t?.globalState||null,this.O=N.ADVANCED_CACHE,this.Z=N.ADVANCED_CACHE_METADATA,this.U=Dt,this.r=null,this.e={memoryHits:0,memoryMisses:0,diskHits:0,diskMisses:0,evictions:0,persistentLoads:0,persistentSaves:0},this.S=null,this.w=null,this.f=!1,this.d=!1,this.t.info("AdvancedCache initialized")}async initialize(){try{await this.F(),this.o&&await this.N(),this.$(),this.t.info("Advanced cache system initialized",{persistentEnabled:this.o&&!!this.n,maxMemoryUsage:this.L,storage:this.n?"globalState":"memory-only"})}catch(t){this.t.error("Failed to initialize cache system",t)}}async F(){let t=U.workspace.getConfiguration("explorerDates");this.o=t.get("persistentCache",!0),this.L=t.get("maxMemoryUsage",50)*1024*1024,this.H()}H(){this.r||(this.r=U.workspace.onDidChangeConfiguration(t=>{(t.affectsConfiguration("explorerDates.persistentCache")||t.affectsConfiguration("explorerDates.maxMemoryUsage"))&&this.F()}))}P(t,e={}){let s=Date.now();return{value:t,size:e.size??this.z(t),ttl:e.ttl??v,tags:e.tags&&e.tags.length>0?[...e.tags]:void 0,version:e.version??1,timestamp:e.timestamp??s,lastAccess:e.lastAccess??s}}B(t){t.lastAccess=Date.now()}W(t){return{ts:t.timestamp,la:t.lastAccess,ttl:t.ttl,sz:t.size,tg:t.tags,v:t.version}}K(t){return t?{timestamp:t.timestamp??t.ts??Date.now(),lastAccess:t.lastAccess??t.la??Date.now(),ttl:t.ttl??t.tt??v,size:t.size??t.sz,tags:t.tags??t.tg,version:t.version??t.v??1}:null}G(t){if(!t)return null;let e=this.K(t.metadata||t.meta);return e?this.P(t.data??t.value,e):null}V(t){return{data:t.value,metadata:this.W(t)}}async get(t){let e=this.s.get(t);if(e){if(this.E(e))return this.e.memoryHits++,this.B(e),e.value;this.l(t)}if(this.e.memoryMisses++,this.o){let s=await this.q(t);if(s)return this.A(t,s,{skipDirtyFlag:!0}),this.e.diskHits++,s.value}return this.e.diskMisses++,null}async set(t,e,s={}){let n=this.P(e,{ttl:s.ttl,tags:s.tags,version:s.version});this.A(t,n),this.o&&this.Y()}A(t,e,s={}){let{skipDirtyFlag:n=!1}=s;this.h+e.size>this.L&&this.j(e.size),this.s.has(t)&&this.l(t),this.s.set(t,e),this.h+=e.size,n||(this.f=!0,this.d=!1),this.t.debug(`Added to cache: ${t} (${e.size} bytes)`)}l(t){let e=this.s.get(t);e&&(this.s.delete(t),this.h-=e.size,this.f=!0,this.d=!1)}j(t){let e=Array.from(this.s.entries());e.sort((n,r)=>n[1].lastAccess-r[1].lastAccess);let s=0;for(let[n,r]of e)if(this.l(n),s+=r.size,this.e.evictions++,s>=t)break;this.t.debug(`Evicted items to free ${s} bytes`)}E(t){return t?Date.now()-t.timestamp<t.ttl:!1}z(t){switch(typeof t){case"string":return t.length*2;case"number":return 8;case"boolean":return 4;case"object":return t===null?4:JSON.stringify(t).length*2;default:return 100}}async N(){if(!this.n){let t=this.U.isWeb?"web":"desktop";this.t.debug(`Persistent storage unavailable in ${t} environment - running in memory-only mode`);return}try{let t=this.n.get(this.O,{}),e=0,s=0;for(let[n,r]of Object.entries(t)){let o=this.G(r);if(o&&this.E(o)){this.A(n,o,{skipDirtyFlag:!0}),e++;continue}s++}this.f=!1,this.e.persistentLoads++,this.t.info(`Loaded persistent cache: ${e} items (${s} expired)`)}catch(t){this.t.error("Failed to load persistent cache from globalState",t)}}async T(){if(!(!this.o||!this.n)){if(this.d){this.t.debug("Skipping persistent cache save (runtime reset requested)"),this.d=!1;return}if(!this.f){this.t.debug("Persistent cache unchanged - skipping save");return}try{let t={};for(let[e,s]of this.s.entries())this.E(s)&&(t[e]=this.V(s));await this.n.update(this.O,t),this.e.persistentSaves++,this.f=!1,this.t.debug(`Saved persistent cache: ${Object.keys(t).length} items`)}catch(t){this.t.error("Failed to save persistent cache to globalState",t)}}}async q(t){if(!this.n)return null;let s=this.n.get(this.O,{})[t],n=this.G(s);return n&&this.E(n)?n:null}Y(){this.n&&(this.m&&clearTimeout(this.m),this.m=setTimeout(()=>{this.T()},5e3))}$(){this.S=setInterval(()=>{this.J()},300*1e3),this.n&&this.o&&(this.w=setInterval(()=>{this.T()},600*1e3))}J(){let t=[];for(let[e,s]of this.s.entries())this.E(s)||t.push(e);for(let e of t)this.l(e);t.length>0&&this.t.debug(`Cleaned up ${t.length} expired cache items`)}invalidateByTags(t){let e=[];for(let[s,n]of this.s.entries())n.tags&&n.tags.some(r=>t.includes(r))&&e.push(s);for(let s of e)this.l(s);this.t.debug(`Invalidated ${e.length} items by tags:`,t)}invalidateByPattern(t){let e=[],s=new RegExp(t);for(let n of this.s.keys())s.test(n)&&e.push(n);for(let n of e)this.l(n);this.t.debug(`Invalidated ${e.length} items by pattern: ${t}`)}clear(){this.s.clear(),this.h=0,this.f=!0,this.t.info("Cache cleared")}resetRuntimeOnly(){this.s.clear(),this.h=0,this.f=!1,this.d=!0,this.t.info("Runtime cache cleared (persistent snapshot preserved)")}getStats(){let t=this.e.memoryHits+this.e.memoryMisses>0?(this.e.memoryHits/(this.e.memoryHits+this.e.memoryMisses)*100).toFixed(2):"0",e=this.e.diskHits+this.e.diskMisses>0?(this.e.diskHits/(this.e.diskHits+this.e.diskMisses)*100).toFixed(2):"0";return{...this.e,memoryItems:this.s.size,memoryUsage:this.h,memoryUsagePercent:(this.h/this.L*100).toFixed(2),memoryHitRate:`${t}%`,diskHitRate:`${e}%`,persistentEnabled:this.o}}async dispose(){this.S&&clearInterval(this.S),this.w&&clearInterval(this.w),this.m&&clearTimeout(this.m),this.o&&this.n&&await this.T(),this.clear(),this.r&&(this.r.dispose(),this.r=null),this.t.info("Advanced cache disposed",this.getStats())}};$.exports={AdvancedCache:L}});var{AdvancedCache:m}=H();function z(i){return new m(i)}module.exports={AdvancedCache:m,createAdvancedCache:z,default:{AdvancedCache:m,createAdvancedCache:z}};
